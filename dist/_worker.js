var lm=Object.defineProperty;var Mi=e=>{throw TypeError(e)};var um=(e,t,r)=>t in e?lm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var q=(e,t,r)=>um(e,typeof t!="symbol"?t+"":t,r),Jo=(e,t,r)=>t.has(e)||Mi("Cannot "+r);var E=(e,t,r)=>(Jo(e,t,"read from private field"),r?r.call(e):t.get(e)),ee=(e,t,r)=>t.has(e)?Mi("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),W=(e,t,r,n)=>(Jo(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),de=(e,t,r)=>(Jo(e,t,"access private method"),r);var Oi=(e,t,r,n)=>({set _(a){W(e,t,a,r)},get _(){return E(e,t,n)}});var tc={Stringify:1},Et=(e,t)=>{const r=new String(e);return r.isEscaped=!0,r.callbacks=t,r},cm=/[&<>'"]/,rc=async(e,t)=>{let r="";t||(t=[]);const n=await Promise.all(e);for(let a=n.length-1;r+=n[a],a--,!(a<0);a--){let o=n[a];typeof o=="object"&&t.push(...o.callbacks||[]);const s=o.isEscaped;if(o=await(typeof o=="object"?o.toString():o),typeof o=="object"&&t.push(...o.callbacks||[]),o.isEscaped??s)r+=o;else{const i=[r];wr(o,i),r=i[0]}}return Et(r,t)},wr=(e,t)=>{const r=e.search(cm);if(r===-1){t[0]+=e;return}let n,a,o=0;for(a=r;a<e.length;a++){switch(e.charCodeAt(a)){case 34:n="&quot;";break;case 39:n="&#39;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}t[0]+=e.substring(o,a)+n,o=a+1}t[0]+=e.substring(o,a)},nc=e=>{const t=e.callbacks;if(!(t!=null&&t.length))return e;const r=[e],n={};return t.forEach(a=>a({phase:tc.Stringify,buffer:r,context:n})),r[0]},ac=async(e,t,r,n,a)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const o=e.callbacks;return o!=null&&o.length?(a?a[0]+=e:a=[e],Promise.all(o.map(i=>i({phase:t,buffer:a,context:n}))).then(i=>Promise.all(i.filter(Boolean).map(l=>ac(l,t,!1,n,a))).then(()=>a[0]))):Promise.resolve(e)},dm=(e,...t)=>{const r=[""];for(let n=0,a=e.length-1;n<a;n++){r[0]+=e[n];const o=Array.isArray(t[n])?t[n].flat(1/0):[t[n]];for(let s=0,i=o.length;s<i;s++){const l=o[s];if(typeof l=="string")wr(l,r);else if(typeof l=="number")r[0]+=l;else{if(typeof l=="boolean"||l===null||l===void 0)continue;if(typeof l=="object"&&l.isEscaped)if(l.callbacks)r.unshift("",l);else{const u=l.toString();u instanceof Promise?r.unshift("",u):r[0]+=u}else l instanceof Promise?r.unshift("",l):wr(l.toString(),r)}}}return r[0]+=e.at(-1),r.length===1?"callbacks"in r?Et(nc(Et(r[0],r.callbacks))):Et(r[0]):rc(r,r.callbacks)},Ds=Symbol("RENDERER"),gs=Symbol("ERROR_HANDLER"),Ae=Symbol("STASH"),oc=Symbol("INTERNAL"),pm=Symbol("MEMO"),to=Symbol("PERMALINK"),ki=e=>(e[oc]=!0,e),sc=e=>({value:t,children:r})=>{if(!r)return;const n={children:[{tag:ki(()=>{e.push(t)}),props:{}}]};Array.isArray(r)?n.children.push(...r.flat()):n.children.push(r),n.children.push({tag:ki(()=>{e.pop()}),props:{}});const a={tag:"",props:n,type:""};return a[gs]=o=>{throw e.pop(),o},a},ic=e=>{const t=[e],r=sc(t);return r.values=t,r.Provider=r,Sn.push(r),r},Sn=[],js=e=>{const t=[e],r=(n=>{t.push(n.value);let a;try{a=n.children?(Array.isArray(n.children)?new dc("",{},n.children):n.children).toString():""}finally{t.pop()}return a instanceof Promise?a.then(o=>Et(o,o.callbacks)):Et(a)});return r.values=t,r.Provider=r,r[Ds]=sc(t),Sn.push(r),r},$n=e=>e.values.at(-1),qa={title:[],script:["src"],style:["data-href"],link:["href"],meta:["name","httpEquiv","charset","itemProp"]},vs={},Fa="data-precedence",ya=e=>Array.isArray(e)?e:[e],Ci=new WeakMap,Ai=(e,t,r,n)=>({buffer:a,context:o})=>{if(!a)return;const s=Ci.get(o)||{};Ci.set(o,s);const i=s[e]||(s[e]=[]);let l=!1;const u=qa[e];if(u.length>0){e:for(const[,c]of i)for(const p of u)if(((c==null?void 0:c[p])??null)===(r==null?void 0:r[p])){l=!0;break e}}if(l?a[0]=a[0].replaceAll(t,""):u.length>0?i.push([t,r,n]):i.unshift([t,r,n]),a[0].indexOf("</head>")!==-1){let c;if(n===void 0)c=i.map(([p])=>p);else{const p=[];c=i.map(([d,,f])=>{let m=p.indexOf(f);return m===-1&&(p.push(f),m=p.length-1),[d,m]}).sort((d,f)=>d[1]-f[1]).map(([d])=>d)}c.forEach(p=>{a[0]=a[0].replaceAll(p,"")}),a[0]=a[0].replace(/(?=<\/head>)/,c.join(""))}},wa=(e,t,r)=>Et(new zt(e,r,ya(t??[])).toString()),ba=(e,t,r,n)=>{if("itemProp"in r)return wa(e,t,r);let{precedence:a,blocking:o,...s}=r;a=n?a??"":void 0,n&&(s[Fa]=a);const i=new zt(e,s,ya(t||[])).toString();return i instanceof Promise?i.then(l=>Et(i,[...l.callbacks||[],Ai(e,l,s,a)])):Et(i,[Ai(e,i,s,a)])},fm=({children:e,...t})=>{const r=zs();if(r){const n=$n(r);if(n==="svg"||n==="head")return new zt("title",t,ya(e??[]))}return ba("title",e,t,!1)},hm=({children:e,...t})=>{const r=zs();return["src","async"].some(n=>!t[n])||r&&$n(r)==="head"?wa("script",e,t):ba("script",e,t,!1)},mm=({children:e,...t})=>["href","precedence"].every(r=>r in t)?(t["data-href"]=t.href,delete t.href,ba("style",e,t,!0)):wa("style",e,t),gm=({children:e,...t})=>["onLoad","onError"].some(r=>r in t)||t.rel==="stylesheet"&&(!("precedence"in t)||"disabled"in t)?wa("link",e,t):ba("link",e,t,"precedence"in t),vm=({children:e,...t})=>{const r=zs();return r&&$n(r)==="head"?wa("meta",e,t):ba("meta",e,t,!1)},lc=(e,{children:t,...r})=>new zt(e,r,ya(t??[])),ym=e=>(typeof e.action=="function"&&(e.action=to in e.action?e.action[to]:void 0),lc("form",e)),uc=(e,t)=>(typeof t.formAction=="function"&&(t.formAction=to in t.formAction?t.formAction[to]:void 0),lc(e,t)),wm=e=>uc("input",e),bm=e=>uc("button",e);const Ho=Object.freeze(Object.defineProperty({__proto__:null,button:bm,form:ym,input:wm,link:gm,meta:vm,script:hm,style:mm,title:fm},Symbol.toStringTag,{value:"Module"}));var _m=new Map([["className","class"],["htmlFor","for"],["crossOrigin","crossorigin"],["httpEquiv","http-equiv"],["itemProp","itemprop"],["fetchPriority","fetchpriority"],["noModule","nomodule"],["formAction","formaction"]]),ro=e=>_m.get(e)||e,cc=(e,t)=>{for(const[r,n]of Object.entries(e)){const a=r[0]==="-"||!/[A-Z]/.test(r)?r:r.replace(/[A-Z]/g,o=>`-${o.toLowerCase()}`);t(a,n==null?null:typeof n=="number"?a.match(/^(?:a|border-im|column(?:-c|s)|flex(?:$|-[^b])|grid-(?:ar|[^a])|font-w|li|or|sca|st|ta|wido|z)|ty$/)?`${n}`:`${n}px`:n)}},ea=void 0,zs=()=>ea,Im=e=>/[A-Z]/.test(e)&&e.match(/^(?:al|basel|clip(?:Path|Rule)$|co|do|fill|fl|fo|gl|let|lig|i|marker[EMS]|o|pai|pointe|sh|st[or]|text[^L]|tr|u|ve|w)/)?e.replace(/([A-Z])/g,"-$1").toLowerCase():e,Tm=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],Sm=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","download","formnovalidate","hidden","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Us=(e,t)=>{for(let r=0,n=e.length;r<n;r++){const a=e[r];if(typeof a=="string")wr(a,t);else{if(typeof a=="boolean"||a===null||a===void 0)continue;a instanceof zt?a.toStringToBuffer(t):typeof a=="number"||a.isEscaped?t[0]+=a:a instanceof Promise?t.unshift("",a):Us(a,t)}}},zt=class{constructor(e,t,r){q(this,"tag");q(this,"props");q(this,"key");q(this,"children");q(this,"isEscaped",!0);q(this,"localContexts");this.tag=e,this.props=t,this.children=r}get type(){return this.tag}get ref(){return this.props.ref||null}toString(){var t,r;const e=[""];(t=this.localContexts)==null||t.forEach(([n,a])=>{n.values.push(a)});try{this.toStringToBuffer(e)}finally{(r=this.localContexts)==null||r.forEach(([n])=>{n.values.pop()})}return e.length===1?"callbacks"in e?nc(Et(e[0],e.callbacks)).toString():e[0]:rc(e,e.callbacks)}toStringToBuffer(e){const t=this.tag,r=this.props;let{children:n}=this;e[0]+=`<${t}`;const a=ea&&$n(ea)==="svg"?o=>Im(ro(o)):o=>ro(o);for(let[o,s]of Object.entries(r))if(o=a(o),o!=="children"){if(o==="style"&&typeof s=="object"){let i="";cc(s,(l,u)=>{u!=null&&(i+=`${i?";":""}${l}:${u}`)}),e[0]+=' style="',wr(i,e),e[0]+='"'}else if(typeof s=="string")e[0]+=` ${o}="`,wr(s,e),e[0]+='"';else if(s!=null)if(typeof s=="number"||s.isEscaped)e[0]+=` ${o}="${s}"`;else if(typeof s=="boolean"&&Sm.includes(o))s&&(e[0]+=` ${o}=""`);else if(o==="dangerouslySetInnerHTML"){if(n.length>0)throw new Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");n=[Et(s.__html)]}else if(s instanceof Promise)e[0]+=` ${o}="`,e.unshift('"',s);else if(typeof s=="function"){if(!o.startsWith("on")&&o!=="ref")throw new Error(`Invalid prop '${o}' of type 'function' supplied to '${t}'.`)}else e[0]+=` ${o}="`,wr(s.toString(),e),e[0]+='"'}if(Tm.includes(t)&&n.length===0){e[0]+="/>";return}e[0]+=">",Us(n,e),e[0]+=`</${t}>`}},Wo=class extends zt{toStringToBuffer(e){const{children:t}=this,r={...this.props};t.length&&(r.children=t.length===1?t[0]:t);const n=this.tag.call(null,r);if(!(typeof n=="boolean"||n==null))if(n instanceof Promise)if(Sn.length===0)e.unshift("",n);else{const a=Sn.map(o=>[o,o.values.at(-1)]);e.unshift("",n.then(o=>(o instanceof zt&&(o.localContexts=a),o)))}else n instanceof zt?n.toStringToBuffer(e):typeof n=="number"||n.isEscaped?(e[0]+=n,n.callbacks&&(e.callbacks||(e.callbacks=[]),e.callbacks.push(...n.callbacks))):wr(n,e)}},dc=class extends zt{toStringToBuffer(e){Us(this.children,e)}},Ni=(e,t,...r)=>{t??(t={}),r.length&&(t.children=r.length===1?r[0]:r);const n=t.key;delete t.key;const a=La(e,t,r);return a.key=n,a},Pi=!1,La=(e,t,r)=>{if(!Pi){for(const n in vs)Ho[n][Ds]=vs[n];Pi=!0}return typeof e=="function"?new Wo(e,t,r):Ho[e]?new Wo(Ho[e],t,r):e==="svg"||e==="head"?(ea||(ea=js("")),new zt(e,t,[new Wo(ea,{value:e},r)])):new zt(e,t,r)},Em=({children:e})=>new dc("",{children:e},Array.isArray(e)?e:e?[e]:[]);function U(e,t,r){let n;if(!t||!("children"in t))n=La(e,t,[]);else{const a=t.children;n=Array.isArray(a)?La(e,t,a):La(e,t,[a])}return n.key=r,n}var $i=(e,t,r)=>(n,a)=>{let o=-1;return s(0);async function s(i){if(i<=o)throw new Error("next() called multiple times");o=i;let l,u=!1,c;if(e[i]?(c=e[i][0][0],n.req.routeIndex=i):c=i===e.length&&a||void 0,c)try{l=await c(n,()=>s(i+1))}catch(p){if(p instanceof Error&&t)n.error=p,l=await t(p,n),u=!0;else throw p}else n.finalized===!1&&r&&(l=await r(n));return l&&(n.finalized===!1||u)&&(n.res=l),n}},xm=Symbol(),Rm=async(e,t=Object.create(null))=>{const{all:r=!1,dot:n=!1}=t,o=(e instanceof vc?e.raw.headers:e.headers).get("Content-Type");return o!=null&&o.startsWith("multipart/form-data")||o!=null&&o.startsWith("application/x-www-form-urlencoded")?Mm(e,{all:r,dot:n}):{}};async function Mm(e,t){const r=await e.formData();return r?Om(r,t):{}}function Om(e,t){const r=Object.create(null);return e.forEach((n,a)=>{t.all||a.endsWith("[]")?km(r,a,n):r[a]=n}),t.dot&&Object.entries(r).forEach(([n,a])=>{n.includes(".")&&(Cm(r,n,a),delete r[n])}),r}var km=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:t.endsWith("[]")?e[t]=[r]:e[t]=r},Cm=(e,t,r)=>{let n=e;const a=t.split(".");a.forEach((o,s)=>{s===a.length-1?n[o]=r:((!n[o]||typeof n[o]!="object"||Array.isArray(n[o])||n[o]instanceof File)&&(n[o]=Object.create(null)),n=n[o])})},pc=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},Am=e=>{const{groups:t,path:r}=Nm(e),n=pc(r);return Pm(n,t)},Nm=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,n)=>{const a=`@${n}`;return t.push([a,r]),a}),{groups:t,path:e}},Pm=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[n]=t[r];for(let a=e.length-1;a>=0;a--)if(e[a].includes(n)){e[a]=e[a].replace(n,t[r][1]);break}}return e},$a={},$m=(e,t)=>{if(e==="*")return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const n=`${e}#${t}`;return $a[n]||(r[2]?$a[n]=t&&t[0]!==":"&&t[0]!=="*"?[n,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:$a[n]=[e,r[1],!0]),$a[n]}return null},Zs=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},Dm=e=>Zs(e,decodeURI),fc=e=>{const t=e.url,r=t.indexOf("/",t.indexOf(":")+4);let n=r;for(;n<t.length;n++){const a=t.charCodeAt(n);if(a===37){const o=t.indexOf("?",n),s=t.slice(r,o===-1?void 0:o);return Dm(s.includes("%25")?s.replace(/%25/g,"%2525"):s)}else if(a===63)break}return t.slice(r,n)},jm=e=>{const t=fc(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},dn=(e,t,...r)=>(r.length&&(t=dn(t,...r)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),hc=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),r=[];let n="";return t.forEach(a=>{if(a!==""&&!/\:/.test(a))n+="/"+a;else if(/\:/.test(a))if(/\?/.test(a)){r.length===0&&n===""?r.push("/"):r.push(n);const o=a.replace("?","");n+="/"+o,r.push(n)}else n+="/"+a}),r.filter((a,o,s)=>s.indexOf(a)===o)},Yo=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?Zs(e,gc):e):e,mc=(e,t,r)=>{let n;if(!r&&t&&!/[%+]/.test(t)){let s=e.indexOf("?",8);if(s===-1)return;for(e.startsWith(t,s+1)||(s=e.indexOf(`&${t}`,s+1));s!==-1;){const i=e.charCodeAt(s+t.length+1);if(i===61){const l=s+t.length+2,u=e.indexOf("&",l);return Yo(e.slice(l,u===-1?void 0:u))}else if(i==38||isNaN(i))return"";s=e.indexOf(`&${t}`,s+1)}if(n=/[%+]/.test(e),!n)return}const a={};n??(n=/[%+]/.test(e));let o=e.indexOf("?",8);for(;o!==-1;){const s=e.indexOf("&",o+1);let i=e.indexOf("=",o);i>s&&s!==-1&&(i=-1);let l=e.slice(o+1,i===-1?s===-1?void 0:s:i);if(n&&(l=Yo(l)),o=s,l==="")continue;let u;i===-1?u="":(u=e.slice(i+1,s===-1?void 0:s),n&&(u=Yo(u))),r?(a[l]&&Array.isArray(a[l])||(a[l]=[]),a[l].push(u)):a[l]??(a[l]=u)}return t?a[t]:a},zm=mc,Um=(e,t)=>mc(e,t,!0),gc=decodeURIComponent,Di=e=>Zs(e,gc),vn,Tt,sr,yc,wc,ys,pr,Wu,vc=(Wu=class{constructor(e,t="/",r=[[]]){ee(this,sr);q(this,"raw");ee(this,vn);ee(this,Tt);q(this,"routeIndex",0);q(this,"path");q(this,"bodyCache",{});ee(this,pr,e=>{const{bodyCache:t,raw:r}=this,n=t[e];if(n)return n;const a=Object.keys(t)[0];return a?t[a].then(o=>(a==="json"&&(o=JSON.stringify(o)),new Response(o)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,W(this,Tt,r),W(this,vn,{})}param(e){return e?de(this,sr,yc).call(this,e):de(this,sr,wc).call(this)}query(e){return zm(this.url,e)}queries(e){return Um(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((r,n)=>{t[n]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await Rm(this,e))}json(){return E(this,pr).call(this,"text").then(e=>JSON.parse(e))}text(){return E(this,pr).call(this,"text")}arrayBuffer(){return E(this,pr).call(this,"arrayBuffer")}blob(){return E(this,pr).call(this,"blob")}formData(){return E(this,pr).call(this,"formData")}addValidatedData(e,t){E(this,vn)[e]=t}valid(e){return E(this,vn)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[xm](){return E(this,Tt)}get matchedRoutes(){return E(this,Tt)[0].map(([[,e]])=>e)}get routePath(){return E(this,Tt)[0].map(([[,e]])=>e)[this.routeIndex].path}},vn=new WeakMap,Tt=new WeakMap,sr=new WeakSet,yc=function(e){const t=E(this,Tt)[0][this.routeIndex][1][e],r=de(this,sr,ys).call(this,t);return r&&/\%/.test(r)?Di(r):r},wc=function(){const e={},t=Object.keys(E(this,Tt)[0][this.routeIndex][1]);for(const r of t){const n=de(this,sr,ys).call(this,E(this,Tt)[0][this.routeIndex][1][r]);n!==void 0&&(e[r]=/\%/.test(n)?Di(n):n)}return e},ys=function(e){return E(this,Tt)[1]?E(this,Tt)[1][e]:e},pr=new WeakMap,Wu),Zm="text/plain; charset=UTF-8",Ko=(e,t)=>({"Content-Type":e,...t}),pa,fa,er,yn,tr,it,ha,wn,bn,zr,ma,ga,fr,pn,Yu,qm=(Yu=class{constructor(e,t){ee(this,fr);ee(this,pa);ee(this,fa);q(this,"env",{});ee(this,er);q(this,"finalized",!1);q(this,"error");ee(this,yn);ee(this,tr);ee(this,it);ee(this,ha);ee(this,wn);ee(this,bn);ee(this,zr);ee(this,ma);ee(this,ga);q(this,"render",(...e)=>(E(this,wn)??W(this,wn,t=>this.html(t)),E(this,wn).call(this,...e)));q(this,"setLayout",e=>W(this,ha,e));q(this,"getLayout",()=>E(this,ha));q(this,"setRenderer",e=>{W(this,wn,e)});q(this,"header",(e,t,r)=>{this.finalized&&W(this,it,new Response(E(this,it).body,E(this,it)));const n=E(this,it)?E(this,it).headers:E(this,zr)??W(this,zr,new Headers);t===void 0?n.delete(e):r!=null&&r.append?n.append(e,t):n.set(e,t)});q(this,"status",e=>{W(this,yn,e)});q(this,"set",(e,t)=>{E(this,er)??W(this,er,new Map),E(this,er).set(e,t)});q(this,"get",e=>E(this,er)?E(this,er).get(e):void 0);q(this,"newResponse",(...e)=>de(this,fr,pn).call(this,...e));q(this,"body",(e,t,r)=>de(this,fr,pn).call(this,e,t,r));q(this,"text",(e,t,r)=>!E(this,zr)&&!E(this,yn)&&!t&&!r&&!this.finalized?new Response(e):de(this,fr,pn).call(this,e,t,Ko(Zm,r)));q(this,"json",(e,t,r)=>de(this,fr,pn).call(this,JSON.stringify(e),t,Ko("application/json",r)));q(this,"html",(e,t,r)=>{const n=a=>de(this,fr,pn).call(this,a,t,Ko("text/html; charset=UTF-8",r));return typeof e=="object"?ac(e,tc.Stringify,!1,{}).then(n):n(e)});q(this,"redirect",(e,t)=>{const r=String(e);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,t??302)});q(this,"notFound",()=>(E(this,bn)??W(this,bn,()=>new Response),E(this,bn).call(this,this)));W(this,pa,e),t&&(W(this,tr,t.executionCtx),this.env=t.env,W(this,bn,t.notFoundHandler),W(this,ga,t.path),W(this,ma,t.matchResult))}get req(){return E(this,fa)??W(this,fa,new vc(E(this,pa),E(this,ga),E(this,ma))),E(this,fa)}get event(){if(E(this,tr)&&"respondWith"in E(this,tr))return E(this,tr);throw Error("This context has no FetchEvent")}get executionCtx(){if(E(this,tr))return E(this,tr);throw Error("This context has no ExecutionContext")}get res(){return E(this,it)||W(this,it,new Response(null,{headers:E(this,zr)??W(this,zr,new Headers)}))}set res(e){if(E(this,it)&&e){e=new Response(e.body,e);for(const[t,r]of E(this,it).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const n=E(this,it).headers.getSetCookie();e.headers.delete("set-cookie");for(const a of n)e.headers.append("set-cookie",a)}else e.headers.set(t,r)}W(this,it,e),this.finalized=!0}get var(){return E(this,er)?Object.fromEntries(E(this,er)):{}}},pa=new WeakMap,fa=new WeakMap,er=new WeakMap,yn=new WeakMap,tr=new WeakMap,it=new WeakMap,ha=new WeakMap,wn=new WeakMap,bn=new WeakMap,zr=new WeakMap,ma=new WeakMap,ga=new WeakMap,fr=new WeakSet,pn=function(e,t,r){const n=E(this,it)?new Headers(E(this,it).headers):E(this,zr)??new Headers;if(typeof t=="object"&&"headers"in t){const o=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(const[s,i]of o)s.toLowerCase()==="set-cookie"?n.append(s,i):n.set(s,i)}if(r)for(const[o,s]of Object.entries(r))if(typeof s=="string")n.set(o,s);else{n.delete(o);for(const i of s)n.append(o,i)}const a=typeof t=="number"?t:(t==null?void 0:t.status)??E(this,yn);return new Response(e,{status:a,headers:n})},Yu),je="ALL",Fm="all",Lm=["get","post","put","delete","options","patch"],bc="Can not add a route since the matcher is already built.",_c=class extends Error{},Vm="__COMPOSED_HANDLER",Gm=e=>e.text("404 Not Found",404),ji=(e,t)=>{if("getResponse"in e){const r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},Pt,ze,Ic,$t,Ar,Va,Ga,_n,Bm=(_n=class{constructor(t={}){ee(this,ze);q(this,"get");q(this,"post");q(this,"put");q(this,"delete");q(this,"options");q(this,"patch");q(this,"all");q(this,"on");q(this,"use");q(this,"router");q(this,"getPath");q(this,"_basePath","/");ee(this,Pt,"/");q(this,"routes",[]);ee(this,$t,Gm);q(this,"errorHandler",ji);q(this,"onError",t=>(this.errorHandler=t,this));q(this,"notFound",t=>(W(this,$t,t),this));q(this,"fetch",(t,...r)=>de(this,ze,Ga).call(this,t,r[1],r[0],t.method));q(this,"request",(t,r,n,a)=>t instanceof Request?this.fetch(r?new Request(t,r):t,n,a):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${dn("/",t)}`,r),n,a)));q(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(de(this,ze,Ga).call(this,t.request,t,void 0,t.request.method))})});[...Lm,Fm].forEach(o=>{this[o]=(s,...i)=>(typeof s=="string"?W(this,Pt,s):de(this,ze,Ar).call(this,o,E(this,Pt),s),i.forEach(l=>{de(this,ze,Ar).call(this,o,E(this,Pt),l)}),this)}),this.on=(o,s,...i)=>{for(const l of[s].flat()){W(this,Pt,l);for(const u of[o].flat())i.map(c=>{de(this,ze,Ar).call(this,u.toUpperCase(),E(this,Pt),c)})}return this},this.use=(o,...s)=>(typeof o=="string"?W(this,Pt,o):(W(this,Pt,"*"),s.unshift(o)),s.forEach(i=>{de(this,ze,Ar).call(this,je,E(this,Pt),i)}),this);const{strict:n,...a}=t;Object.assign(this,a),this.getPath=n??!0?t.getPath??fc:jm}route(t,r){const n=this.basePath(t);return r.routes.map(a=>{var s;let o;r.errorHandler===ji?o=a.handler:(o=async(i,l)=>(await $i([],r.errorHandler)(i,()=>a.handler(i,l))).res,o[Vm]=a.handler),de(s=n,ze,Ar).call(s,a.method,a.path,o)}),this}basePath(t){const r=de(this,ze,Ic).call(this);return r._basePath=dn(this._basePath,t),r}mount(t,r,n){let a,o;n&&(typeof n=="function"?o=n:(o=n.optionHandler,n.replaceRequest===!1?a=l=>l:a=n.replaceRequest));const s=o?l=>{const u=o(l);return Array.isArray(u)?u:[u]}:l=>{let u;try{u=l.executionCtx}catch{}return[l.env,u]};a||(a=(()=>{const l=dn(this._basePath,t),u=l==="/"?0:l.length;return c=>{const p=new URL(c.url);return p.pathname=p.pathname.slice(u)||"/",new Request(p,c)}})());const i=async(l,u)=>{const c=await r(a(l.req.raw),...s(l));if(c)return c;await u()};return de(this,ze,Ar).call(this,je,dn(t,"*"),i),this}},Pt=new WeakMap,ze=new WeakSet,Ic=function(){const t=new _n({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,W(t,$t,E(this,$t)),t.routes=this.routes,t},$t=new WeakMap,Ar=function(t,r,n){t=t.toUpperCase(),r=dn(this._basePath,r);const a={basePath:this._basePath,path:r,method:t,handler:n};this.router.add(t,r,[n,a]),this.routes.push(a)},Va=function(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t},Ga=function(t,r,n,a){if(a==="HEAD")return(async()=>new Response(null,await de(this,ze,Ga).call(this,t,r,n,"GET")))();const o=this.getPath(t,{env:n}),s=this.router.match(a,o),i=new qm(t,{path:o,matchResult:s,env:n,executionCtx:r,notFoundHandler:E(this,$t)});if(s[0].length===1){let u;try{u=s[0][0][0][0](i,async()=>{i.res=await E(this,$t).call(this,i)})}catch(c){return de(this,ze,Va).call(this,c,i)}return u instanceof Promise?u.then(c=>c||(i.finalized?i.res:E(this,$t).call(this,i))).catch(c=>de(this,ze,Va).call(this,c,i)):u??E(this,$t).call(this,i)}const l=$i(s[0],this.errorHandler,E(this,$t));return(async()=>{try{const u=await l(i);if(!u.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return u.res}catch(u){return de(this,ze,Va).call(this,u,i)}})()},_n),Tc=[];function Jm(e,t){const r=this.buildAllMatchers(),n=((a,o)=>{const s=r[a]||r[je],i=s[2][o];if(i)return i;const l=o.match(s[0]);if(!l)return[[],Tc];const u=l.indexOf("",1);return[s[1][u],l]});return this.match=n,n(e,t)}var no="[^/]+",Yn=".*",Kn="(?:|/.*)",fn=Symbol(),Hm=new Set(".\\+*[^]$()");function Wm(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===Yn||e===Kn?1:t===Yn||t===Kn?-1:e===no?1:t===no?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var Ur,Zr,Dt,Vr,Ym=(Vr=class{constructor(){ee(this,Ur);ee(this,Zr);ee(this,Dt,Object.create(null))}insert(t,r,n,a,o){if(t.length===0){if(E(this,Ur)!==void 0)throw fn;if(o)return;W(this,Ur,r);return}const[s,...i]=t,l=s==="*"?i.length===0?["","",Yn]:["","",no]:s==="/*"?["","",Kn]:s.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let u;if(l){const c=l[1];let p=l[2]||no;if(c&&l[2]&&(p===".*"||(p=p.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(p))))throw fn;if(u=E(this,Dt)[p],!u){if(Object.keys(E(this,Dt)).some(d=>d!==Yn&&d!==Kn))throw fn;if(o)return;u=E(this,Dt)[p]=new Vr,c!==""&&W(u,Zr,a.varIndex++)}!o&&c!==""&&n.push([c,E(u,Zr)])}else if(u=E(this,Dt)[s],!u){if(Object.keys(E(this,Dt)).some(c=>c.length>1&&c!==Yn&&c!==Kn))throw fn;if(o)return;u=E(this,Dt)[s]=new Vr}u.insert(i,r,n,a,o)}buildRegExpStr(){const r=Object.keys(E(this,Dt)).sort(Wm).map(n=>{const a=E(this,Dt)[n];return(typeof E(a,Zr)=="number"?`(${n})@${E(a,Zr)}`:Hm.has(n)?`\\${n}`:n)+a.buildRegExpStr()});return typeof E(this,Ur)=="number"&&r.unshift(`#${E(this,Ur)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},Ur=new WeakMap,Zr=new WeakMap,Dt=new WeakMap,Vr),_o,va,Ku,Km=(Ku=class{constructor(){ee(this,_o,{varIndex:0});ee(this,va,new Ym)}insert(e,t,r){const n=[],a=[];for(let s=0;;){let i=!1;if(e=e.replace(/\{[^}]+\}/g,l=>{const u=`@\\${s}`;return a[s]=[u,l],s++,i=!0,u}),!i)break}const o=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let s=a.length-1;s>=0;s--){const[i]=a[s];for(let l=o.length-1;l>=0;l--)if(o[l].indexOf(i)!==-1){o[l]=o[l].replace(i,a[s][1]);break}}return E(this,va).insert(o,t,n,E(this,_o),r),n}buildRegExp(){let e=E(this,va).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],n=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(a,o,s)=>o!==void 0?(r[++t]=Number(o),"$()"):(s!==void 0&&(n[Number(s)]=++t),"")),[new RegExp(`^${e}`),r,n]}},_o=new WeakMap,va=new WeakMap,Ku),Xm=[/^$/,[],Object.create(null)],Ba=Object.create(null);function Sc(e){return Ba[e]??(Ba[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function Qm(){Ba=Object.create(null)}function eg(e){var u;const t=new Km,r=[];if(e.length===0)return Xm;const n=e.map(c=>[!/\*|\/:/.test(c[0]),...c]).sort(([c,p],[d,f])=>c?1:d?-1:p.length-f.length),a=Object.create(null);for(let c=0,p=-1,d=n.length;c<d;c++){const[f,m,h]=n[c];f?a[m]=[h.map(([w])=>[w,Object.create(null)]),Tc]:p++;let g;try{g=t.insert(m,p,f)}catch(w){throw w===fn?new _c(m):w}f||(r[p]=h.map(([w,b])=>{const y=Object.create(null);for(b-=1;b>=0;b--){const[T,x]=g[b];y[T]=x}return[w,y]}))}const[o,s,i]=t.buildRegExp();for(let c=0,p=r.length;c<p;c++)for(let d=0,f=r[c].length;d<f;d++){const m=(u=r[c][d])==null?void 0:u[1];if(!m)continue;const h=Object.keys(m);for(let g=0,w=h.length;g<w;g++)m[h[g]]=i[m[h[g]]]}const l=[];for(const c in s)l[c]=r[s[c]];return[o,l,a]}function un(e,t){if(e){for(const r of Object.keys(e).sort((n,a)=>a.length-n.length))if(Sc(r).test(t))return[...e[r]]}}var hr,mr,Io,Ec,Xu,tg=(Xu=class{constructor(){ee(this,Io);q(this,"name","RegExpRouter");ee(this,hr);ee(this,mr);q(this,"match",Jm);W(this,hr,{[je]:Object.create(null)}),W(this,mr,{[je]:Object.create(null)})}add(e,t,r){var i;const n=E(this,hr),a=E(this,mr);if(!n||!a)throw new Error(bc);n[e]||[n,a].forEach(l=>{l[e]=Object.create(null),Object.keys(l[je]).forEach(u=>{l[e][u]=[...l[je][u]]})}),t==="/*"&&(t="*");const o=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const l=Sc(t);e===je?Object.keys(n).forEach(u=>{var c;(c=n[u])[t]||(c[t]=un(n[u],t)||un(n[je],t)||[])}):(i=n[e])[t]||(i[t]=un(n[e],t)||un(n[je],t)||[]),Object.keys(n).forEach(u=>{(e===je||e===u)&&Object.keys(n[u]).forEach(c=>{l.test(c)&&n[u][c].push([r,o])})}),Object.keys(a).forEach(u=>{(e===je||e===u)&&Object.keys(a[u]).forEach(c=>l.test(c)&&a[u][c].push([r,o]))});return}const s=hc(t)||[t];for(let l=0,u=s.length;l<u;l++){const c=s[l];Object.keys(a).forEach(p=>{var d;(e===je||e===p)&&((d=a[p])[c]||(d[c]=[...un(n[p],c)||un(n[je],c)||[]]),a[p][c].push([r,o-u+l+1]))})}}buildAllMatchers(){const e=Object.create(null);return Object.keys(E(this,mr)).concat(Object.keys(E(this,hr))).forEach(t=>{e[t]||(e[t]=de(this,Io,Ec).call(this,t))}),W(this,hr,W(this,mr,void 0)),Qm(),e}},hr=new WeakMap,mr=new WeakMap,Io=new WeakSet,Ec=function(e){const t=[];let r=e===je;return[E(this,hr),E(this,mr)].forEach(n=>{const a=n[e]?Object.keys(n[e]).map(o=>[o,n[e][o]]):[];a.length!==0?(r||(r=!0),t.push(...a)):e!==je&&t.push(...Object.keys(n[je]).map(o=>[o,n[je][o]]))}),r?eg(t):null},Xu),gr,rr,Qu,rg=(Qu=class{constructor(e){q(this,"name","SmartRouter");ee(this,gr,[]);ee(this,rr,[]);W(this,gr,e.routers)}add(e,t,r){if(!E(this,rr))throw new Error(bc);E(this,rr).push([e,t,r])}match(e,t){if(!E(this,rr))throw new Error("Fatal error");const r=E(this,gr),n=E(this,rr),a=r.length;let o=0,s;for(;o<a;o++){const i=r[o];try{for(let l=0,u=n.length;l<u;l++)i.add(...n[l]);s=i.match(e,t)}catch(l){if(l instanceof _c)continue;throw l}this.match=i.match.bind(i),W(this,gr,[i]),W(this,rr,void 0);break}if(o===a)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,s}get activeRouter(){if(E(this,rr)||E(this,gr).length!==1)throw new Error("No active router has been determined yet.");return E(this,gr)[0]}},gr=new WeakMap,rr=new WeakMap,Qu),Gn=Object.create(null),vr,Qe,qr,In,Je,nr,Nr,Tn,ng=(Tn=class{constructor(t,r,n){ee(this,nr);ee(this,vr);ee(this,Qe);ee(this,qr);ee(this,In,0);ee(this,Je,Gn);if(W(this,Qe,n||Object.create(null)),W(this,vr,[]),t&&r){const a=Object.create(null);a[t]={handler:r,possibleKeys:[],score:0},W(this,vr,[a])}W(this,qr,[])}insert(t,r,n){W(this,In,++Oi(this,In)._);let a=this;const o=Am(r),s=[];for(let i=0,l=o.length;i<l;i++){const u=o[i],c=o[i+1],p=$m(u,c),d=Array.isArray(p)?p[0]:u;if(d in E(a,Qe)){a=E(a,Qe)[d],p&&s.push(p[1]);continue}E(a,Qe)[d]=new Tn,p&&(E(a,qr).push(p),s.push(p[1])),a=E(a,Qe)[d]}return E(a,vr).push({[t]:{handler:n,possibleKeys:s.filter((i,l,u)=>u.indexOf(i)===l),score:E(this,In)}}),a}search(t,r){var l;const n=[];W(this,Je,Gn);let o=[this];const s=pc(r),i=[];for(let u=0,c=s.length;u<c;u++){const p=s[u],d=u===c-1,f=[];for(let m=0,h=o.length;m<h;m++){const g=o[m],w=E(g,Qe)[p];w&&(W(w,Je,E(g,Je)),d?(E(w,Qe)["*"]&&n.push(...de(this,nr,Nr).call(this,E(w,Qe)["*"],t,E(g,Je))),n.push(...de(this,nr,Nr).call(this,w,t,E(g,Je)))):f.push(w));for(let b=0,y=E(g,qr).length;b<y;b++){const T=E(g,qr)[b],x=E(g,Je)===Gn?{}:{...E(g,Je)};if(T==="*"){const M=E(g,Qe)["*"];M&&(n.push(...de(this,nr,Nr).call(this,M,t,E(g,Je))),W(M,Je,x),f.push(M));continue}const[R,I,A]=T;if(!p&&!(A instanceof RegExp))continue;const $=E(g,Qe)[R],N=s.slice(u).join("/");if(A instanceof RegExp){const M=A.exec(N);if(M){if(x[I]=M[0],n.push(...de(this,nr,Nr).call(this,$,t,E(g,Je),x)),Object.keys(E($,Qe)).length){W($,Je,x);const P=((l=M[0].match(/\//))==null?void 0:l.length)??0;(i[P]||(i[P]=[])).push($)}continue}}(A===!0||A.test(p))&&(x[I]=p,d?(n.push(...de(this,nr,Nr).call(this,$,t,x,E(g,Je))),E($,Qe)["*"]&&n.push(...de(this,nr,Nr).call(this,E($,Qe)["*"],t,x,E(g,Je)))):(W($,Je,x),f.push($)))}}o=f.concat(i.shift()??[])}return n.length>1&&n.sort((u,c)=>u.score-c.score),[n.map(({handler:u,params:c})=>[u,c])]}},vr=new WeakMap,Qe=new WeakMap,qr=new WeakMap,In=new WeakMap,Je=new WeakMap,nr=new WeakSet,Nr=function(t,r,n,a){const o=[];for(let s=0,i=E(t,vr).length;s<i;s++){const l=E(t,vr)[s],u=l[r]||l[je],c={};if(u!==void 0&&(u.params=Object.create(null),o.push(u),n!==Gn||a&&a!==Gn))for(let p=0,d=u.possibleKeys.length;p<d;p++){const f=u.possibleKeys[p],m=c[u.score];u.params[f]=a!=null&&a[f]&&!m?a[f]:n[f]??(a==null?void 0:a[f]),c[u.score]=!0}}return o},Tn),Fr,ec,ag=(ec=class{constructor(){q(this,"name","TrieRouter");ee(this,Fr);W(this,Fr,new ng)}add(e,t,r){const n=hc(t);if(n){for(let a=0,o=n.length;a<o;a++)E(this,Fr).insert(e,n[a],r);return}E(this,Fr).insert(e,t,r)}match(e,t){return E(this,Fr).search(e,t)}},Fr=new WeakMap,ec),xc=class extends Bm{constructor(e={}){super(e),this.router=e.router??new rg({routers:[new tg,new ag]})}},og=e=>{const r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},n=(o=>typeof o=="string"?o==="*"?()=>o:s=>o===s?s:null:typeof o=="function"?o:s=>o.includes(s)?s:null)(r.origin),a=(o=>typeof o=="function"?o:Array.isArray(o)?()=>o:()=>[])(r.allowMethods);return async function(s,i){var c;function l(p,d){s.res.headers.set(p,d)}const u=await n(s.req.header("origin")||"",s);if(u&&l("Access-Control-Allow-Origin",u),r.credentials&&l("Access-Control-Allow-Credentials","true"),(c=r.exposeHeaders)!=null&&c.length&&l("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),s.req.method==="OPTIONS"){r.origin!=="*"&&l("Vary","Origin"),r.maxAge!=null&&l("Access-Control-Max-Age",r.maxAge.toString());const p=await a(s.req.header("origin")||"",s);p.length&&l("Access-Control-Allow-Methods",p.join(","));let d=r.allowHeaders;if(!(d!=null&&d.length)){const f=s.req.header("Access-Control-Request-Headers");f&&(d=f.split(/\s*,\s*/))}return d!=null&&d.length&&(l("Access-Control-Allow-Headers",d.join(",")),s.res.headers.append("Vary","Access-Control-Request-Headers")),s.res.headers.delete("Content-Length"),s.res.headers.delete("Content-Type"),new Response(null,{headers:s.res.headers,status:204,statusText:"No Content"})}await i(),r.origin!=="*"&&s.header("Vary","Origin",{append:!0})}},ta="_hp",sg={Change:"Input",DoubleClick:"DblClick"},ig={svg:"2000/svg",math:"1998/Math/MathML"},ra=[],ws=new WeakMap,En=void 0,lg=()=>En,Qt=e=>"t"in e,Xo={onClick:["click",!1]},zi=e=>{if(!e.startsWith("on"))return;if(Xo[e])return Xo[e];const t=e.match(/^on([A-Z][a-zA-Z]+?(?:PointerCapture)?)(Capture)?$/);if(t){const[,r,n]=t;return Xo[e]=[(sg[r]||r).toLowerCase(),!!n]}},Ui=(e,t)=>En&&e instanceof SVGElement&&/[A-Z]/.test(t)&&(t in e.style||t.match(/^(?:o|pai|str|u|ve)/))?t.replace(/([A-Z])/g,"-$1").toLowerCase():t,ug=(e,t,r)=>{var n;t||(t={});for(let a in t){const o=t[a];if(a!=="children"&&(!r||r[a]!==o)){a=ro(a);const s=zi(a);if(s){if((r==null?void 0:r[a])!==o&&(r&&e.removeEventListener(s[0],r[a],s[1]),o!=null)){if(typeof o!="function")throw new Error(`Event handler for "${a}" is not a function`);e.addEventListener(s[0],o,s[1])}}else if(a==="dangerouslySetInnerHTML"&&o)e.innerHTML=o.__html;else if(a==="ref"){let i;typeof o=="function"?i=o(e)||(()=>o(null)):o&&"current"in o&&(o.current=e,i=()=>o.current=null),ws.set(e,i)}else if(a==="style"){const i=e.style;typeof o=="string"?i.cssText=o:(i.cssText="",o!=null&&cc(o,i.setProperty.bind(i)))}else{if(a==="value"){const l=e.nodeName;if(l==="INPUT"||l==="TEXTAREA"||l==="SELECT"){if(e.value=o==null||o===!1?null:o,l==="TEXTAREA"){e.textContent=o;continue}else if(l==="SELECT"){e.selectedIndex===-1&&(e.selectedIndex=0);continue}}}else(a==="checked"&&e.nodeName==="INPUT"||a==="selected"&&e.nodeName==="OPTION")&&(e[a]=o);const i=Ui(e,a);o==null||o===!1?e.removeAttribute(i):o===!0?e.setAttribute(i,""):typeof o=="string"||typeof o=="number"?e.setAttribute(i,o):e.setAttribute(i,o.toString())}}}if(r)for(let a in r){const o=r[a];if(a!=="children"&&!(a in t)){a=ro(a);const s=zi(a);s?e.removeEventListener(s[0],o,s[1]):a==="ref"?(n=ws.get(e))==null||n():e.removeAttribute(Ui(e,a))}}},cg=(e,t)=>{t[Ae][0]=0,ra.push([e,t]);const r=t.tag[Ds]||t.tag,n=r.defaultProps?{...r.defaultProps,...t.props}:t.props;try{return[r.call(null,n)]}finally{ra.pop()}},Rc=(e,t,r,n,a)=>{var o,s;(o=e.vR)!=null&&o.length&&(n.push(...e.vR),delete e.vR),typeof e.tag=="function"&&((s=e[Ae][1][Cc])==null||s.forEach(i=>a.push(i))),e.vC.forEach(i=>{var l;if(Qt(i))r.push(i);else if(typeof i.tag=="function"||i.tag===""){i.c=t;const u=r.length;if(Rc(i,t,r,n,a),i.s){for(let c=u;c<r.length;c++)r[c].s=!0;i.s=!1}}else r.push(i),(l=i.vR)!=null&&l.length&&(n.push(...i.vR),delete i.vR)})},dg=e=>{for(;;e=e.tag===ta||!e.vC||!e.pP?e.nN:e.vC[0]){if(!e)return null;if(e.tag!==ta&&e.e)return e.e}},Mc=e=>{var t,r,n,a,o,s;Qt(e)||((r=(t=e[Ae])==null?void 0:t[1][Cc])==null||r.forEach(i=>{var l;return(l=i[2])==null?void 0:l.call(i)}),(n=ws.get(e.e))==null||n(),e.p===2&&((a=e.vC)==null||a.forEach(i=>i.p=2)),(o=e.vC)==null||o.forEach(Mc)),e.p||((s=e.e)==null||s.remove(),delete e.e),typeof e.tag=="function"&&(Jn.delete(e),Ja.delete(e),delete e[Ae][3],e.a=!0)},Oc=(e,t,r)=>{e.c=t,kc(e,t,r)},Zi=(e,t)=>{if(t){for(let r=0,n=e.length;r<n;r++)if(e[r]===t)return r}},qi=Symbol(),kc=(e,t,r)=>{var u;const n=[],a=[],o=[];Rc(e,t,n,a,o),a.forEach(Mc);const s=r?void 0:t.childNodes;let i,l=null;if(r)i=-1;else if(!s.length)i=0;else{const c=Zi(s,dg(e.nN));c!==void 0?(l=s[c],i=c):i=Zi(s,(u=n.find(p=>p.tag!==ta&&p.e))==null?void 0:u.e)??-1,i===-1&&(r=!0)}for(let c=0,p=n.length;c<p;c++,i++){const d=n[c];let f;if(d.s&&d.e)f=d.e,d.s=!1;else{const m=r||!d.e;Qt(d)?(d.e&&d.d&&(d.e.textContent=d.t),d.d=!1,f=d.e||(d.e=document.createTextNode(d.t))):(f=d.e||(d.e=d.n?document.createElementNS(d.n,d.tag):document.createElement(d.tag)),ug(f,d.props,d.pP),kc(d,f,m))}d.tag===ta?i--:r?f.parentNode||t.appendChild(f):s[i]!==f&&s[i-1]!==f&&(s[i+1]===f?t.appendChild(s[i]):t.insertBefore(f,l||s[i]||null))}if(e.pP&&delete e.pP,o.length){const c=[],p=[];o.forEach(([,d,,f,m])=>{d&&c.push(d),f&&p.push(f),m==null||m()}),c.forEach(d=>d()),p.length&&requestAnimationFrame(()=>{p.forEach(d=>d())})}},pg=(e,t)=>!!(e&&e.length===t.length&&e.every((r,n)=>r[1]===t[n][1])),Ja=new WeakMap,bs=(e,t,r)=>{var o,s,i,l,u,c;const n=!r&&t.pC;r&&(t.pC||(t.pC=t.vC));let a;try{r||(r=typeof t.tag=="function"?cg(e,t):ya(t.props.children)),((o=r[0])==null?void 0:o.tag)===""&&r[0][gs]&&(a=r[0][gs],e[5].push([e,a,t]));const p=n?[...t.pC]:t.vC?[...t.vC]:void 0,d=[];let f;for(let m=0;m<r.length;m++){Array.isArray(r[m])&&r.splice(m,1,...r[m].flat());let h=fg(r[m]);if(h){typeof h.tag=="function"&&!h.tag[oc]&&(Sn.length>0&&(h[Ae][2]=Sn.map(w=>[w,w.values.at(-1)])),(s=e[5])!=null&&s.length&&(h[Ae][3]=e[5].at(-1)));let g;if(p&&p.length){const w=p.findIndex(Qt(h)?b=>Qt(b):h.key!==void 0?b=>b.key===h.key&&b.tag===h.tag:b=>b.tag===h.tag);w!==-1&&(g=p[w],p.splice(w,1))}if(g)if(Qt(h))g.t!==h.t&&(g.t=h.t,g.d=!0),h=g;else{const w=g.pP=g.props;if(g.props=h.props,g.f||(g.f=h.f||t.f),typeof h.tag=="function"){const b=g[Ae][2];g[Ae][2]=h[Ae][2]||[],g[Ae][3]=h[Ae][3],!g.f&&((g.o||g)===h.o||(l=(i=g.tag)[pm])!=null&&l.call(i,w,g.props))&&pg(b,g[Ae][2])&&(g.s=!0)}h=g}else if(!Qt(h)&&En){const w=$n(En);w&&(h.n=w)}if(!Qt(h)&&!h.s&&(bs(e,h),delete h.f),d.push(h),f&&!f.s&&!h.s)for(let w=f;w&&!Qt(w);w=(u=w.vC)==null?void 0:u.at(-1))w.nN=h;f=h}}t.vR=n?[...t.vC,...p||[]]:p||[],t.vC=d,n&&delete t.pC}catch(p){if(t.f=!0,p===qi){if(a)return;throw p}const[d,f,m]=((c=t[Ae])==null?void 0:c[3])||[];if(f){const h=()=>Ha([0,!1,e[2]],m),g=Ja.get(m)||[];g.push(h),Ja.set(m,g);const w=f(p,()=>{const b=Ja.get(m);if(b){const y=b.indexOf(h);if(y!==-1)return b.splice(y,1),h()}});if(w){if(e[0]===1)e[1]=!0;else if(bs(e,m,[w]),(f.length===1||e!==d)&&m.c){Oc(m,m.c,!1);return}throw qi}}throw p}finally{a&&e[5].pop()}},fg=e=>{if(!(e==null||typeof e=="boolean")){if(typeof e=="string"||typeof e=="number")return{t:e.toString(),d:!0};if("vR"in e&&(e={tag:e.tag,props:e.props,key:e.key,f:e.f,type:e.tag,ref:e.props.ref,o:e.o||e}),typeof e.tag=="function")e[Ae]=[0,[]];else{const t=ig[e.tag];t&&(En||(En=ic("")),e.props.children=[{tag:En,props:{value:e.n=`http://www.w3.org/${t}`,children:e.props.children}}])}return e}},Fi=(e,t)=>{var r,n;(r=t[Ae][2])==null||r.forEach(([a,o])=>{a.values.push(o)});try{bs(e,t,void 0)}catch{return}if(t.a){delete t.a;return}(n=t[Ae][2])==null||n.forEach(([a])=>{a.values.pop()}),(e[0]!==1||!e[1])&&Oc(t,t.c,!1)},Jn=new WeakMap,Li=[],Ha=async(e,t)=>{e[5]||(e[5]=[]);const r=Jn.get(t);r&&r[0](void 0);let n;const a=new Promise(o=>n=o);if(Jn.set(t,[n,()=>{e[2]?e[2](e,t,o=>{Fi(o,t)}).then(()=>n(t)):(Fi(e,t),n(t))}]),Li.length)Li.at(-1).add(t);else{await Promise.resolve();const o=Jn.get(t);o&&(Jn.delete(t),o[1]())}return a},hg=(e,t,r)=>({tag:ta,props:{children:e},key:r,e:t,p:1}),Qo=0,Cc=1,es=2,ts=3,rs=new WeakMap,Ac=(e,t)=>!e||!t||e.length!==t.length||t.some((r,n)=>r!==e[n]),mg=void 0,Vi=[],gg=e=>{var s;const t=()=>typeof e=="function"?e():e,r=ra.at(-1);if(!r)return[t(),()=>{}];const[,n]=r,a=(s=n[Ae][1])[Qo]||(s[Qo]=[]),o=n[Ae][0]++;return a[o]||(a[o]=[t(),i=>{const l=mg,u=a[o];if(typeof i=="function"&&(i=i(u[0])),!Object.is(i,u[0]))if(u[0]=i,Vi.length){const[c,p]=Vi.at(-1);Promise.all([c===3?n:Ha([c,!1,l],n),p]).then(([d])=>{if(!d||!(c===2||c===3))return;const f=d.vC;requestAnimationFrame(()=>{setTimeout(()=>{f===d.vC&&Ha([c===3?1:0,!1,l],d)})})})}else Ha([0,!1,l],n)}])},qs=(e,t)=>{var i;const r=ra.at(-1);if(!r)return e;const[,n]=r,a=(i=n[Ae][1])[es]||(i[es]=[]),o=n[Ae][0]++,s=a[o];return Ac(s==null?void 0:s[1],t)?a[o]=[e,t]:e=a[o][0],e},vg=e=>{const t=rs.get(e);if(t){if(t.length===2)throw t[1];return t[0]}throw e.then(r=>rs.set(e,[r]),r=>rs.set(e,[void 0,r])),e},yg=(e,t)=>{var i;const r=ra.at(-1);if(!r)return e();const[,n]=r,a=(i=n[Ae][1])[ts]||(i[ts]=[]),o=n[Ae][0]++,s=a[o];return Ac(s==null?void 0:s[1],t)&&(a[o]=[e(),t]),a[o][0]},wg=ic({pending:!1,data:null,method:null,action:null}),Gi=new Set,bg=e=>{Gi.add(e),e.finally(()=>Gi.delete(e))},Fs=(e,t)=>yg(()=>r=>{let n;e&&(typeof e=="function"?n=e(r)||(()=>{e(null)}):e&&"current"in e&&(e.current=r,n=()=>{e.current=null}));const a=t(r);return()=>{a==null||a(),n==null||n()}},[e]),cn=Object.create(null),Da=Object.create(null),_a=(e,t,r,n,a)=>{if(t!=null&&t.itemProp)return{tag:e,props:t,type:e,ref:t.ref};const o=document.head;let{onLoad:s,onError:i,precedence:l,blocking:u,...c}=t,p=null,d=!1;const f=qa[e];let m;if(f.length>0){const b=o.querySelectorAll(e);e:for(const y of b)for(const T of qa[e])if(y.getAttribute(T)===t[T]){p=y;break e}if(!p){const y=f.reduce((T,x)=>t[x]===void 0?T:`${T}-${x}-${t[x]}`,e);d=!Da[y],p=Da[y]||(Da[y]=(()=>{const T=document.createElement(e);for(const x of f)t[x]!==void 0&&T.setAttribute(x,t[x]),t.rel&&T.setAttribute("rel",t.rel);return T})())}}else m=o.querySelectorAll(e);l=n?l??"":void 0,n&&(c[Fa]=l);const h=qs(b=>{if(f.length>0){let y=!1;for(const T of o.querySelectorAll(e)){if(y&&T.getAttribute(Fa)!==l){o.insertBefore(b,T);return}T.getAttribute(Fa)===l&&(y=!0)}o.appendChild(b)}else if(m){let y=!1;for(const T of m)if(T===b){y=!0;break}y||o.insertBefore(b,o.contains(m[0])?m[0]:o.querySelector(e)),m=void 0}},[l]),g=Fs(t.ref,b=>{var x;const y=f[0];if(r===2&&(b.innerHTML=""),(d||m)&&h(b),!i&&!s)return;let T=cn[x=b.getAttribute(y)]||(cn[x]=new Promise((R,I)=>{b.addEventListener("load",R),b.addEventListener("error",I)}));s&&(T=T.then(s)),i&&(T=T.catch(i)),T.catch(()=>{})});if(a&&u==="render"){const b=qa[e][0];if(t[b]){const y=t[b],T=cn[y]||(cn[y]=new Promise((x,R)=>{h(p),p.addEventListener("load",x),p.addEventListener("error",R)}));vg(T)}}const w={tag:e,type:e,props:{...c,ref:g},ref:g};return w.p=r,p&&(w.e=p),hg(w,o)},_g=e=>{const t=lg(),r=t&&$n(t);return r!=null&&r.endsWith("svg")?{tag:"title",props:e,type:"title",ref:e.ref}:_a("title",e,void 0,!1,!1)},Ig=e=>!e||["src","async"].some(t=>!e[t])?{tag:"script",props:e,type:"script",ref:e.ref}:_a("script",e,1,!1,!0),Tg=e=>!e||!["href","precedence"].every(t=>t in e)?{tag:"style",props:e,type:"style",ref:e.ref}:(e["data-href"]=e.href,delete e.href,_a("style",e,2,!0,!0)),Sg=e=>!e||["onLoad","onError"].some(t=>t in e)||e.rel==="stylesheet"&&(!("precedence"in e)||"disabled"in e)?{tag:"link",props:e,type:"link",ref:e.ref}:_a("link",e,1,"precedence"in e,!0),Eg=e=>_a("meta",e,void 0,!1,!1),Nc=Symbol(),xg=e=>{const{action:t,...r}=e;typeof t!="function"&&(r.action=t);const[n,a]=gg([null,!1]),o=qs(async u=>{const c=u.isTrusted?t:u.detail[Nc];if(typeof c!="function")return;u.preventDefault();const p=new FormData(u.target);a([p,!0]);const d=c(p);d instanceof Promise&&(bg(d),await d),a([null,!0])},[]),s=Fs(e.ref,u=>(u.addEventListener("submit",o),()=>{u.removeEventListener("submit",o)})),[i,l]=n;return n[1]=!1,{tag:wg,props:{value:{pending:i!==null,data:i,method:i?"post":null,action:i?t:null},children:{tag:"form",props:{...r,ref:s},type:"form",ref:s}},f:l}},Pc=(e,{formAction:t,...r})=>{if(typeof t=="function"){const n=qs(a=>{a.preventDefault(),a.currentTarget.form.dispatchEvent(new CustomEvent("submit",{detail:{[Nc]:t}}))},[]);r.ref=Fs(r.ref,a=>(a.addEventListener("click",n),()=>{a.removeEventListener("click",n)}))}return{tag:e,props:r,type:e,ref:r.ref}},Rg=e=>Pc("input",e),Mg=e=>Pc("button",e);Object.assign(vs,{title:_g,script:Ig,style:Tg,link:Sg,meta:Eg,form:xg,input:Rg,button:Mg});js(null);new TextEncoder;var Og=js(null),kg=(e,t,r,n)=>(a,o)=>{const s="<!DOCTYPE html>",i=r?Ni(u=>r(u,e),{Layout:t,...o},a):a,l=dm`${Et(s)}${Ni(Og.Provider,{value:e},i)}`;return e.html(l)},Cg=(e,t)=>function(n,a){const o=n.getLayout()??Em;return e&&n.setLayout(s=>e({...s,Layout:o},n)),n.setRenderer(kg(n,o,e)),a()};const Ag=Cg(({children:e})=>U("html",{lang:"ru",children:[U("head",{children:[U("meta",{charset:"UTF-8"}),U("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),U("title",{children:"Virtual Try-On - Виртуальная примерочная"}),U("link",{href:"/static/style.css",rel:"stylesheet"})]}),U("body",{children:e})]})),Ia=new xc;Ia.use("/api/*",og());Ia.use(Ag);Ia.get("/",e=>e.render(U("div",{children:[U("section",{id:"hero",class:"hero-section",children:U("div",{class:"hero-content",children:[U("video",{autoplay:!0,muted:!0,loop:!0,playsinline:!0,class:"hero-video",children:U("source",{src:"/static/hero-video.mp4",type:"video/mp4"})}),U("div",{class:"hero-overlay",children:[U("h1",{class:"hero-title",children:"Virtual Try-On"}),U("p",{class:"hero-subtitle",children:"Попробуйте любую одежду виртуально"}),U("div",{class:"scroll-indicator",children:[U("span",{children:"Прокрутите вниз"}),U("div",{class:"arrow-down"})]})]})]})}),U("section",{id:"tryon",class:"tryon-section",children:U("div",{class:"container",children:[U("h2",{class:"section-title",children:"Виртуальная примерочная"}),U("p",{class:"section-description",children:"Загрузите свое фото и фото одежды, которую хотите примерить"}),U("div",{class:"upload-container",children:[U("div",{class:"upload-box",children:[U("div",{class:"upload-area",id:"photo-upload",children:[U("input",{type:"file",id:"photo-input",accept:"image/*",style:"display: none;"}),U("div",{class:"upload-placeholder",children:[U("svg",{class:"upload-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:U("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),U("p",{children:"Ваше фото"}),U("span",{children:"Нажмите для загрузки"})]}),U("img",{id:"photo-preview",class:"image-preview",style:"display: none;"})]}),U("p",{class:"upload-label",children:"Фото человека"})]}),U("div",{class:"plus-icon",children:"+"}),U("div",{class:"upload-box",children:[U("div",{class:"upload-area",id:"outfit-upload",children:[U("input",{type:"file",id:"outfit-input",accept:"image/*",style:"display: none;"}),U("div",{class:"upload-placeholder",children:[U("svg",{class:"upload-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:U("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})}),U("p",{children:"Фото одежды"}),U("span",{children:"Нажмите для загрузки"})]}),U("img",{id:"outfit-preview",class:"image-preview",style:"display: none;"})]}),U("p",{class:"upload-label",children:"Одежда для примерки"})]}),U("div",{class:"equals-icon",children:"="}),U("div",{class:"upload-box",children:[U("div",{class:"result-area",id:"result-area",children:[U("div",{class:"result-placeholder",children:[U("svg",{class:"result-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:U("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5"})}),U("p",{children:"Результат"}),U("span",{children:"Появится здесь"})]}),U("img",{id:"result-preview",class:"image-preview",style:"display: none;"}),U("div",{id:"loading-spinner",class:"loading-spinner",style:"display: none;",children:[U("div",{class:"spinner"}),U("p",{children:"Обрабатываем изображения..."})]})]}),U("p",{class:"upload-label",children:"Ваш новый образ"})]})]}),U("button",{id:"generate-btn",class:"generate-btn",disabled:!0,children:"Создать образ"}),U("div",{id:"error-message",class:"error-message",style:"display: none;"})]})}),U("script",{src:"/static/app.js"})]})));Ia.post("/api/tryon",async e=>{var t,r,n,a,o,s,i;try{const l=await e.req.formData(),u=l.get("photo"),c=l.get("outfit");if(!u||!c)return e.json({error:"Both images are required"},400);const p=e.env.GOOGLE_API_KEY;if(!p)return e.json({error:"API key not configured. Please set GOOGLE_API_KEY in your environment variables."},500);const d=await u.arrayBuffer(),f=await c.arrayBuffer(),m=btoa(String.fromCharCode(...new Uint8Array(d))),h=btoa(String.fromCharCode(...new Uint8Array(f))),{google:g}=await Promise.resolve().then(()=>TI),{generateImage:w}=await Promise.resolve().then(()=>Vx),R=`PHOTO A: Person in their original photo
PHOTO B: Outfit/clothing to apply

TASK: Take the outfit from PHOTO B and apply it to the person in PHOTO A.

REQUIREMENTS:
- Keep the person's face, body type, pose, and background from PHOTO A EXACTLY the same
- Only change the clothing to match PHOTO B
- Make it look natural and realistic
- Maintain consistent lighting and shadows
- Preserve all body proportions

OUTFIT DESCRIPTION from PHOTO B:
${((o=(a=(n=(r=(t=(await(await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${p}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`Photo B shows clothing/outfit. Describe it in JSON format with these fields:
{
  "garment_type": "type of clothing",
  "style": "style description",
  "colors": ["dominant colors"],
  "patterns": "patterns or prints",
  "details": "notable details"
}`},{inlineData:{mimeType:c.type,data:h}}]}]})})).json()).candidates)==null?void 0:t[0])==null?void 0:r.content)==null?void 0:n.parts)==null?void 0:a[0])==null?void 0:o.text)||"casual outfit"}

Generate a photorealistic image showing the person from PHOTO A wearing the outfit from PHOTO B.`,A=await(await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${p}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:R},{inlineData:{mimeType:u.type,data:m}},{inlineData:{mimeType:c.type,data:h}}]}],generationConfig:{temperature:.4,topK:32,topP:1,maxOutputTokens:4096}})})).json();if(A.candidates&&((i=(s=A.candidates[0])==null?void 0:s.content)!=null&&i.parts)){const $=A.candidates[0].content.parts;for(const N of $)if(N.inlineData)return e.json({success:!0,image:`data:${N.inlineData.mimeType};base64,${N.inlineData.data}`})}return e.json({error:"Failed to generate image",details:A},500)}catch(l){return console.error("Try-on error:",l),e.json({error:"Failed to process images",details:l.message},500)}});const Bi=new xc,Ng=Object.assign({"/src/index.tsx":Ia});let $c=!1;for(const[,e]of Object.entries(Ng))e&&(Bi.all("*",t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),Bi.notFound(t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),$c=!0);if(!$c)throw new Error("Can't import modules from ['/src/index.ts','/src/index.tsx','/app/server.ts']");var Dc="vercel.ai.error",Pg=Symbol.for(Dc),Ji,Hi,C=class jc extends(Hi=Error,Ji=Pg,Hi){constructor({name:t,message:r,cause:n}){super(r),this[Ji]=!0,this.name=t,this.cause=n}static isInstance(t){return jc.hasMarker(t,Dc)}static hasMarker(t,r){const n=Symbol.for(r);return t!=null&&typeof t=="object"&&n in t&&typeof t[n]=="boolean"&&t[n]===!0}},zc="AI_APICallError",Uc=`vercel.ai.error.${zc}`,$g=Symbol.for(Uc),Wi,Yi,He=class extends(Yi=C,Wi=$g,Yi){constructor({message:e,url:t,requestBodyValues:r,statusCode:n,responseHeaders:a,responseBody:o,cause:s,isRetryable:i=n!=null&&(n===408||n===409||n===429||n>=500),data:l}){super({name:zc,message:e,cause:s}),this[Wi]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=n,this.responseHeaders=a,this.responseBody=o,this.isRetryable=i,this.data=l}static isInstance(e){return C.hasMarker(e,Uc)}},Zc="AI_EmptyResponseBodyError",qc=`vercel.ai.error.${Zc}`,Dg=Symbol.for(qc),Ki,Xi,Fc=class extends(Xi=C,Ki=Dg,Xi){constructor({message:e="Empty response body"}={}){super({name:Zc,message:e}),this[Ki]=!0}static isInstance(e){return C.hasMarker(e,qc)}};function Gr(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var Lc="AI_InvalidArgumentError",Vc=`vercel.ai.error.${Lc}`,jg=Symbol.for(Vc),Qi,el,Ls=class extends(el=C,Qi=jg,el){constructor({message:t,cause:r,argument:n}){super({name:Lc,message:t,cause:r}),this[Qi]=!0,this.argument=n}static isInstance(t){return C.hasMarker(t,Vc)}},Gc="AI_InvalidPromptError",Bc=`vercel.ai.error.${Gc}`,zg=Symbol.for(Bc),tl,rl,Pr=class extends(rl=C,tl=zg,rl){constructor({prompt:e,message:t,cause:r}){super({name:Gc,message:`Invalid prompt: ${t}`,cause:r}),this[tl]=!0,this.prompt=e}static isInstance(e){return C.hasMarker(e,Bc)}},Jc="AI_InvalidResponseDataError",Hc=`vercel.ai.error.${Jc}`,Ug=Symbol.for(Hc),nl,al,Zg=class extends(al=C,nl=Ug,al){constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:Jc,message:t}),this[nl]=!0,this.data=e}static isInstance(e){return C.hasMarker(e,Hc)}},Wc="AI_JSONParseError",Yc=`vercel.ai.error.${Wc}`,qg=Symbol.for(Yc),ol,sl,xn=class extends(sl=C,ol=qg,sl){constructor({text:e,cause:t}){super({name:Wc,message:`JSON parsing failed: Text: ${e}.
Error message: ${Gr(t)}`,cause:t}),this[ol]=!0,this.text=e}static isInstance(e){return C.hasMarker(e,Yc)}},Kc="AI_LoadAPIKeyError",Xc=`vercel.ai.error.${Kc}`,Fg=Symbol.for(Xc),il,ll,Hn=class extends(ll=C,il=Fg,ll){constructor({message:e}){super({name:Kc,message:e}),this[il]=!0}static isInstance(e){return C.hasMarker(e,Xc)}},Qc="AI_LoadSettingError",ed=`vercel.ai.error.${Qc}`,Lg=Symbol.for(ed),ul,cl,Vg=class extends(cl=C,ul=Lg,cl){constructor({message:e}){super({name:Qc,message:e}),this[ul]=!0}static isInstance(e){return C.hasMarker(e,ed)}},td="AI_NoContentGeneratedError",rd=`vercel.ai.error.${td}`,Gg=Symbol.for(rd),dl,pl,Bg=class extends(pl=C,dl=Gg,pl){constructor({message:e="No content generated."}={}){super({name:td,message:e}),this[dl]=!0}static isInstance(e){return C.hasMarker(e,rd)}},nd="AI_NoSuchModelError",ad=`vercel.ai.error.${nd}`,Jg=Symbol.for(ad),fl,hl,lt=class extends(hl=C,fl=Jg,hl){constructor({errorName:e=nd,modelId:t,modelType:r,message:n=`No such ${r}: ${t}`}){super({name:e,message:n}),this[fl]=!0,this.modelId=t,this.modelType=r}static isInstance(e){return C.hasMarker(e,ad)}},od="AI_TooManyEmbeddingValuesForCallError",sd=`vercel.ai.error.${od}`,Hg=Symbol.for(sd),ml,gl,id=class extends(gl=C,ml=Hg,gl){constructor(e){super({name:od,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[ml]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return C.hasMarker(e,sd)}},ld="AI_TypeValidationError",ud=`vercel.ai.error.${ld}`,Wg=Symbol.for(ud),vl,yl,We=class _s extends(yl=C,vl=Wg,yl){constructor({value:t,cause:r,context:n}){let a="Type validation failed";if(n!=null&&n.field&&(a+=` for ${n.field}`),n!=null&&n.entityName||n!=null&&n.entityId){a+=" (";const o=[];n.entityName&&o.push(n.entityName),n.entityId&&o.push(`id: "${n.entityId}"`),a+=o.join(", "),a+=")"}super({name:ld,message:`${a}: Value: ${JSON.stringify(t)}.
Error message: ${Gr(r)}`,cause:r}),this[vl]=!0,this.value=t,this.context=n}static isInstance(t){return C.hasMarker(t,ud)}static wrap({value:t,cause:r,context:n}){var a,o,s;return _s.isInstance(r)&&r.value===t&&((a=r.context)==null?void 0:a.field)===(n==null?void 0:n.field)&&((o=r.context)==null?void 0:o.entityName)===(n==null?void 0:n.entityName)&&((s=r.context)==null?void 0:s.entityId)===(n==null?void 0:n.entityId)?r:new _s({value:t,cause:r,context:n})}},cd="AI_UnsupportedFunctionalityError",dd=`vercel.ai.error.${cd}`,Yg=Symbol.for(dd),wl,bl,_r=class extends(bl=C,wl=Yg,bl){constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:cd,message:t}),this[wl]=!0,this.functionality=e}static isInstance(e){return C.hasMarker(e,dd)}};function ao(e){return e===null||typeof e=="string"||typeof e=="number"||typeof e=="boolean"?!0:Array.isArray(e)?e.every(ao):typeof e=="object"?Object.entries(e).every(([t,r])=>typeof t=="string"&&(r===void 0||ao(r))):!1}function _l(e){return Array.isArray(e)&&e.every(ao)}function oo(e){return e!=null&&typeof e=="object"&&Object.entries(e).every(([t,r])=>typeof t=="string"&&(r===void 0||ao(r)))}function S(e,t,r){function n(i,l){if(i._zod||Object.defineProperty(i,"_zod",{value:{def:l,constr:s,traits:new Set},enumerable:!1}),i._zod.traits.has(e))return;i._zod.traits.add(e),t(i,l);const u=s.prototype,c=Object.keys(u);for(let p=0;p<c.length;p++){const d=c[p];d in i||(i[d]=u[d].bind(i))}}const a=(r==null?void 0:r.Parent)??Object;class o extends a{}Object.defineProperty(o,"name",{value:e});function s(i){var l;const u=r!=null&&r.Parent?new o:this;n(u,i),(l=u._zod).deferred??(l.deferred=[]);for(const c of u._zod.deferred)c();return u}return Object.defineProperty(s,"init",{value:n}),Object.defineProperty(s,Symbol.hasInstance,{value:i=>{var l,u;return r!=null&&r.Parent&&i instanceof r.Parent?!0:(u=(l=i==null?void 0:i._zod)==null?void 0:l.traits)==null?void 0:u.has(e)}}),Object.defineProperty(s,"name",{value:e}),s}class gn extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class pd extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const fd={};function Ir(e){return fd}function hd(e){const t=Object.values(e).filter(n=>typeof n=="number");return Object.entries(e).filter(([n,a])=>t.indexOf(+n)===-1).map(([n,a])=>a)}function Is(e,t){return typeof t=="bigint"?t.toString():t}function To(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function Vs(e){return e==null}function Gs(e){const t=e.startsWith("^")?1:0,r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}function Kg(e,t){const r=(e.toString().split(".")[1]||"").length,n=t.toString();let a=(n.split(".")[1]||"").length;if(a===0&&/\d?e-\d?/.test(n)){const l=n.match(/\d?e-(\d?)/);l!=null&&l[1]&&(a=Number.parseInt(l[1]))}const o=r>a?r:a,s=Number.parseInt(e.toFixed(o).replace(".","")),i=Number.parseInt(t.toFixed(o).replace(".",""));return s%i/10**o}const Il=Symbol("evaluating");function re(e,t,r){let n;Object.defineProperty(e,t,{get(){if(n!==Il)return n===void 0&&(n=Il,n=r()),n},set(a){Object.defineProperty(e,t,{value:a})},configurable:!0})}function Xr(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function xr(...e){const t={};for(const r of e){const n=Object.getOwnPropertyDescriptors(r);Object.assign(t,n)}return Object.defineProperties({},t)}function Tl(e){return JSON.stringify(e)}function Xg(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const md="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function na(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const Qg=To(()=>{var e;if(typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)!=null&&e.includes("Cloudflare")))return!1;try{const t=Function;return new t(""),!0}catch{return!1}});function Rn(e){if(na(e)===!1)return!1;const t=e.constructor;if(t===void 0||typeof t!="function")return!0;const r=t.prototype;return!(na(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function gd(e){return Rn(e)?{...e}:Array.isArray(e)?[...e]:e}const ev=new Set(["string","number","symbol"]);function Mn(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Rr(e,t,r){const n=new e._zod.constr(t??e._zod.def);return(!t||r!=null&&r.parent)&&(n._zod.parent=e),n}function j(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if((t==null?void 0:t.message)!==void 0){if((t==null?void 0:t.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function tv(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const rv={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function nv(e,t){const r=e._zod.def,n=r.checks;if(n&&n.length>0)throw new Error(".pick() cannot be used on object schemas containing refinements");const o=xr(e._zod.def,{get shape(){const s={};for(const i in t){if(!(i in r.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&(s[i]=r.shape[i])}return Xr(this,"shape",s),s},checks:[]});return Rr(e,o)}function av(e,t){const r=e._zod.def,n=r.checks;if(n&&n.length>0)throw new Error(".omit() cannot be used on object schemas containing refinements");const o=xr(e._zod.def,{get shape(){const s={...e._zod.def.shape};for(const i in t){if(!(i in r.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&delete s[i]}return Xr(this,"shape",s),s},checks:[]});return Rr(e,o)}function ov(e,t){if(!Rn(t))throw new Error("Invalid input to extend: expected a plain object");const r=e._zod.def.checks;if(r&&r.length>0){const o=e._zod.def.shape;for(const s in t)if(Object.getOwnPropertyDescriptor(o,s)!==void 0)throw new Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}const a=xr(e._zod.def,{get shape(){const o={...e._zod.def.shape,...t};return Xr(this,"shape",o),o}});return Rr(e,a)}function sv(e,t){if(!Rn(t))throw new Error("Invalid input to safeExtend: expected a plain object");const r=xr(e._zod.def,{get shape(){const n={...e._zod.def.shape,...t};return Xr(this,"shape",n),n}});return Rr(e,r)}function iv(e,t){const r=xr(e._zod.def,{get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return Xr(this,"shape",n),n},get catchall(){return t._zod.def.catchall},checks:[]});return Rr(e,r)}function lv(e,t,r){const a=t._zod.def.checks;if(a&&a.length>0)throw new Error(".partial() cannot be used on object schemas containing refinements");const s=xr(t._zod.def,{get shape(){const i=t._zod.def.shape,l={...i};if(r)for(const u in r){if(!(u in i))throw new Error(`Unrecognized key: "${u}"`);r[u]&&(l[u]=e?new e({type:"optional",innerType:i[u]}):i[u])}else for(const u in i)l[u]=e?new e({type:"optional",innerType:i[u]}):i[u];return Xr(this,"shape",l),l},checks:[]});return Rr(t,s)}function uv(e,t,r){const n=xr(t._zod.def,{get shape(){const a=t._zod.def.shape,o={...a};if(r)for(const s in r){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(o[s]=new e({type:"nonoptional",innerType:a[s]}))}else for(const s in a)o[s]=new e({type:"nonoptional",innerType:a[s]});return Xr(this,"shape",o),o}});return Rr(t,n)}function hn(e,t=0){var r;if(e.aborted===!0)return!0;for(let n=t;n<e.issues.length;n++)if(((r=e.issues[n])==null?void 0:r.continue)!==!0)return!0;return!1}function mn(e,t){return t.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(e),r})}function ja(e){return typeof e=="string"?e:e==null?void 0:e.message}function Tr(e,t,r){var a,o,s,i,l,u;const n={...e,path:e.path??[]};if(!e.message){const c=ja((s=(o=(a=e.inst)==null?void 0:a._zod.def)==null?void 0:o.error)==null?void 0:s.call(o,e))??ja((i=t==null?void 0:t.error)==null?void 0:i.call(t,e))??ja((l=r.customError)==null?void 0:l.call(r,e))??ja((u=r.localeError)==null?void 0:u.call(r,e))??"Invalid input";n.message=c}return delete n.inst,delete n.continue,t!=null&&t.reportInput||delete n.input,n}function Bs(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function aa(...e){const[t,r,n]=e;return typeof t=="string"?{message:t,code:"custom",input:r,inst:n}:{...t}}const vd=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,Is,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},yd=S("$ZodError",vd),wd=S("$ZodError",vd,{Parent:Error});function cv(e,t=r=>r.message){const r={},n=[];for(const a of e.issues)a.path.length>0?(r[a.path[0]]=r[a.path[0]]||[],r[a.path[0]].push(t(a))):n.push(t(a));return{formErrors:n,fieldErrors:r}}function dv(e,t=r=>r.message){const r={_errors:[]},n=a=>{for(const o of a.issues)if(o.code==="invalid_union"&&o.errors.length)o.errors.map(s=>n({issues:s}));else if(o.code==="invalid_key")n({issues:o.issues});else if(o.code==="invalid_element")n({issues:o.issues});else if(o.path.length===0)r._errors.push(t(o));else{let s=r,i=0;for(;i<o.path.length;){const l=o.path[i];i===o.path.length-1?(s[l]=s[l]||{_errors:[]},s[l]._errors.push(t(o))):s[l]=s[l]||{_errors:[]},s=s[l],i++}}};return n(e),r}const Js=e=>(t,r,n,a)=>{const o=n?Object.assign(n,{async:!1}):{async:!1},s=t._zod.run({value:r,issues:[]},o);if(s instanceof Promise)throw new gn;if(s.issues.length){const i=new((a==null?void 0:a.Err)??e)(s.issues.map(l=>Tr(l,o,Ir())));throw md(i,a==null?void 0:a.callee),i}return s.value},Hs=e=>async(t,r,n,a)=>{const o=n?Object.assign(n,{async:!0}):{async:!0};let s=t._zod.run({value:r,issues:[]},o);if(s instanceof Promise&&(s=await s),s.issues.length){const i=new((a==null?void 0:a.Err)??e)(s.issues.map(l=>Tr(l,o,Ir())));throw md(i,a==null?void 0:a.callee),i}return s.value},So=e=>(t,r,n)=>{const a=n?{...n,async:!1}:{async:!1},o=t._zod.run({value:r,issues:[]},a);if(o instanceof Promise)throw new gn;return o.issues.length?{success:!1,error:new(e??yd)(o.issues.map(s=>Tr(s,a,Ir())))}:{success:!0,data:o.value}},pv=So(wd),Eo=e=>async(t,r,n)=>{const a=n?Object.assign(n,{async:!0}):{async:!0};let o=t._zod.run({value:r,issues:[]},a);return o instanceof Promise&&(o=await o),o.issues.length?{success:!1,error:new e(o.issues.map(s=>Tr(s,a,Ir())))}:{success:!0,data:o.value}},fv=Eo(wd),hv=e=>(t,r,n)=>{const a=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Js(e)(t,r,a)},mv=e=>(t,r,n)=>Js(e)(t,r,n),gv=e=>async(t,r,n)=>{const a=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Hs(e)(t,r,a)},vv=e=>async(t,r,n)=>Hs(e)(t,r,n),yv=e=>(t,r,n)=>{const a=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return So(e)(t,r,a)},wv=e=>(t,r,n)=>So(e)(t,r,n),bv=e=>async(t,r,n)=>{const a=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Eo(e)(t,r,a)},_v=e=>async(t,r,n)=>Eo(e)(t,r,n),Iv=/^[cC][^\s-]{8,}$/,Tv=/^[0-9a-z]+$/,Sv=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Ev=/^[0-9a-vA-V]{20}$/,xv=/^[A-Za-z0-9]{27}$/,Rv=/^[a-zA-Z0-9_-]{21}$/,Mv=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,Ov=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Sl=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,kv=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,Cv="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Av(){return new RegExp(Cv,"u")}const Nv=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Pv=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,$v=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Dv=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,jv=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,bd=/^[A-Za-z0-9_-]*$/,zv=/^\+[1-9]\d{6,14}$/,_d="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",Uv=new RegExp(`^${_d}$`);function Id(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function Zv(e){return new RegExp(`^${Id(e)}$`)}function qv(e){const t=Id({precision:e.precision}),r=["Z"];e.local&&r.push(""),e.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const n=`${t}(?:${r.join("|")})`;return new RegExp(`^${_d}T(?:${n})$`)}const Fv=e=>{const t=e?`[\\s\\S]{${(e==null?void 0:e.minimum)??0},${(e==null?void 0:e.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},Lv=/^-?\d+$/,Td=/^-?\d+(?:\.\d+)?$/,Vv=/^(?:true|false)$/i,Gv=/^null$/i,Bv=/^[^A-Z]*$/,Jv=/^[^a-z]*$/,ft=S("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),Sd={number:"number",bigint:"bigint",object:"date"},Ed=S("$ZodCheckLessThan",(e,t)=>{ft.init(e,t);const r=Sd[typeof t.value];e._zod.onattach.push(n=>{const a=n._zod.bag,o=(t.inclusive?a.maximum:a.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<o&&(t.inclusive?a.maximum=t.value:a.exclusiveMaximum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value<=t.value:n.value<t.value)||n.issues.push({origin:r,code:"too_big",maximum:typeof t.value=="object"?t.value.getTime():t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),xd=S("$ZodCheckGreaterThan",(e,t)=>{ft.init(e,t);const r=Sd[typeof t.value];e._zod.onattach.push(n=>{const a=n._zod.bag,o=(t.inclusive?a.minimum:a.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>o&&(t.inclusive?a.minimum=t.value:a.exclusiveMinimum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value>=t.value:n.value>t.value)||n.issues.push({origin:r,code:"too_small",minimum:typeof t.value=="object"?t.value.getTime():t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Hv=S("$ZodCheckMultipleOf",(e,t)=>{ft.init(e,t),e._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=t.value)}),e._zod.check=r=>{if(typeof r.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%t.value===BigInt(0):Kg(r.value,t.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:t.value,input:r.value,inst:e,continue:!t.abort})}}),Wv=S("$ZodCheckNumberFormat",(e,t)=>{var s;ft.init(e,t),t.format=t.format||"float64";const r=(s=t.format)==null?void 0:s.includes("int"),n=r?"int":"number",[a,o]=rv[t.format];e._zod.onattach.push(i=>{const l=i._zod.bag;l.format=t.format,l.minimum=a,l.maximum=o,r&&(l.pattern=Lv)}),e._zod.check=i=>{const l=i.value;if(r){if(!Number.isInteger(l)){i.issues.push({expected:n,format:t.format,code:"invalid_type",continue:!1,input:l,inst:e});return}if(!Number.isSafeInteger(l)){l>0?i.issues.push({input:l,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,inclusive:!0,continue:!t.abort}):i.issues.push({input:l,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,inclusive:!0,continue:!t.abort});return}}l<a&&i.issues.push({origin:"number",input:l,code:"too_small",minimum:a,inclusive:!0,inst:e,continue:!t.abort}),l>o&&i.issues.push({origin:"number",input:l,code:"too_big",maximum:o,inclusive:!0,inst:e,continue:!t.abort})}}),Yv=S("$ZodCheckMaxLength",(e,t)=>{var r;ft.init(e,t),(r=e._zod.def).when??(r.when=n=>{const a=n.value;return!Vs(a)&&a.length!==void 0}),e._zod.onattach.push(n=>{const a=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<a&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const a=n.value;if(a.length<=t.maximum)return;const s=Bs(a);n.issues.push({origin:s,code:"too_big",maximum:t.maximum,inclusive:!0,input:a,inst:e,continue:!t.abort})}}),Kv=S("$ZodCheckMinLength",(e,t)=>{var r;ft.init(e,t),(r=e._zod.def).when??(r.when=n=>{const a=n.value;return!Vs(a)&&a.length!==void 0}),e._zod.onattach.push(n=>{const a=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>a&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const a=n.value;if(a.length>=t.minimum)return;const s=Bs(a);n.issues.push({origin:s,code:"too_small",minimum:t.minimum,inclusive:!0,input:a,inst:e,continue:!t.abort})}}),Xv=S("$ZodCheckLengthEquals",(e,t)=>{var r;ft.init(e,t),(r=e._zod.def).when??(r.when=n=>{const a=n.value;return!Vs(a)&&a.length!==void 0}),e._zod.onattach.push(n=>{const a=n._zod.bag;a.minimum=t.length,a.maximum=t.length,a.length=t.length}),e._zod.check=n=>{const a=n.value,o=a.length;if(o===t.length)return;const s=Bs(a),i=o>t.length;n.issues.push({origin:s,...i?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:n.value,inst:e,continue:!t.abort})}}),xo=S("$ZodCheckStringFormat",(e,t)=>{var r,n;ft.init(e,t),e._zod.onattach.push(a=>{const o=a._zod.bag;o.format=t.format,t.pattern&&(o.patterns??(o.patterns=new Set),o.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=a=>{t.pattern.lastIndex=0,!t.pattern.test(a.value)&&a.issues.push({origin:"string",code:"invalid_format",format:t.format,input:a.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(n=e._zod).check??(n.check=()=>{})}),Qv=S("$ZodCheckRegex",(e,t)=>{xo.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),ey=S("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=Bv),xo.init(e,t)}),ty=S("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=Jv),xo.init(e,t)}),ry=S("$ZodCheckIncludes",(e,t)=>{ft.init(e,t);const r=Mn(t.includes),n=new RegExp(typeof t.position=="number"?`^.{${t.position}}${r}`:r);t.pattern=n,e._zod.onattach.push(a=>{const o=a._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=a=>{a.value.includes(t.includes,t.position)||a.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:a.value,inst:e,continue:!t.abort})}}),ny=S("$ZodCheckStartsWith",(e,t)=>{ft.init(e,t);const r=new RegExp(`^${Mn(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const a=n._zod.bag;a.patterns??(a.patterns=new Set),a.patterns.add(r)}),e._zod.check=n=>{n.value.startsWith(t.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:n.value,inst:e,continue:!t.abort})}}),ay=S("$ZodCheckEndsWith",(e,t)=>{ft.init(e,t);const r=new RegExp(`.*${Mn(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const a=n._zod.bag;a.patterns??(a.patterns=new Set),a.patterns.add(r)}),e._zod.check=n=>{n.value.endsWith(t.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:n.value,inst:e,continue:!t.abort})}}),oy=S("$ZodCheckOverwrite",(e,t)=>{ft.init(e,t),e._zod.check=r=>{r.value=t.tx(r.value)}});class sy{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const n=t.split(`
`).filter(s=>s),a=Math.min(...n.map(s=>s.length-s.trimStart().length)),o=n.map(s=>s.slice(a)).map(s=>" ".repeat(this.indent*2)+s);for(const s of o)this.content.push(s)}compile(){const t=Function,r=this==null?void 0:this.args,a=[...((this==null?void 0:this.content)??[""]).map(o=>`  ${o}`)];return new t(...r,a.join(`
`))}}const iy={major:4,minor:3,patch:6},_e=S("$ZodType",(e,t)=>{var a;var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=iy;const n=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&n.unshift(e);for(const o of n)for(const s of o._zod.onattach)s(e);if(n.length===0)(r=e._zod).deferred??(r.deferred=[]),(a=e._zod.deferred)==null||a.push(()=>{e._zod.run=e._zod.parse});else{const o=(i,l,u)=>{let c=hn(i),p;for(const d of l){if(d._zod.def.when){if(!d._zod.def.when(i))continue}else if(c)continue;const f=i.issues.length,m=d._zod.check(i);if(m instanceof Promise&&(u==null?void 0:u.async)===!1)throw new gn;if(p||m instanceof Promise)p=(p??Promise.resolve()).then(async()=>{await m,i.issues.length!==f&&(c||(c=hn(i,f)))});else{if(i.issues.length===f)continue;c||(c=hn(i,f))}}return p?p.then(()=>i):i},s=(i,l,u)=>{if(hn(i))return i.aborted=!0,i;const c=o(l,n,u);if(c instanceof Promise){if(u.async===!1)throw new gn;return c.then(p=>e._zod.parse(p,u))}return e._zod.parse(c,u)};e._zod.run=(i,l)=>{if(l.skipChecks)return e._zod.parse(i,l);if(l.direction==="backward"){const c=e._zod.parse({value:i.value,issues:[]},{...l,skipChecks:!0});return c instanceof Promise?c.then(p=>s(p,i,l)):s(c,i,l)}const u=e._zod.parse(i,l);if(u instanceof Promise){if(l.async===!1)throw new gn;return u.then(c=>o(c,n,l))}return o(u,n,l)}}re(e,"~standard",()=>({validate:o=>{var s;try{const i=pv(e,o);return i.success?{value:i.data}:{issues:(s=i.error)==null?void 0:s.issues}}catch{return fv(e,o).then(l=>{var u;return l.success?{value:l.data}:{issues:(u=l.error)==null?void 0:u.issues}})}},vendor:"zod",version:1}))}),Ws=S("$ZodString",(e,t)=>{var r;_e.init(e,t),e._zod.pattern=[...((r=e==null?void 0:e._zod.bag)==null?void 0:r.patterns)??[]].pop()??Fv(e._zod.bag),e._zod.parse=(n,a)=>{if(t.coerce)try{n.value=String(n.value)}catch{}return typeof n.value=="string"||n.issues.push({expected:"string",code:"invalid_type",input:n.value,inst:e}),n}}),xe=S("$ZodStringFormat",(e,t)=>{xo.init(e,t),Ws.init(e,t)}),ly=S("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=Ov),xe.init(e,t)}),uy=S("$ZodUUID",(e,t)=>{if(t.version){const n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(n===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=Sl(n))}else t.pattern??(t.pattern=Sl());xe.init(e,t)}),cy=S("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=kv),xe.init(e,t)}),dy=S("$ZodURL",(e,t)=>{xe.init(e,t),e._zod.check=r=>{try{const n=r.value.trim(),a=new URL(n);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(a.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(a.protocol.endsWith(":")?a.protocol.slice(0,-1):a.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort})),t.normalize?r.value=a.href:r.value=n;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),py=S("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=Av()),xe.init(e,t)}),fy=S("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=Rv),xe.init(e,t)}),hy=S("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=Iv),xe.init(e,t)}),my=S("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=Tv),xe.init(e,t)}),gy=S("$ZodULID",(e,t)=>{t.pattern??(t.pattern=Sv),xe.init(e,t)}),vy=S("$ZodXID",(e,t)=>{t.pattern??(t.pattern=Ev),xe.init(e,t)}),yy=S("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=xv),xe.init(e,t)}),wy=S("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=qv(t)),xe.init(e,t)}),by=S("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=Uv),xe.init(e,t)}),_y=S("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=Zv(t)),xe.init(e,t)}),Iy=S("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=Mv),xe.init(e,t)}),Ty=S("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=Nv),xe.init(e,t),e._zod.bag.format="ipv4"}),Sy=S("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=Pv),xe.init(e,t),e._zod.bag.format="ipv6",e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),Ey=S("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=$v),xe.init(e,t)}),xy=S("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=Dv),xe.init(e,t),e._zod.check=r=>{const n=r.value.split("/");try{if(n.length!==2)throw new Error;const[a,o]=n;if(!o)throw new Error;const s=Number(o);if(`${s}`!==o)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${a}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function Rd(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const Ry=S("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=jv),xe.init(e,t),e._zod.bag.contentEncoding="base64",e._zod.check=r=>{Rd(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}});function My(e){if(!bd.test(e))return!1;const t=e.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=t.padEnd(Math.ceil(t.length/4)*4,"=");return Rd(r)}const Oy=S("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=bd),xe.init(e,t),e._zod.bag.contentEncoding="base64url",e._zod.check=r=>{My(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),ky=S("$ZodE164",(e,t)=>{t.pattern??(t.pattern=zv),xe.init(e,t)});function Cy(e,t=null){try{const r=e.split(".");if(r.length!==3)return!1;const[n]=r;if(!n)return!1;const a=JSON.parse(atob(n));return!("typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||t&&(!("alg"in a)||a.alg!==t))}catch{return!1}}const Ay=S("$ZodJWT",(e,t)=>{xe.init(e,t),e._zod.check=r=>{Cy(r.value,t.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),Md=S("$ZodNumber",(e,t)=>{_e.init(e,t),e._zod.pattern=e._zod.bag.pattern??Td,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=Number(r.value)}catch{}const a=r.value;if(typeof a=="number"&&!Number.isNaN(a)&&Number.isFinite(a))return r;const o=typeof a=="number"?Number.isNaN(a)?"NaN":Number.isFinite(a)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:a,inst:e,...o?{received:o}:{}}),r}}),Ny=S("$ZodNumberFormat",(e,t)=>{Wv.init(e,t),Md.init(e,t)}),Py=S("$ZodBoolean",(e,t)=>{_e.init(e,t),e._zod.pattern=Vv,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=!!r.value}catch{}const a=r.value;return typeof a=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:a,inst:e}),r}}),$y=S("$ZodNull",(e,t)=>{_e.init(e,t),e._zod.pattern=Gv,e._zod.values=new Set([null]),e._zod.parse=(r,n)=>{const a=r.value;return a===null||r.issues.push({expected:"null",code:"invalid_type",input:a,inst:e}),r}}),Dy=S("$ZodAny",(e,t)=>{_e.init(e,t),e._zod.parse=r=>r}),jy=S("$ZodUnknown",(e,t)=>{_e.init(e,t),e._zod.parse=r=>r}),zy=S("$ZodNever",(e,t)=>{_e.init(e,t),e._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:e}),r)});function El(e,t,r){e.issues.length&&t.issues.push(...mn(r,e.issues)),t.value[r]=e.value}const Uy=S("$ZodArray",(e,t)=>{_e.init(e,t),e._zod.parse=(r,n)=>{const a=r.value;if(!Array.isArray(a))return r.issues.push({expected:"array",code:"invalid_type",input:a,inst:e}),r;r.value=Array(a.length);const o=[];for(let s=0;s<a.length;s++){const i=a[s],l=t.element._zod.run({value:i,issues:[]},n);l instanceof Promise?o.push(l.then(u=>El(u,r,s))):El(l,r,s)}return o.length?Promise.all(o).then(()=>r):r}});function so(e,t,r,n,a){if(e.issues.length){if(a&&!(r in n))return;t.issues.push(...mn(r,e.issues))}e.value===void 0?r in n&&(t.value[r]=void 0):t.value[r]=e.value}function Od(e){var n,a,o,s;const t=Object.keys(e.shape);for(const i of t)if(!((s=(o=(a=(n=e.shape)==null?void 0:n[i])==null?void 0:a._zod)==null?void 0:o.traits)!=null&&s.has("$ZodType")))throw new Error(`Invalid element at key "${i}": expected a Zod schema`);const r=tv(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(r)}}function kd(e,t,r,n,a,o){const s=[],i=a.keySet,l=a.catchall._zod,u=l.def.type,c=l.optout==="optional";for(const p in t){if(i.has(p))continue;if(u==="never"){s.push(p);continue}const d=l.run({value:t[p],issues:[]},n);d instanceof Promise?e.push(d.then(f=>so(f,r,p,t,c))):so(d,r,p,t,c)}return s.length&&r.issues.push({code:"unrecognized_keys",keys:s,input:t,inst:o}),e.length?Promise.all(e).then(()=>r):r}const Zy=S("$ZodObject",(e,t)=>{_e.init(e,t);const r=Object.getOwnPropertyDescriptor(t,"shape");if(!(r!=null&&r.get)){const i=t.shape;Object.defineProperty(t,"shape",{get:()=>{const l={...i};return Object.defineProperty(t,"shape",{value:l}),l}})}const n=To(()=>Od(t));re(e._zod,"propValues",()=>{const i=t.shape,l={};for(const u in i){const c=i[u]._zod;if(c.values){l[u]??(l[u]=new Set);for(const p of c.values)l[u].add(p)}}return l});const a=na,o=t.catchall;let s;e._zod.parse=(i,l)=>{s??(s=n.value);const u=i.value;if(!a(u))return i.issues.push({expected:"object",code:"invalid_type",input:u,inst:e}),i;i.value={};const c=[],p=s.shape;for(const d of s.keys){const f=p[d],m=f._zod.optout==="optional",h=f._zod.run({value:u[d],issues:[]},l);h instanceof Promise?c.push(h.then(g=>so(g,i,d,u,m))):so(h,i,d,u,m)}return o?kd(c,u,i,l,n.value,e):c.length?Promise.all(c).then(()=>i):i}}),qy=S("$ZodObjectJIT",(e,t)=>{Zy.init(e,t);const r=e._zod.parse,n=To(()=>Od(t)),a=d=>{var y;const f=new sy(["shape","payload","ctx"]),m=n.value,h=T=>{const x=Tl(T);return`shape[${x}]._zod.run({ value: input[${x}], issues: [] }, ctx)`};f.write("const input = payload.value;");const g=Object.create(null);let w=0;for(const T of m.keys)g[T]=`key_${w++}`;f.write("const newResult = {};");for(const T of m.keys){const x=g[T],R=Tl(T),I=d[T],A=((y=I==null?void 0:I._zod)==null?void 0:y.optout)==="optional";f.write(`const ${x} = ${h(T)};`),A?f.write(`
        if (${x}.issues.length) {
          if (${R} in input) {
            payload.issues = payload.issues.concat(${x}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${R}, ...iss.path] : [${R}]
            })));
          }
        }
        
        if (${x}.value === undefined) {
          if (${R} in input) {
            newResult[${R}] = undefined;
          }
        } else {
          newResult[${R}] = ${x}.value;
        }
        
      `):f.write(`
        if (${x}.issues.length) {
          payload.issues = payload.issues.concat(${x}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${R}, ...iss.path] : [${R}]
          })));
        }
        
        if (${x}.value === undefined) {
          if (${R} in input) {
            newResult[${R}] = undefined;
          }
        } else {
          newResult[${R}] = ${x}.value;
        }
        
      `)}f.write("payload.value = newResult;"),f.write("return payload;");const b=f.compile();return(T,x)=>b(d,T,x)};let o;const s=na,i=!fd.jitless,u=i&&Qg.value,c=t.catchall;let p;e._zod.parse=(d,f)=>{p??(p=n.value);const m=d.value;return s(m)?i&&u&&(f==null?void 0:f.async)===!1&&f.jitless!==!0?(o||(o=a(t.shape)),d=o(d,f),c?kd([],m,d,f,p,e):d):r(d,f):(d.issues.push({expected:"object",code:"invalid_type",input:m,inst:e}),d)}});function xl(e,t,r,n){for(const o of e)if(o.issues.length===0)return t.value=o.value,t;const a=e.filter(o=>!hn(o));return a.length===1?(t.value=a[0].value,a[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(o=>o.issues.map(s=>Tr(s,n,Ir())))}),t)}const Cd=S("$ZodUnion",(e,t)=>{_e.init(e,t),re(e._zod,"optin",()=>t.options.some(a=>a._zod.optin==="optional")?"optional":void 0),re(e._zod,"optout",()=>t.options.some(a=>a._zod.optout==="optional")?"optional":void 0),re(e._zod,"values",()=>{if(t.options.every(a=>a._zod.values))return new Set(t.options.flatMap(a=>Array.from(a._zod.values)))}),re(e._zod,"pattern",()=>{if(t.options.every(a=>a._zod.pattern)){const a=t.options.map(o=>o._zod.pattern);return new RegExp(`^(${a.map(o=>Gs(o.source)).join("|")})$`)}});const r=t.options.length===1,n=t.options[0]._zod.run;e._zod.parse=(a,o)=>{if(r)return n(a,o);let s=!1;const i=[];for(const l of t.options){const u=l._zod.run({value:a.value,issues:[]},o);if(u instanceof Promise)i.push(u),s=!0;else{if(u.issues.length===0)return u;i.push(u)}}return s?Promise.all(i).then(l=>xl(l,a,e,o)):xl(i,a,e,o)}}),Fy=S("$ZodDiscriminatedUnion",(e,t)=>{t.inclusive=!1,Cd.init(e,t);const r=e._zod.parse;re(e._zod,"propValues",()=>{const a={};for(const o of t.options){const s=o._zod.propValues;if(!s||Object.keys(s).length===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(o)}"`);for(const[i,l]of Object.entries(s)){a[i]||(a[i]=new Set);for(const u of l)a[i].add(u)}}return a});const n=To(()=>{var s;const a=t.options,o=new Map;for(const i of a){const l=(s=i._zod.propValues)==null?void 0:s[t.discriminator];if(!l||l.size===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(i)}"`);for(const u of l){if(o.has(u))throw new Error(`Duplicate discriminator value "${String(u)}"`);o.set(u,i)}}return o});e._zod.parse=(a,o)=>{const s=a.value;if(!na(s))return a.issues.push({code:"invalid_type",expected:"object",input:s,inst:e}),a;const i=n.value.get(s==null?void 0:s[t.discriminator]);return i?i._zod.run(a,o):t.unionFallback?r(a,o):(a.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:t.discriminator,input:s,path:[t.discriminator],inst:e}),a)}}),Ly=S("$ZodIntersection",(e,t)=>{_e.init(e,t),e._zod.parse=(r,n)=>{const a=r.value,o=t.left._zod.run({value:a,issues:[]},n),s=t.right._zod.run({value:a,issues:[]},n);return o instanceof Promise||s instanceof Promise?Promise.all([o,s]).then(([l,u])=>Rl(r,l,u)):Rl(r,o,s)}});function Ts(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(Rn(e)&&Rn(t)){const r=Object.keys(t),n=Object.keys(e).filter(o=>r.indexOf(o)!==-1),a={...e,...t};for(const o of n){const s=Ts(e[o],t[o]);if(!s.valid)return{valid:!1,mergeErrorPath:[o,...s.mergeErrorPath]};a[o]=s.data}return{valid:!0,data:a}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const r=[];for(let n=0;n<e.length;n++){const a=e[n],o=t[n],s=Ts(a,o);if(!s.valid)return{valid:!1,mergeErrorPath:[n,...s.mergeErrorPath]};r.push(s.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function Rl(e,t,r){const n=new Map;let a;for(const i of t.issues)if(i.code==="unrecognized_keys"){a??(a=i);for(const l of i.keys)n.has(l)||n.set(l,{}),n.get(l).l=!0}else e.issues.push(i);for(const i of r.issues)if(i.code==="unrecognized_keys")for(const l of i.keys)n.has(l)||n.set(l,{}),n.get(l).r=!0;else e.issues.push(i);const o=[...n].filter(([,i])=>i.l&&i.r).map(([i])=>i);if(o.length&&a&&e.issues.push({...a,keys:o}),hn(e))return e;const s=Ts(t.value,r.value);if(!s.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(s.mergeErrorPath)}`);return e.value=s.data,e}const Vy=S("$ZodRecord",(e,t)=>{_e.init(e,t),e._zod.parse=(r,n)=>{const a=r.value;if(!Rn(a))return r.issues.push({expected:"record",code:"invalid_type",input:a,inst:e}),r;const o=[],s=t.keyType._zod.values;if(s){r.value={};const i=new Set;for(const u of s)if(typeof u=="string"||typeof u=="number"||typeof u=="symbol"){i.add(typeof u=="number"?u.toString():u);const c=t.valueType._zod.run({value:a[u],issues:[]},n);c instanceof Promise?o.push(c.then(p=>{p.issues.length&&r.issues.push(...mn(u,p.issues)),r.value[u]=p.value})):(c.issues.length&&r.issues.push(...mn(u,c.issues)),r.value[u]=c.value)}let l;for(const u in a)i.has(u)||(l=l??[],l.push(u));l&&l.length>0&&r.issues.push({code:"unrecognized_keys",input:a,inst:e,keys:l})}else{r.value={};for(const i of Reflect.ownKeys(a)){if(i==="__proto__")continue;let l=t.keyType._zod.run({value:i,issues:[]},n);if(l instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(typeof i=="string"&&Td.test(i)&&l.issues.length){const p=t.keyType._zod.run({value:Number(i),issues:[]},n);if(p instanceof Promise)throw new Error("Async schemas not supported in object keys currently");p.issues.length===0&&(l=p)}if(l.issues.length){t.mode==="loose"?r.value[i]=a[i]:r.issues.push({code:"invalid_key",origin:"record",issues:l.issues.map(p=>Tr(p,n,Ir())),input:i,path:[i],inst:e});continue}const c=t.valueType._zod.run({value:a[i],issues:[]},n);c instanceof Promise?o.push(c.then(p=>{p.issues.length&&r.issues.push(...mn(i,p.issues)),r.value[l.value]=p.value})):(c.issues.length&&r.issues.push(...mn(i,c.issues)),r.value[l.value]=c.value)}}return o.length?Promise.all(o).then(()=>r):r}}),Gy=S("$ZodEnum",(e,t)=>{_e.init(e,t);const r=hd(t.entries),n=new Set(r);e._zod.values=n,e._zod.pattern=new RegExp(`^(${r.filter(a=>ev.has(typeof a)).map(a=>typeof a=="string"?Mn(a):a.toString()).join("|")})$`),e._zod.parse=(a,o)=>{const s=a.value;return n.has(s)||a.issues.push({code:"invalid_value",values:r,input:s,inst:e}),a}}),By=S("$ZodLiteral",(e,t)=>{if(_e.init(e,t),t.values.length===0)throw new Error("Cannot create literal schema with no valid values");const r=new Set(t.values);e._zod.values=r,e._zod.pattern=new RegExp(`^(${t.values.map(n=>typeof n=="string"?Mn(n):n?Mn(n.toString()):String(n)).join("|")})$`),e._zod.parse=(n,a)=>{const o=n.value;return r.has(o)||n.issues.push({code:"invalid_value",values:t.values,input:o,inst:e}),n}}),Jy=S("$ZodTransform",(e,t)=>{_e.init(e,t),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new pd(e.constructor.name);const a=t.transform(r.value,r);if(n.async)return(a instanceof Promise?a:Promise.resolve(a)).then(s=>(r.value=s,r));if(a instanceof Promise)throw new gn;return r.value=a,r}});function Ml(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const Ad=S("$ZodOptional",(e,t)=>{_e.init(e,t),e._zod.optin="optional",e._zod.optout="optional",re(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),re(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${Gs(r.source)})?$`):void 0}),e._zod.parse=(r,n)=>{if(t.innerType._zod.optin==="optional"){const a=t.innerType._zod.run(r,n);return a instanceof Promise?a.then(o=>Ml(o,r.value)):Ml(a,r.value)}return r.value===void 0?r:t.innerType._zod.run(r,n)}}),Hy=S("$ZodExactOptional",(e,t)=>{Ad.init(e,t),re(e._zod,"values",()=>t.innerType._zod.values),re(e._zod,"pattern",()=>t.innerType._zod.pattern),e._zod.parse=(r,n)=>t.innerType._zod.run(r,n)}),Wy=S("$ZodNullable",(e,t)=>{_e.init(e,t),re(e._zod,"optin",()=>t.innerType._zod.optin),re(e._zod,"optout",()=>t.innerType._zod.optout),re(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${Gs(r.source)}|null)$`):void 0}),re(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(r,n)=>r.value===null?r:t.innerType._zod.run(r,n)}),Yy=S("$ZodDefault",(e,t)=>{_e.init(e,t),e._zod.optin="optional",re(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);if(r.value===void 0)return r.value=t.defaultValue,r;const a=t.innerType._zod.run(r,n);return a instanceof Promise?a.then(o=>Ol(o,t)):Ol(a,t)}});function Ol(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const Ky=S("$ZodPrefault",(e,t)=>{_e.init(e,t),e._zod.optin="optional",re(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>(n.direction==="backward"||r.value===void 0&&(r.value=t.defaultValue),t.innerType._zod.run(r,n))}),Xy=S("$ZodNonOptional",(e,t)=>{_e.init(e,t),re(e._zod,"values",()=>{const r=t.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),e._zod.parse=(r,n)=>{const a=t.innerType._zod.run(r,n);return a instanceof Promise?a.then(o=>kl(o,e)):kl(a,e)}});function kl(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const Qy=S("$ZodCatch",(e,t)=>{_e.init(e,t),re(e._zod,"optin",()=>t.innerType._zod.optin),re(e._zod,"optout",()=>t.innerType._zod.optout),re(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const a=t.innerType._zod.run(r,n);return a instanceof Promise?a.then(o=>(r.value=o.value,o.issues.length&&(r.value=t.catchValue({...r,error:{issues:o.issues.map(s=>Tr(s,n,Ir()))},input:r.value}),r.issues=[]),r)):(r.value=a.value,a.issues.length&&(r.value=t.catchValue({...r,error:{issues:a.issues.map(o=>Tr(o,n,Ir()))},input:r.value}),r.issues=[]),r)}}),ew=S("$ZodPipe",(e,t)=>{_e.init(e,t),re(e._zod,"values",()=>t.in._zod.values),re(e._zod,"optin",()=>t.in._zod.optin),re(e._zod,"optout",()=>t.out._zod.optout),re(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(r,n)=>{if(n.direction==="backward"){const o=t.out._zod.run(r,n);return o instanceof Promise?o.then(s=>za(s,t.in,n)):za(o,t.in,n)}const a=t.in._zod.run(r,n);return a instanceof Promise?a.then(o=>za(o,t.out,n)):za(a,t.out,n)}});function za(e,t,r){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},r)}const tw=S("$ZodReadonly",(e,t)=>{_e.init(e,t),re(e._zod,"propValues",()=>t.innerType._zod.propValues),re(e._zod,"values",()=>t.innerType._zod.values),re(e._zod,"optin",()=>{var r,n;return(n=(r=t.innerType)==null?void 0:r._zod)==null?void 0:n.optin}),re(e._zod,"optout",()=>{var r,n;return(n=(r=t.innerType)==null?void 0:r._zod)==null?void 0:n.optout}),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const a=t.innerType._zod.run(r,n);return a instanceof Promise?a.then(Cl):Cl(a)}});function Cl(e){return e.value=Object.freeze(e.value),e}const rw=S("$ZodLazy",(e,t)=>{_e.init(e,t),re(e._zod,"innerType",()=>t.getter()),re(e._zod,"pattern",()=>{var r,n;return(n=(r=e._zod.innerType)==null?void 0:r._zod)==null?void 0:n.pattern}),re(e._zod,"propValues",()=>{var r,n;return(n=(r=e._zod.innerType)==null?void 0:r._zod)==null?void 0:n.propValues}),re(e._zod,"optin",()=>{var r,n;return((n=(r=e._zod.innerType)==null?void 0:r._zod)==null?void 0:n.optin)??void 0}),re(e._zod,"optout",()=>{var r,n;return((n=(r=e._zod.innerType)==null?void 0:r._zod)==null?void 0:n.optout)??void 0}),e._zod.parse=(r,n)=>e._zod.innerType._zod.run(r,n)}),nw=S("$ZodCustom",(e,t)=>{ft.init(e,t),_e.init(e,t),e._zod.parse=(r,n)=>r,e._zod.check=r=>{const n=r.value,a=t.fn(n);if(a instanceof Promise)return a.then(o=>Al(o,r,n,e));Al(a,r,n,e)}});function Al(e,t,r,n){if(!e){const a={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(a.params=n._zod.def.params),t.issues.push(aa(a))}}var Nl;class aw{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...r){const n=r[0];return this._map.set(t,n),n&&typeof n=="object"&&"id"in n&&this._idmap.set(n.id,t),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const r=this._map.get(t);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(t),this}get(t){const r=t._zod.parent;if(r){const n={...this.get(r)??{}};delete n.id;const a={...n,...this._map.get(t)};return Object.keys(a).length?a:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function ow(){return new aw}(Nl=globalThis).__zod_globalRegistry??(Nl.__zod_globalRegistry=ow());const Wn=globalThis.__zod_globalRegistry;function sw(e,t){return new e({type:"string",...j(t)})}function iw(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...j(t)})}function Pl(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...j(t)})}function lw(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...j(t)})}function uw(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...j(t)})}function cw(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...j(t)})}function dw(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...j(t)})}function pw(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...j(t)})}function fw(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...j(t)})}function hw(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...j(t)})}function mw(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...j(t)})}function gw(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...j(t)})}function vw(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...j(t)})}function yw(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...j(t)})}function ww(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...j(t)})}function bw(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...j(t)})}function _w(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...j(t)})}function Iw(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...j(t)})}function Tw(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...j(t)})}function Sw(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...j(t)})}function Ew(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...j(t)})}function xw(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...j(t)})}function Rw(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...j(t)})}function Mw(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...j(t)})}function Ow(e,t){return new e({type:"string",format:"date",check:"string_format",...j(t)})}function kw(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...j(t)})}function Cw(e,t){return new e({type:"string",format:"duration",check:"string_format",...j(t)})}function Aw(e,t){return new e({type:"number",checks:[],...j(t)})}function Nw(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...j(t)})}function Pw(e,t){return new e({type:"boolean",...j(t)})}function $w(e,t){return new e({type:"null",...j(t)})}function Dw(e){return new e({type:"any"})}function jw(e){return new e({type:"unknown"})}function zw(e,t){return new e({type:"never",...j(t)})}function $l(e,t){return new Ed({check:"less_than",...j(t),value:e,inclusive:!1})}function ns(e,t){return new Ed({check:"less_than",...j(t),value:e,inclusive:!0})}function Dl(e,t){return new xd({check:"greater_than",...j(t),value:e,inclusive:!1})}function as(e,t){return new xd({check:"greater_than",...j(t),value:e,inclusive:!0})}function jl(e,t){return new Hv({check:"multiple_of",...j(t),value:e})}function Nd(e,t){return new Yv({check:"max_length",...j(t),maximum:e})}function io(e,t){return new Kv({check:"min_length",...j(t),minimum:e})}function Pd(e,t){return new Xv({check:"length_equals",...j(t),length:e})}function Uw(e,t){return new Qv({check:"string_format",format:"regex",...j(t),pattern:e})}function Zw(e){return new ey({check:"string_format",format:"lowercase",...j(e)})}function qw(e){return new ty({check:"string_format",format:"uppercase",...j(e)})}function Fw(e,t){return new ry({check:"string_format",format:"includes",...j(t),includes:e})}function Lw(e,t){return new ny({check:"string_format",format:"starts_with",...j(t),prefix:e})}function Vw(e,t){return new ay({check:"string_format",format:"ends_with",...j(t),suffix:e})}function Dn(e){return new oy({check:"overwrite",tx:e})}function Gw(e){return Dn(t=>t.normalize(e))}function Bw(){return Dn(e=>e.trim())}function Jw(){return Dn(e=>e.toLowerCase())}function Hw(){return Dn(e=>e.toUpperCase())}function Ww(){return Dn(e=>Xg(e))}function Yw(e,t,r){return new e({type:"array",element:t,...j(r)})}function Kw(e,t,r){const n=j(r);return n.abort??(n.abort=!0),new e({type:"custom",check:"custom",fn:t,...n})}function Xw(e,t,r){return new e({type:"custom",check:"custom",fn:t,...j(r)})}function Qw(e){const t=eb(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(aa(n,r.value,t._zod.def));else{const a=n;a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=r.value),a.inst??(a.inst=t),a.continue??(a.continue=!t._zod.def.abort),r.issues.push(aa(a))}},e(r.value,r)));return t}function eb(e,t){const r=new ft({check:"custom",...j(t)});return r._zod.check=e,r}function lo(e){let t=(e==null?void 0:e.target)??"draft-2020-12";return t==="draft-4"&&(t="draft-04"),t==="draft-7"&&(t="draft-07"),{processors:e.processors??{},metadataRegistry:(e==null?void 0:e.metadata)??Wn,target:t,unrepresentable:(e==null?void 0:e.unrepresentable)??"throw",override:(e==null?void 0:e.override)??(()=>{}),io:(e==null?void 0:e.io)??"output",counter:0,seen:new Map,cycles:(e==null?void 0:e.cycles)??"ref",reused:(e==null?void 0:e.reused)??"inline",external:(e==null?void 0:e.external)??void 0}}function be(e,t,r={path:[],schemaPath:[]}){var c,p;var n;const a=e._zod.def,o=t.seen.get(e);if(o)return o.count++,r.schemaPath.includes(e)&&(o.cycle=r.path),o.schema;const s={schema:{},count:1,cycle:void 0,path:r.path};t.seen.set(e,s);const i=(p=(c=e._zod).toJSONSchema)==null?void 0:p.call(c);if(i)s.schema=i;else{const d={...r,schemaPath:[...r.schemaPath,e],path:r.path};if(e._zod.processJSONSchema)e._zod.processJSONSchema(t,s.schema,d);else{const m=s.schema,h=t.processors[a.type];if(!h)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${a.type}`);h(e,t,m,d)}const f=e._zod.parent;f&&(s.ref||(s.ref=f),be(f,t,d),t.seen.get(f).isParent=!0)}const l=t.metadataRegistry.get(e);return l&&Object.assign(s.schema,l),t.io==="input"&&st(e)&&(delete s.schema.examples,delete s.schema.default),t.io==="input"&&s.schema._prefault&&((n=s.schema).default??(n.default=s.schema._prefault)),delete s.schema._prefault,t.seen.get(e).schema}function uo(e,t){var s,i,l,u;const r=e.seen.get(t);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");const n=new Map;for(const c of e.seen.entries()){const p=(s=e.metadataRegistry.get(c[0]))==null?void 0:s.id;if(p){const d=n.get(p);if(d&&d!==c[0])throw new Error(`Duplicate schema id "${p}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);n.set(p,c[0])}}const a=c=>{var h;const p=e.target==="draft-2020-12"?"$defs":"definitions";if(e.external){const g=(h=e.external.registry.get(c[0]))==null?void 0:h.id,w=e.external.uri??(y=>y);if(g)return{ref:w(g)};const b=c[1].defId??c[1].schema.id??`schema${e.counter++}`;return c[1].defId=b,{defId:b,ref:`${w("__shared")}#/${p}/${b}`}}if(c[1]===r)return{ref:"#"};const f=`#/${p}/`,m=c[1].schema.id??`__schema${e.counter++}`;return{defId:m,ref:f+m}},o=c=>{if(c[1].schema.$ref)return;const p=c[1],{ref:d,defId:f}=a(c);p.def={...p.schema},f&&(p.defId=f);const m=p.schema;for(const h in m)delete m[h];m.$ref=d};if(e.cycles==="throw")for(const c of e.seen.entries()){const p=c[1];if(p.cycle)throw new Error(`Cycle detected: #/${(i=p.cycle)==null?void 0:i.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const c of e.seen.entries()){const p=c[1];if(t===c[0]){o(c);continue}if(e.external){const f=(l=e.external.registry.get(c[0]))==null?void 0:l.id;if(t!==c[0]&&f){o(c);continue}}if((u=e.metadataRegistry.get(c[0]))==null?void 0:u.id){o(c);continue}if(p.cycle){o(c);continue}if(p.count>1&&e.reused==="ref"){o(c);continue}}}function co(e,t){var s,i,l;const r=e.seen.get(t);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");const n=u=>{const c=e.seen.get(u);if(c.ref===null)return;const p=c.def??c.schema,d={...p},f=c.ref;if(c.ref=null,f){n(f);const h=e.seen.get(f),g=h.schema;if(g.$ref&&(e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0")?(p.allOf=p.allOf??[],p.allOf.push(g)):Object.assign(p,g),Object.assign(p,d),u._zod.parent===f)for(const b in p)b==="$ref"||b==="allOf"||b in d||delete p[b];if(g.$ref&&h.def)for(const b in p)b==="$ref"||b==="allOf"||b in h.def&&JSON.stringify(p[b])===JSON.stringify(h.def[b])&&delete p[b]}const m=u._zod.parent;if(m&&m!==f){n(m);const h=e.seen.get(m);if(h!=null&&h.schema.$ref&&(p.$ref=h.schema.$ref,h.def))for(const g in p)g==="$ref"||g==="allOf"||g in h.def&&JSON.stringify(p[g])===JSON.stringify(h.def[g])&&delete p[g]}e.override({zodSchema:u,jsonSchema:p,path:c.path??[]})};for(const u of[...e.seen.entries()].reverse())n(u[0]);const a={};if(e.target==="draft-2020-12"?a.$schema="https://json-schema.org/draft/2020-12/schema":e.target==="draft-07"?a.$schema="http://json-schema.org/draft-07/schema#":e.target==="draft-04"?a.$schema="http://json-schema.org/draft-04/schema#":e.target,(s=e.external)!=null&&s.uri){const u=(i=e.external.registry.get(t))==null?void 0:i.id;if(!u)throw new Error("Schema is missing an `id` property");a.$id=e.external.uri(u)}Object.assign(a,r.def??r.schema);const o=((l=e.external)==null?void 0:l.defs)??{};for(const u of e.seen.entries()){const c=u[1];c.def&&c.defId&&(o[c.defId]=c.def)}e.external||Object.keys(o).length>0&&(e.target==="draft-2020-12"?a.$defs=o:a.definitions=o);try{const u=JSON.parse(JSON.stringify(a));return Object.defineProperty(u,"~standard",{value:{...t["~standard"],jsonSchema:{input:po(t,"input",e.processors),output:po(t,"output",e.processors)}},enumerable:!1,writable:!1}),u}catch{throw new Error("Error converting schema to JSON.")}}function st(e,t){const r=t??{seen:new Set};if(r.seen.has(e))return!1;r.seen.add(e);const n=e._zod.def;if(n.type==="transform")return!0;if(n.type==="array")return st(n.element,r);if(n.type==="set")return st(n.valueType,r);if(n.type==="lazy")return st(n.getter(),r);if(n.type==="promise"||n.type==="optional"||n.type==="nonoptional"||n.type==="nullable"||n.type==="readonly"||n.type==="default"||n.type==="prefault")return st(n.innerType,r);if(n.type==="intersection")return st(n.left,r)||st(n.right,r);if(n.type==="record"||n.type==="map")return st(n.keyType,r)||st(n.valueType,r);if(n.type==="pipe")return st(n.in,r)||st(n.out,r);if(n.type==="object"){for(const a in n.shape)if(st(n.shape[a],r))return!0;return!1}if(n.type==="union"){for(const a of n.options)if(st(a,r))return!0;return!1}if(n.type==="tuple"){for(const a of n.items)if(st(a,r))return!0;return!!(n.rest&&st(n.rest,r))}return!1}const tb=(e,t={})=>r=>{const n=lo({...r,processors:t});return be(e,n),uo(n,e),co(n,e)},po=(e,t,r={})=>n=>{const{libraryOptions:a,target:o}=n??{},s=lo({...a??{},target:o,io:t,processors:r});return be(e,s),uo(s,e),co(s,e)},rb={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},$d=(e,t,r,n)=>{const a=r;a.type="string";const{minimum:o,maximum:s,format:i,patterns:l,contentEncoding:u}=e._zod.bag;if(typeof o=="number"&&(a.minLength=o),typeof s=="number"&&(a.maxLength=s),i&&(a.format=rb[i]??i,a.format===""&&delete a.format,i==="time"&&delete a.format),u&&(a.contentEncoding=u),l&&l.size>0){const c=[...l];c.length===1?a.pattern=c[0].source:c.length>1&&(a.allOf=[...c.map(p=>({...t.target==="draft-07"||t.target==="draft-04"||t.target==="openapi-3.0"?{type:"string"}:{},pattern:p.source}))])}},Dd=(e,t,r,n)=>{const a=r,{minimum:o,maximum:s,format:i,multipleOf:l,exclusiveMaximum:u,exclusiveMinimum:c}=e._zod.bag;typeof i=="string"&&i.includes("int")?a.type="integer":a.type="number",typeof c=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(a.minimum=c,a.exclusiveMinimum=!0):a.exclusiveMinimum=c),typeof o=="number"&&(a.minimum=o,typeof c=="number"&&t.target!=="draft-04"&&(c>=o?delete a.minimum:delete a.exclusiveMinimum)),typeof u=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(a.maximum=u,a.exclusiveMaximum=!0):a.exclusiveMaximum=u),typeof s=="number"&&(a.maximum=s,typeof u=="number"&&t.target!=="draft-04"&&(u<=s?delete a.maximum:delete a.exclusiveMaximum)),typeof l=="number"&&(a.multipleOf=l)},jd=(e,t,r,n)=>{r.type="boolean"},nb=(e,t,r,n)=>{if(t.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema")},ab=(e,t,r,n)=>{if(t.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema")},zd=(e,t,r,n)=>{t.target==="openapi-3.0"?(r.type="string",r.nullable=!0,r.enum=[null]):r.type="null"},ob=(e,t,r,n)=>{if(t.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema")},sb=(e,t,r,n)=>{if(t.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema")},Ud=(e,t,r,n)=>{r.not={}},Zd=(e,t,r,n)=>{},qd=(e,t,r,n)=>{},ib=(e,t,r,n)=>{if(t.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema")},Fd=(e,t,r,n)=>{const a=e._zod.def,o=hd(a.entries);o.every(s=>typeof s=="number")&&(r.type="number"),o.every(s=>typeof s=="string")&&(r.type="string"),r.enum=o},Ld=(e,t,r,n)=>{const a=e._zod.def,o=[];for(const s of a.values)if(s===void 0){if(t.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof s=="bigint"){if(t.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");o.push(Number(s))}else o.push(s);if(o.length!==0)if(o.length===1){const s=o[0];r.type=s===null?"null":typeof s,t.target==="draft-04"||t.target==="openapi-3.0"?r.enum=[s]:r.const=s}else o.every(s=>typeof s=="number")&&(r.type="number"),o.every(s=>typeof s=="string")&&(r.type="string"),o.every(s=>typeof s=="boolean")&&(r.type="boolean"),o.every(s=>s===null)&&(r.type="null"),r.enum=o},lb=(e,t,r,n)=>{if(t.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema")},ub=(e,t,r,n)=>{const a=r,o=e._zod.pattern;if(!o)throw new Error("Pattern not found in template literal");a.type="string",a.pattern=o.source},cb=(e,t,r,n)=>{const a=r,o={type:"string",format:"binary",contentEncoding:"binary"},{minimum:s,maximum:i,mime:l}=e._zod.bag;s!==void 0&&(o.minLength=s),i!==void 0&&(o.maxLength=i),l?l.length===1?(o.contentMediaType=l[0],Object.assign(a,o)):(Object.assign(a,o),a.anyOf=l.map(u=>({contentMediaType:u}))):Object.assign(a,o)},db=(e,t,r,n)=>{r.type="boolean"},Vd=(e,t,r,n)=>{if(t.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},pb=(e,t,r,n)=>{if(t.unrepresentable==="throw")throw new Error("Function types cannot be represented in JSON Schema")},Gd=(e,t,r,n)=>{if(t.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},fb=(e,t,r,n)=>{if(t.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema")},hb=(e,t,r,n)=>{if(t.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema")},Bd=(e,t,r,n)=>{const a=r,o=e._zod.def,{minimum:s,maximum:i}=e._zod.bag;typeof s=="number"&&(a.minItems=s),typeof i=="number"&&(a.maxItems=i),a.type="array",a.items=be(o.element,t,{...n,path:[...n.path,"items"]})},Jd=(e,t,r,n)=>{var u;const a=r,o=e._zod.def;a.type="object",a.properties={};const s=o.shape;for(const c in s)a.properties[c]=be(s[c],t,{...n,path:[...n.path,"properties",c]});const i=new Set(Object.keys(s)),l=new Set([...i].filter(c=>{const p=o.shape[c]._zod;return t.io==="input"?p.optin===void 0:p.optout===void 0}));l.size>0&&(a.required=Array.from(l)),((u=o.catchall)==null?void 0:u._zod.def.type)==="never"?a.additionalProperties=!1:o.catchall?o.catchall&&(a.additionalProperties=be(o.catchall,t,{...n,path:[...n.path,"additionalProperties"]})):t.io==="output"&&(a.additionalProperties=!1)},Hd=(e,t,r,n)=>{const a=e._zod.def,o=a.inclusive===!1,s=a.options.map((i,l)=>be(i,t,{...n,path:[...n.path,o?"oneOf":"anyOf",l]}));o?r.oneOf=s:r.anyOf=s},Wd=(e,t,r,n)=>{const a=e._zod.def,o=be(a.left,t,{...n,path:[...n.path,"allOf",0]}),s=be(a.right,t,{...n,path:[...n.path,"allOf",1]}),i=u=>"allOf"in u&&Object.keys(u).length===1,l=[...i(o)?o.allOf:[o],...i(s)?s.allOf:[s]];r.allOf=l},mb=(e,t,r,n)=>{const a=r,o=e._zod.def;a.type="array";const s=t.target==="draft-2020-12"?"prefixItems":"items",i=t.target==="draft-2020-12"||t.target==="openapi-3.0"?"items":"additionalItems",l=o.items.map((d,f)=>be(d,t,{...n,path:[...n.path,s,f]})),u=o.rest?be(o.rest,t,{...n,path:[...n.path,i,...t.target==="openapi-3.0"?[o.items.length]:[]]}):null;t.target==="draft-2020-12"?(a.prefixItems=l,u&&(a.items=u)):t.target==="openapi-3.0"?(a.items={anyOf:l},u&&a.items.anyOf.push(u),a.minItems=l.length,u||(a.maxItems=l.length)):(a.items=l,u&&(a.additionalItems=u));const{minimum:c,maximum:p}=e._zod.bag;typeof c=="number"&&(a.minItems=c),typeof p=="number"&&(a.maxItems=p)},Yd=(e,t,r,n)=>{const a=r,o=e._zod.def;a.type="object";const s=o.keyType,i=s._zod.bag,l=i==null?void 0:i.patterns;if(o.mode==="loose"&&l&&l.size>0){const c=be(o.valueType,t,{...n,path:[...n.path,"patternProperties","*"]});a.patternProperties={};for(const p of l)a.patternProperties[p.source]=c}else(t.target==="draft-07"||t.target==="draft-2020-12")&&(a.propertyNames=be(o.keyType,t,{...n,path:[...n.path,"propertyNames"]})),a.additionalProperties=be(o.valueType,t,{...n,path:[...n.path,"additionalProperties"]});const u=s._zod.values;if(u){const c=[...u].filter(p=>typeof p=="string"||typeof p=="number");c.length>0&&(a.required=c)}},Kd=(e,t,r,n)=>{const a=e._zod.def,o=be(a.innerType,t,n),s=t.seen.get(e);t.target==="openapi-3.0"?(s.ref=a.innerType,r.nullable=!0):r.anyOf=[o,{type:"null"}]},Xd=(e,t,r,n)=>{const a=e._zod.def;be(a.innerType,t,n);const o=t.seen.get(e);o.ref=a.innerType},Qd=(e,t,r,n)=>{const a=e._zod.def;be(a.innerType,t,n);const o=t.seen.get(e);o.ref=a.innerType,r.default=JSON.parse(JSON.stringify(a.defaultValue))},ep=(e,t,r,n)=>{const a=e._zod.def;be(a.innerType,t,n);const o=t.seen.get(e);o.ref=a.innerType,t.io==="input"&&(r._prefault=JSON.parse(JSON.stringify(a.defaultValue)))},tp=(e,t,r,n)=>{const a=e._zod.def;be(a.innerType,t,n);const o=t.seen.get(e);o.ref=a.innerType;let s;try{s=a.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}r.default=s},rp=(e,t,r,n)=>{const a=e._zod.def,o=t.io==="input"?a.in._zod.def.type==="transform"?a.out:a.in:a.out;be(o,t,n);const s=t.seen.get(e);s.ref=o},np=(e,t,r,n)=>{const a=e._zod.def;be(a.innerType,t,n);const o=t.seen.get(e);o.ref=a.innerType,r.readOnly=!0},gb=(e,t,r,n)=>{const a=e._zod.def;be(a.innerType,t,n);const o=t.seen.get(e);o.ref=a.innerType},Ys=(e,t,r,n)=>{const a=e._zod.def;be(a.innerType,t,n);const o=t.seen.get(e);o.ref=a.innerType},ap=(e,t,r,n)=>{const a=e._zod.innerType;be(a,t,n);const o=t.seen.get(e);o.ref=a},zl={string:$d,number:Dd,boolean:jd,bigint:nb,symbol:ab,null:zd,undefined:ob,void:sb,never:Ud,any:Zd,unknown:qd,date:ib,enum:Fd,literal:Ld,nan:lb,template_literal:ub,file:cb,success:db,custom:Vd,function:pb,transform:Gd,map:fb,set:hb,array:Bd,object:Jd,union:Hd,intersection:Wd,tuple:mb,record:Yd,nullable:Kd,nonoptional:Xd,default:Qd,prefault:ep,catch:tp,pipe:rp,readonly:np,promise:gb,optional:Ys,lazy:ap};function vb(e,t){if("_idmap"in e){const n=e,a=lo({...t,processors:zl}),o={};for(const l of n._idmap.entries()){const[u,c]=l;be(c,a)}const s={},i={registry:n,uri:t==null?void 0:t.uri,defs:o};a.external=i;for(const l of n._idmap.entries()){const[u,c]=l;uo(a,c),s[u]=co(a,c)}if(Object.keys(o).length>0){const l=a.target==="draft-2020-12"?"$defs":"definitions";s.__shared={[l]:o}}return{schemas:s}}const r=lo({...t,processors:zl});return be(e,r),uo(r,e),co(r,e)}const yb=S("ZodISODateTime",(e,t)=>{wy.init(e,t),Ce.init(e,t)});function wb(e){return Mw(yb,e)}const bb=S("ZodISODate",(e,t)=>{by.init(e,t),Ce.init(e,t)});function _b(e){return Ow(bb,e)}const Ib=S("ZodISOTime",(e,t)=>{_y.init(e,t),Ce.init(e,t)});function Tb(e){return kw(Ib,e)}const Sb=S("ZodISODuration",(e,t)=>{Iy.init(e,t),Ce.init(e,t)});function Eb(e){return Cw(Sb,e)}const xb=(e,t)=>{yd.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:r=>dv(e,r)},flatten:{value:r=>cv(e,r)},addIssue:{value:r=>{e.issues.push(r),e.message=JSON.stringify(e.issues,Is,2)}},addIssues:{value:r=>{e.issues.push(...r),e.message=JSON.stringify(e.issues,Is,2)}},isEmpty:{get(){return e.issues.length===0}}})},Mt=S("ZodError",xb,{Parent:Error}),Rb=Js(Mt),Mb=Hs(Mt),Ob=So(Mt),op=Eo(Mt),kb=hv(Mt),Cb=mv(Mt),Ab=gv(Mt),Nb=vv(Mt),Pb=yv(Mt),$b=wv(Mt),Db=bv(Mt),jb=_v(Mt),Ie=S("ZodType",(e,t)=>(_e.init(e,t),Object.assign(e["~standard"],{jsonSchema:{input:po(e,"input"),output:po(e,"output")}}),e.toJSONSchema=tb(e,{}),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone(xr(t,{checks:[...t.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),{parent:!0}),e.with=e.check,e.clone=(r,n)=>Rr(e,r,n),e.brand=()=>e,e.register=((r,n)=>(r.add(e,n),e)),e.parse=(r,n)=>Rb(e,r,n,{callee:e.parse}),e.safeParse=(r,n)=>Ob(e,r,n),e.parseAsync=async(r,n)=>Mb(e,r,n,{callee:e.parseAsync}),e.safeParseAsync=async(r,n)=>op(e,r,n),e.spa=e.safeParseAsync,e.encode=(r,n)=>kb(e,r,n),e.decode=(r,n)=>Cb(e,r,n),e.encodeAsync=async(r,n)=>Ab(e,r,n),e.decodeAsync=async(r,n)=>Nb(e,r,n),e.safeEncode=(r,n)=>Pb(e,r,n),e.safeDecode=(r,n)=>$b(e,r,n),e.safeEncodeAsync=async(r,n)=>Db(e,r,n),e.safeDecodeAsync=async(r,n)=>jb(e,r,n),e.refine=(r,n)=>e.check(N_(r,n)),e.superRefine=r=>e.check(P_(r)),e.overwrite=r=>e.check(Dn(r)),e.optional=()=>ql(e),e.exactOptional=()=>w_(e),e.nullable=()=>Fl(e),e.nullish=()=>ql(Fl(e)),e.nonoptional=r=>E_(e,r),e.array=()=>H(e),e.or=r=>ke([e,r]),e.and=r=>f_(e,r),e.transform=r=>Ll(e,v_(r)),e.default=r=>I_(e,r),e.prefault=r=>S_(e,r),e.catch=r=>R_(e,r),e.pipe=r=>Ll(e,r),e.readonly=()=>k_(e),e.describe=r=>{const n=e.clone();return Wn.add(n,{description:r}),n},Object.defineProperty(e,"description",{get(){var r;return(r=Wn.get(e))==null?void 0:r.description},configurable:!0}),e.meta=(...r)=>{if(r.length===0)return Wn.get(e);const n=e.clone();return Wn.add(n,r[0]),n},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e.apply=r=>r(e),e)),sp=S("_ZodString",(e,t)=>{Ws.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(n,a,o)=>$d(e,n,a);const r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...n)=>e.check(Uw(...n)),e.includes=(...n)=>e.check(Fw(...n)),e.startsWith=(...n)=>e.check(Lw(...n)),e.endsWith=(...n)=>e.check(Vw(...n)),e.min=(...n)=>e.check(io(...n)),e.max=(...n)=>e.check(Nd(...n)),e.length=(...n)=>e.check(Pd(...n)),e.nonempty=(...n)=>e.check(io(1,...n)),e.lowercase=n=>e.check(Zw(n)),e.uppercase=n=>e.check(qw(n)),e.trim=()=>e.check(Bw()),e.normalize=(...n)=>e.check(Gw(...n)),e.toLowerCase=()=>e.check(Jw()),e.toUpperCase=()=>e.check(Hw()),e.slugify=()=>e.check(Ww())}),zb=S("ZodString",(e,t)=>{Ws.init(e,t),sp.init(e,t),e.email=r=>e.check(iw(Ub,r)),e.url=r=>e.check(pw(Zb,r)),e.jwt=r=>e.check(Rw(t_,r)),e.emoji=r=>e.check(fw(qb,r)),e.guid=r=>e.check(Pl(Ul,r)),e.uuid=r=>e.check(lw(Ua,r)),e.uuidv4=r=>e.check(uw(Ua,r)),e.uuidv6=r=>e.check(cw(Ua,r)),e.uuidv7=r=>e.check(dw(Ua,r)),e.nanoid=r=>e.check(hw(Fb,r)),e.guid=r=>e.check(Pl(Ul,r)),e.cuid=r=>e.check(mw(Lb,r)),e.cuid2=r=>e.check(gw(Vb,r)),e.ulid=r=>e.check(vw(Gb,r)),e.base64=r=>e.check(Sw(Xb,r)),e.base64url=r=>e.check(Ew(Qb,r)),e.xid=r=>e.check(yw(Bb,r)),e.ksuid=r=>e.check(ww(Jb,r)),e.ipv4=r=>e.check(bw(Hb,r)),e.ipv6=r=>e.check(_w(Wb,r)),e.cidrv4=r=>e.check(Iw(Yb,r)),e.cidrv6=r=>e.check(Tw(Kb,r)),e.e164=r=>e.check(xw(e_,r)),e.datetime=r=>e.check(wb(r)),e.date=r=>e.check(_b(r)),e.time=r=>e.check(Tb(r)),e.duration=r=>e.check(Eb(r))});function v(e){return sw(zb,e)}const Ce=S("ZodStringFormat",(e,t)=>{xe.init(e,t),sp.init(e,t)}),Ub=S("ZodEmail",(e,t)=>{cy.init(e,t),Ce.init(e,t)}),Ul=S("ZodGUID",(e,t)=>{ly.init(e,t),Ce.init(e,t)}),Ua=S("ZodUUID",(e,t)=>{uy.init(e,t),Ce.init(e,t)}),Zb=S("ZodURL",(e,t)=>{dy.init(e,t),Ce.init(e,t)}),qb=S("ZodEmoji",(e,t)=>{py.init(e,t),Ce.init(e,t)}),Fb=S("ZodNanoID",(e,t)=>{fy.init(e,t),Ce.init(e,t)}),Lb=S("ZodCUID",(e,t)=>{hy.init(e,t),Ce.init(e,t)}),Vb=S("ZodCUID2",(e,t)=>{my.init(e,t),Ce.init(e,t)}),Gb=S("ZodULID",(e,t)=>{gy.init(e,t),Ce.init(e,t)}),Bb=S("ZodXID",(e,t)=>{vy.init(e,t),Ce.init(e,t)}),Jb=S("ZodKSUID",(e,t)=>{yy.init(e,t),Ce.init(e,t)}),Hb=S("ZodIPv4",(e,t)=>{Ty.init(e,t),Ce.init(e,t)}),Wb=S("ZodIPv6",(e,t)=>{Sy.init(e,t),Ce.init(e,t)}),Yb=S("ZodCIDRv4",(e,t)=>{Ey.init(e,t),Ce.init(e,t)}),Kb=S("ZodCIDRv6",(e,t)=>{xy.init(e,t),Ce.init(e,t)}),Xb=S("ZodBase64",(e,t)=>{Ry.init(e,t),Ce.init(e,t)}),Qb=S("ZodBase64URL",(e,t)=>{Oy.init(e,t),Ce.init(e,t)}),e_=S("ZodE164",(e,t)=>{ky.init(e,t),Ce.init(e,t)}),t_=S("ZodJWT",(e,t)=>{Ay.init(e,t),Ce.init(e,t)}),ip=S("ZodNumber",(e,t)=>{Md.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(n,a,o)=>Dd(e,n,a),e.gt=(n,a)=>e.check(Dl(n,a)),e.gte=(n,a)=>e.check(as(n,a)),e.min=(n,a)=>e.check(as(n,a)),e.lt=(n,a)=>e.check($l(n,a)),e.lte=(n,a)=>e.check(ns(n,a)),e.max=(n,a)=>e.check(ns(n,a)),e.int=n=>e.check(Zl(n)),e.safe=n=>e.check(Zl(n)),e.positive=n=>e.check(Dl(0,n)),e.nonnegative=n=>e.check(as(0,n)),e.negative=n=>e.check($l(0,n)),e.nonpositive=n=>e.check(ns(0,n)),e.multipleOf=(n,a)=>e.check(jl(n,a)),e.step=(n,a)=>e.check(jl(n,a)),e.finite=()=>e;const r=e._zod.bag;e.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),e.isFinite=!0,e.format=r.format??null});function X(e){return Aw(ip,e)}const r_=S("ZodNumberFormat",(e,t)=>{Ny.init(e,t),ip.init(e,t)});function Zl(e){return Nw(r_,e)}const n_=S("ZodBoolean",(e,t)=>{Py.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>jd(e,r,n)});function Q(e){return Pw(n_,e)}const a_=S("ZodNull",(e,t)=>{$y.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>zd(e,r,n)});function o_(e){return $w(a_,e)}const s_=S("ZodAny",(e,t)=>{Dy.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Zd()});function yr(){return Dw(s_)}const i_=S("ZodUnknown",(e,t)=>{jy.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>qd()});function te(){return jw(i_)}const l_=S("ZodNever",(e,t)=>{zy.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Ud(e,r,n)});function oe(e){return zw(l_,e)}const u_=S("ZodArray",(e,t)=>{Uy.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Bd(e,r,n,a),e.element=t.element,e.min=(r,n)=>e.check(io(r,n)),e.nonempty=r=>e.check(io(1,r)),e.max=(r,n)=>e.check(Nd(r,n)),e.length=(r,n)=>e.check(Pd(r,n)),e.unwrap=()=>e.element});function H(e,t){return Yw(u_,e,t)}const lp=S("ZodObject",(e,t)=>{qy.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Jd(e,r,n,a),re(e,"shape",()=>t.shape),e.keyof=()=>Oe(Object.keys(e._zod.def.shape)),e.catchall=r=>e.clone({...e._zod.def,catchall:r}),e.passthrough=()=>e.clone({...e._zod.def,catchall:te()}),e.loose=()=>e.clone({...e._zod.def,catchall:te()}),e.strict=()=>e.clone({...e._zod.def,catchall:oe()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=r=>ov(e,r),e.safeExtend=r=>sv(e,r),e.merge=r=>iv(e,r),e.pick=r=>nv(e,r),e.omit=r=>av(e,r),e.partial=(...r)=>lv(cp,e,r[0]),e.required=(...r)=>uv(dp,e,r[0])});function _(e,t){const r={type:"object",shape:e??{},...j(t)};return new lp(r)}function Te(e,t){return new lp({type:"object",shape:e,catchall:oe(),...j(t)})}const up=S("ZodUnion",(e,t)=>{Cd.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Hd(e,r,n,a),e.options=t.options});function ke(e,t){return new up({type:"union",options:e,...j(t)})}const c_=S("ZodDiscriminatedUnion",(e,t)=>{up.init(e,t),Fy.init(e,t)});function d_(e,t,r){return new c_({type:"union",options:t,discriminator:e,...j(r)})}const p_=S("ZodIntersection",(e,t)=>{Ly.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Wd(e,r,n,a)});function f_(e,t){return new p_({type:"intersection",left:e,right:t})}const h_=S("ZodRecord",(e,t)=>{Vy.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Yd(e,r,n,a),e.keyType=t.keyType,e.valueType=t.valueType});function ar(e,t,r){return new h_({type:"record",keyType:e,valueType:t,...j(r)})}const Ss=S("ZodEnum",(e,t)=>{Gy.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(n,a,o)=>Fd(e,n,a),e.enum=t.entries,e.options=Object.values(t.entries);const r=new Set(Object.keys(t.entries));e.extract=(n,a)=>{const o={};for(const s of n)if(r.has(s))o[s]=t.entries[s];else throw new Error(`Key ${s} not found in enum`);return new Ss({...t,checks:[],...j(a),entries:o})},e.exclude=(n,a)=>{const o={...t.entries};for(const s of n)if(r.has(s))delete o[s];else throw new Error(`Key ${s} not found in enum`);return new Ss({...t,checks:[],...j(a),entries:o})}});function Oe(e,t){const r=Array.isArray(e)?Object.fromEntries(e.map(n=>[n,n])):e;return new Ss({type:"enum",entries:r,...j(t)})}const m_=S("ZodLiteral",(e,t)=>{By.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Ld(e,r,n),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function O(e,t){return new m_({type:"literal",values:Array.isArray(e)?e:[e],...j(t)})}const g_=S("ZodTransform",(e,t)=>{Jy.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Gd(e,r),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new pd(e.constructor.name);r.addIssue=o=>{if(typeof o=="string")r.issues.push(aa(o,r.value,t));else{const s=o;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=e),r.issues.push(aa(s))}};const a=t.transform(r.value,r);return a instanceof Promise?a.then(o=>(r.value=o,r)):(r.value=a,r)}});function v_(e){return new g_({type:"transform",transform:e})}const cp=S("ZodOptional",(e,t)=>{Ad.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Ys(e,r,n,a),e.unwrap=()=>e._zod.def.innerType});function ql(e){return new cp({type:"optional",innerType:e})}const y_=S("ZodExactOptional",(e,t)=>{Hy.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Ys(e,r,n,a),e.unwrap=()=>e._zod.def.innerType});function w_(e){return new y_({type:"optional",innerType:e})}const b_=S("ZodNullable",(e,t)=>{Wy.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Kd(e,r,n,a),e.unwrap=()=>e._zod.def.innerType});function Fl(e){return new b_({type:"nullable",innerType:e})}const __=S("ZodDefault",(e,t)=>{Yy.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Qd(e,r,n,a),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function I_(e,t){return new __({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():gd(t)}})}const T_=S("ZodPrefault",(e,t)=>{Ky.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>ep(e,r,n,a),e.unwrap=()=>e._zod.def.innerType});function S_(e,t){return new T_({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():gd(t)}})}const dp=S("ZodNonOptional",(e,t)=>{Xy.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Xd(e,r,n,a),e.unwrap=()=>e._zod.def.innerType});function E_(e,t){return new dp({type:"nonoptional",innerType:e,...j(t)})}const x_=S("ZodCatch",(e,t)=>{Qy.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>tp(e,r,n,a),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function R_(e,t){return new x_({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const M_=S("ZodPipe",(e,t)=>{ew.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>rp(e,r,n,a),e.in=t.in,e.out=t.out});function Ll(e,t){return new M_({type:"pipe",in:e,out:t})}const O_=S("ZodReadonly",(e,t)=>{tw.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>np(e,r,n,a),e.unwrap=()=>e._zod.def.innerType});function k_(e){return new O_({type:"readonly",innerType:e})}const C_=S("ZodLazy",(e,t)=>{rw.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>ap(e,r,n,a),e.unwrap=()=>e._zod.def.getter()});function A_(e){return new C_({type:"lazy",getter:e})}const Ks=S("ZodCustom",(e,t)=>{nw.init(e,t),Ie.init(e,t),e._zod.processJSONSchema=(r,n,a)=>Vd(e,r)});function pp(e,t){return Kw(Ks,e??(()=>!0),t)}function N_(e,t={}){return Xw(Ks,e,t)}function P_(e){return Qw(e)}function fo(e,t={}){const r=new Ks({type:"custom",check:"custom",fn:n=>n instanceof e,abort:!0,...j(t)});return r._zod.bag.Class=e,r._zod.check=n=>{n.value instanceof e||n.issues.push({code:"invalid_type",expected:e.name,input:n.value,inst:r,path:[...r._zod.def.path??[]]})},r}var oa;(function(e){e.assertEqual=a=>{};function t(a){}e.assertIs=t;function r(a){throw new Error}e.assertNever=r,e.arrayToEnum=a=>{const o={};for(const s of a)o[s]=s;return o},e.getValidEnumValues=a=>{const o=e.objectKeys(a).filter(i=>typeof a[a[i]]!="number"),s={};for(const i of o)s[i]=a[i];return e.objectValues(s)},e.objectValues=a=>e.objectKeys(a).map(function(o){return a[o]}),e.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const o=[];for(const s in a)Object.prototype.hasOwnProperty.call(a,s)&&o.push(s);return o},e.find=(a,o)=>{for(const s of a)if(o(s))return s},e.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function n(a,o=" | "){return a.map(s=>typeof s=="string"?`'${s}'`:s).join(o)}e.joinValues=n,e.jsonStringifyReplacer=(a,o)=>typeof o=="bigint"?o.toString():o})(oa||(oa={}));var Vl;(function(e){e.mergeShapes=(t,r)=>({...t,...r})})(Vl||(Vl={}));oa.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]);oa.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class ho extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}format(t){const r=t||function(o){return o.message},n={_errors:[]},a=o=>{for(const s of o.issues)if(s.code==="invalid_union")s.unionErrors.map(a);else if(s.code==="invalid_return_type")a(s.returnTypeError);else if(s.code==="invalid_arguments")a(s.argumentsError);else if(s.path.length===0)n._errors.push(r(s));else{let i=n,l=0;for(;l<s.path.length;){const u=s.path[l];l===s.path.length-1?(i[u]=i[u]||{_errors:[]},i[u]._errors.push(r(s))):i[u]=i[u]||{_errors:[]},i=i[u],l++}}};return a(this),n}static assert(t){if(!(t instanceof ho))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,oa.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){const r=Object.create(null),n=[];for(const a of this.issues)if(a.path.length>0){const o=a.path[0];r[o]=r[o]||[],r[o].push(t(a))}else n.push(t(a));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}}ho.create=e=>new ho(e);var Gl;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(Gl||(Gl={}));var K;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(K||(K={}));class Bl extends Error{constructor(t,r){super(t),this.name="ParseError",this.type=r.type,this.field=r.field,this.value=r.value,this.line=r.line}}function os(e){}function $_(e){if(typeof e=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:t=os,onError:r=os,onRetry:n=os,onComment:a}=e;let o="",s=!0,i,l="",u="";function c(h){const g=s?h.replace(/^\xEF\xBB\xBF/,""):h,[w,b]=D_(`${o}${g}`);for(const y of w)p(y);o=b,s=!1}function p(h){if(h===""){f();return}if(h.startsWith(":")){a&&a(h.slice(h.startsWith(": ")?2:1));return}const g=h.indexOf(":");if(g!==-1){const w=h.slice(0,g),b=h[g+1]===" "?2:1,y=h.slice(g+b);d(w,y,h);return}d(h,"",h)}function d(h,g,w){switch(h){case"event":u=g;break;case"data":l=`${l}${g}
`;break;case"id":i=g.includes("\0")?void 0:g;break;case"retry":/^\d+$/.test(g)?n(parseInt(g,10)):r(new Bl(`Invalid \`retry\` value: "${g}"`,{type:"invalid-retry",value:g,line:w}));break;default:r(new Bl(`Unknown field "${h.length>20?`${h.slice(0,20)}…`:h}"`,{type:"unknown-field",field:h,value:g,line:w}));break}}function f(){l.length>0&&t({id:i,event:u||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),i=void 0,l="",u=""}function m(h={}){o&&h.consume&&p(o),s=!0,i=void 0,l="",u="",o=""}return{feed:c,reset:m}}function D_(e){const t=[];let r="",n=0;for(;n<e.length;){const a=e.indexOf("\r",n),o=e.indexOf(`
`,n);let s=-1;if(a!==-1&&o!==-1?s=Math.min(a,o):a!==-1?a===e.length-1?s=-1:s=a:o!==-1&&(s=o),s===-1){r=e.slice(n);break}else{const i=e.slice(n,s);t.push(i),n=s+1,e[n-1]==="\r"&&e[n]===`
`&&n++}}return[t,r]}class j_ extends TransformStream{constructor({onError:t,onRetry:r,onComment:n}={}){let a;super({start(o){a=$_({onEvent:s=>{o.enqueue(s)},onError(s){t==="terminate"?o.error(s):typeof t=="function"&&t(s)},onRetry:r,onComment:n})},transform(o){a.feed(o)}})}}var fp={};function Bt(...e){return e.reduce((t,r)=>({...t,...r??{}}),{})}async function Ro(e,t){if(e==null)return Promise.resolve();const r=t==null?void 0:t.abortSignal;return new Promise((n,a)=>{if(r!=null&&r.aborted){a(Jl());return}const o=setTimeout(()=>{s(),n()},e),s=()=>{clearTimeout(o),r==null||r.removeEventListener("abort",i)},i=()=>{s(),a(Jl())};r==null||r.addEventListener("abort",i)})}function Jl(){return new DOMException("Delay was aborted","AbortError")}var St=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get promise(){return this._promise?this._promise:(this._promise=new Promise((e,t)=>{this.status.type==="resolved"?e(this.status.value):this.status.type==="rejected"&&t(this.status.error),this._resolve=e,this._reject=t}),this._promise)}resolve(e){var t;this.status={type:"resolved",value:e},this._promise&&((t=this._resolve)==null||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this._promise&&((t=this._reject)==null||t.call(this,e))}isResolved(){return this.status.type==="resolved"}isRejected(){return this.status.type==="rejected"}isPending(){return this.status.type==="pending"}};function Ta(e){return Object.fromEntries([...e.headers])}var{btoa:z_,atob:U_}=globalThis;function Br(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),r=U_(t);return Uint8Array.from(r,n=>n.codePointAt(0))}function On(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return z_(t)}function Hl(e){return e instanceof Uint8Array?On(e):e}var hp="AI_DownloadError",mp=`vercel.ai.error.${hp}`,Z_=Symbol.for(mp),Wl,Yl,Wa=class extends(Yl=C,Wl=Z_,Yl){constructor({url:e,statusCode:t,statusText:r,cause:n,message:a=n==null?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${n}`}){super({name:hp,message:a,cause:n}),this[Wl]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return C.hasMarker(e,mp)}},jn=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:n="-"}={})=>{const a=()=>{const o=r.length,s=new Array(t);for(let i=0;i<t;i++)s[i]=r[Math.random()*o|0];return s.join("")};if(e==null)return a;if(r.includes(n))throw new Ls({argument:"separator",message:`The separator "${n}" must not be part of the alphabet "${r}".`});return()=>`${e}${n}${a()}`},kn=jn();function Mo(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}function Jr(e){return(e instanceof Error||e instanceof DOMException)&&(e.name==="AbortError"||e.name==="ResponseAborted"||e.name==="TimeoutError")}var q_=["fetch failed","failed to fetch"],F_=["ConnectionRefused","ConnectionClosed","FailedToOpenSocket","ECONNRESET","ECONNREFUSED","ETIMEDOUT","EPIPE"];function L_(e){if(!(e instanceof Error))return!1;const t=e.code;return!!(typeof t=="string"&&F_.includes(t))}function gp({error:e,url:t,requestBodyValues:r}){if(Jr(e))return e;if(e instanceof TypeError&&q_.includes(e.message.toLowerCase())){const n=e.cause;if(n!=null)return new He({message:`Cannot connect to API: ${n.message}`,cause:n,url:t,requestBodyValues:r,isRetryable:!0})}return L_(e)?new He({message:`Cannot connect to API: ${e.message}`,cause:e,url:t,requestBodyValues:r,isRetryable:!0}):e}function Cn(e=globalThis){var t,r,n;return e.window?"runtime/browser":(t=e.navigator)!=null&&t.userAgent?`runtime/${e.navigator.userAgent.toLowerCase()}`:(n=(r=e.process)==null?void 0:r.versions)!=null&&n.node?`runtime/node.js/${e.process.version.substring(0)}`:e.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}function $r(e){if(e==null)return{};const t={};if(e instanceof Headers)e.forEach((r,n)=>{t[n.toLowerCase()]=r});else{Array.isArray(e)||(e=Object.entries(e));for(const[r,n]of e)n!=null&&(t[r.toLowerCase()]=n)}return t}function rt(e,...t){const r=new Headers($r(e)),n=r.get("user-agent")||"";return r.set("user-agent",[n,...t].filter(Boolean).join(" ")),Object.fromEntries(r.entries())}var vp="4.0.13",V_=()=>globalThis.fetch,Es=async({url:e,headers:t={},successfulResponseHandler:r,failedResponseHandler:n,abortSignal:a,fetch:o=V_()})=>{try{const s=await o(e,{method:"GET",headers:rt(t,`ai-sdk/provider-utils/${vp}`,Cn()),signal:a}),i=Ta(s);if(!s.ok){let l;try{l=await n({response:s,url:e,requestBodyValues:{}})}catch(u){throw Jr(u)||He.isInstance(u)?u:new He({message:"Failed to process error response",cause:u,statusCode:s.status,url:e,responseHeaders:i,requestBodyValues:{}})}throw l.value}try{return await r({response:s,url:e,requestBodyValues:{}})}catch(l){throw l instanceof Error&&(Jr(l)||He.isInstance(l))?l:new He({message:"Failed to process successful response",cause:l,statusCode:s.status,url:e,responseHeaders:i,requestBodyValues:{}})}}catch(s){throw gp({error:s,url:e,requestBodyValues:{}})}};function G_(e){return e!=null}function B_({mediaType:e,url:t,supportedUrls:r}){return t=t.toLowerCase(),e=e.toLowerCase(),Object.entries(r).map(([n,a])=>{const o=n.toLowerCase();return o==="*"||o==="*/*"?{mediaTypePrefix:"",regexes:a}:{mediaTypePrefix:o.replace(/\*/,""),regexes:a}}).filter(({mediaTypePrefix:n})=>e.startsWith(n)).flatMap(({regexes:n})=>n).some(n=>n.test(t))}function J_({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:n}){if(typeof e=="string")return e;if(e!=null)throw new Hn({message:`${n} API key must be a string.`});if(typeof process>"u")throw new Hn({message:`${n} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(e=fp[t],e==null)throw new Hn({message:`${n} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if(typeof e!="string")throw new Hn({message:`${n} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}function Ya({settingValue:e,environmentVariableName:t}){if(typeof e=="string")return e;if(!(e!=null||typeof process>"u")&&(e=fp[t],!(e==null||typeof e!="string")))return e}var H_=/"__proto__"\s*:/,W_=/"constructor"\s*:/;function Kl(e){const t=JSON.parse(e);return t===null||typeof t!="object"||H_.test(e)===!1&&W_.test(e)===!1?t:Y_(t)}function Y_(e){let t=[e];for(;t.length;){const r=t;t=[];for(const n of r){if(Object.prototype.hasOwnProperty.call(n,"__proto__"))throw new SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(n,"constructor")&&Object.prototype.hasOwnProperty.call(n.constructor,"prototype"))throw new SyntaxError("Object contains forbidden prototype property");for(const a in n){const o=n[a];o&&typeof o=="object"&&t.push(o)}}}return e}function yp(e){const{stackTraceLimit:t}=Error;try{Error.stackTraceLimit=0}catch{return Kl(e)}try{return Kl(e)}finally{Error.stackTraceLimit=t}}function Xs(e){if(e.type==="object"||Array.isArray(e.type)&&e.type.includes("object")){e.additionalProperties=!1;const{properties:r}=e;if(r!=null)for(const n of Object.keys(r))r[n]=Cr(r[n])}e.items!=null&&(e.items=Array.isArray(e.items)?e.items.map(Cr):Cr(e.items)),e.anyOf!=null&&(e.anyOf=e.anyOf.map(Cr)),e.allOf!=null&&(e.allOf=e.allOf.map(Cr)),e.oneOf!=null&&(e.oneOf=e.oneOf.map(Cr));const{definitions:t}=e;if(t!=null)for(const r of Object.keys(t))t[r]=Cr(t[r]);return e}function Cr(e){return typeof e=="boolean"?e:Xs(e)}var K_=Symbol("Let zodToJsonSchema decide on which parser to use"),Xl={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},X_=e=>typeof e=="string"?{...Xl,name:e}:{...Xl,...e};function gt(){return{}}function Q_(e,t){var r,n,a;const o={type:"array"};return(r=e.type)!=null&&r._def&&((a=(n=e.type)==null?void 0:n._def)==null?void 0:a.typeName)!==K.ZodAny&&(o.items=he(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&(o.minItems=e.minLength.value),e.maxLength&&(o.maxItems=e.maxLength.value),e.exactLength&&(o.minItems=e.exactLength.value,o.maxItems=e.exactLength.value),o}function e0(e){const t={type:"integer",format:"int64"};if(!e.checks)return t;for(const r of e.checks)switch(r.kind){case"min":r.inclusive?t.minimum=r.value:t.exclusiveMinimum=r.value;break;case"max":r.inclusive?t.maximum=r.value:t.exclusiveMaximum=r.value;break;case"multipleOf":t.multipleOf=r.value;break}return t}function t0(){return{type:"boolean"}}function wp(e,t){return he(e.type._def,t)}var r0=(e,t)=>he(e.innerType._def,t);function bp(e,t,r){const n=r??t.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((a,o)=>bp(e,t,a))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return n0(e)}}var n0=e=>{const t={type:"integer",format:"unix-time"};for(const r of e.checks)switch(r.kind){case"min":t.minimum=r.value;break;case"max":t.maximum=r.value;break}return t};function a0(e,t){return{...he(e.innerType._def,t),default:e.defaultValue()}}function o0(e,t){return t.effectStrategy==="input"?he(e.schema._def,t):gt()}function s0(e){return{type:"string",enum:Array.from(e.values)}}var i0=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function l0(e,t){const r=[he(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),he(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(a=>!!a),n=[];return r.forEach(a=>{if(i0(a))n.push(...a.allOf);else{let o=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:s,...i}=a;o=i}n.push(o)}}),n.length?{allOf:n}:void 0}function u0(e){const t=typeof e.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(e.value)?"array":"object"}:{type:t==="bigint"?"integer":t,const:e.value}}var ss=void 0,At={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(ss===void 0&&(ss=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),ss),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function _p(e,t){const r={type:"string"};if(e.checks)for(const n of e.checks)switch(n.kind){case"min":r.minLength=typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value;break;case"max":r.maxLength=typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value;break;case"email":switch(t.emailStrategy){case"format:email":Nt(r,"email",n.message,t);break;case"format:idn-email":Nt(r,"idn-email",n.message,t);break;case"pattern:zod":ot(r,At.email,n.message,t);break}break;case"url":Nt(r,"uri",n.message,t);break;case"uuid":Nt(r,"uuid",n.message,t);break;case"regex":ot(r,n.regex,n.message,t);break;case"cuid":ot(r,At.cuid,n.message,t);break;case"cuid2":ot(r,At.cuid2,n.message,t);break;case"startsWith":ot(r,RegExp(`^${is(n.value,t)}`),n.message,t);break;case"endsWith":ot(r,RegExp(`${is(n.value,t)}$`),n.message,t);break;case"datetime":Nt(r,"date-time",n.message,t);break;case"date":Nt(r,"date",n.message,t);break;case"time":Nt(r,"time",n.message,t);break;case"duration":Nt(r,"duration",n.message,t);break;case"length":r.minLength=typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,r.maxLength=typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value;break;case"includes":{ot(r,RegExp(is(n.value,t)),n.message,t);break}case"ip":{n.version!=="v6"&&Nt(r,"ipv4",n.message,t),n.version!=="v4"&&Nt(r,"ipv6",n.message,t);break}case"base64url":ot(r,At.base64url,n.message,t);break;case"jwt":ot(r,At.jwt,n.message,t);break;case"cidr":{n.version!=="v6"&&ot(r,At.ipv4Cidr,n.message,t),n.version!=="v4"&&ot(r,At.ipv6Cidr,n.message,t);break}case"emoji":ot(r,At.emoji(),n.message,t);break;case"ulid":{ot(r,At.ulid,n.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{Nt(r,"binary",n.message,t);break}case"contentEncoding:base64":{r.contentEncoding="base64";break}case"pattern:zod":{ot(r,At.base64,n.message,t);break}}break}case"nanoid":ot(r,At.nanoid,n.message,t)}return r}function is(e,t){return t.patternStrategy==="escape"?d0(e):e}var c0=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function d0(e){let t="";for(let r=0;r<e.length;r++)c0.has(e[r])||(t+="\\"),t+=e[r];return t}function Nt(e,t,r,n){var a;e.format||(a=e.anyOf)!=null&&a.some(o=>o.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push({format:t,...r&&n.errorMessages&&{errorMessage:{format:r}}})):e.format=t}function ot(e,t,r,n){var a;e.pattern||(a=e.allOf)!=null&&a.some(o=>o.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push({pattern:Ql(t,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):e.pattern=Ql(t,n)}function Ql(e,t){var r;if(!t.applyRegexFlags||!e.flags)return e.source;const n={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},a=n.i?e.source.toLowerCase():e.source;let o="",s=!1,i=!1,l=!1;for(let u=0;u<a.length;u++){if(s){o+=a[u],s=!1;continue}if(n.i){if(i){if(a[u].match(/[a-z]/)){l?(o+=a[u],o+=`${a[u-2]}-${a[u]}`.toUpperCase(),l=!1):a[u+1]==="-"&&((r=a[u+2])!=null&&r.match(/[a-z]/))?(o+=a[u],l=!0):o+=`${a[u]}${a[u].toUpperCase()}`;continue}}else if(a[u].match(/[a-z]/)){o+=`[${a[u]}${a[u].toUpperCase()}]`;continue}}if(n.m){if(a[u]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(a[u]==="$"){o+=`($|(?=[\r
]))`;continue}}if(n.s&&a[u]==="."){o+=i?`${a[u]}\r
`:`[${a[u]}\r
]`;continue}o+=a[u],a[u]==="\\"?s=!0:i&&a[u]==="]"?i=!1:!i&&a[u]==="["&&(i=!0)}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return o}function Ip(e,t){var r,n,a,o,s,i;const l={type:"object",additionalProperties:(r=he(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]}))!=null?r:t.allowedAdditionalProperties};if(((n=e.keyType)==null?void 0:n._def.typeName)===K.ZodString&&((a=e.keyType._def.checks)!=null&&a.length)){const{type:u,...c}=_p(e.keyType._def,t);return{...l,propertyNames:c}}else{if(((o=e.keyType)==null?void 0:o._def.typeName)===K.ZodEnum)return{...l,propertyNames:{enum:e.keyType._def.values}};if(((s=e.keyType)==null?void 0:s._def.typeName)===K.ZodBranded&&e.keyType._def.type._def.typeName===K.ZodString&&((i=e.keyType._def.type._def.checks)!=null&&i.length)){const{type:u,...c}=wp(e.keyType._def,t);return{...l,propertyNames:c}}}return l}function p0(e,t){if(t.mapStrategy==="record")return Ip(e,t);const r=he(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||gt(),n=he(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||gt();return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function f0(e){const t=e.values,n=Object.keys(e.values).filter(o=>typeof t[t[o]]!="number").map(o=>t[o]),a=Array.from(new Set(n.map(o=>typeof o)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:n}}function h0(){return{not:gt()}}function m0(){return{type:"null"}}var xs={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function g0(e,t){const r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(n=>n._def.typeName in xs&&(!n._def.checks||!n._def.checks.length))){const n=r.reduce((a,o)=>{const s=xs[o._def.typeName];return s&&!a.includes(s)?[...a,s]:a},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=r.reduce((a,o)=>{const s=typeof o._def.value;switch(s){case"string":case"number":case"boolean":return[...a,s];case"bigint":return[...a,"integer"];case"object":if(o._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(n.length===r.length){const a=n.filter((o,s,i)=>i.indexOf(o)===s);return{type:a.length>1?a:a[0],enum:r.reduce((o,s)=>o.includes(s._def.value)?o:[...o,s._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,a)=>[...n,...a._def.values.filter(o=>!n.includes(o))],[])};return v0(e,t)}var v0=(e,t)=>{const r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((n,a)=>he(n._def,{...t,currentPath:[...t.currentPath,"anyOf",`${a}`]})).filter(n=>!!n&&(!t.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function y0(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return{type:[xs[e.innerType._def.typeName],"null"]};const r=he(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function w0(e){const t={type:"number"};if(!e.checks)return t;for(const r of e.checks)switch(r.kind){case"int":t.type="integer";break;case"min":r.inclusive?t.minimum=r.value:t.exclusiveMinimum=r.value;break;case"max":r.inclusive?t.maximum=r.value:t.exclusiveMaximum=r.value;break;case"multipleOf":t.multipleOf=r.value;break}return t}function b0(e,t){const r={type:"object",properties:{}},n=[],a=e.shape();for(const s in a){let i=a[s];if(i===void 0||i._def===void 0)continue;const l=I0(i),u=he(i._def,{...t,currentPath:[...t.currentPath,"properties",s],propertyPath:[...t.currentPath,"properties",s]});u!==void 0&&(r.properties[s]=u,l||n.push(s))}n.length&&(r.required=n);const o=_0(e,t);return o!==void 0&&(r.additionalProperties=o),r}function _0(e,t){if(e.catchall._def.typeName!=="ZodNever")return he(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function I0(e){try{return e.isOptional()}catch{return!0}}var T0=(e,t)=>{var r;if(t.currentPath.toString()===((r=t.propertyPath)==null?void 0:r.toString()))return he(e.innerType._def,t);const n=he(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:gt()},n]}:gt()},S0=(e,t)=>{if(t.pipeStrategy==="input")return he(e.in._def,t);if(t.pipeStrategy==="output")return he(e.out._def,t);const r=he(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),n=he(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(a=>a!==void 0)}};function E0(e,t){return he(e.type._def,t)}function x0(e,t){const n={type:"array",uniqueItems:!0,items:he(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&(n.minItems=e.minSize.value),e.maxSize&&(n.maxItems=e.maxSize.value),n}function R0(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((r,n)=>he(r._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:he(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((r,n)=>he(r._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function M0(){return{not:gt()}}function O0(){return gt()}var k0=(e,t)=>he(e.innerType._def,t),C0=(e,t,r)=>{switch(t){case K.ZodString:return _p(e,r);case K.ZodNumber:return w0(e);case K.ZodObject:return b0(e,r);case K.ZodBigInt:return e0(e);case K.ZodBoolean:return t0();case K.ZodDate:return bp(e,r);case K.ZodUndefined:return M0();case K.ZodNull:return m0();case K.ZodArray:return Q_(e,r);case K.ZodUnion:case K.ZodDiscriminatedUnion:return g0(e,r);case K.ZodIntersection:return l0(e,r);case K.ZodTuple:return R0(e,r);case K.ZodRecord:return Ip(e,r);case K.ZodLiteral:return u0(e);case K.ZodEnum:return s0(e);case K.ZodNativeEnum:return f0(e);case K.ZodNullable:return y0(e,r);case K.ZodOptional:return T0(e,r);case K.ZodMap:return p0(e,r);case K.ZodSet:return x0(e,r);case K.ZodLazy:return()=>e.getter()._def;case K.ZodPromise:return E0(e,r);case K.ZodNaN:case K.ZodNever:return h0();case K.ZodEffects:return o0(e,r);case K.ZodAny:return gt();case K.ZodUnknown:return O0();case K.ZodDefault:return a0(e,r);case K.ZodBranded:return wp(e,r);case K.ZodReadonly:return k0(e,r);case K.ZodCatch:return r0(e,r);case K.ZodPipeline:return S0(e,r);case K.ZodFunction:case K.ZodVoid:case K.ZodSymbol:return;default:return(n=>{})()}},A0=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")};function he(e,t,r=!1){var n;const a=t.seen.get(e);if(t.override){const l=(n=t.override)==null?void 0:n.call(t,e,t,a,r);if(l!==K_)return l}if(a&&!r){const l=N0(a,t);if(l!==void 0)return l}const o={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,o);const s=C0(e,e.typeName,t),i=typeof s=="function"?he(s(),t):s;if(i&&P0(e,t,i),t.postProcess){const l=t.postProcess(i,e,t);return o.jsonSchema=i,l}return o.jsonSchema=i,i}var N0=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:A0(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((r,n)=>t.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),gt()):t.$refStrategy==="seen"?gt():void 0}},P0=(e,t,r)=>(e.description&&(r.description=e.description),r),$0=e=>{const t=X_(e),r=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([n,a])=>[a._def,{def:a._def,path:[...t.basePath,t.definitionPath,n],jsonSchema:void 0}]))}},D0=(e,t)=>{var r;const n=$0(t);let a=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((u,[c,p])=>{var d;return{...u,[c]:(d=he(p._def,{...n,currentPath:[...n.basePath,n.definitionPath,c]},!0))!=null?d:gt()}},{}):void 0;const o=typeof t=="string"?t:(t==null?void 0:t.nameStrategy)==="title"||t==null?void 0:t.name,s=(r=he(e._def,o===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,o]},!1))!=null?r:gt(),i=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;i!==void 0&&(s.title=i);const l=o===void 0?a?{...s,[n.definitionPath]:a}:s:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,o].join("/"),[n.definitionPath]:{...a,[o]:s}};return l.$schema="http://json-schema.org/draft-07/schema#",l},Rs=Symbol.for("vercel.ai.schema");function ye(e){let t;return()=>(t==null&&(t=e()),t)}function Sa(e,{validate:t}={}){return{[Rs]:!0,_type:void 0,get jsonSchema(){return typeof e=="function"&&(e=e()),e},validate:t}}function j0(e){return typeof e=="object"&&e!==null&&Rs in e&&e[Rs]===!0&&"jsonSchema"in e&&"validate"in e}function or(e){return e==null?Sa({properties:{},additionalProperties:!1}):j0(e)?e:"~standard"in e?e["~standard"].vendor==="zod"?me(e):z0(e):e()}function z0(e){return Sa(()=>Xs(e["~standard"].jsonSchema.input({target:"draft-07"})),{validate:async t=>{const r=await e["~standard"].validate(t);return"value"in r?{success:!0,value:r.value}:{success:!1,error:new We({value:t,cause:r.issues})}}})}function U0(e,t){var r;const n=(r=t==null?void 0:t.useReferences)!=null?r:!1;return Sa(()=>D0(e,{$refStrategy:n?"root":"none"}),{validate:async a=>{const o=await e.safeParseAsync(a);return o.success?{success:!0,value:o.data}:{success:!1,error:o.error}}})}function Z0(e,t){var r;const n=(r=t==null?void 0:t.useReferences)!=null?r:!1;return Sa(()=>Xs(vb(e,{target:"draft-7",io:"input",reused:n?"ref":"inline"})),{validate:async a=>{const o=await op(e,a);return o.success?{success:!0,value:o.data}:{success:!1,error:o.error}}})}function q0(e){return"_zod"in e}function me(e,t){return q0(e)?Z0(e,t):U0(e,t)}async function dr({value:e,schema:t,context:r}){const n=await pt({value:e,schema:t,context:r});if(!n.success)throw We.wrap({value:e,cause:n.error,context:r});return n.value}async function pt({value:e,schema:t,context:r}){const n=or(t);try{if(n.validate==null)return{success:!0,value:e,rawValue:e};const a=await n.validate(e);return a.success?{success:!0,value:a.value,rawValue:e}:{success:!1,error:We.wrap({value:e,cause:a.error,context:r}),rawValue:e}}catch(a){return{success:!1,error:We.wrap({value:e,cause:a,context:r}),rawValue:e}}}async function F0({text:e,schema:t}){try{const r=yp(e);return t==null?r:dr({value:r,schema:t})}catch(r){throw xn.isInstance(r)||We.isInstance(r)?r:new xn({text:e,cause:r})}}async function xt({text:e,schema:t}){try{const r=yp(e);return t==null?{success:!0,value:r,rawValue:r}:await pt({value:r,schema:t})}catch(r){return{success:!1,error:xn.isInstance(r)?r:new xn({text:e,cause:r}),rawValue:void 0}}}function Oo({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new j_).pipeThrough(new TransformStream({async transform({data:r},n){r!=="[DONE]"&&n.enqueue(await xt({text:r,schema:t}))}}))}async function sa({provider:e,providerOptions:t,schema:r}){if((t==null?void 0:t[e])==null)return;const n=await pt({value:t[e],schema:r});if(!n.success)throw new Ls({argument:"providerOptions",message:`invalid ${e} provider options`,cause:n.error});return n.value}var L0=()=>globalThis.fetch,Jt=async({url:e,headers:t,body:r,failedResponseHandler:n,successfulResponseHandler:a,abortSignal:o,fetch:s})=>V0({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(r),values:r},failedResponseHandler:n,successfulResponseHandler:a,abortSignal:o,fetch:s}),V0=async({url:e,headers:t={},body:r,successfulResponseHandler:n,failedResponseHandler:a,abortSignal:o,fetch:s=L0()})=>{try{const i=await s(e,{method:"POST",headers:rt(t,`ai-sdk/provider-utils/${vp}`,Cn()),body:r.content,signal:o}),l=Ta(i);if(!i.ok){let u;try{u=await a({response:i,url:e,requestBodyValues:r.values})}catch(c){throw Jr(c)||He.isInstance(c)?c:new He({message:"Failed to process error response",cause:c,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:r.values})}throw u.value}try{return await n({response:i,url:e,requestBodyValues:r.values})}catch(u){throw u instanceof Error&&(Jr(u)||He.isInstance(u))?u:new He({message:"Failed to process successful response",cause:u,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:r.values})}}catch(i){throw gp({error:i,url:e,requestBodyValues:r.values})}};function G0(e){return e}function B0(e){return{...e,type:"dynamic"}}function zn({id:e,inputSchema:t}){return({execute:r,outputSchema:n,needsApproval:a,toModelOutput:o,onInputStart:s,onInputDelta:i,onInputAvailable:l,...u})=>({type:"provider",id:e,args:u,inputSchema:t,outputSchema:n,execute:r,needsApproval:a,toModelOutput:o,onInputStart:s,onInputDelta:i,onInputAvailable:l})}function Qs({id:e,inputSchema:t,outputSchema:r,supportsDeferredResults:n}){return({execute:a,needsApproval:o,toModelOutput:s,onInputStart:i,onInputDelta:l,onInputAvailable:u,...c})=>({type:"provider",id:e,args:c,inputSchema:t,outputSchema:r,execute:a,needsApproval:o,toModelOutput:s,onInputStart:i,onInputDelta:l,onInputAvailable:u,supportsDeferredResults:n})}async function Se(e){return typeof e=="function"&&(e=e()),Promise.resolve(e)}var Hr=({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:n,url:a,requestBodyValues:o})=>{const s=await n.text(),i=Ta(n);if(s.trim()==="")return{responseHeaders:i,value:new He({message:n.statusText,url:a,requestBodyValues:o,statusCode:n.status,responseHeaders:i,responseBody:s,isRetryable:r==null?void 0:r(n)})};try{const l=await F0({text:s,schema:e});return{responseHeaders:i,value:new He({message:t(l),url:a,requestBodyValues:o,statusCode:n.status,responseHeaders:i,responseBody:s,data:l,isRetryable:r==null?void 0:r(n,l)})}}catch{return{responseHeaders:i,value:new He({message:n.statusText,url:a,requestBodyValues:o,statusCode:n.status,responseHeaders:i,responseBody:s,isRetryable:r==null?void 0:r(n)})}}},Tp=e=>async({response:t})=>{const r=Ta(t);if(t.body==null)throw new Fc({});return{responseHeaders:r,value:Oo({stream:t.body,schema:e})}},Ut=e=>async({response:t,url:r,requestBodyValues:n})=>{const a=await t.text(),o=await xt({text:a,schema:e}),s=Ta(t);if(!o.success)throw new He({message:"Invalid JSON response",cause:o.error,statusCode:t.status,responseHeaders:s,responseBody:a,url:r,requestBodyValues:n});return{responseHeaders:s,value:o.value,rawValue:o.rawValue}};function Sp(e){return e==null?void 0:e.replace(/\/$/,"")}function J0(e){return e!=null&&typeof e[Symbol.asyncIterator]=="function"}async function*H0({execute:e,input:t,options:r}){const n=e(t,r);if(J0(n)){let a;for await(const o of n)a=o,yield{type:"preliminary",output:o};yield{type:"final",output:a}}else yield{type:"final",output:await n}}var Ep="3.0.20",W0=ye(()=>me(_({error:_({code:X().nullable(),message:v(),status:v()})}))),Wr=Hr({errorSchema:W0,errorToMessage:e=>e.error.message}),Y0=ye(()=>me(_({outputDimensionality:X().optional(),taskType:Oe(["SEMANTIC_SIMILARITY","CLASSIFICATION","CLUSTERING","RETRIEVAL_DOCUMENT","RETRIEVAL_QUERY","QUESTION_ANSWERING","FACT_VERIFICATION","CODE_RETRIEVAL_QUERY"]).optional()}))),K0=class{constructor(e,t){this.specificationVersion="v3",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:r,providerOptions:n}){const a=await sa({provider:"google",providerOptions:n,schema:Y0});if(e.length>this.maxEmbeddingsPerCall)throw new id({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const o=Bt(await Se(this.config.headers),t);if(e.length===1){const{responseHeaders:u,value:c,rawValue:p}=await Jt({url:`${this.config.baseURL}/models/${this.modelId}:embedContent`,headers:o,body:{model:`models/${this.modelId}`,content:{parts:[{text:e[0]}]},outputDimensionality:a==null?void 0:a.outputDimensionality,taskType:a==null?void 0:a.taskType},failedResponseHandler:Wr,successfulResponseHandler:Ut(Q0),abortSignal:r,fetch:this.config.fetch});return{warnings:[],embeddings:[c.embedding.values],usage:void 0,response:{headers:u,body:p}}}const{responseHeaders:s,value:i,rawValue:l}=await Jt({url:`${this.config.baseURL}/models/${this.modelId}:batchEmbedContents`,headers:o,body:{requests:e.map(u=>({model:`models/${this.modelId}`,content:{role:"user",parts:[{text:u}]},outputDimensionality:a==null?void 0:a.outputDimensionality,taskType:a==null?void 0:a.taskType}))},failedResponseHandler:Wr,successfulResponseHandler:Ut(X0),abortSignal:r,fetch:this.config.fetch});return{warnings:[],embeddings:i.embeddings.map(u=>u.values),usage:void 0,response:{headers:s,body:l}}}},X0=ye(()=>me(_({embeddings:H(_({values:H(X())}))}))),Q0=ye(()=>me(_({embedding:_({values:H(X())})})));function eu(e){var t,r,n,a;if(e==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const o=(t=e.promptTokenCount)!=null?t:0,s=(r=e.candidatesTokenCount)!=null?r:0,i=(n=e.cachedContentTokenCount)!=null?n:0,l=(a=e.thoughtsTokenCount)!=null?a:0;return{inputTokens:{total:o,noCache:o-i,cacheRead:i,cacheWrite:void 0},outputTokens:{total:s+l,text:s,reasoning:l},raw:e}}function Vt(e,t=!0){if(e==null)return;if(eI(e))return t?void 0:typeof e=="object"&&e.description?{type:"object",description:e.description}:{type:"object"};if(typeof e=="boolean")return{type:"boolean",properties:{}};const{type:r,description:n,required:a,properties:o,items:s,allOf:i,anyOf:l,oneOf:u,format:c,const:p,minLength:d,enum:f}=e,m={};if(n&&(m.description=n),a&&(m.required=a),c&&(m.format=c),p!==void 0&&(m.enum=[p]),r)if(Array.isArray(r)){const h=r.includes("null"),g=r.filter(w=>w!=="null");g.length===0?m.type="null":(m.anyOf=g.map(w=>({type:w})),h&&(m.nullable=!0))}else m.type=r;if(f!==void 0&&(m.enum=f),o!=null&&(m.properties=Object.entries(o).reduce((h,[g,w])=>(h[g]=Vt(w,!1),h),{})),s&&(m.items=Array.isArray(s)?s.map(h=>Vt(h,!1)):Vt(s,!1)),i&&(m.allOf=i.map(h=>Vt(h,!1))),l)if(l.some(h=>typeof h=="object"&&(h==null?void 0:h.type)==="null")){const h=l.filter(g=>!(typeof g=="object"&&(g==null?void 0:g.type)==="null"));if(h.length===1){const g=Vt(h[0],!1);typeof g=="object"&&(m.nullable=!0,Object.assign(m,g))}else m.anyOf=h.map(g=>Vt(g,!1)),m.nullable=!0}else m.anyOf=l.map(h=>Vt(h,!1));return u&&(m.oneOf=u.map(h=>Vt(h,!1))),d!==void 0&&(m.minLength=d),m}function eI(e){return e!=null&&typeof e=="object"&&e.type==="object"&&(e.properties==null||Object.keys(e.properties).length===0)&&!e.additionalProperties}function tI(e,t){var r,n,a;const o=[],s=[];let i=!0;const l=(r=t==null?void 0:t.isGemmaModel)!=null?r:!1,u=(n=t==null?void 0:t.providerOptionsName)!=null?n:"google";for(const{role:c,content:p}of e)switch(c){case"system":{if(!i)throw new _r({functionality:"system messages are only supported at the beginning of the conversation"});o.push({text:p});break}case"user":{i=!1;const d=[];for(const f of p)switch(f.type){case"text":{d.push({text:f.text});break}case"file":{const m=f.mediaType==="image/*"?"image/jpeg":f.mediaType;d.push(f.data instanceof URL?{fileData:{mimeType:m,fileUri:f.data.toString()}}:{inlineData:{mimeType:m,data:Hl(f.data)}});break}}s.push({role:"user",parts:d});break}case"assistant":{i=!1,s.push({role:"model",parts:p.map(d=>{var f;const m=(f=d.providerOptions)==null?void 0:f[u],h=(m==null?void 0:m.thoughtSignature)!=null?String(m.thoughtSignature):void 0;switch(d.type){case"text":return d.text.length===0?void 0:{text:d.text,thoughtSignature:h};case"reasoning":return d.text.length===0?void 0:{text:d.text,thought:!0,thoughtSignature:h};case"file":{if(d.data instanceof URL)throw new _r({functionality:"File data URLs in assistant messages are not supported"});return{inlineData:{mimeType:d.mediaType,data:Hl(d.data)},thoughtSignature:h}}case"tool-call":return{functionCall:{name:d.toolName,args:d.input},thoughtSignature:h}}}).filter(d=>d!==void 0)});break}case"tool":{i=!1;const d=[];for(const f of p){if(f.type==="tool-approval-response")continue;const m=f.output;if(m.type==="content")for(const h of m.value)switch(h.type){case"text":d.push({functionResponse:{name:f.toolName,response:{name:f.toolName,content:h.text}}});break;case"image-data":d.push({inlineData:{mimeType:h.mediaType,data:h.data}},{text:"Tool executed successfully and returned this image as a response"});break;default:d.push({text:JSON.stringify(h)});break}else d.push({functionResponse:{name:f.toolName,response:{name:f.toolName,content:m.type==="execution-denied"?(a=m.reason)!=null?a:"Tool execution denied.":m.value}}})}s.push({role:"user",parts:d});break}}if(l&&o.length>0&&s.length>0&&s[0].role==="user"){const c=o.map(p=>p.text).join(`

`);s[0].parts.unshift({text:c+`

`})}return{systemInstruction:o.length>0&&!l?{parts:o}:void 0,contents:s}}function tu(e){return e.includes("/")?e:`models/${e}`}var ru=ye(()=>me(_({responseModalities:H(Oe(["TEXT","IMAGE"])).optional(),thinkingConfig:_({thinkingBudget:X().optional(),includeThoughts:Q().optional(),thinkingLevel:Oe(["minimal","low","medium","high"]).optional()}).optional(),cachedContent:v().optional(),structuredOutputs:Q().optional(),safetySettings:H(_({category:Oe(["HARM_CATEGORY_UNSPECIFIED","HARM_CATEGORY_HATE_SPEECH","HARM_CATEGORY_DANGEROUS_CONTENT","HARM_CATEGORY_HARASSMENT","HARM_CATEGORY_SEXUALLY_EXPLICIT","HARM_CATEGORY_CIVIC_INTEGRITY"]),threshold:Oe(["HARM_BLOCK_THRESHOLD_UNSPECIFIED","BLOCK_LOW_AND_ABOVE","BLOCK_MEDIUM_AND_ABOVE","BLOCK_ONLY_HIGH","BLOCK_NONE","OFF"])})).optional(),threshold:Oe(["HARM_BLOCK_THRESHOLD_UNSPECIFIED","BLOCK_LOW_AND_ABOVE","BLOCK_MEDIUM_AND_ABOVE","BLOCK_ONLY_HIGH","BLOCK_NONE","OFF"]).optional(),audioTimestamp:Q().optional(),labels:ar(v(),v()).optional(),mediaResolution:Oe(["MEDIA_RESOLUTION_UNSPECIFIED","MEDIA_RESOLUTION_LOW","MEDIA_RESOLUTION_MEDIUM","MEDIA_RESOLUTION_HIGH"]).optional(),imageConfig:_({aspectRatio:Oe(["1:1","2:3","3:2","3:4","4:3","4:5","5:4","9:16","16:9","21:9"]).optional(),imageSize:Oe(["1K","2K","4K"]).optional()}).optional(),retrievalConfig:_({latLng:_({latitude:X(),longitude:X()}).optional()}).optional()})));function rI({tools:e,toolChoice:t,modelId:r}){var n;e=e!=null&&e.length?e:void 0;const a=[],o=["gemini-flash-latest","gemini-flash-lite-latest","gemini-pro-latest"].some(f=>f===r),s=r.includes("gemini-2")||r.includes("gemini-3")||o,i=r.includes("gemini-1.5-flash")&&!r.includes("-8b"),l=r.includes("gemini-2.5")||r.includes("gemini-3");if(e==null)return{tools:void 0,toolConfig:void 0,toolWarnings:a};const u=e.some(f=>f.type==="function"),c=e.some(f=>f.type==="provider");if(u&&c&&a.push({type:"unsupported",feature:"combination of function and provider-defined tools"}),c){const f=[];return e.filter(h=>h.type==="provider").forEach(h=>{switch(h.id){case"google.google_search":s?f.push({googleSearch:{}}):i?f.push({googleSearchRetrieval:{dynamicRetrievalConfig:{mode:h.args.mode,dynamicThreshold:h.args.dynamicThreshold}}}):f.push({googleSearchRetrieval:{}});break;case"google.enterprise_web_search":s?f.push({enterpriseWebSearch:{}}):a.push({type:"unsupported",feature:`provider-defined tool ${h.id}`,details:"Enterprise Web Search requires Gemini 2.0 or newer."});break;case"google.url_context":s?f.push({urlContext:{}}):a.push({type:"unsupported",feature:`provider-defined tool ${h.id}`,details:"The URL context tool is not supported with other Gemini models than Gemini 2."});break;case"google.code_execution":s?f.push({codeExecution:{}}):a.push({type:"unsupported",feature:`provider-defined tool ${h.id}`,details:"The code execution tools is not supported with other Gemini models than Gemini 2."});break;case"google.file_search":l?f.push({fileSearch:{...h.args}}):a.push({type:"unsupported",feature:`provider-defined tool ${h.id}`,details:"The file search tool is only supported with Gemini 2.5 models and Gemini 3 models."});break;case"google.vertex_rag_store":s?f.push({retrieval:{vertex_rag_store:{rag_resources:{rag_corpus:h.args.ragCorpus},similarity_top_k:h.args.topK}}}):a.push({type:"unsupported",feature:`provider-defined tool ${h.id}`,details:"The RAG store tool is not supported with other Gemini models than Gemini 2."});break;case"google.google_maps":s?f.push({googleMaps:{}}):a.push({type:"unsupported",feature:`provider-defined tool ${h.id}`,details:"The Google Maps grounding tool is not supported with Gemini models other than Gemini 2 or newer."});break;default:a.push({type:"unsupported",feature:`provider-defined tool ${h.id}`});break}}),{tools:f.length>0?f:void 0,toolConfig:void 0,toolWarnings:a}}const p=[];for(const f of e)switch(f.type){case"function":p.push({name:f.name,description:(n=f.description)!=null?n:"",parameters:Vt(f.inputSchema)});break;default:a.push({type:"unsupported",feature:`function tool ${f.name}`});break}if(t==null)return{tools:[{functionDeclarations:p}],toolConfig:void 0,toolWarnings:a};const d=t.type;switch(d){case"auto":return{tools:[{functionDeclarations:p}],toolConfig:{functionCallingConfig:{mode:"AUTO"}},toolWarnings:a};case"none":return{tools:[{functionDeclarations:p}],toolConfig:{functionCallingConfig:{mode:"NONE"}},toolWarnings:a};case"required":return{tools:[{functionDeclarations:p}],toolConfig:{functionCallingConfig:{mode:"ANY"}},toolWarnings:a};case"tool":return{tools:[{functionDeclarations:p}],toolConfig:{functionCallingConfig:{mode:"ANY",allowedFunctionNames:[t.toolName]}},toolWarnings:a};default:{const f=d;throw new _r({functionality:`tool choice type: ${f}`})}}}function nu({finishReason:e,hasToolCalls:t}){switch(e){case"STOP":return t?"tool-calls":"stop";case"MAX_TOKENS":return"length";case"IMAGE_SAFETY":case"RECITATION":case"SAFETY":case"BLOCKLIST":case"PROHIBITED_CONTENT":case"SPII":return"content-filter";case"MALFORMED_FUNCTION_CALL":return"error";case"FINISH_REASON_UNSPECIFIED":case"OTHER":default:return"other"}}var nI=class{constructor(e,t){this.specificationVersion="v3";var r;this.modelId=e,this.config=t,this.generateId=(r=t.generateId)!=null?r:kn}get provider(){return this.config.provider}get supportedUrls(){var e,t,r;return(r=(t=(e=this.config).supportedUrls)==null?void 0:t.call(e))!=null?r:{}}async getArgs({prompt:e,maxOutputTokens:t,temperature:r,topP:n,topK:a,frequencyPenalty:o,presencePenalty:s,stopSequences:i,responseFormat:l,seed:u,tools:c,toolChoice:p,providerOptions:d}){var f;const m=[],h=this.config.provider.includes("vertex")?"vertex":"google";let g=await sa({provider:h,providerOptions:d,schema:ru});g==null&&h!=="google"&&(g=await sa({provider:"google",providerOptions:d,schema:ru})),c!=null&&c.some(I=>I.type==="provider"&&I.id==="google.vertex_rag_store")&&!this.config.provider.startsWith("google.vertex.")&&m.push({type:"other",message:`The 'vertex_rag_store' tool is only supported with the Google Vertex provider and might not be supported or could behave unexpectedly with the current Google provider (${this.config.provider}).`});const w=this.modelId.toLowerCase().startsWith("gemma-"),{contents:b,systemInstruction:y}=tI(e,{isGemmaModel:w,providerOptionsName:h}),{tools:T,toolConfig:x,toolWarnings:R}=rI({tools:c,toolChoice:p,modelId:this.modelId});return{args:{generationConfig:{maxOutputTokens:t,temperature:r,topK:a,topP:n,frequencyPenalty:o,presencePenalty:s,stopSequences:i,seed:u,responseMimeType:(l==null?void 0:l.type)==="json"?"application/json":void 0,responseSchema:(l==null?void 0:l.type)==="json"&&l.schema!=null&&((f=g==null?void 0:g.structuredOutputs)==null||f)?Vt(l.schema):void 0,...(g==null?void 0:g.audioTimestamp)&&{audioTimestamp:g.audioTimestamp},responseModalities:g==null?void 0:g.responseModalities,thinkingConfig:g==null?void 0:g.thinkingConfig,...(g==null?void 0:g.mediaResolution)&&{mediaResolution:g.mediaResolution},...(g==null?void 0:g.imageConfig)&&{imageConfig:g.imageConfig}},contents:b,systemInstruction:w?void 0:y,safetySettings:g==null?void 0:g.safetySettings,tools:T,toolConfig:g!=null&&g.retrievalConfig?{...x,retrievalConfig:g.retrievalConfig}:x,cachedContent:g==null?void 0:g.cachedContent,labels:g==null?void 0:g.labels},warnings:[...m,...R],providerOptionsName:h}}async doGenerate(e){var t,r,n,a,o,s,i,l,u;const{args:c,warnings:p,providerOptionsName:d}=await this.getArgs(e),f=Bt(await Se(this.config.headers),e.headers),{responseHeaders:m,value:h,rawValue:g}=await Jt({url:`${this.config.baseURL}/${tu(this.modelId)}:generateContent`,headers:f,body:c,failedResponseHandler:Wr,successfulResponseHandler:Ut(oI),abortSignal:e.abortSignal,fetch:this.config.fetch}),w=h.candidates[0],b=[],y=(r=(t=w.content)==null?void 0:t.parts)!=null?r:[],T=h.usageMetadata;let x;for(const I of y)if("executableCode"in I&&((n=I.executableCode)!=null&&n.code)){const A=this.config.generateId();x=A,b.push({type:"tool-call",toolCallId:A,toolName:"code_execution",input:JSON.stringify(I.executableCode),providerExecuted:!0})}else"codeExecutionResult"in I&&I.codeExecutionResult?(b.push({type:"tool-result",toolCallId:x,toolName:"code_execution",result:{outcome:I.codeExecutionResult.outcome,output:I.codeExecutionResult.output}}),x=void 0):"text"in I&&I.text!=null&&I.text.length>0?b.push({type:I.thought===!0?"reasoning":"text",text:I.text,providerMetadata:I.thoughtSignature?{[d]:{thoughtSignature:I.thoughtSignature}}:void 0}):"functionCall"in I?b.push({type:"tool-call",toolCallId:this.config.generateId(),toolName:I.functionCall.name,input:JSON.stringify(I.functionCall.args),providerMetadata:I.thoughtSignature?{[d]:{thoughtSignature:I.thoughtSignature}}:void 0}):"inlineData"in I&&b.push({type:"file",data:I.inlineData.data,mediaType:I.inlineData.mimeType,providerMetadata:I.thoughtSignature?{[d]:{thoughtSignature:I.thoughtSignature}}:void 0});const R=(a=au({groundingMetadata:w.groundingMetadata,generateId:this.config.generateId}))!=null?a:[];for(const I of R)b.push(I);return{content:b,finishReason:{unified:nu({finishReason:w.finishReason,hasToolCalls:b.some(I=>I.type==="tool-call"&&!I.providerExecuted)}),raw:(o=w.finishReason)!=null?o:void 0},usage:eu(T),warnings:p,providerMetadata:{[d]:{promptFeedback:(s=h.promptFeedback)!=null?s:null,groundingMetadata:(i=w.groundingMetadata)!=null?i:null,urlContextMetadata:(l=w.urlContextMetadata)!=null?l:null,safetyRatings:(u=w.safetyRatings)!=null?u:null,usageMetadata:T??null}},request:{body:c},response:{headers:m,body:g}}}async doStream(e){const{args:t,warnings:r,providerOptionsName:n}=await this.getArgs(e),a=Bt(await Se(this.config.headers),e.headers),{responseHeaders:o,value:s}=await Jt({url:`${this.config.baseURL}/${tu(this.modelId)}:streamGenerateContent?alt=sse`,headers:a,body:t,failedResponseHandler:Wr,successfulResponseHandler:Tp(sI),abortSignal:e.abortSignal,fetch:this.config.fetch});let i={unified:"other",raw:void 0},l,u;const c=this.config.generateId;let p=!1,d=null,f=null,m=0;const h=new Set;let g;return{stream:s.pipeThrough(new TransformStream({start(w){w.enqueue({type:"stream-start",warnings:r})},transform(w,b){var y,T,x,R,I,A,$;if(e.includeRawChunks&&b.enqueue({type:"raw",rawValue:w.rawValue}),!w.success){b.enqueue({type:"error",error:w.error});return}const N=w.value,M=N.usageMetadata;M!=null&&(l=M);const P=(y=N.candidates)==null?void 0:y[0];if(P==null)return;const V=P.content,G=au({groundingMetadata:P.groundingMetadata,generateId:c});if(G!=null)for(const pe of G)pe.sourceType==="url"&&!h.has(pe.url)&&(h.add(pe.url),b.enqueue(pe));if(V!=null){const pe=(T=V.parts)!=null?T:[];for(const D of pe)if("executableCode"in D&&((x=D.executableCode)!=null&&x.code)){const ae=c();g=ae,b.enqueue({type:"tool-call",toolCallId:ae,toolName:"code_execution",input:JSON.stringify(D.executableCode),providerExecuted:!0})}else if("codeExecutionResult"in D&&D.codeExecutionResult){const ae=g;ae&&(b.enqueue({type:"tool-result",toolCallId:ae,toolName:"code_execution",result:{outcome:D.codeExecutionResult.outcome,output:D.codeExecutionResult.output}}),g=void 0)}else"text"in D&&D.text!=null&&D.text.length>0?D.thought===!0?(d!==null&&(b.enqueue({type:"text-end",id:d}),d=null),f===null&&(f=String(m++),b.enqueue({type:"reasoning-start",id:f,providerMetadata:D.thoughtSignature?{[n]:{thoughtSignature:D.thoughtSignature}}:void 0})),b.enqueue({type:"reasoning-delta",id:f,delta:D.text,providerMetadata:D.thoughtSignature?{[n]:{thoughtSignature:D.thoughtSignature}}:void 0})):(f!==null&&(b.enqueue({type:"reasoning-end",id:f}),f=null),d===null&&(d=String(m++),b.enqueue({type:"text-start",id:d,providerMetadata:D.thoughtSignature?{[n]:{thoughtSignature:D.thoughtSignature}}:void 0})),b.enqueue({type:"text-delta",id:d,delta:D.text,providerMetadata:D.thoughtSignature?{[n]:{thoughtSignature:D.thoughtSignature}}:void 0})):"inlineData"in D&&b.enqueue({type:"file",mediaType:D.inlineData.mimeType,data:D.inlineData.data});const ne=aI({parts:V.parts,generateId:c,providerOptionsName:n});if(ne!=null)for(const D of ne)b.enqueue({type:"tool-input-start",id:D.toolCallId,toolName:D.toolName,providerMetadata:D.providerMetadata}),b.enqueue({type:"tool-input-delta",id:D.toolCallId,delta:D.args,providerMetadata:D.providerMetadata}),b.enqueue({type:"tool-input-end",id:D.toolCallId,providerMetadata:D.providerMetadata}),b.enqueue({type:"tool-call",toolCallId:D.toolCallId,toolName:D.toolName,input:D.args,providerMetadata:D.providerMetadata}),p=!0}P.finishReason!=null&&(i={unified:nu({finishReason:P.finishReason,hasToolCalls:p}),raw:P.finishReason},u={[n]:{promptFeedback:(R=N.promptFeedback)!=null?R:null,groundingMetadata:(I=P.groundingMetadata)!=null?I:null,urlContextMetadata:(A=P.urlContextMetadata)!=null?A:null,safetyRatings:($=P.safetyRatings)!=null?$:null}},M!=null&&(u[n].usageMetadata=M))},flush(w){d!==null&&w.enqueue({type:"text-end",id:d}),f!==null&&w.enqueue({type:"reasoning-end",id:f}),w.enqueue({type:"finish",finishReason:i,usage:eu(l),providerMetadata:u})}})),response:{headers:o},request:{body:t}}}};function aI({parts:e,generateId:t,providerOptionsName:r}){const n=e==null?void 0:e.filter(a=>"functionCall"in a);return n==null||n.length===0?void 0:n.map(a=>({type:"tool-call",toolCallId:t(),toolName:a.functionCall.name,args:JSON.stringify(a.functionCall.args),providerMetadata:a.thoughtSignature?{[r]:{thoughtSignature:a.thoughtSignature}}:void 0}))}function au({groundingMetadata:e,generateId:t}){var r,n,a,o,s;if(!(e!=null&&e.groundingChunks))return;const i=[];for(const l of e.groundingChunks)if(l.web!=null)i.push({type:"source",sourceType:"url",id:t(),url:l.web.uri,title:(r=l.web.title)!=null?r:void 0});else if(l.retrievedContext!=null){const u=l.retrievedContext.uri,c=l.retrievedContext.fileSearchStore;if(u&&(u.startsWith("http://")||u.startsWith("https://")))i.push({type:"source",sourceType:"url",id:t(),url:u,title:(n=l.retrievedContext.title)!=null?n:void 0});else if(u){const p=(a=l.retrievedContext.title)!=null?a:"Unknown Document";let d="application/octet-stream",f;u.endsWith(".pdf")?(d="application/pdf",f=u.split("/").pop()):u.endsWith(".txt")?(d="text/plain",f=u.split("/").pop()):u.endsWith(".docx")?(d="application/vnd.openxmlformats-officedocument.wordprocessingml.document",f=u.split("/").pop()):u.endsWith(".doc")?(d="application/msword",f=u.split("/").pop()):(u.match(/\.(md|markdown)$/)&&(d="text/markdown"),f=u.split("/").pop()),i.push({type:"source",sourceType:"document",id:t(),mediaType:d,title:p,filename:f})}else if(c){const p=(o=l.retrievedContext.title)!=null?o:"Unknown Document";i.push({type:"source",sourceType:"document",id:t(),mediaType:"application/octet-stream",title:p,filename:c.split("/").pop()})}}else l.maps!=null&&l.maps.uri&&i.push({type:"source",sourceType:"url",id:t(),url:l.maps.uri,title:(s=l.maps.title)!=null?s:void 0});return i.length>0?i:void 0}var xp=()=>_({webSearchQueries:H(v()).nullish(),retrievalQueries:H(v()).nullish(),searchEntryPoint:_({renderedContent:v()}).nullish(),groundingChunks:H(_({web:_({uri:v(),title:v().nullish()}).nullish(),retrievedContext:_({uri:v().nullish(),title:v().nullish(),text:v().nullish(),fileSearchStore:v().nullish()}).nullish(),maps:_({uri:v().nullish(),title:v().nullish(),text:v().nullish(),placeId:v().nullish()}).nullish()})).nullish(),groundingSupports:H(_({segment:_({startIndex:X().nullish(),endIndex:X().nullish(),text:v().nullish()}).nullish(),segment_text:v().nullish(),groundingChunkIndices:H(X()).nullish(),supportChunkIndices:H(X()).nullish(),confidenceScores:H(X()).nullish(),confidenceScore:H(X()).nullish()})).nullish(),retrievalMetadata:ke([_({webDynamicRetrievalScore:X()}),_({})]).nullish()}),Rp=()=>_({parts:H(ke([_({functionCall:_({name:v(),args:te()}),thoughtSignature:v().nullish()}),_({inlineData:_({mimeType:v(),data:v()}),thoughtSignature:v().nullish()}),_({executableCode:_({language:v(),code:v()}).nullish(),codeExecutionResult:_({outcome:v(),output:v()}).nullish(),text:v().nullish(),thought:Q().nullish(),thoughtSignature:v().nullish()})])).nullish()}),mo=()=>_({category:v().nullish(),probability:v().nullish(),probabilityScore:X().nullish(),severity:v().nullish(),severityScore:X().nullish(),blocked:Q().nullish()}),Mp=_({cachedContentTokenCount:X().nullish(),thoughtsTokenCount:X().nullish(),promptTokenCount:X().nullish(),candidatesTokenCount:X().nullish(),totalTokenCount:X().nullish(),trafficType:v().nullish()}),Op=()=>_({urlMetadata:H(_({retrievedUrl:v(),urlRetrievalStatus:v()}))}),oI=ye(()=>me(_({candidates:H(_({content:Rp().nullish().or(_({}).strict()),finishReason:v().nullish(),safetyRatings:H(mo()).nullish(),groundingMetadata:xp().nullish(),urlContextMetadata:Op().nullish()})),usageMetadata:Mp.nullish(),promptFeedback:_({blockReason:v().nullish(),safetyRatings:H(mo()).nullish()}).nullish()}))),sI=ye(()=>me(_({candidates:H(_({content:Rp().nullish(),finishReason:v().nullish(),safetyRatings:H(mo()).nullish(),groundingMetadata:xp().nullish(),urlContextMetadata:Op().nullish()})).nullish(),usageMetadata:Mp.nullish(),promptFeedback:_({blockReason:v().nullish(),safetyRatings:H(mo()).nullish()}).nullish()}))),iI=Qs({id:"google.code_execution",inputSchema:_({language:v().describe("The programming language of the code."),code:v().describe("The code to be executed.")}),outputSchema:_({outcome:v().describe('The outcome of the execution (e.g., "OUTCOME_OK").'),output:v().describe("The output from the code execution.")})}),lI=zn({id:"google.enterprise_web_search",inputSchema:ye(()=>me(_({})))}),uI=_({fileSearchStoreNames:H(v()).describe("The names of the file_search_stores to retrieve from. Example: `fileSearchStores/my-file-search-store-123`"),topK:X().int().positive().describe("The number of file search retrieval chunks to retrieve.").optional(),metadataFilter:v().describe("Metadata filter to apply to the file search retrieval documents. See https://google.aip.dev/160 for the syntax of the filter expression.").optional()}).passthrough(),cI=ye(()=>me(uI)),dI=zn({id:"google.file_search",inputSchema:cI}),pI=zn({id:"google.google_maps",inputSchema:ye(()=>me(_({})))}),fI=zn({id:"google.google_search",inputSchema:ye(()=>me(_({mode:Oe(["MODE_DYNAMIC","MODE_UNSPECIFIED"]).default("MODE_UNSPECIFIED"),dynamicThreshold:X().default(1)})))}),hI=zn({id:"google.url_context",inputSchema:ye(()=>me(_({})))}),mI=zn({id:"google.vertex_rag_store",inputSchema:_({ragCorpus:v(),topK:X().optional()})}),gI={googleSearch:fI,enterpriseWebSearch:lI,googleMaps:pI,urlContext:hI,fileSearch:dI,codeExecution:iI,vertexRagStore:mI},vI=class{constructor(e,t,r){this.modelId=e,this.settings=t,this.config=r,this.specificationVersion="v3"}get maxImagesPerCall(){var e;return(e=this.settings.maxImagesPerCall)!=null?e:4}get provider(){return this.config.provider}async doGenerate(e){var t,r,n;const{prompt:a,n:o=1,size:s,aspectRatio:i="1:1",seed:l,providerOptions:u,headers:c,abortSignal:p,files:d,mask:f}=e,m=[];if(d!=null&&d.length>0)throw new Error("Google Generative AI does not support image editing. Use Google Vertex AI (@ai-sdk/google-vertex) for image editing capabilities.");if(f!=null)throw new Error("Google Generative AI does not support image editing with masks. Use Google Vertex AI (@ai-sdk/google-vertex) for image editing capabilities.");s!=null&&m.push({type:"unsupported",feature:"size",details:"This model does not support the `size` option. Use `aspectRatio` instead."}),l!=null&&m.push({type:"unsupported",feature:"seed",details:"This model does not support the `seed` option through this provider."});const h=await sa({provider:"google",providerOptions:u,schema:wI}),g=(n=(r=(t=this.config._internal)==null?void 0:t.currentDate)==null?void 0:r.call(t))!=null?n:new Date,w={sampleCount:o};i!=null&&(w.aspectRatio=i),h&&Object.assign(w,h);const b={instances:[{prompt:a}],parameters:w},{responseHeaders:y,value:T}=await Jt({url:`${this.config.baseURL}/models/${this.modelId}:predict`,headers:Bt(await Se(this.config.headers),c),body:b,failedResponseHandler:Wr,successfulResponseHandler:Ut(yI),abortSignal:p,fetch:this.config.fetch});return{images:T.predictions.map(x=>x.bytesBase64Encoded),warnings:m??[],providerMetadata:{google:{images:T.predictions.map(x=>({}))}},response:{timestamp:g,modelId:this.modelId,headers:y}}}},yI=ye(()=>me(_({predictions:H(_({bytesBase64Encoded:v()})).default([])}))),wI=ye(()=>me(_({personGeneration:Oe(["dont_allow","allow_adult","allow_all"]).nullish(),aspectRatio:Oe(["1:1","3:4","4:3","9:16","16:9"]).nullish()}))),bI=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v3"}get provider(){return this.config.provider}get maxVideosPerCall(){return 4}async doGenerate(e){var t,r,n,a,o,s,i,l;const u=(n=(r=(t=this.config._internal)==null?void 0:t.currentDate)==null?void 0:r.call(t))!=null?n:new Date,c=[],p=await sa({provider:"google",providerOptions:e.providerOptions,schema:_I}),d=[{}],f=d[0];if(e.prompt!=null&&(f.prompt=e.prompt),e.image!=null)if(e.image.type==="url")c.push({type:"unsupported",feature:"URL-based image input",details:"Google Generative AI video models require base64-encoded images. URL will be ignored."});else{const M=typeof e.image.data=="string"?e.image.data:On(e.image.data);f.image={inlineData:{mimeType:e.image.mediaType||"image/png",data:M}}}(p==null?void 0:p.referenceImages)!=null&&(f.referenceImages=p.referenceImages.map(M=>M.bytesBase64Encoded?{inlineData:{mimeType:"image/png",data:M.bytesBase64Encoded}}:M.gcsUri?{gcsUri:M.gcsUri}:M));const m={sampleCount:e.n};if(e.aspectRatio&&(m.aspectRatio=e.aspectRatio),e.resolution){const M={"1280x720":"720p","1920x1080":"1080p","3840x2160":"4k"};m.resolution=M[e.resolution]||e.resolution}if(e.duration&&(m.durationSeconds=e.duration),e.seed&&(m.seed=e.seed),p!=null){const M=p;M.personGeneration!==void 0&&M.personGeneration!==null&&(m.personGeneration=M.personGeneration),M.negativePrompt!==void 0&&M.negativePrompt!==null&&(m.negativePrompt=M.negativePrompt);for(const[P,V]of Object.entries(M))["pollIntervalMs","pollTimeoutMs","personGeneration","negativePrompt","referenceImages"].includes(P)||(m[P]=V)}const{value:h}=await Jt({url:`${this.config.baseURL}/models/${this.modelId}:predictLongRunning`,headers:Bt(await Se(this.config.headers),e.headers),body:{instances:d,parameters:m},successfulResponseHandler:Ut(ou),failedResponseHandler:Wr,abortSignal:e.abortSignal,fetch:this.config.fetch}),g=h.name;if(!g)throw new C({name:"GOOGLE_VIDEO_GENERATION_ERROR",message:"No operation name returned from API"});const w=(a=p==null?void 0:p.pollIntervalMs)!=null?a:1e4,b=(o=p==null?void 0:p.pollTimeoutMs)!=null?o:6e5,y=Date.now();let T=h,x;for(;!T.done;){if(Date.now()-y>b)throw new C({name:"GOOGLE_VIDEO_GENERATION_TIMEOUT",message:`Video generation timed out after ${b}ms`});if(await Ro(w),(s=e.abortSignal)!=null&&s.aborted)throw new C({name:"GOOGLE_VIDEO_GENERATION_ABORTED",message:"Video generation request was aborted"});const{value:M,responseHeaders:P}=await Es({url:`${this.config.baseURL}/${g}`,headers:Bt(await Se(this.config.headers),e.headers),successfulResponseHandler:Ut(ou),failedResponseHandler:Wr,abortSignal:e.abortSignal,fetch:this.config.fetch});T=M,x=P}if(T.error)throw new C({name:"GOOGLE_VIDEO_GENERATION_FAILED",message:`Video generation failed: ${T.error.message}`});const R=T.response;if(!((i=R==null?void 0:R.generateVideoResponse)!=null&&i.generatedSamples)||R.generateVideoResponse.generatedSamples.length===0)throw new C({name:"GOOGLE_VIDEO_GENERATION_ERROR",message:`No videos in response. Response: ${JSON.stringify(T)}`});const I=[],A=[],$=await Se(this.config.headers),N=$==null?void 0:$["x-goog-api-key"];for(const M of R.generateVideoResponse.generatedSamples)if((l=M.video)!=null&&l.uri){const P=N?`${M.video.uri}${M.video.uri.includes("?")?"&":"?"}key=${N}`:M.video.uri;I.push({type:"url",url:P,mediaType:"video/mp4"}),A.push({uri:M.video.uri})}if(I.length===0)throw new C({name:"GOOGLE_VIDEO_GENERATION_ERROR",message:"No valid videos in response"});return{videos:I,warnings:c,response:{timestamp:u,modelId:this.modelId,headers:x},providerMetadata:{google:{videos:A}}}}},ou=_({name:v().nullish(),done:Q().nullish(),error:_({code:X().nullish(),message:v(),status:v().nullish()}).nullish(),response:_({generateVideoResponse:_({generatedSamples:H(_({video:_({uri:v().nullish()}).nullish()})).nullish()}).nullish()}).nullish()}),_I=ye(()=>me(_({pollIntervalMs:X().positive().nullish(),pollTimeoutMs:X().positive().nullish(),personGeneration:Oe(["dont_allow","allow_adult","allow_all"]).nullish(),negativePrompt:v().nullish(),referenceImages:H(_({bytesBase64Encoded:v().nullish(),gcsUri:v().nullish()})).nullish()}).passthrough()));function kp(e={}){var t,r;const n=(t=Sp(e.baseURL))!=null?t:"https://generativelanguage.googleapis.com/v1beta",a=(r=e.name)!=null?r:"google.generative-ai",o=()=>rt({"x-goog-api-key":J_({apiKey:e.apiKey,environmentVariableName:"GOOGLE_GENERATIVE_AI_API_KEY",description:"Google Generative AI"}),...e.headers},`ai-sdk/google/${Ep}`),s=p=>{var d;return new nI(p,{provider:a,baseURL:n,headers:o,generateId:(d=e.generateId)!=null?d:kn,supportedUrls:()=>({"*":[new RegExp(`^${n}/files/.*$`),new RegExp("^https://(?:www\\.)?youtube\\.com/watch\\?v=[\\w-]+(?:&[\\w=&.-]*)?$"),new RegExp("^https://youtu\\.be/[\\w-]+(?:\\?[\\w=&.-]*)?$")]}),fetch:e.fetch})},i=p=>new K0(p,{provider:a,baseURL:n,headers:o,fetch:e.fetch}),l=(p,d={})=>new vI(p,d,{provider:a,baseURL:n,headers:o,fetch:e.fetch}),u=p=>{var d;return new bI(p,{provider:a,baseURL:n,headers:o,fetch:e.fetch,generateId:(d=e.generateId)!=null?d:kn})},c=function(p){if(new.target)throw new Error("The Google Generative AI model function cannot be called with the new keyword.");return s(p)};return c.specificationVersion="v3",c.languageModel=s,c.chat=s,c.generativeAI=s,c.embedding=i,c.embeddingModel=i,c.textEmbedding=i,c.textEmbeddingModel=i,c.image=l,c.imageModel=l,c.video=u,c.tools=gI,c}var II=kp();const TI=Object.freeze(Object.defineProperty({__proto__:null,VERSION:Ep,createGoogleGenerativeAI:kp,google:II},Symbol.toStringTag,{value:"Module"}));var ls,su;function SI(){if(su)return ls;su=1;var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a=(c,p)=>{for(var d in p)e(c,d,{get:p[d],enumerable:!0})},o=(c,p,d,f)=>{if(p&&typeof p=="object"||typeof p=="function")for(let m of r(p))!n.call(c,m)&&m!==d&&e(c,m,{get:()=>p[m],enumerable:!(f=t(p,m))||f.enumerable});return c},s=c=>o(e({},"__esModule",{value:!0}),c),i={};a(i,{SYMBOL_FOR_REQ_CONTEXT:()=>l,getContext:()=>u}),ls=s(i);const l=Symbol.for("@vercel/request-context");function u(){var p,d;return((d=(p=globalThis[l])==null?void 0:p.get)==null?void 0:d.call(p))??{}}return ls}var us,iu;function EI(){if(iu)return us;iu=1;var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a=(p,d)=>{for(var f in d)e(p,f,{get:d[f],enumerable:!0})},o=(p,d,f,m)=>{if(d&&typeof d=="object"||typeof d=="function")for(let h of r(d))!n.call(p,h)&&h!==f&&e(p,h,{get:()=>d[h],enumerable:!(m=t(d,h))||m.enumerable});return p},s=p=>o(e({},"__esModule",{value:!0}),p),i={};a(i,{getContext:()=>l.getContext,getVercelOidcToken:()=>u,getVercelOidcTokenSync:()=>c}),us=s(i);var l=SI();async function u(){return""}function c(){return""}return us}var Cp=EI(),xI="vercel.ai.gateway.error",cs=Symbol.for(xI),lu,uu,vt=class Ap extends(uu=Error,lu=cs,uu){constructor({message:t,statusCode:r=500,cause:n,generationId:a}){super(a?`${t} [${a}]`:t),this[lu]=!0,this.statusCode=r,this.cause=n,this.generationId=a}static isInstance(t){return Ap.hasMarker(t)}static hasMarker(t){return typeof t=="object"&&t!==null&&cs in t&&t[cs]===!0}},Np="GatewayAuthenticationError",RI=`vercel.ai.gateway.error.${Np}`,cu=Symbol.for(RI),du,pu,ei=class Pp extends(pu=vt,du=cu,pu){constructor({message:t="Authentication failed",statusCode:r=401,cause:n,generationId:a}={}){super({message:t,statusCode:r,cause:n,generationId:a}),this[du]=!0,this.name=Np,this.type="authentication_error"}static isInstance(t){return vt.hasMarker(t)&&cu in t}static createContextualError({apiKeyProvided:t,oidcTokenProvided:r,message:n="Authentication failed",statusCode:a=401,cause:o,generationId:s}){let i;return t?i=`AI Gateway authentication failed: Invalid API key.

Create a new API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys

Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:r?i=`AI Gateway authentication failed: Invalid OIDC token.

Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.

Alternatively, use an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys`:i=`AI Gateway authentication failed: No authentication provided.

Option 1 - API key:
Create an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys
Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

Option 2 - OIDC token:
Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.`,new Pp({message:i,statusCode:a,cause:o,generationId:s})}},$p="GatewayInvalidRequestError",MI=`vercel.ai.gateway.error.${$p}`,fu=Symbol.for(MI),hu,mu,OI=class extends(mu=vt,hu=fu,mu){constructor({message:e="Invalid request",statusCode:t=400,cause:r,generationId:n}={}){super({message:e,statusCode:t,cause:r,generationId:n}),this[hu]=!0,this.name=$p,this.type="invalid_request_error"}static isInstance(e){return vt.hasMarker(e)&&fu in e}},Dp="GatewayRateLimitError",kI=`vercel.ai.gateway.error.${Dp}`,gu=Symbol.for(kI),vu,yu,CI=class extends(yu=vt,vu=gu,yu){constructor({message:e="Rate limit exceeded",statusCode:t=429,cause:r,generationId:n}={}){super({message:e,statusCode:t,cause:r,generationId:n}),this[vu]=!0,this.name=Dp,this.type="rate_limit_exceeded"}static isInstance(e){return vt.hasMarker(e)&&gu in e}},jp="GatewayModelNotFoundError",AI=`vercel.ai.gateway.error.${jp}`,wu=Symbol.for(AI),NI=ye(()=>me(_({modelId:v()}))),bu,_u,PI=class extends(_u=vt,bu=wu,_u){constructor({message:e="Model not found",statusCode:t=404,modelId:r,cause:n,generationId:a}={}){super({message:e,statusCode:t,cause:n,generationId:a}),this[bu]=!0,this.name=jp,this.type="model_not_found",this.modelId=r}static isInstance(e){return vt.hasMarker(e)&&wu in e}},zp="GatewayInternalServerError",$I=`vercel.ai.gateway.error.${zp}`,Iu=Symbol.for($I),Tu,Su,Eu=class extends(Su=vt,Tu=Iu,Su){constructor({message:e="Internal server error",statusCode:t=500,cause:r,generationId:n}={}){super({message:e,statusCode:t,cause:r,generationId:n}),this[Tu]=!0,this.name=zp,this.type="internal_server_error"}static isInstance(e){return vt.hasMarker(e)&&Iu in e}},Up="GatewayResponseError",DI=`vercel.ai.gateway.error.${Up}`,xu=Symbol.for(DI),Ru,Mu,jI=class extends(Mu=vt,Ru=xu,Mu){constructor({message:e="Invalid response from Gateway",statusCode:t=502,response:r,validationError:n,cause:a,generationId:o}={}){super({message:e,statusCode:t,cause:a,generationId:o}),this[Ru]=!0,this.name=Up,this.type="response_error",this.response=r,this.validationError=n}static isInstance(e){return vt.hasMarker(e)&&xu in e}};async function Ou({response:e,statusCode:t,defaultMessage:r="Gateway request failed",cause:n,authMethod:a}){var o;const s=await pt({value:e,schema:zI});if(!s.success){const p=typeof e=="object"&&e!==null&&"generationId"in e?e.generationId:void 0;return new jI({message:`Invalid error response format: ${r}`,statusCode:t,response:e,validationError:s.error,cause:n,generationId:p})}const i=s.value,l=i.error.type,u=i.error.message,c=(o=i.generationId)!=null?o:void 0;switch(l){case"authentication_error":return ei.createContextualError({apiKeyProvided:a==="api-key",oidcTokenProvided:a==="oidc",statusCode:t,cause:n,generationId:c});case"invalid_request_error":return new OI({message:u,statusCode:t,cause:n,generationId:c});case"rate_limit_exceeded":return new CI({message:u,statusCode:t,cause:n,generationId:c});case"model_not_found":{const p=await pt({value:i.error.param,schema:NI});return new PI({message:u,statusCode:t,modelId:p.success?p.value.modelId:void 0,cause:n,generationId:c})}case"internal_server_error":return new Eu({message:u,statusCode:t,cause:n,generationId:c});default:return new Eu({message:u,statusCode:t,cause:n,generationId:c})}}var zI=ye(()=>me(_({error:_({message:v(),type:v().nullish(),param:te().nullish(),code:ke([v(),X()]).nullish()}),generationId:v().nullish()})));function Sr(e,t){var r;return vt.isInstance(e)?e:He.isInstance(e)?Ou({response:UI(e),statusCode:(r=e.statusCode)!=null?r:500,defaultMessage:"Gateway request failed",cause:e,authMethod:t}):Ou({response:{},statusCode:500,defaultMessage:e instanceof Error?`Gateway request failed: ${e.message}`:"Unknown Gateway error",cause:e,authMethod:t})}function UI(e){if(e.data!==void 0)return e.data;if(e.responseBody!=null)try{return JSON.parse(e.responseBody)}catch{return e.responseBody}return{}}var Zp="ai-gateway-auth-method";async function An(e){const t=await pt({value:e[Zp],schema:ZI});return t.success?t.value:void 0}var ZI=ye(()=>me(ke([O("api-key"),O("oidc")]))),ku=class{constructor(e){this.config=e}async getAvailableModels(){try{const{value:e}=await Es({url:`${this.config.baseURL}/config`,headers:await Se(this.config.headers()),successfulResponseHandler:Ut(qI),failedResponseHandler:Hr({errorSchema:yr(),errorToMessage:t=>t}),fetch:this.config.fetch});return e}catch(e){throw await Sr(e)}}async getCredits(){try{const e=new URL(this.config.baseURL),{value:t}=await Es({url:`${e.origin}/v1/credits`,headers:await Se(this.config.headers()),successfulResponseHandler:Ut(FI),failedResponseHandler:Hr({errorSchema:yr(),errorToMessage:r=>r}),fetch:this.config.fetch});return t}catch(e){throw await Sr(e)}}},qI=ye(()=>me(_({models:H(_({id:v(),name:v(),description:v().nullish(),pricing:_({input:v(),output:v(),input_cache_read:v().nullish(),input_cache_write:v().nullish()}).transform(({input:e,output:t,input_cache_read:r,input_cache_write:n})=>({input:e,output:t,...r?{cachedInputTokens:r}:{},...n?{cacheCreationInputTokens:n}:{}})).nullish(),specification:_({specificationVersion:O("v3"),provider:v(),modelId:v()}),modelType:Oe(["language","embedding","image"]).nullish()}))}))),FI=ye(()=>me(_({balance:v(),total_used:v()}).transform(({balance:e,total_used:t})=>({balance:e,totalUsed:t})))),LI=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v3",this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(e){const{abortSignal:t,...r}=e;return{args:this.maybeEncodeFileParts(r),warnings:[]}}async doGenerate(e){const{args:t,warnings:r}=await this.getArgs(e),{abortSignal:n}=e,a=await Se(this.config.headers());try{const{responseHeaders:o,value:s,rawValue:i}=await Jt({url:this.getUrl(),headers:Bt(a,e.headers,this.getModelConfigHeaders(this.modelId,!1),await Se(this.config.o11yHeaders)),body:t,successfulResponseHandler:Ut(yr()),failedResponseHandler:Hr({errorSchema:yr(),errorToMessage:l=>l}),...n&&{abortSignal:n},fetch:this.config.fetch});return{...s,request:{body:t},response:{headers:o,body:i},warnings:r}}catch(o){throw await Sr(o,await An(a))}}async doStream(e){const{args:t,warnings:r}=await this.getArgs(e),{abortSignal:n}=e,a=await Se(this.config.headers());try{const{value:o,responseHeaders:s}=await Jt({url:this.getUrl(),headers:Bt(a,e.headers,this.getModelConfigHeaders(this.modelId,!0),await Se(this.config.o11yHeaders)),body:t,successfulResponseHandler:Tp(yr()),failedResponseHandler:Hr({errorSchema:yr(),errorToMessage:i=>i}),...n&&{abortSignal:n},fetch:this.config.fetch});return{stream:o.pipeThrough(new TransformStream({start(i){r.length>0&&i.enqueue({type:"stream-start",warnings:r})},transform(i,l){if(i.success){const u=i.value;if(u.type==="raw"&&!e.includeRawChunks)return;u.type==="response-metadata"&&u.timestamp&&typeof u.timestamp=="string"&&(u.timestamp=new Date(u.timestamp)),l.enqueue(u)}else l.error(i.error)}})),request:{body:t},response:{headers:s}}}catch(o){throw await Sr(o,await An(a))}}isFilePart(e){return e&&typeof e=="object"&&"type"in e&&e.type==="file"}maybeEncodeFileParts(e){for(const t of e.prompt)for(const r of t.content)if(this.isFilePart(r)){const n=r;if(n.data instanceof Uint8Array){const a=Uint8Array.from(n.data),o=Buffer.from(a).toString("base64");n.data=new URL(`data:${n.mediaType||"application/octet-stream"};base64,${o}`)}}return e}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(e,t){return{"ai-language-model-specification-version":"3","ai-language-model-id":e,"ai-language-model-streaming":String(t)}}},VI=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v3",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:r,providerOptions:n}){var a;const o=await Se(this.config.headers());try{const{responseHeaders:s,value:i,rawValue:l}=await Jt({url:this.getUrl(),headers:Bt(o,t??{},this.getModelConfigHeaders(),await Se(this.config.o11yHeaders)),body:{values:e,...n?{providerOptions:n}:{}},successfulResponseHandler:Ut(GI),failedResponseHandler:Hr({errorSchema:yr(),errorToMessage:u=>u}),...r&&{abortSignal:r},fetch:this.config.fetch});return{embeddings:i.embeddings,usage:(a=i.usage)!=null?a:void 0,providerMetadata:i.providerMetadata,response:{headers:s,body:l},warnings:[]}}catch(s){throw await Sr(s,await An(o))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":"3","ai-model-id":this.modelId}}},GI=ye(()=>me(_({embeddings:H(H(X())),usage:_({tokens:X()}).nullish(),providerMetadata:ar(v(),ar(v(),te())).optional()}))),BI=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v3",this.maxImagesPerCall=Number.MAX_SAFE_INTEGER}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:r,aspectRatio:n,seed:a,files:o,mask:s,providerOptions:i,headers:l,abortSignal:u}){var c;const p=await Se(this.config.headers());try{const{responseHeaders:d,value:f,rawValue:m}=await Jt({url:this.getUrl(),headers:Bt(p,l??{},this.getModelConfigHeaders(),await Se(this.config.o11yHeaders)),body:{prompt:e,n:t,...r&&{size:r},...n&&{aspectRatio:n},...a&&{seed:a},...i&&{providerOptions:i},...o&&{files:o.map(h=>Cu(h))},...s&&{mask:Cu(s)}},successfulResponseHandler:Ut(HI),failedResponseHandler:Hr({errorSchema:yr(),errorToMessage:h=>h}),...u&&{abortSignal:u},fetch:this.config.fetch});return{images:f.images,warnings:(c=f.warnings)!=null?c:[],providerMetadata:f.providerMetadata,response:{timestamp:new Date,modelId:this.modelId,headers:d}}}catch(d){throw Sr(d,await An(p))}}getUrl(){return`${this.config.baseURL}/image-model`}getModelConfigHeaders(){return{"ai-image-model-specification-version":"3","ai-model-id":this.modelId}}};function Cu(e){return e.type==="file"&&e.data instanceof Uint8Array?{...e,data:On(e.data)}:e}var JI=_({images:H(te()).optional()}).catchall(te()),HI=_({images:H(v()),warnings:H(_({type:O("other"),message:v()})).optional(),providerMetadata:ar(v(),JI).optional()}),WI=ye(()=>me(_({objective:v().describe("Natural-language description of the web research goal, including source or freshness guidance and broader context from the task. Maximum 5000 characters."),search_queries:H(v()).optional().describe("Optional search queries to supplement the objective. Maximum 200 characters per query."),mode:Oe(["one-shot","agentic"]).optional().describe('Mode preset: "one-shot" for comprehensive results with longer excerpts (default), "agentic" for concise, token-efficient results for multi-step workflows.'),max_results:X().optional().describe("Maximum number of results to return (1-20). Defaults to 10 if not specified."),source_policy:_({include_domains:H(v()).optional().describe("List of domains to include in search results."),exclude_domains:H(v()).optional().describe("List of domains to exclude from search results."),after_date:v().optional().describe("Only include results published after this date (ISO 8601 format).")}).optional().describe("Source policy for controlling which domains to include/exclude and freshness."),excerpts:_({max_chars_per_result:X().optional().describe("Maximum characters per result."),max_chars_total:X().optional().describe("Maximum total characters across all results.")}).optional().describe("Excerpt configuration for controlling result length."),fetch_policy:_({max_age_seconds:X().optional().describe("Maximum age in seconds for cached content. Set to 0 to always fetch fresh content.")}).optional().describe("Fetch policy for controlling content freshness.")}))),YI=ye(()=>me(ke([_({searchId:v(),results:H(_({url:v(),title:v(),excerpt:v(),publishDate:v().nullable().optional(),relevanceScore:X().optional()}))}),_({error:Oe(["api_error","rate_limit","timeout","invalid_input","configuration_error","unknown"]),statusCode:X().optional(),message:v()})]))),KI=Qs({id:"gateway.parallel_search",inputSchema:WI,outputSchema:YI}),XI=(e={})=>KI(e),QI=ye(()=>me(_({query:ke([v(),H(v())]).describe("Search query (string) or multiple queries (array of up to 5 strings). Multi-query searches return combined results from all queries."),max_results:X().optional().describe("Maximum number of search results to return (1-20, default: 10)"),max_tokens_per_page:X().optional().describe("Maximum number of tokens to extract per search result page (256-2048, default: 2048)"),max_tokens:X().optional().describe("Maximum total tokens across all search results (default: 25000, max: 1000000)"),country:v().optional().describe("Two-letter ISO 3166-1 alpha-2 country code for regional search results (e.g., 'US', 'GB', 'FR')"),search_domain_filter:H(v()).optional().describe("List of domains to include or exclude from search results (max 20). To include: ['nature.com', 'science.org']. To exclude: ['-example.com', '-spam.net']"),search_language_filter:H(v()).optional().describe("List of ISO 639-1 language codes to filter results (max 10, lowercase). Examples: ['en', 'fr', 'de']"),search_after_date:v().optional().describe("Include only results published after this date. Format: 'MM/DD/YYYY' (e.g., '3/1/2025'). Cannot be used with search_recency_filter."),search_before_date:v().optional().describe("Include only results published before this date. Format: 'MM/DD/YYYY' (e.g., '3/15/2025'). Cannot be used with search_recency_filter."),last_updated_after_filter:v().optional().describe("Include only results last updated after this date. Format: 'MM/DD/YYYY' (e.g., '3/1/2025'). Cannot be used with search_recency_filter."),last_updated_before_filter:v().optional().describe("Include only results last updated before this date. Format: 'MM/DD/YYYY' (e.g., '3/15/2025'). Cannot be used with search_recency_filter."),search_recency_filter:Oe(["day","week","month","year"]).optional().describe("Filter results by relative time period. Cannot be used with search_after_date or search_before_date.")}))),eT=ye(()=>me(ke([_({results:H(_({title:v(),url:v(),snippet:v(),date:v().optional(),lastUpdated:v().optional()})),id:v()}),_({error:Oe(["api_error","rate_limit","timeout","invalid_input","unknown"]),statusCode:X().optional(),message:v()})]))),tT=Qs({id:"gateway.perplexity_search",inputSchema:QI,outputSchema:eT}),rT=(e={})=>tT(e),nT={parallelSearch:XI,perplexitySearch:rT};async function aT(){var e;return(e=Cp.getContext().headers)==null?void 0:e["x-vercel-id"]}var oT="3.0.32",sT="0.0.1";function qp(e={}){var t,r;let n=null,a=null;const o=(t=e.metadataCacheRefreshMillis)!=null?t:1e3*60*5;let s=0;const i=(r=Sp(e.baseURL))!=null?r:"https://ai-gateway.vercel.sh/v3/ai",l=async()=>{try{const h=await iT(e);return rt({Authorization:`Bearer ${h.token}`,"ai-gateway-protocol-version":sT,[Zp]:h.authMethod,...e.headers},`ai-sdk/gateway/${oT}`)}catch(h){throw ei.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401,cause:h})}},u=()=>{const h=Ya({settingValue:void 0,environmentVariableName:"VERCEL_DEPLOYMENT_ID"}),g=Ya({settingValue:void 0,environmentVariableName:"VERCEL_ENV"}),w=Ya({settingValue:void 0,environmentVariableName:"VERCEL_REGION"});return async()=>{const b=await aT();return{...h&&{"ai-o11y-deployment-id":h},...g&&{"ai-o11y-environment":g},...w&&{"ai-o11y-region":w},...b&&{"ai-o11y-request-id":b}}}},c=h=>new LI(h,{provider:"gateway",baseURL:i,headers:l,fetch:e.fetch,o11yHeaders:u()}),p=async()=>{var h,g,w;const b=(w=(g=(h=e._internal)==null?void 0:h.currentDate)==null?void 0:g.call(h).getTime())!=null?w:Date.now();return(!n||b-s>o)&&(s=b,n=new ku({baseURL:i,headers:l,fetch:e.fetch}).getAvailableModels().then(y=>(a=y,y)).catch(async y=>{throw await Sr(y,await An(await l()))})),a?Promise.resolve(a):n},d=async()=>new ku({baseURL:i,headers:l,fetch:e.fetch}).getCredits().catch(async h=>{throw await Sr(h,await An(await l()))}),f=function(h){if(new.target)throw new Error("The Gateway Provider model function cannot be called with the new keyword.");return c(h)};f.specificationVersion="v3",f.getAvailableModels=p,f.getCredits=d,f.imageModel=h=>new BI(h,{provider:"gateway",baseURL:i,headers:l,fetch:e.fetch,o11yHeaders:u()}),f.languageModel=c;const m=h=>new VI(h,{provider:"gateway",baseURL:i,headers:l,fetch:e.fetch,o11yHeaders:u()});return f.embeddingModel=m,f.textEmbeddingModel=m,f.tools=nT,f}var Fp=qp();async function iT(e){const t=Ya({settingValue:e.apiKey,environmentVariableName:"AI_GATEWAY_API_KEY"});return t?{token:t,authMethod:"api-key"}:{token:await Cp.getVercelOidcToken(),authMethod:"oidc"}}var lT=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},jr="1.9.0",Au=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function uT(e){var t=new Set([e]),r=new Set,n=e.match(Au);if(!n)return function(){return!1};var a={major:+n[1],minor:+n[2],patch:+n[3],prerelease:n[4]};if(a.prerelease!=null)return function(l){return l===e};function o(i){return r.add(i),!1}function s(i){return t.add(i),!0}return function(l){if(t.has(l))return!0;if(r.has(l))return!1;var u=l.match(Au);if(!u)return o(l);var c={major:+u[1],minor:+u[2],patch:+u[3],prerelease:u[4]};return c.prerelease!=null||a.major!==c.major?o(l):a.major===0?a.minor===c.minor&&a.patch<=c.patch?s(l):o(l):a.minor<=c.minor?s(l):o(l)}}var cT=uT(jr),dT=jr.split(".")[0],ia=Symbol.for("opentelemetry.js.api."+dT),la=lT;function Ea(e,t,r,n){var a;n===void 0&&(n=!1);var o=la[ia]=(a=la[ia])!==null&&a!==void 0?a:{version:jr};if(!n&&o[e]){var s=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return r.error(s.stack||s.message),!1}if(o.version!==jr){var s=new Error("@opentelemetry/api: Registration of version v"+o.version+" for "+e+" does not match previously registered API v"+jr);return r.error(s.stack||s.message),!1}return o[e]=t,r.debug("@opentelemetry/api: Registered a global for "+e+" v"+jr+"."),!0}function Yr(e){var t,r,n=(t=la[ia])===null||t===void 0?void 0:t.version;if(!(!n||!cT(n)))return(r=la[ia])===null||r===void 0?void 0:r[e]}function xa(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+jr+".");var r=la[ia];r&&delete r[e]}var pT=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,o=[],s;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(i){s={error:i}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},fT=function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,o;n<a;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},hT=(function(){function e(t){this._namespace=t.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Bn("debug",this._namespace,t)},e.prototype.error=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Bn("error",this._namespace,t)},e.prototype.info=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Bn("info",this._namespace,t)},e.prototype.warn=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Bn("warn",this._namespace,t)},e.prototype.verbose=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Bn("verbose",this._namespace,t)},e})();function Bn(e,t,r){var n=Yr("diag");if(n)return r.unshift(t),n[e].apply(n,fT([],pT(r),!1))}var mt;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"})(mt||(mt={}));function mT(e,t){e<mt.NONE?e=mt.NONE:e>mt.ALL&&(e=mt.ALL),t=t||{};function r(n,a){var o=t[n];return typeof o=="function"&&e>=a?o.bind(t):function(){}}return{error:r("error",mt.ERROR),warn:r("warn",mt.WARN),info:r("info",mt.INFO),debug:r("debug",mt.DEBUG),verbose:r("verbose",mt.VERBOSE)}}var gT=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,o=[],s;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(i){s={error:i}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},vT=function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,o;n<a;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},yT="diag",Ht=(function(){function e(){function t(a){return function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var i=Yr("diag");if(i)return i[a].apply(i,vT([],gT(o),!1))}}var r=this,n=function(a,o){var s,i,l;if(o===void 0&&(o={logLevel:mt.INFO}),a===r){var u=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return r.error((s=u.stack)!==null&&s!==void 0?s:u.message),!1}typeof o=="number"&&(o={logLevel:o});var c=Yr("diag"),p=mT((i=o.logLevel)!==null&&i!==void 0?i:mt.INFO,a);if(c&&!o.suppressOverrideMessage){var d=(l=new Error().stack)!==null&&l!==void 0?l:"<failed to generate stacktrace>";c.warn("Current logger will be overwritten from "+d),p.warn("Current logger will overwrite one already registered from "+d)}return Ea("diag",p,r,!0)};r.setLogger=n,r.disable=function(){xa(yT,r)},r.createComponentLogger=function(a){return new hT(a)},r.verbose=t("verbose"),r.debug=t("debug"),r.info=t("info"),r.warn=t("warn"),r.error=t("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e})(),wT=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,o=[],s;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(i){s={error:i}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},bT=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},_T=(function(){function e(t){this._entries=t?new Map(t):new Map}return e.prototype.getEntry=function(t){var r=this._entries.get(t);if(r)return Object.assign({},r)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(t){var r=wT(t,2),n=r[0],a=r[1];return[n,a]})},e.prototype.setEntry=function(t,r){var n=new e(this._entries);return n._entries.set(t,r),n},e.prototype.removeEntry=function(t){var r=new e(this._entries);return r._entries.delete(t),r},e.prototype.removeEntries=function(){for(var t,r,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];var o=new e(this._entries);try{for(var s=bT(n),i=s.next();!i.done;i=s.next()){var l=i.value;o._entries.delete(l)}}catch(u){t={error:u}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return o},e.prototype.clear=function(){return new e},e})();Ht.instance();function IT(e){return e===void 0&&(e={}),new _T(new Map(Object.entries(e)))}function Lp(e){return Symbol.for(e)}var TT=(function(){function e(t){var r=this;r._currentContext=t?new Map(t):new Map,r.getValue=function(n){return r._currentContext.get(n)},r.setValue=function(n,a){var o=new e(r._currentContext);return o._currentContext.set(n,a),o},r.deleteValue=function(n){var a=new e(r._currentContext);return a._currentContext.delete(n),a}}return e})(),ST=new TT,Qr=(function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),ET=(function(){function e(){}return e.prototype.createGauge=function(t,r){return $T},e.prototype.createHistogram=function(t,r){return DT},e.prototype.createCounter=function(t,r){return PT},e.prototype.createUpDownCounter=function(t,r){return jT},e.prototype.createObservableGauge=function(t,r){return UT},e.prototype.createObservableCounter=function(t,r){return zT},e.prototype.createObservableUpDownCounter=function(t,r){return ZT},e.prototype.addBatchObservableCallback=function(t,r){},e.prototype.removeBatchObservableCallback=function(t){},e})(),ko=(function(){function e(){}return e})(),xT=(function(e){Qr(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.add=function(r,n){},t})(ko),RT=(function(e){Qr(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.add=function(r,n){},t})(ko),MT=(function(e){Qr(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.record=function(r,n){},t})(ko),OT=(function(e){Qr(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.record=function(r,n){},t})(ko),ti=(function(){function e(){}return e.prototype.addCallback=function(t){},e.prototype.removeCallback=function(t){},e})(),kT=(function(e){Qr(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t})(ti),CT=(function(e){Qr(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t})(ti),AT=(function(e){Qr(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t})(ti),NT=new ET,PT=new xT,$T=new MT,DT=new OT,jT=new RT,zT=new kT,UT=new CT,ZT=new AT,qT={get:function(e,t){if(e!=null)return e[t]},keys:function(e){return e==null?[]:Object.keys(e)}},FT={set:function(e,t,r){e!=null&&(e[t]=r)}},LT=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,o=[],s;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(i){s={error:i}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},VT=function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,o;n<a;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},GT=(function(){function e(){}return e.prototype.active=function(){return ST},e.prototype.with=function(t,r,n){for(var a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o];return r.call.apply(r,VT([n],LT(a),!1))},e.prototype.bind=function(t,r){return r},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e})(),BT=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,o=[],s;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(i){s={error:i}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},JT=function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,o;n<a;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},ds="context",HT=new GT,Co=(function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(t){return Ea(ds,t,Ht.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(t,r,n){for(var a,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return(a=this._getContextManager()).with.apply(a,JT([t,r,n],BT(o),!1))},e.prototype.bind=function(t,r){return this._getContextManager().bind(t,r)},e.prototype._getContextManager=function(){return Yr(ds)||HT},e.prototype.disable=function(){this._getContextManager().disable(),xa(ds,Ht.instance())},e})(),Ms;(function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"})(Ms||(Ms={}));var Vp="0000000000000000",Gp="00000000000000000000000000000000",WT={traceId:Gp,spanId:Vp,traceFlags:Ms.NONE},Xn=(function(){function e(t){t===void 0&&(t=WT),this._spanContext=t}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(t,r){return this},e.prototype.setAttributes=function(t){return this},e.prototype.addEvent=function(t,r){return this},e.prototype.addLink=function(t){return this},e.prototype.addLinks=function(t){return this},e.prototype.setStatus=function(t){return this},e.prototype.updateName=function(t){return this},e.prototype.end=function(t){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(t,r){},e})(),ri=Lp("OpenTelemetry Context Key SPAN");function ni(e){return e.getValue(ri)||void 0}function YT(){return ni(Co.getInstance().active())}function ai(e,t){return e.setValue(ri,t)}function KT(e){return e.deleteValue(ri)}function XT(e,t){return ai(e,new Xn(t))}function Bp(e){var t;return(t=ni(e))===null||t===void 0?void 0:t.spanContext()}var QT=/^([0-9a-f]{32})$/i,eS=/^[0-9a-f]{16}$/i;function tS(e){return QT.test(e)&&e!==Gp}function rS(e){return eS.test(e)&&e!==Vp}function Jp(e){return tS(e.traceId)&&rS(e.spanId)}function nS(e){return new Xn(e)}var ps=Co.getInstance(),Hp=(function(){function e(){}return e.prototype.startSpan=function(t,r,n){n===void 0&&(n=ps.active());var a=!!(r!=null&&r.root);if(a)return new Xn;var o=n&&Bp(n);return aS(o)&&Jp(o)?new Xn(o):new Xn},e.prototype.startActiveSpan=function(t,r,n,a){var o,s,i;if(!(arguments.length<2)){arguments.length===2?i=r:arguments.length===3?(o=r,i=n):(o=r,s=n,i=a);var l=s??ps.active(),u=this.startSpan(t,o,l),c=ai(l,u);return ps.with(c,i,void 0,u)}},e})();function aS(e){return typeof e=="object"&&typeof e.spanId=="string"&&typeof e.traceId=="string"&&typeof e.traceFlags=="number"}var oS=new Hp,sS=(function(){function e(t,r,n,a){this._provider=t,this.name=r,this.version=n,this.options=a}return e.prototype.startSpan=function(t,r,n){return this._getTracer().startSpan(t,r,n)},e.prototype.startActiveSpan=function(t,r,n,a){var o=this._getTracer();return Reflect.apply(o.startActiveSpan,o,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):oS},e})(),iS=(function(){function e(){}return e.prototype.getTracer=function(t,r,n){return new Hp},e})(),lS=new iS,Nu=(function(){function e(){}return e.prototype.getTracer=function(t,r,n){var a;return(a=this.getDelegateTracer(t,r,n))!==null&&a!==void 0?a:new sS(this,t,r,n)},e.prototype.getDelegate=function(){var t;return(t=this._delegate)!==null&&t!==void 0?t:lS},e.prototype.setDelegate=function(t){this._delegate=t},e.prototype.getDelegateTracer=function(t,r,n){var a;return(a=this._delegate)===null||a===void 0?void 0:a.getTracer(t,r,n)},e})(),go;(function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"})(go||(go={}));var Pu=Co.getInstance();Ht.instance();var uS=(function(){function e(){}return e.prototype.getMeter=function(t,r,n){return NT},e})(),cS=new uS,fs="metrics",dS=(function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalMeterProvider=function(t){return Ea(fs,t,Ht.instance())},e.prototype.getMeterProvider=function(){return Yr(fs)||cS},e.prototype.getMeter=function(t,r,n){return this.getMeterProvider().getMeter(t,r,n)},e.prototype.disable=function(){xa(fs,Ht.instance())},e})();dS.getInstance();var pS=(function(){function e(){}return e.prototype.inject=function(t,r){},e.prototype.extract=function(t,r){return t},e.prototype.fields=function(){return[]},e})(),oi=Lp("OpenTelemetry Baggage Key");function Wp(e){return e.getValue(oi)||void 0}function fS(){return Wp(Co.getInstance().active())}function hS(e,t){return e.setValue(oi,t)}function mS(e){return e.deleteValue(oi)}var hs="propagation",gS=new pS,vS=(function(){function e(){this.createBaggage=IT,this.getBaggage=Wp,this.getActiveBaggage=fS,this.setBaggage=hS,this.deleteBaggage=mS}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(t){return Ea(hs,t,Ht.instance())},e.prototype.inject=function(t,r,n){return n===void 0&&(n=FT),this._getGlobalPropagator().inject(t,r,n)},e.prototype.extract=function(t,r,n){return n===void 0&&(n=qT),this._getGlobalPropagator().extract(t,r,n)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){xa(hs,Ht.instance())},e.prototype._getGlobalPropagator=function(){return Yr(hs)||gS},e})();vS.getInstance();var ms="trace",yS=(function(){function e(){this._proxyTracerProvider=new Nu,this.wrapSpanContext=nS,this.isSpanContextValid=Jp,this.deleteSpan=KT,this.getSpan=ni,this.getActiveSpan=YT,this.getSpanContext=Bp,this.setSpan=ai,this.setSpanContext=XT}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(t){var r=Ea(ms,this._proxyTracerProvider,Ht.instance());return r&&this._proxyTracerProvider.setDelegate(t),r},e.prototype.getTracerProvider=function(){return Yr(ms)||this._proxyTracerProvider},e.prototype.getTracer=function(t,r){return this.getTracerProvider().getTracer(t,r)},e.prototype.disable=function(){xa(ms,Ht.instance()),this._proxyTracerProvider=new Nu},e})(),wS=yS.getInstance(),bS=Object.defineProperty,_S=(e,t)=>{for(var r in t)bS(e,r,{get:t[r],enumerable:!0})},Yp="AI_InvalidArgumentError",Kp=`vercel.ai.error.${Yp}`,IS=Symbol.for(Kp),Xp,ve=class extends C{constructor({parameter:e,value:t,message:r}){super({name:Yp,message:`Invalid argument for parameter ${e}: ${r}`}),this[Xp]=!0,this.parameter=e,this.value=t}static isInstance(e){return C.hasMarker(e,Kp)}};Xp=IS;var Qp="AI_InvalidStreamPartError",ef=`vercel.ai.error.${Qp}`,TS=Symbol.for(ef),tf,SS=class extends C{constructor({chunk:e,message:t}){super({name:Qp,message:t}),this[tf]=!0,this.chunk=e}static isInstance(e){return C.hasMarker(e,ef)}};tf=TS;var rf="AI_InvalidToolApprovalError",nf=`vercel.ai.error.${rf}`,ES=Symbol.for(nf),af,of=class extends C{constructor({approvalId:e}){super({name:rf,message:`Tool approval response references unknown approvalId: "${e}". No matching tool-approval-request found in message history.`}),this[af]=!0,this.approvalId=e}static isInstance(e){return C.hasMarker(e,nf)}};af=ES;var sf="AI_InvalidToolInputError",lf=`vercel.ai.error.${sf}`,xS=Symbol.for(lf),uf,Ao=class extends C{constructor({toolInput:e,toolName:t,cause:r,message:n=`Invalid input for tool ${t}: ${Gr(r)}`}){super({name:sf,message:n,cause:r}),this[uf]=!0,this.toolInput=e,this.toolName=t}static isInstance(e){return C.hasMarker(e,lf)}};uf=xS;var cf="AI_ToolCallNotFoundForApprovalError",df=`vercel.ai.error.${cf}`,RS=Symbol.for(df),pf,No=class extends C{constructor({toolCallId:e,approvalId:t}){super({name:cf,message:`Tool call "${e}" not found for approval request "${t}".`}),this[pf]=!0,this.toolCallId=e,this.approvalId=t}static isInstance(e){return C.hasMarker(e,df)}};pf=RS;var ff="AI_MissingToolResultsError",hf=`vercel.ai.error.${ff}`,MS=Symbol.for(hf),mf,Os=class extends C{constructor({toolCallIds:e}){super({name:ff,message:`Tool result${e.length>1?"s are":" is"} missing for tool call${e.length>1?"s":""} ${e.join(", ")}.`}),this[mf]=!0,this.toolCallIds=e}static isInstance(e){return C.hasMarker(e,hf)}};mf=MS;var gf="AI_NoImageGeneratedError",vf=`vercel.ai.error.${gf}`,OS=Symbol.for(vf),yf,wf=class extends C{constructor({message:e="No image generated.",cause:t,responses:r}){super({name:gf,message:e,cause:t}),this[yf]=!0,this.responses=r}static isInstance(e){return C.hasMarker(e,vf)}};yf=OS;var bf="AI_NoObjectGeneratedError",_f=`vercel.ai.error.${bf}`,kS=Symbol.for(_f),If,dt=class extends C{constructor({message:e="No object generated.",cause:t,text:r,response:n,usage:a,finishReason:o}){super({name:bf,message:e,cause:t}),this[If]=!0,this.text=r,this.response=n,this.usage=a,this.finishReason=o}static isInstance(e){return C.hasMarker(e,_f)}};If=kS;var Tf="AI_NoOutputGeneratedError",Sf=`vercel.ai.error.${Tf}`,CS=Symbol.for(Sf),Ef,si=class extends C{constructor({message:e="No output generated.",cause:t}={}){super({name:Tf,message:e,cause:t}),this[Ef]=!0}static isInstance(e){return C.hasMarker(e,Sf)}};Ef=CS;var xf="AI_NoSpeechGeneratedError",Rf=`vercel.ai.error.${xf}`,AS=Symbol.for(Rf),Mf,Of=class extends C{constructor(e){super({name:xf,message:"No speech audio generated."}),this[Mf]=!0,this.responses=e.responses}static isInstance(e){return C.hasMarker(e,Rf)}};Mf=AS;var kf="AI_NoTranscriptGeneratedError",Cf=`vercel.ai.error.${kf}`,NS=Symbol.for(Cf),Af,Nf=class extends C{constructor(e){super({name:kf,message:"No transcript generated."}),this[Af]=!0,this.responses=e.responses}static isInstance(e){return C.hasMarker(e,Cf)}};Af=NS;var ks="AI_NoVideoGeneratedError",Pf=`vercel.ai.error.${ks}`,PS=Symbol.for(Pf),$f,Df=class extends C{constructor({message:e="No video generated.",cause:t,responses:r}){super({name:ks,message:e,cause:t}),this[$f]=!0,this.responses=r}static isInstance(e){return C.hasMarker(e,Pf)}static isNoVideoGeneratedError(e){return e instanceof Error&&e.name===ks&&typeof e.responses<"u"}toJSON(){return{name:this.name,message:this.message,stack:this.stack,cause:this.cause,responses:this.responses}}};$f=PS;var jf="AI_NoSuchToolError",zf=`vercel.ai.error.${jf}`,$S=Symbol.for(zf),Uf,vo=class extends C{constructor({toolName:e,availableTools:t=void 0,message:r=`Model tried to call unavailable tool '${e}'. ${t===void 0?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:jf,message:r}),this[Uf]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return C.hasMarker(e,zf)}};Uf=$S;var Zf="AI_ToolCallRepairError",qf=`vercel.ai.error.${Zf}`,DS=Symbol.for(qf),Ff,Lf=class extends C{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${Gr(e)}`}){super({name:Zf,message:r,cause:e}),this[Ff]=!0,this.originalError=t}static isInstance(e){return C.hasMarker(e,qf)}};Ff=DS;var en=class extends C{constructor(e){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${e.version} for provider "${e.provider}" and model "${e.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=e.version,this.provider=e.provider,this.modelId=e.modelId}},Vf="AI_UIMessageStreamError",Gf=`vercel.ai.error.${Vf}`,jS=Symbol.for(Gf),Bf,Dr=class extends C{constructor({chunkType:e,chunkId:t,message:r}){super({name:Vf,message:r}),this[Bf]=!0,this.chunkType=e,this.chunkId=t}static isInstance(e){return C.hasMarker(e,Gf)}};Bf=jS;var Jf="AI_InvalidDataContentError",Hf=`vercel.ai.error.${Jf}`,zS=Symbol.for(Hf),Wf,Cs=class extends C{constructor({content:e,cause:t,message:r=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:Jf,message:r,cause:t}),this[Wf]=!0,this.content=e}static isInstance(e){return C.hasMarker(e,Hf)}};Wf=zS;var Yf="AI_InvalidMessageRoleError",Kf=`vercel.ai.error.${Yf}`,US=Symbol.for(Kf),Xf,Qf=class extends C{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:Yf,message:t}),this[Xf]=!0,this.role=e}static isInstance(e){return C.hasMarker(e,Kf)}};Xf=US;var eh="AI_MessageConversionError",th=`vercel.ai.error.${eh}`,ZS=Symbol.for(th),rh,nh=class extends C{constructor({originalMessage:e,message:t}){super({name:eh,message:t}),this[rh]=!0,this.originalMessage=e}static isInstance(e){return C.hasMarker(e,th)}};rh=ZS;var ah="AI_RetryError",oh=`vercel.ai.error.${ah}`,qS=Symbol.for(oh),sh,As=class extends C{constructor({message:e,reason:t,errors:r}){super({name:ah,message:e}),this[sh]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return C.hasMarker(e,oh)}};sh=qS;function FS({warning:e,provider:t,model:r}){const n=`AI SDK Warning (${t} / ${r}):`;switch(e.type){case"unsupported":{let a=`${n} The feature "${e.feature}" is not supported.`;return e.details&&(a+=` ${e.details}`),a}case"compatibility":{let a=`${n} The feature "${e.feature}" is used in a compatibility mode.`;return e.details&&(a+=` ${e.details}`),a}case"other":return`${n} ${e.message}`;default:return`${n} ${JSON.stringify(e,null,2)}`}}var LS="AI SDK Warning System: To turn off warning logging, set the AI_SDK_LOG_WARNINGS global to false.",$u=!1,yt=e=>{if(e.warnings.length===0)return;const t=globalThis.AI_SDK_LOG_WARNINGS;if(t!==!1){if(typeof t=="function"){t(e);return}$u||($u=!0,console.info(LS));for(const r of e.warnings)console.warn(FS({warning:r,provider:e.provider,model:e.model}))}};function Ra({provider:e,modelId:t}){yt({warnings:[{type:"compatibility",feature:"specificationVersion",details:"Using v2 specification compatibility mode. Some features may not be available."}],provider:e,model:t})}function ih(e){return e.specificationVersion==="v3"?e:(Ra({provider:e.provider,modelId:e.modelId}),new Proxy(e,{get(t,r){return r==="specificationVersion"?"v3":t[r]}}))}function lh(e){return e.specificationVersion==="v3"?e:(Ra({provider:e.provider,modelId:e.modelId}),new Proxy(e,{get(t,r){return r==="specificationVersion"?"v3":t[r]}}))}function uh(e){return e.specificationVersion==="v3"?e:(Ra({provider:e.provider,modelId:e.modelId}),new Proxy(e,{get(t,r){switch(r){case"specificationVersion":return"v3";case"doGenerate":return async(...n)=>{const a=await t.doGenerate(...n);return{...a,finishReason:ch(a.finishReason),usage:dh(a.usage)}};case"doStream":return async(...n)=>{const a=await t.doStream(...n);return{...a,stream:VS(a.stream)}};default:return t[r]}}}))}function VS(e){return e.pipeThrough(new TransformStream({transform(t,r){switch(t.type){case"finish":r.enqueue({...t,finishReason:ch(t.finishReason),usage:dh(t.usage)});break;default:r.enqueue(t);break}}}))}function ch(e){return{unified:e==="unknown"?"other":e,raw:void 0}}function dh(e){return{inputTokens:{total:e.inputTokens,noCache:void 0,cacheRead:e.cachedInputTokens,cacheWrite:void 0},outputTokens:{total:e.outputTokens,text:void 0,reasoning:e.reasoningTokens}}}function ph(e){return e.specificationVersion==="v3"?e:(Ra({provider:e.provider,modelId:e.modelId}),new Proxy(e,{get(t,r){return r==="specificationVersion"?"v3":t[r]}}))}function fh(e){return e.specificationVersion==="v3"?e:(Ra({provider:e.provider,modelId:e.modelId}),new Proxy(e,{get(t,r){return r==="specificationVersion"?"v3":t[r]}}))}function Nn(e){if(typeof e!="string"){if(e.specificationVersion!=="v3"&&e.specificationVersion!=="v2"){const t=e;throw new en({version:t.specificationVersion,provider:t.provider,modelId:t.modelId})}return uh(e)}return Ma().languageModel(e)}function hh(e){if(typeof e!="string"){if(e.specificationVersion!=="v3"&&e.specificationVersion!=="v2"){const t=e;throw new en({version:t.specificationVersion,provider:t.provider,modelId:t.modelId})}return ih(e)}return Ma().embeddingModel(e)}function GS(e){var t,r;if(typeof e!="string"){if(e.specificationVersion!=="v3"&&e.specificationVersion!=="v2"){const n=e;throw new en({version:n.specificationVersion,provider:n.provider,modelId:n.modelId})}return fh(e)}return(r=(t=Ma()).transcriptionModel)==null?void 0:r.call(t,e)}function BS(e){var t,r;if(typeof e!="string"){if(e.specificationVersion!=="v3"&&e.specificationVersion!=="v2"){const n=e;throw new en({version:n.specificationVersion,provider:n.provider,modelId:n.modelId})}return ph(e)}return(r=(t=Ma()).speechModel)==null?void 0:r.call(t,e)}function JS(e){if(typeof e!="string"){if(e.specificationVersion!=="v3"&&e.specificationVersion!=="v2"){const t=e;throw new en({version:t.specificationVersion,provider:t.provider,modelId:t.modelId})}return lh(e)}return Ma().imageModel(e)}function HS(e){if(typeof e=="string")throw new Error('Video models cannot be resolved from strings. Please use a Experimental_VideoModelV3 object from a provider (e.g., fal.video("model-id")).');if(e.specificationVersion!=="v3"){const t=e;throw new en({version:t.specificationVersion,provider:t.provider,modelId:t.modelId})}return e}function Ma(){var e;return(e=globalThis.AI_SDK_DEFAULT_PROVIDER)!=null?e:Fp}function ii(e){if(e!=null)return typeof e=="number"?e:e.totalMs}function mh(e){if(!(e==null||typeof e=="number"))return e.stepMs}function WS(e){if(!(e==null||typeof e=="number"))return e.chunkMs}var Pn=[{mediaType:"image/gif",bytesPrefix:[71,73,70]},{mediaType:"image/png",bytesPrefix:[137,80,78,71]},{mediaType:"image/jpeg",bytesPrefix:[255,216]},{mediaType:"image/webp",bytesPrefix:[82,73,70,70,null,null,null,null,87,69,66,80]},{mediaType:"image/bmp",bytesPrefix:[66,77]},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0]},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42]},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102]},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99]}],gh=[{mediaType:"audio/mpeg",bytesPrefix:[255,251]},{mediaType:"audio/mpeg",bytesPrefix:[255,250]},{mediaType:"audio/mpeg",bytesPrefix:[255,243]},{mediaType:"audio/mpeg",bytesPrefix:[255,242]},{mediaType:"audio/mpeg",bytesPrefix:[255,227]},{mediaType:"audio/mpeg",bytesPrefix:[255,226]},{mediaType:"audio/wav",bytesPrefix:[82,73,70,70,null,null,null,null,87,65,86,69]},{mediaType:"audio/ogg",bytesPrefix:[79,103,103,83]},{mediaType:"audio/flac",bytesPrefix:[102,76,97,67]},{mediaType:"audio/aac",bytesPrefix:[64,21,0,0]},{mediaType:"audio/mp4",bytesPrefix:[102,116,121,112]},{mediaType:"audio/webm",bytesPrefix:[26,69,223,163]}],Du=[{mediaType:"video/mp4",bytesPrefix:[0,0,0,null,102,116,121,112]},{mediaType:"video/webm",bytesPrefix:[26,69,223,163]},{mediaType:"video/quicktime",bytesPrefix:[0,0,0,20,102,116,121,112,113,116]},{mediaType:"video/x-msvideo",bytesPrefix:[82,73,70,70]}],YS=e=>{const t=typeof e=="string"?Br(e):e,r=(t[6]&127)<<21|(t[7]&127)<<14|(t[8]&127)<<7|t[9]&127;return t.slice(r+10)};function KS(e){return typeof e=="string"&&e.startsWith("SUQz")||typeof e!="string"&&e.length>10&&e[0]===73&&e[1]===68&&e[2]===51?YS(e):e}function Wt({data:e,signatures:t}){const r=KS(e),n=typeof r=="string"?Br(r.substring(0,Math.min(r.length,24))):r;for(const a of t)if(n.length>=a.bytesPrefix.length&&a.bytesPrefix.every((o,s)=>o===null||n[s]===o))return a.mediaType}var Rt="6.0.69",li=async({url:e})=>{var t;const r=e.toString();try{const n=await fetch(r,{headers:rt({},`ai-sdk/${Rt}`,Cn())});if(!n.ok)throw new Wa({url:r,statusCode:n.status,statusText:n.statusText});return{data:new Uint8Array(await n.arrayBuffer()),mediaType:(t=n.headers.get("content-type"))!=null?t:void 0}}catch(n){throw Wa.isInstance(n)?n:new Wa({url:r,cause:n})}},XS=(e=li)=>t=>Promise.all(t.map(async r=>r.isUrlSupportedByModel?null:e(r)));function ui(e){try{const[t,r]=e.split(",");return{mediaType:t.split(";")[0].split(":")[1],base64Content:r}}catch{return{mediaType:void 0,base64Content:void 0}}}var vh=ke([v(),fo(Uint8Array),fo(ArrayBuffer),pp(e=>{var t,r;return(r=(t=globalThis.Buffer)==null?void 0:t.isBuffer(e))!=null?r:!1},{message:"Must be a Buffer"})]);function yh(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if(typeof e=="string")try{e=new URL(e)}catch{}if(e instanceof URL&&e.protocol==="data:"){const{mediaType:t,base64Content:r}=ui(e.toString());if(t==null||r==null)throw new C({name:"InvalidDataContentError",message:`Invalid data URL format in content ${e.toString()}`});return{data:r,mediaType:t}}return{data:e,mediaType:void 0}}function QS(e){return typeof e=="string"?e:e instanceof ArrayBuffer?On(new Uint8Array(e)):On(e)}function wh(e){if(e instanceof Uint8Array)return e;if(typeof e=="string")try{return Br(e)}catch(t){throw new Cs({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new Cs({content:e})}function Er(e){return e===void 0?[]:Array.isArray(e)?e:[e]}async function Po({prompt:e,supportedUrls:t,download:r=XS()}){const n=await tE(e.messages,r,t),a=new Map;for(const u of e.messages)if(u.role==="assistant"&&Array.isArray(u.content))for(const c of u.content)c.type==="tool-approval-request"&&"approvalId"in c&&"toolCallId"in c&&a.set(c.approvalId,c.toolCallId);const o=new Set;for(const u of e.messages)if(u.role==="tool"){for(const c of u.content)if(c.type==="tool-approval-response"){const p=a.get(c.approvalId);p&&o.add(p)}}const s=[...e.system!=null?typeof e.system=="string"?[{role:"system",content:e.system}]:Er(e.system).map(u=>({role:"system",content:u.content,providerOptions:u.providerOptions})):[],...e.messages.map(u=>eE({message:u,downloadedAssets:n}))],i=[];for(const u of s){if(u.role!=="tool"){i.push(u);continue}const c=i.at(-1);(c==null?void 0:c.role)==="tool"?c.content.push(...u.content):i.push(u)}const l=new Set;for(const u of i)switch(u.role){case"assistant":{for(const c of u.content)c.type==="tool-call"&&!c.providerExecuted&&l.add(c.toolCallId);break}case"tool":{for(const c of u.content)c.type==="tool-result"&&l.delete(c.toolCallId);break}case"user":case"system":for(const c of o)l.delete(c);if(l.size>0)throw new Os({toolCallIds:Array.from(l)});break}for(const u of o)l.delete(u);if(l.size>0)throw new Os({toolCallIds:Array.from(l)});return i.filter(u=>u.role!=="tool"||u.content.length>0)}function eE({message:e,downloadedAssets:t}){const r=e.role;switch(r){case"system":return{role:"system",content:e.content,providerOptions:e.providerOptions};case"user":return typeof e.content=="string"?{role:"user",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions}:{role:"user",content:e.content.map(n=>rE(n,t)).filter(n=>n.type!=="text"||n.text!==""),providerOptions:e.providerOptions};case"assistant":return typeof e.content=="string"?{role:"assistant",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions}:{role:"assistant",content:e.content.filter(n=>n.type!=="text"||n.text!==""||n.providerOptions!=null).filter(n=>n.type!=="tool-approval-request").map(n=>{const a=n.providerOptions;switch(n.type){case"file":{const{data:o,mediaType:s}=yh(n.data);return{type:"file",data:o,filename:n.filename,mediaType:s??n.mediaType,providerOptions:a}}case"reasoning":return{type:"reasoning",text:n.text,providerOptions:a};case"text":return{type:"text",text:n.text,providerOptions:a};case"tool-call":return{type:"tool-call",toolCallId:n.toolCallId,toolName:n.toolName,input:n.input,providerExecuted:n.providerExecuted,providerOptions:a};case"tool-result":return{type:"tool-result",toolCallId:n.toolCallId,toolName:n.toolName,output:ju(n.output),providerOptions:a}}}),providerOptions:e.providerOptions};case"tool":return{role:"tool",content:e.content.filter(n=>n.type!=="tool-approval-response"||n.providerExecuted).map(n=>{switch(n.type){case"tool-result":return{type:"tool-result",toolCallId:n.toolCallId,toolName:n.toolName,output:ju(n.output),providerOptions:n.providerOptions};case"tool-approval-response":return{type:"tool-approval-response",approvalId:n.approvalId,approved:n.approved,reason:n.reason}}}),providerOptions:e.providerOptions};default:{const n=r;throw new Qf({role:n})}}}async function tE(e,t,r){const n=e.filter(o=>o.role==="user").map(o=>o.content).filter(o=>Array.isArray(o)).flat().filter(o=>o.type==="image"||o.type==="file").map(o=>{var s;const i=(s=o.mediaType)!=null?s:o.type==="image"?"image/*":void 0;let l=o.type==="image"?o.image:o.data;if(typeof l=="string")try{l=new URL(l)}catch{}return{mediaType:i,data:l}}).filter(o=>o.data instanceof URL).map(o=>({url:o.data,isUrlSupportedByModel:o.mediaType!=null&&B_({url:o.data.toString(),mediaType:o.mediaType,supportedUrls:r})})),a=await t(n);return Object.fromEntries(a.map((o,s)=>o==null?null:[n[s].url.toString(),{data:o.data,mediaType:o.mediaType}]).filter(o=>o!=null))}function rE(e,t){var r;if(e.type==="text")return{type:"text",text:e.text,providerOptions:e.providerOptions};let n;const a=e.type;switch(a){case"image":n=e.image;break;case"file":n=e.data;break;default:throw new Error(`Unsupported part type: ${a}`)}const{data:o,mediaType:s}=yh(n);let i=s??e.mediaType,l=o;if(l instanceof URL){const u=t[l.toString()];u&&(l=u.data,i??(i=u.mediaType))}switch(a){case"image":return(l instanceof Uint8Array||typeof l=="string")&&(i=(r=Wt({data:l,signatures:Pn}))!=null?r:i),{type:"file",mediaType:i??"image/*",filename:void 0,data:l,providerOptions:e.providerOptions};case"file":{if(i==null)throw new Error("Media type is missing for file part");return{type:"file",mediaType:i,filename:e.filename,data:l,providerOptions:e.providerOptions}}}}function ju(e){return e.type!=="content"?e:{type:"content",value:e.value.map(t=>t.type!=="media"?t:t.mediaType.startsWith("image/")?{type:"image-data",data:t.data,mediaType:t.mediaType}:{type:"file-data",data:t.data,mediaType:t.mediaType})}}async function Lr({toolCallId:e,input:t,output:r,tool:n,errorMode:a}){return a==="text"?{type:"error-text",value:Gr(r)}:a==="json"?{type:"error-json",value:zu(r)}:n!=null&&n.toModelOutput?await n.toModelOutput({toolCallId:e,input:t,output:r}):typeof r=="string"?{type:"text",value:r}:{type:"json",value:zu(r)}}function zu(e){return e===void 0?null:e}function Kr({maxOutputTokens:e,temperature:t,topP:r,topK:n,presencePenalty:a,frequencyPenalty:o,seed:s,stopSequences:i}){if(e!=null){if(!Number.isInteger(e))throw new ve({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be an integer"});if(e<1)throw new ve({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be >= 1"})}if(t!=null&&typeof t!="number")throw new ve({parameter:"temperature",value:t,message:"temperature must be a number"});if(r!=null&&typeof r!="number")throw new ve({parameter:"topP",value:r,message:"topP must be a number"});if(n!=null&&typeof n!="number")throw new ve({parameter:"topK",value:n,message:"topK must be a number"});if(a!=null&&typeof a!="number")throw new ve({parameter:"presencePenalty",value:a,message:"presencePenalty must be a number"});if(o!=null&&typeof o!="number")throw new ve({parameter:"frequencyPenalty",value:o,message:"frequencyPenalty must be a number"});if(s!=null&&!Number.isInteger(s))throw new ve({parameter:"seed",value:s,message:"seed must be an integer"});return{maxOutputTokens:e,temperature:t,topP:r,topK:n,presencePenalty:a,frequencyPenalty:o,stopSequences:i,seed:s}}function nE(e){return e!=null&&Object.keys(e).length>0}async function bh({tools:e,toolChoice:t,activeTools:r}){if(!nE(e))return{tools:void 0,toolChoice:void 0};const n=r!=null?Object.entries(e).filter(([o])=>r.includes(o)):Object.entries(e),a=[];for(const[o,s]of n){const i=s.type;switch(i){case void 0:case"dynamic":case"function":a.push({type:"function",name:o,description:s.description,inputSchema:await or(s.inputSchema).jsonSchema,...s.inputExamples!=null?{inputExamples:s.inputExamples}:{},providerOptions:s.providerOptions,...s.strict!=null?{strict:s.strict}:{}});break;case"provider":a.push({type:"provider",name:o,id:s.id,args:s.args});break;default:{const l=i;throw new Error(`Unsupported tool type: ${l}`)}}}return{tools:a,toolChoice:t==null?{type:"auto"}:typeof t=="string"?{type:t}:{type:"tool",toolName:t.toolName}}}var ua=A_(()=>ke([o_(),v(),X(),Q(),ar(v(),ua.optional()),H(ua)])),Z=ar(v(),ar(v(),ua.optional())),_h=_({type:O("text"),text:v(),providerOptions:Z.optional()}),aE=_({type:O("image"),image:ke([vh,fo(URL)]),mediaType:v().optional(),providerOptions:Z.optional()}),Ih=_({type:O("file"),data:ke([vh,fo(URL)]),filename:v().optional(),mediaType:v(),providerOptions:Z.optional()}),oE=_({type:O("reasoning"),text:v(),providerOptions:Z.optional()}),sE=_({type:O("tool-call"),toolCallId:v(),toolName:v(),input:te(),providerOptions:Z.optional(),providerExecuted:Q().optional()}),iE=d_("type",[_({type:O("text"),value:v(),providerOptions:Z.optional()}),_({type:O("json"),value:ua,providerOptions:Z.optional()}),_({type:O("execution-denied"),reason:v().optional(),providerOptions:Z.optional()}),_({type:O("error-text"),value:v(),providerOptions:Z.optional()}),_({type:O("error-json"),value:ua,providerOptions:Z.optional()}),_({type:O("content"),value:H(ke([_({type:O("text"),text:v(),providerOptions:Z.optional()}),_({type:O("media"),data:v(),mediaType:v()}),_({type:O("file-data"),data:v(),mediaType:v(),filename:v().optional(),providerOptions:Z.optional()}),_({type:O("file-url"),url:v(),providerOptions:Z.optional()}),_({type:O("file-id"),fileId:ke([v(),ar(v(),v())]),providerOptions:Z.optional()}),_({type:O("image-data"),data:v(),mediaType:v(),providerOptions:Z.optional()}),_({type:O("image-url"),url:v(),providerOptions:Z.optional()}),_({type:O("image-file-id"),fileId:ke([v(),ar(v(),v())]),providerOptions:Z.optional()}),_({type:O("custom"),providerOptions:Z.optional()})]))})]),Th=_({type:O("tool-result"),toolCallId:v(),toolName:v(),output:iE,providerOptions:Z.optional()}),lE=_({type:O("tool-approval-request"),approvalId:v(),toolCallId:v()}),uE=_({type:O("tool-approval-response"),approvalId:v(),approved:Q(),reason:v().optional()}),Sh=_({role:O("system"),content:v(),providerOptions:Z.optional()}),Eh=_({role:O("user"),content:ke([v(),H(ke([_h,aE,Ih]))]),providerOptions:Z.optional()}),xh=_({role:O("assistant"),content:ke([v(),H(ke([_h,Ih,oE,sE,Th,lE]))]),providerOptions:Z.optional()}),Rh=_({role:O("tool"),content:H(ke([Th,uE])),providerOptions:Z.optional()}),Mh=ke([Sh,Eh,xh,Rh]);async function $o(e){if(e.prompt==null&&e.messages==null)throw new Pr({prompt:e,message:"prompt or messages must be defined"});if(e.prompt!=null&&e.messages!=null)throw new Pr({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(e.system!=null&&typeof e.system!="string"&&!Er(e.system).every(n=>typeof n=="object"&&n!==null&&"role"in n&&n.role==="system"))throw new Pr({prompt:e,message:"system must be a string, SystemModelMessage, or array of SystemModelMessage"});let t;if(e.prompt!=null&&typeof e.prompt=="string")t=[{role:"user",content:e.prompt}];else if(e.prompt!=null&&Array.isArray(e.prompt))t=e.prompt;else if(e.messages!=null)t=e.messages;else throw new Pr({prompt:e,message:"prompt or messages must be defined"});if(t.length===0)throw new Pr({prompt:e,message:"messages must not be empty"});const r=await pt({value:t,schema:H(Mh)});if(!r.success)throw new Pr({prompt:e,message:"The messages do not match the ModelMessage[] schema.",cause:r.error});return{messages:t,system:e.system}}function Do(e){if(!ei.isInstance(e))return e;const t=(process==null?void 0:"production")==="production",r="https://ai-sdk.dev/unauthenticated-ai-gateway";return t?new C({name:"GatewayError",message:`Unauthenticated. Configure AI_GATEWAY_API_KEY or use a provider module. Learn more: ${r}`}):Object.assign(new Error(`\x1B[1m\x1B[31mUnauthenticated request to AI Gateway.\x1B[0m

To authenticate, set the \x1B[33mAI_GATEWAY_API_KEY\x1B[0m environment variable with your API key.

Alternatively, you can use a provider module instead of the AI Gateway.

Learn more: \x1B[34m${r}\x1B[0m

`),{name:"GatewayAuthenticationError"})}function et({operationId:e,telemetry:t}){return{"operation.name":`${e}${(t==null?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":t==null?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":t==null?void 0:t.functionId}}function tn({model:e,settings:t,telemetry:r,headers:n}){var a;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((o,[s,i])=>{if(s==="timeout"){const l=ii(i);l!=null&&(o[`ai.settings.${s}`]=l)}else o[`ai.settings.${s}`]=i;return o},{}),...Object.entries((a=r==null?void 0:r.metadata)!=null?a:{}).reduce((o,[s,i])=>(o[`ai.telemetry.metadata.${s}`]=i,o),{}),...Object.entries(n??{}).reduce((o,[s,i])=>(i!==void 0&&(o[`ai.request.headers.${s}`]=i),o),{})}}var cE={startSpan(){return Za},startActiveSpan(e,t,r,n){if(typeof t=="function")return t(Za);if(typeof r=="function")return r(Za);if(typeof n=="function")return n(Za)}},Za={spanContext(){return dE},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this}},dE={traceId:"",spanId:"",traceFlags:0};function rn({isEnabled:e=!1,tracer:t}={}){return e?t||wS.getTracer("ai"):cE}async function tt({name:e,tracer:t,attributes:r,fn:n,endWhenDone:a=!0}){return t.startActiveSpan(e,{attributes:await r},async o=>{const s=Pu.active();try{const i=await Pu.with(s,()=>n(o));return a&&o.end(),i}catch(i){try{Oh(o,i)}finally{o.end()}throw i}})}function Oh(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:go.ERROR,message:t.message})):e.setStatus({code:go.ERROR})}async function le({telemetry:e,attributes:t}){if((e==null?void 0:e.isEnabled)!==!0)return{};const r={};for(const[n,a]of Object.entries(t))if(a!=null){if(typeof a=="object"&&"input"in a&&typeof a.input=="function"){if((e==null?void 0:e.recordInputs)===!1)continue;const o=await a.input();o!=null&&(r[n]=o);continue}if(typeof a=="object"&&"output"in a&&typeof a.output=="function"){if((e==null?void 0:e.recordOutputs)===!1)continue;const o=await a.output();o!=null&&(r[n]=o);continue}r[n]=a}return r}function jo(e){return JSON.stringify(e.map(t=>({...t,content:typeof t.content=="string"?t.content:t.content.map(r=>r.type==="file"?{...r,data:r.data instanceof Uint8Array?QS(r.data):r.data}:r)})))}function ca(e){return{inputTokens:e.inputTokens.total,inputTokenDetails:{noCacheTokens:e.inputTokens.noCache,cacheReadTokens:e.inputTokens.cacheRead,cacheWriteTokens:e.inputTokens.cacheWrite},outputTokens:e.outputTokens.total,outputTokenDetails:{textTokens:e.outputTokens.text,reasoningTokens:e.outputTokens.reasoning},totalTokens:ct(e.inputTokens.total,e.outputTokens.total),raw:e.raw,reasoningTokens:e.outputTokens.reasoning,cachedInputTokens:e.inputTokens.cacheRead}}function Ka(){return{inputTokens:void 0,inputTokenDetails:{noCacheTokens:void 0,cacheReadTokens:void 0,cacheWriteTokens:void 0},outputTokens:void 0,outputTokenDetails:{textTokens:void 0,reasoningTokens:void 0},totalTokens:void 0,raw:void 0}}function kh(e,t){var r,n,a,o,s,i,l,u,c,p;return{inputTokens:ct(e.inputTokens,t.inputTokens),inputTokenDetails:{noCacheTokens:ct((r=e.inputTokenDetails)==null?void 0:r.noCacheTokens,(n=t.inputTokenDetails)==null?void 0:n.noCacheTokens),cacheReadTokens:ct((a=e.inputTokenDetails)==null?void 0:a.cacheReadTokens,(o=t.inputTokenDetails)==null?void 0:o.cacheReadTokens),cacheWriteTokens:ct((s=e.inputTokenDetails)==null?void 0:s.cacheWriteTokens,(i=t.inputTokenDetails)==null?void 0:i.cacheWriteTokens)},outputTokens:ct(e.outputTokens,t.outputTokens),outputTokenDetails:{textTokens:ct((l=e.outputTokenDetails)==null?void 0:l.textTokens,(u=t.outputTokenDetails)==null?void 0:u.textTokens),reasoningTokens:ct((c=e.outputTokenDetails)==null?void 0:c.reasoningTokens,(p=t.outputTokenDetails)==null?void 0:p.reasoningTokens)},totalTokens:ct(e.totalTokens,t.totalTokens),reasoningTokens:ct(e.reasoningTokens,t.reasoningTokens),cachedInputTokens:ct(e.cachedInputTokens,t.cachedInputTokens)}}function ct(e,t){return e==null&&t==null?void 0:(e??0)+(t??0)}function pE(e,t){return{inputTokens:ct(e.inputTokens,t.inputTokens),outputTokens:ct(e.outputTokens,t.outputTokens),totalTokens:ct(e.totalTokens,t.totalTokens)}}function Un(e,t){if(e===void 0&&t===void 0)return;if(e===void 0)return t;if(t===void 0)return e;const r={...e};for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const a=t[n];if(a===void 0)continue;const o=n in e?e[n]:void 0,s=a!==null&&typeof a=="object"&&!Array.isArray(a)&&!(a instanceof Date)&&!(a instanceof RegExp),i=o!=null&&typeof o=="object"&&!Array.isArray(o)&&!(o instanceof Date)&&!(o instanceof RegExp);s&&i?r[n]=Un(o,a):r[n]=a}return r}function fE({error:e,exponentialBackoffDelay:t}){const r=e.responseHeaders;if(!r)return t;let n;const a=r["retry-after-ms"];if(a){const s=parseFloat(a);Number.isNaN(s)||(n=s)}const o=r["retry-after"];if(o&&n===void 0){const s=parseFloat(o);Number.isNaN(s)?n=Date.parse(o)-Date.now():n=s*1e3}return n!=null&&!Number.isNaN(n)&&0<=n&&(n<60*1e3||n<t)?n:t}var hE=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2,abortSignal:n}={})=>async a=>Ch(a,{maxRetries:e,delayInMs:t,backoffFactor:r,abortSignal:n});async function Ch(e,{maxRetries:t,delayInMs:r,backoffFactor:n,abortSignal:a},o=[]){try{return await e()}catch(s){if(Jr(s)||t===0)throw s;const i=Mo(s),l=[...o,s],u=l.length;if(u>t)throw new As({message:`Failed after ${u} attempts. Last error: ${i}`,reason:"maxRetriesExceeded",errors:l});if(s instanceof Error&&He.isInstance(s)&&s.isRetryable===!0&&u<=t)return await Ro(fE({error:s,exponentialBackoffDelay:r}),{abortSignal:a}),Ch(e,{maxRetries:t,delayInMs:n*r,backoffFactor:n,abortSignal:a},l);throw u===1?s:new As({message:`Failed after ${u} attempts with non-retryable error: '${i}'`,reason:"errorNotRetryable",errors:l})}}function Zt({maxRetries:e,abortSignal:t}){if(e!=null){if(!Number.isInteger(e))throw new ve({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new ve({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}const r=e??2;return{maxRetries:r,retry:hE({maxRetries:r,abortSignal:t})}}function Ah({messages:e}){const t=e.at(-1);if((t==null?void 0:t.role)!="tool")return{approvedToolApprovals:[],deniedToolApprovals:[]};const r={};for(const l of e)if(l.role==="assistant"&&typeof l.content!="string"){const u=l.content;for(const c of u)c.type==="tool-call"&&(r[c.toolCallId]=c)}const n={};for(const l of e)if(l.role==="assistant"&&typeof l.content!="string"){const u=l.content;for(const c of u)c.type==="tool-approval-request"&&(n[c.approvalId]=c)}const a={};for(const l of t.content)l.type==="tool-result"&&(a[l.toolCallId]=l);const o=[],s=[],i=t.content.filter(l=>l.type==="tool-approval-response");for(const l of i){const u=n[l.approvalId];if(u==null)throw new of({approvalId:l.approvalId});if(a[u.toolCallId]!=null)continue;const c=r[u.toolCallId];if(c==null)throw new No({toolCallId:u.toolCallId,approvalId:u.approvalId});const p={approvalRequest:u,approvalResponse:l,toolCall:c};l.approved?o.push(p):s.push(p)}return{approvedToolApprovals:o,deniedToolApprovals:s}}async function ci({toolCall:e,tools:t,tracer:r,telemetry:n,messages:a,abortSignal:o,experimental_context:s,onPreliminaryToolResult:i}){const{toolName:l,toolCallId:u,input:c}=e,p=t==null?void 0:t[l];if((p==null?void 0:p.execute)!=null)return tt({name:"ai.toolCall",attributes:le({telemetry:n,attributes:{...et({operationId:"ai.toolCall",telemetry:n}),"ai.toolCall.name":l,"ai.toolCall.id":u,"ai.toolCall.args":{output:()=>JSON.stringify(c)}}}),tracer:r,fn:async d=>{let f;try{const m=H0({execute:p.execute.bind(p),input:c,options:{toolCallId:u,messages:a,abortSignal:o,experimental_context:s}});for await(const h of m)h.type==="preliminary"?i==null||i({...e,type:"tool-result",output:h.output,preliminary:!0}):f=h.output}catch(m){return Oh(d,m),{type:"tool-error",toolCallId:u,toolName:l,input:c,error:m,dynamic:p.type==="dynamic",...e.providerMetadata!=null?{providerMetadata:e.providerMetadata}:{}}}try{d.setAttributes(await le({telemetry:n,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(f)}}}))}catch{}return{type:"tool-result",toolCallId:u,toolName:l,input:c,output:f,dynamic:p.type==="dynamic",...e.providerMetadata!=null?{providerMetadata:e.providerMetadata}:{}}}})}function Ns(e){const t=e.filter(r=>r.type==="text");if(t.length!==0)return t.map(r=>r.text).join("")}var br=class{constructor({data:e,mediaType:t}){const r=e instanceof Uint8Array;this.base64Data=r?void 0:e,this.uint8ArrayData=r?e:void 0,this.mediaType=t}get base64(){return this.base64Data==null&&(this.base64Data=On(this.uint8ArrayData)),this.base64Data}get uint8Array(){return this.uint8ArrayData==null&&(this.uint8ArrayData=Br(this.base64Data)),this.uint8ArrayData}},mE=class extends br{constructor(e){super(e),this.type="file"}};async function Nh({tool:e,toolCall:t,messages:r,experimental_context:n}){return e.needsApproval==null?!1:typeof e.needsApproval=="boolean"?e.needsApproval:await e.needsApproval(t.input,{toolCallId:t.toolCallId,messages:r,experimental_context:n})}var Ph={};_S(Ph,{array:()=>yE,choice:()=>wE,json:()=>bE,object:()=>vE,text:()=>yo});function gE(e){const t=["ROOT"];let r=-1,n=null;function a(l,u,c){switch(l){case'"':{r=u,t.pop(),t.push(c),t.push("INSIDE_STRING");break}case"f":case"t":case"n":{r=u,n=u,t.pop(),t.push(c),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(c),t.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{r=u,t.pop(),t.push(c),t.push("INSIDE_NUMBER");break}case"{":{r=u,t.pop(),t.push(c),t.push("INSIDE_OBJECT_START");break}case"[":{r=u,t.pop(),t.push(c),t.push("INSIDE_ARRAY_START");break}}}function o(l,u){switch(l){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{r=u,t.pop();break}}}function s(l,u){switch(l){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{r=u,t.pop();break}}}for(let l=0;l<e.length;l++){const u=e[l];switch(t[t.length-1]){case"ROOT":a(u,l,"FINISH");break;case"INSIDE_OBJECT_START":{switch(u){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}case"}":{r=l,t.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(u){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(u){case'"':{t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(u){case":":{t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{a(u,l,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{o(u,l);break}case"INSIDE_STRING":{switch(u){case'"':{t.pop(),r=l;break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:r=l}break}case"INSIDE_ARRAY_START":{switch(u){case"]":{r=l,t.pop();break}default:{r=l,a(u,l,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(u){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{r=l,t.pop();break}default:{r=l;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{a(u,l,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),r=l;break}case"INSIDE_NUMBER":{switch(u){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{r=l;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&s(u,l),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&o(u,l);break}case"}":{t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&o(u,l);break}case"]":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&s(u,l);break}default:{t.pop();break}}break}case"INSIDE_LITERAL":{const p=e.substring(n,l+1);!"false".startsWith(p)&&!"true".startsWith(p)&&!"null".startsWith(p)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?o(u,l):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&s(u,l)):r=l;break}}}let i=e.slice(0,r+1);for(let l=t.length-1;l>=0;l--)switch(t[l]){case"INSIDE_STRING":{i+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{i+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{i+="]";break}case"INSIDE_LITERAL":{const c=e.substring(n,e.length);"true".startsWith(c)?i+="true".slice(c.length):"false".startsWith(c)?i+="false".slice(c.length):"null".startsWith(c)&&(i+="null".slice(c.length))}}return i}async function nn(e){if(e===void 0)return{value:void 0,state:"undefined-input"};let t=await xt({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await xt({text:gE(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}var yo=()=>({name:"text",responseFormat:Promise.resolve({type:"text"}),async parseCompleteOutput({text:e}){return e},async parsePartialOutput({text:e}){return{partial:e}},createElementStreamTransform(){}}),vE=({schema:e,name:t,description:r})=>{const n=or(e);return{name:"object",responseFormat:Se(n.jsonSchema).then(a=>({type:"json",schema:a,...t!=null&&{name:t},...r!=null&&{description:r}})),async parseCompleteOutput({text:a},o){const s=await xt({text:a});if(!s.success)throw new dt({message:"No object generated: could not parse the response.",cause:s.error,text:a,response:o.response,usage:o.usage,finishReason:o.finishReason});const i=await pt({value:s.value,schema:n});if(!i.success)throw new dt({message:"No object generated: response did not match schema.",cause:i.error,text:a,response:o.response,usage:o.usage,finishReason:o.finishReason});return i.value},async parsePartialOutput({text:a}){const o=await nn(a);switch(o.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:o.value}}},createElementStreamTransform(){}}},yE=({element:e,name:t,description:r})=>{const n=or(e);return{name:"array",responseFormat:Se(n.jsonSchema).then(a=>{const{$schema:o,...s}=a;return{type:"json",schema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:s}},required:["elements"],additionalProperties:!1},...t!=null&&{name:t},...r!=null&&{description:r}}}),async parseCompleteOutput({text:a},o){const s=await xt({text:a});if(!s.success)throw new dt({message:"No object generated: could not parse the response.",cause:s.error,text:a,response:o.response,usage:o.usage,finishReason:o.finishReason});const i=s.value;if(i==null||typeof i!="object"||!("elements"in i)||!Array.isArray(i.elements))throw new dt({message:"No object generated: response did not match schema.",cause:new We({value:i,cause:"response must be an object with an elements array"}),text:a,response:o.response,usage:o.usage,finishReason:o.finishReason});for(const l of i.elements){const u=await pt({value:l,schema:n});if(!u.success)throw new dt({message:"No object generated: response did not match schema.",cause:u.error,text:a,response:o.response,usage:o.usage,finishReason:o.finishReason})}return i.elements},async parsePartialOutput({text:a}){const o=await nn(a);switch(o.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":{const s=o.value;if(s==null||typeof s!="object"||!("elements"in s)||!Array.isArray(s.elements))return;const i=o.state==="repaired-parse"&&s.elements.length>0?s.elements.slice(0,-1):s.elements,l=[];for(const u of i){const c=await pt({value:u,schema:n});c.success&&l.push(c.value)}return{partial:l}}}},createElementStreamTransform(){let a=0;return new TransformStream({transform({partialOutput:o},s){if(o!=null)for(;a<o.length;a++)s.enqueue(o[a])}})}}},wE=({options:e,name:t,description:r})=>({name:"choice",responseFormat:Promise.resolve({type:"json",schema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},...t!=null&&{name:t},...r!=null&&{description:r}}),async parseCompleteOutput({text:n},a){const o=await xt({text:n});if(!o.success)throw new dt({message:"No object generated: could not parse the response.",cause:o.error,text:n,response:a.response,usage:a.usage,finishReason:a.finishReason});const s=o.value;if(s==null||typeof s!="object"||!("result"in s)||typeof s.result!="string"||!e.includes(s.result))throw new dt({message:"No object generated: response did not match schema.",cause:new We({value:s,cause:"response must be an object that contains a choice value."}),text:n,response:a.response,usage:a.usage,finishReason:a.finishReason});return s.result},async parsePartialOutput({text:n}){const a=await nn(n);switch(a.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":{const o=a.value;if(o==null||typeof o!="object"||!("result"in o)||typeof o.result!="string")return;const s=e.filter(i=>i.startsWith(o.result));return a.state==="successful-parse"?s.includes(o.result)?{partial:o.result}:void 0:s.length===1?{partial:s[0]}:void 0}}},createElementStreamTransform(){}}),bE=({name:e,description:t}={})=>({name:"json",responseFormat:Promise.resolve({type:"json",...e!=null&&{name:e},...t!=null&&{description:t}}),async parseCompleteOutput({text:r},n){const a=await xt({text:r});if(!a.success)throw new dt({message:"No object generated: could not parse the response.",cause:a.error,text:r,response:n.response,usage:n.usage,finishReason:n.finishReason});return a.value},async parsePartialOutput({text:r}){const n=await nn(r);switch(n.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return n.value===void 0?void 0:{partial:n.value}}},createElementStreamTransform(){}});async function $h({toolCall:e,tools:t,repairToolCall:r,system:n,messages:a}){var o;try{if(t==null){if(e.providerExecuted&&e.dynamic)return await Dh(e);throw new vo({toolName:e.toolName})}try{return await Uu({toolCall:e,tools:t})}catch(s){if(r==null||!(vo.isInstance(s)||Ao.isInstance(s)))throw s;let i=null;try{i=await r({toolCall:e,tools:t,inputSchema:async({toolName:l})=>{const{inputSchema:u}=t[l];return await or(u).jsonSchema},system:n,messages:a,error:s})}catch(l){throw new Lf({cause:l,originalError:s})}if(i==null)throw s;return await Uu({toolCall:i,tools:t})}}catch(s){const i=await xt({text:e.input}),l=i.success?i.value:e.input;return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:l,dynamic:!0,invalid:!0,error:s,title:(o=t==null?void 0:t[e.toolName])==null?void 0:o.title,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}}}async function Dh(e){const t=e.input.trim()===""?{success:!0,value:{}}:await xt({text:e.input});if(t.success===!1)throw new Ao({toolName:e.toolName,toolInput:e.input,cause:t.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:t.value,providerExecuted:!0,dynamic:!0,providerMetadata:e.providerMetadata}}async function Uu({toolCall:e,tools:t}){const r=e.toolName,n=t[r];if(n==null){if(e.providerExecuted&&e.dynamic)return await Dh(e);throw new vo({toolName:e.toolName,availableTools:Object.keys(t)})}const a=or(n.inputSchema),o=e.input.trim()===""?await pt({value:{},schema:a}):await xt({text:e.input,schema:a});if(o.success===!1)throw new Ao({toolName:r,toolInput:e.input,cause:o.error});return n.type==="dynamic"?{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:o.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,dynamic:!0,title:n.title}:{type:"tool-call",toolCallId:e.toolCallId,toolName:r,input:o.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,title:n.title}}var jh=class{constructor({content:e,finishReason:t,rawFinishReason:r,usage:n,warnings:a,request:o,response:s,providerMetadata:i}){this.content=e,this.finishReason=t,this.rawFinishReason=r,this.usage=n,this.warnings=a,this.request=o,this.response=s,this.providerMetadata=i}get text(){return this.content.filter(e=>e.type==="text").map(e=>e.text).join("")}get reasoning(){return this.content.filter(e=>e.type==="reasoning")}get reasoningText(){return this.reasoning.length===0?void 0:this.reasoning.map(e=>e.text).join("")}get files(){return this.content.filter(e=>e.type==="file").map(e=>e.file)}get sources(){return this.content.filter(e=>e.type==="source")}get toolCalls(){return this.content.filter(e=>e.type==="tool-call")}get staticToolCalls(){return this.toolCalls.filter(e=>e.dynamic!==!0)}get dynamicToolCalls(){return this.toolCalls.filter(e=>e.dynamic===!0)}get toolResults(){return this.content.filter(e=>e.type==="tool-result")}get staticToolResults(){return this.toolResults.filter(e=>e.dynamic!==!0)}get dynamicToolResults(){return this.toolResults.filter(e=>e.dynamic===!0)}};function zo(e){return({steps:t})=>t.length===e}function _E(e){return({steps:t})=>{var r,n,a;return(a=(n=(r=t[t.length-1])==null?void 0:r.toolCalls)==null?void 0:n.some(o=>o.toolName===e))!=null?a:!1}}async function zh({stopConditions:e,steps:t}){return(await Promise.all(e.map(r=>r({steps:t})))).some(r=>r)}async function Ps({content:e,tools:t}){const r=[],n=[];for(const o of e)if(o.type!=="source"&&!((o.type==="tool-result"||o.type==="tool-error")&&!o.providerExecuted)&&!(o.type==="text"&&o.text.length===0))switch(o.type){case"text":n.push({type:"text",text:o.text,providerOptions:o.providerMetadata});break;case"reasoning":n.push({type:"reasoning",text:o.text,providerOptions:o.providerMetadata});break;case"file":n.push({type:"file",data:o.file.base64,mediaType:o.file.mediaType,providerOptions:o.providerMetadata});break;case"tool-call":n.push({type:"tool-call",toolCallId:o.toolCallId,toolName:o.toolName,input:o.input,providerExecuted:o.providerExecuted,providerOptions:o.providerMetadata});break;case"tool-result":{const s=await Lr({toolCallId:o.toolCallId,input:o.input,tool:t==null?void 0:t[o.toolName],output:o.output,errorMode:"none"});n.push({type:"tool-result",toolCallId:o.toolCallId,toolName:o.toolName,output:s,providerOptions:o.providerMetadata});break}case"tool-error":{const s=await Lr({toolCallId:o.toolCallId,input:o.input,tool:t==null?void 0:t[o.toolName],output:o.error,errorMode:"json"});n.push({type:"tool-result",toolCallId:o.toolCallId,toolName:o.toolName,output:s,providerOptions:o.providerMetadata});break}case"tool-approval-request":n.push({type:"tool-approval-request",approvalId:o.approvalId,toolCallId:o.toolCall.toolCallId});break}n.length>0&&r.push({role:"assistant",content:n});const a=[];for(const o of e){if(!(o.type==="tool-result"||o.type==="tool-error")||o.providerExecuted)continue;const s=await Lr({toolCallId:o.toolCallId,input:o.input,tool:t==null?void 0:t[o.toolName],output:o.type==="tool-result"?o.output:o.error,errorMode:o.type==="tool-error"?"text":"none"});a.push({type:"tool-result",toolCallId:o.toolCallId,toolName:o.toolName,output:s,...o.providerMetadata!=null?{providerOptions:o.providerMetadata}:{}})}return a.length>0&&r.push({role:"tool",content:a}),r}function Uh(...e){const t=e.filter(n=>n!=null);if(t.length===0)return;if(t.length===1)return t[0];const r=new AbortController;for(const n of t){if(n.aborted)return r.abort(n.reason),r.signal;n.addEventListener("abort",()=>{r.abort(n.reason)},{once:!0})}return r.signal}var IE=jn({prefix:"aitxt",size:24});async function Zh({model:e,tools:t,toolChoice:r,system:n,prompt:a,messages:o,maxRetries:s,abortSignal:i,timeout:l,headers:u,stopWhen:c=zo(1),experimental_output:p,output:d=p,experimental_telemetry:f,providerOptions:m,experimental_activeTools:h,activeTools:g=h,experimental_prepareStep:w,prepareStep:b=w,experimental_repairToolCall:y,experimental_download:T,experimental_context:x,experimental_include:R,_internal:{generateId:I=IE}={},onStepFinish:A,onFinish:$,...N}){const M=Nn(e),P=Er(c),V=ii(l),G=mh(l),pe=G!=null?new AbortController:void 0,ne=Uh(i,V!=null?AbortSignal.timeout(V):void 0,pe==null?void 0:pe.signal),{maxRetries:D,retry:ae}=Zt({maxRetries:s,abortSignal:ne}),Ue=Kr(N),Ze=rt(u??{},`ai/${Rt}`),Ot=tn({model:M,telemetry:f,headers:Ze,settings:{...Ue,maxRetries:D}}),nt=await $o({system:n,prompt:a,messages:o}),Ye=rn(f);try{return await tt({name:"ai.generateText",attributes:le({telemetry:f,attributes:{...et({operationId:"ai.generateText",telemetry:f}),...Ot,"ai.model.provider":M.provider,"ai.model.id":M.modelId,"ai.prompt":{input:()=>JSON.stringify({system:n,prompt:a,messages:o})}}}),tracer:Ye,fn:async Fe=>{var ce,at,kt,Ke,qe,Ne,ut,wt,bt,qt,Yt;const F=nt.messages,J=[],{approvedToolApprovals:_t,deniedToolApprovals:Ee}=Ah({messages:F}),we=_t.filter(ue=>!ue.toolCall.providerExecuted);if(Ee.length>0||we.length>0){const ue=await Zu({toolCalls:we.map(B=>B.toolCall),tools:t,tracer:Ye,telemetry:f,messages:F,abortSignal:ne,experimental_context:x}),Le=[];for(const B of ue){const ge=await Lr({toolCallId:B.toolCallId,input:B.input,tool:t==null?void 0:t[B.toolName],output:B.type==="tool-result"?B.output:B.error,errorMode:B.type==="tool-error"?"json":"none"});Le.push({type:"tool-result",toolCallId:B.toolCallId,toolName:B.toolName,output:ge})}for(const B of Ee)Le.push({type:"tool-result",toolCallId:B.toolCall.toolCallId,toolName:B.toolCall.toolName,output:{type:"execution-denied",reason:B.approvalResponse.reason,...B.toolCall.providerExecuted&&{providerOptions:{openai:{approvalId:B.approvalResponse.approvalId}}}}});J.push({role:"tool",content:Le})}const se=[..._t,...Ee].filter(ue=>ue.toolCall.providerExecuted);se.length>0&&J.push({role:"tool",content:se.map(ue=>({type:"tool-approval-response",approvalId:ue.approvalResponse.approvalId,approved:ue.approvalResponse.approved,reason:ue.approvalResponse.reason,providerExecuted:!0}))});const Re=Kr(N);let z,$e=[],ht=[];const k=[],fe=new Map;do{const ue=G!=null?setTimeout(()=>pe.abort(),G):void 0;try{const Le=[...F,...J],B=await(b==null?void 0:b({model:M,steps:k,stepNumber:k.length,messages:Le,experimental_context:x})),ge=Nn((ce=B==null?void 0:B.model)!=null?ce:M),Me=await Po({prompt:{system:(at=B==null?void 0:B.system)!=null?at:nt.system,messages:(kt=B==null?void 0:B.messages)!=null?kt:Le},supportedUrls:await ge.supportedUrls,download:T});x=(Ke=B==null?void 0:B.experimental_context)!=null?Ke:x;const{toolChoice:lr,tools:an}=await bh({tools:t,toolChoice:(qe=B==null?void 0:B.toolChoice)!=null?qe:r,activeTools:(Ne=B==null?void 0:B.activeTools)!=null?Ne:g});z=await ae(()=>{var Y;return tt({name:"ai.generateText.doGenerate",attributes:le({telemetry:f,attributes:{...et({operationId:"ai.generateText.doGenerate",telemetry:f}),...Ot,"ai.model.provider":ge.provider,"ai.model.id":ge.modelId,"ai.prompt.messages":{input:()=>jo(Me)},"ai.prompt.tools":{input:()=>an==null?void 0:an.map(Xe=>JSON.stringify(Xe))},"ai.prompt.toolChoice":{input:()=>lr!=null?JSON.stringify(lr):void 0},"gen_ai.system":ge.provider,"gen_ai.request.model":ge.modelId,"gen_ai.request.frequency_penalty":N.frequencyPenalty,"gen_ai.request.max_tokens":N.maxOutputTokens,"gen_ai.request.presence_penalty":N.presencePenalty,"gen_ai.request.stop_sequences":N.stopSequences,"gen_ai.request.temperature":(Y=N.temperature)!=null?Y:void 0,"gen_ai.request.top_k":N.topK,"gen_ai.request.top_p":N.topP}}),tracer:Ye,fn:async Xe=>{var kr,Kt,Aa,Na,qn,on,Xt,Fn;const Zo=Un(m,B==null?void 0:B.providerOptions),Ge=await ge.doGenerate({...Re,tools:an,toolChoice:lr,responseFormat:await(d==null?void 0:d.responseFormat),prompt:Me,providerOptions:Zo,abortSignal:ne,headers:Ze}),It={id:(Kt=(kr=Ge.response)==null?void 0:kr.id)!=null?Kt:I(),timestamp:(Na=(Aa=Ge.response)==null?void 0:Aa.timestamp)!=null?Na:new Date,modelId:(on=(qn=Ge.response)==null?void 0:qn.modelId)!=null?on:ge.modelId,headers:(Xt=Ge.response)==null?void 0:Xt.headers,body:(Fn=Ge.response)==null?void 0:Fn.body};return Xe.setAttributes(await le({telemetry:f,attributes:{"ai.response.finishReason":Ge.finishReason.unified,"ai.response.text":{output:()=>Ns(Ge.content)},"ai.response.toolCalls":{output:()=>{const cr=qu(Ge.content);return cr==null?void 0:JSON.stringify(cr)}},"ai.response.id":It.id,"ai.response.model":It.modelId,"ai.response.timestamp":It.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(Ge.providerMetadata),"ai.usage.promptTokens":Ge.usage.inputTokens.total,"ai.usage.completionTokens":Ge.usage.outputTokens.total,"gen_ai.response.finish_reasons":[Ge.finishReason.unified],"gen_ai.response.id":It.id,"gen_ai.response.model":It.modelId,"gen_ai.usage.input_tokens":Ge.usage.inputTokens.total,"gen_ai.usage.output_tokens":Ge.usage.outputTokens.total}})),{...Ge,response:It}}})});const ur=await Promise.all(z.content.filter(Y=>Y.type==="tool-call").map(Y=>$h({toolCall:Y,tools:t,repairToolCall:y,system:n,messages:Le}))),Ft={};for(const Y of ur){if(Y.invalid)continue;const Xe=t==null?void 0:t[Y.toolName];Xe!=null&&((Xe==null?void 0:Xe.onInputAvailable)!=null&&await Xe.onInputAvailable({input:Y.input,toolCallId:Y.toolCallId,messages:Le,abortSignal:ne,experimental_context:x}),await Nh({tool:Xe,toolCall:Y,messages:Le,experimental_context:x})&&(Ft[Y.toolCallId]={type:"tool-approval-request",approvalId:I(),toolCall:Y}))}const Uo=ur.filter(Y=>Y.invalid&&Y.dynamic);ht=[];for(const Y of Uo)ht.push({type:"tool-error",toolCallId:Y.toolCallId,toolName:Y.toolName,input:Y.input,error:Mo(Y.error),dynamic:!0});$e=ur.filter(Y=>!Y.providerExecuted),t!=null&&ht.push(...await Zu({toolCalls:$e.filter(Y=>!Y.invalid&&Ft[Y.toolCallId]==null),tools:t,tracer:Ye,telemetry:f,messages:Le,abortSignal:ne,experimental_context:x}));for(const Y of ur){if(!Y.providerExecuted)continue;const Xe=t==null?void 0:t[Y.toolName];(Xe==null?void 0:Xe.type)==="provider"&&Xe.supportsDeferredResults&&(z.content.some(Kt=>Kt.type==="tool-result"&&Kt.toolCallId===Y.toolCallId)||fe.set(Y.toolCallId,{toolName:Y.toolName}))}for(const Y of z.content)Y.type==="tool-result"&&fe.delete(Y.toolCallId);const Zn=SE({content:z.content,toolCalls:ur,toolOutputs:ht,toolApprovalRequests:Object.values(Ft),tools:t});J.push(...await Ps({content:Zn,tools:t}));const Ca=(ut=R==null?void 0:R.requestBody)==null||ut?(wt=z.request)!=null?wt:{}:{...z.request,body:void 0},Or={...z.response,messages:structuredClone(J),body:(bt=R==null?void 0:R.responseBody)==null||bt?(qt=z.response)==null?void 0:qt.body:void 0},Ve=new jh({content:Zn,finishReason:z.finishReason.unified,rawFinishReason:z.finishReason.raw,usage:ca(z.usage),warnings:z.warnings,providerMetadata:z.providerMetadata,request:Ca,response:Or});yt({warnings:(Yt=z.warnings)!=null?Yt:[],provider:ge.provider,model:ge.modelId}),k.push(Ve),await(A==null?void 0:A(Ve))}finally{ue!=null&&clearTimeout(ue)}}while(($e.length>0&&ht.length===$e.length||fe.size>0)&&!await zh({stopConditions:P,steps:k}));Fe.setAttributes(await le({telemetry:f,attributes:{"ai.response.finishReason":z.finishReason.unified,"ai.response.text":{output:()=>Ns(z.content)},"ai.response.toolCalls":{output:()=>{const ue=qu(z.content);return ue==null?void 0:JSON.stringify(ue)}},"ai.response.providerMetadata":JSON.stringify(z.providerMetadata),"ai.usage.promptTokens":z.usage.inputTokens.total,"ai.usage.completionTokens":z.usage.outputTokens.total}}));const ie=k[k.length-1],ir=k.reduce((ue,Le)=>kh(ue,Le.usage),{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0,reasoningTokens:void 0,cachedInputTokens:void 0});await($==null?void 0:$({finishReason:ie.finishReason,rawFinishReason:ie.rawFinishReason,usage:ie.usage,content:ie.content,text:ie.text,reasoningText:ie.reasoningText,reasoning:ie.reasoning,files:ie.files,sources:ie.sources,toolCalls:ie.toolCalls,staticToolCalls:ie.staticToolCalls,dynamicToolCalls:ie.dynamicToolCalls,toolResults:ie.toolResults,staticToolResults:ie.staticToolResults,dynamicToolResults:ie.dynamicToolResults,request:ie.request,response:ie.response,warnings:ie.warnings,providerMetadata:ie.providerMetadata,steps:k,totalUsage:ir,experimental_context:x}));let Mr;return ie.finishReason==="stop"&&(Mr=await(d??yo()).parseCompleteOutput({text:ie.text},{response:ie.response,usage:ie.usage,finishReason:ie.finishReason})),new TE({steps:k,totalUsage:ir,output:Mr})}})}catch(Fe){throw Do(Fe)}}async function Zu({toolCalls:e,tools:t,tracer:r,telemetry:n,messages:a,abortSignal:o,experimental_context:s}){return(await Promise.all(e.map(async l=>ci({toolCall:l,tools:t,tracer:r,telemetry:n,messages:a,abortSignal:o,experimental_context:s})))).filter(l=>l!=null)}var TE=class{constructor(e){this.steps=e.steps,this._output=e.output,this.totalUsage=e.totalUsage}get finalStep(){return this.steps[this.steps.length-1]}get content(){return this.finalStep.content}get text(){return this.finalStep.text}get files(){return this.finalStep.files}get reasoningText(){return this.finalStep.reasoningText}get reasoning(){return this.finalStep.reasoning}get toolCalls(){return this.finalStep.toolCalls}get staticToolCalls(){return this.finalStep.staticToolCalls}get dynamicToolCalls(){return this.finalStep.dynamicToolCalls}get toolResults(){return this.finalStep.toolResults}get staticToolResults(){return this.finalStep.staticToolResults}get dynamicToolResults(){return this.finalStep.dynamicToolResults}get sources(){return this.finalStep.sources}get finishReason(){return this.finalStep.finishReason}get rawFinishReason(){return this.finalStep.rawFinishReason}get warnings(){return this.finalStep.warnings}get providerMetadata(){return this.finalStep.providerMetadata}get response(){return this.finalStep.response}get request(){return this.finalStep.request}get usage(){return this.finalStep.usage}get experimental_output(){return this.output}get output(){if(this._output==null)throw new si;return this._output}};function qu(e){const t=e.filter(r=>r.type==="tool-call");if(t.length!==0)return t.map(r=>({toolCallId:r.toolCallId,toolName:r.toolName,input:r.input}))}function SE({content:e,toolCalls:t,toolOutputs:r,toolApprovalRequests:n,tools:a}){const o=[];for(const s of e)switch(s.type){case"text":case"reasoning":case"source":o.push(s);break;case"file":{o.push({type:"file",file:new br(s),...s.providerMetadata!=null?{providerMetadata:s.providerMetadata}:{}});break}case"tool-call":{o.push(t.find(i=>i.toolCallId===s.toolCallId));break}case"tool-result":{const i=t.find(l=>l.toolCallId===s.toolCallId);if(i==null){const l=a==null?void 0:a[s.toolName];if(!((l==null?void 0:l.type)==="provider"&&l.supportsDeferredResults))throw new Error(`Tool call ${s.toolCallId} not found.`);s.isError?o.push({type:"tool-error",toolCallId:s.toolCallId,toolName:s.toolName,input:void 0,error:s.result,providerExecuted:!0,dynamic:s.dynamic}):o.push({type:"tool-result",toolCallId:s.toolCallId,toolName:s.toolName,input:void 0,output:s.result,providerExecuted:!0,dynamic:s.dynamic});break}s.isError?o.push({type:"tool-error",toolCallId:s.toolCallId,toolName:s.toolName,input:i.input,error:s.result,providerExecuted:!0,dynamic:i.dynamic}):o.push({type:"tool-result",toolCallId:s.toolCallId,toolName:s.toolName,input:i.input,output:s.result,providerExecuted:!0,dynamic:i.dynamic});break}case"tool-approval-request":{const i=t.find(l=>l.toolCallId===s.toolCallId);if(i==null)throw new No({toolCallId:s.toolCallId,approvalId:s.approvalId});o.push({type:"tool-approval-request",approvalId:s.approvalId,toolCall:i});break}}return[...o,...r,...n]}function Oa(e,t){const r=new Headers(e??{});for(const[n,a]of Object.entries(t))r.has(n)||r.set(n,a);return r}function di({status:e,statusText:t,headers:r,textStream:n}){return new Response(n.pipeThrough(new TextEncoderStream),{status:e??200,statusText:t,headers:Oa(r,{"content-type":"text/plain; charset=utf-8"})})}function qh({response:e,status:t,statusText:r,headers:n,stream:a}){const o=t??200;r!==void 0?e.writeHead(o,r,n):e.writeHead(o,n);const s=a.getReader();(async()=>{try{for(;;){const{done:l,value:u}=await s.read();if(l)break;e.write(u)||await new Promise(p=>{e.once("drain",p)})}}catch(l){throw l}finally{e.end()}})()}function pi({response:e,status:t,statusText:r,headers:n,textStream:a}){qh({response:e,status:t,statusText:r,headers:Object.fromEntries(Oa(n,{"content-type":"text/plain; charset=utf-8"}).entries()),stream:a.pipeThrough(new TextEncoderStream)})}var fi=class extends TransformStream{constructor(){super({transform(e,t){t.enqueue(`data: ${JSON.stringify(e)}

`)},flush(e){e.enqueue(`data: [DONE]

`)}})}},hi={"content-type":"text/event-stream","cache-control":"no-cache",connection:"keep-alive","x-vercel-ai-ui-message-stream":"v1","x-accel-buffering":"no"};function mi({status:e,statusText:t,headers:r,stream:n,consumeSseStream:a}){let o=n.pipeThrough(new fi);if(a){const[s,i]=o.tee();o=s,a({stream:i})}return new Response(o.pipeThrough(new TextEncoderStream),{status:e,statusText:t,headers:Oa(r,hi)})}function EE({originalMessages:e,responseMessageId:t}){if(e==null)return;const r=e[e.length-1];return(r==null?void 0:r.role)==="assistant"?r.id:typeof t=="function"?t():t}var gi=ye(()=>me(ke([Te({type:O("text-start"),id:v(),providerMetadata:Z.optional()}),Te({type:O("text-delta"),id:v(),delta:v(),providerMetadata:Z.optional()}),Te({type:O("text-end"),id:v(),providerMetadata:Z.optional()}),Te({type:O("error"),errorText:v()}),Te({type:O("tool-input-start"),toolCallId:v(),toolName:v(),providerExecuted:Q().optional(),providerMetadata:Z.optional(),dynamic:Q().optional(),title:v().optional()}),Te({type:O("tool-input-delta"),toolCallId:v(),inputTextDelta:v()}),Te({type:O("tool-input-available"),toolCallId:v(),toolName:v(),input:te(),providerExecuted:Q().optional(),providerMetadata:Z.optional(),dynamic:Q().optional(),title:v().optional()}),Te({type:O("tool-input-error"),toolCallId:v(),toolName:v(),input:te(),providerExecuted:Q().optional(),providerMetadata:Z.optional(),dynamic:Q().optional(),errorText:v(),title:v().optional()}),Te({type:O("tool-approval-request"),approvalId:v(),toolCallId:v()}),Te({type:O("tool-output-available"),toolCallId:v(),output:te(),providerExecuted:Q().optional(),dynamic:Q().optional(),preliminary:Q().optional()}),Te({type:O("tool-output-error"),toolCallId:v(),errorText:v(),providerExecuted:Q().optional(),dynamic:Q().optional()}),Te({type:O("tool-output-denied"),toolCallId:v()}),Te({type:O("reasoning-start"),id:v(),providerMetadata:Z.optional()}),Te({type:O("reasoning-delta"),id:v(),delta:v(),providerMetadata:Z.optional()}),Te({type:O("reasoning-end"),id:v(),providerMetadata:Z.optional()}),Te({type:O("source-url"),sourceId:v(),url:v(),title:v().optional(),providerMetadata:Z.optional()}),Te({type:O("source-document"),sourceId:v(),mediaType:v(),title:v(),filename:v().optional(),providerMetadata:Z.optional()}),Te({type:O("file"),url:v(),mediaType:v(),providerMetadata:Z.optional()}),Te({type:pp(e=>typeof e=="string"&&e.startsWith("data-"),{message:'Type must start with "data-"'}),id:v().optional(),data:te(),transient:Q().optional()}),Te({type:O("start-step")}),Te({type:O("finish-step")}),Te({type:O("start"),messageId:v().optional(),messageMetadata:te().optional()}),Te({type:O("finish"),finishReason:Oe(["stop","length","content-filter","tool-calls","error","other"]).optional(),messageMetadata:te().optional()}),Te({type:O("abort"),reason:v().optional()}),Te({type:O("message-metadata"),messageMetadata:te()})])));function xE(e){return e.type.startsWith("data-")}function Xa(e){return e.type.startsWith("data-")}function Qa(e){return e.type==="text"}function eo(e){return e.type==="file"}function $s(e){return e.type==="reasoning"}function wo(e){return e.type.startsWith("tool-")}function Fh(e){return e.type==="dynamic-tool"}function jt(e){return wo(e)||Fh(e)}var RE=jt;function bo(e){return e.type.split("-").slice(1).join("-")}function Qn(e){return Fh(e)?e.toolName:bo(e)}var ME=Qn;function vi({lastMessage:e,messageId:t}){return{message:(e==null?void 0:e.role)==="assistant"?e:{id:t,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function yi({stream:e,messageMetadataSchema:t,dataPartSchemas:r,runUpdateMessageJob:n,onError:a,onToolCall:o,onData:s}){return e.pipeThrough(new TransformStream({async transform(i,l){await n(async({state:u,write:c})=>{var p,d,f,m;function h(y){const x=u.message.parts.filter(jt).find(R=>R.toolCallId===y);if(x==null)throw new Dr({chunkType:"tool-invocation",chunkId:y,message:`No tool invocation found for tool call ID "${y}".`});return x}function g(y){var T;const x=u.message.parts.find(A=>wo(A)&&A.toolCallId===y.toolCallId),R=y,I=x;x!=null?(x.state=y.state,I.input=R.input,I.output=R.output,I.errorText=R.errorText,I.rawInput=R.rawInput,I.preliminary=R.preliminary,y.title!==void 0&&(I.title=y.title),I.providerExecuted=(T=R.providerExecuted)!=null?T:x.providerExecuted,R.providerMetadata!=null&&(x.callProviderMetadata=R.providerMetadata)):u.message.parts.push({type:`tool-${y.toolName}`,toolCallId:y.toolCallId,state:y.state,title:y.title,input:R.input,output:R.output,rawInput:R.rawInput,errorText:R.errorText,providerExecuted:R.providerExecuted,preliminary:R.preliminary,...R.providerMetadata!=null?{callProviderMetadata:R.providerMetadata}:{}})}function w(y){var T,x;const R=u.message.parts.find($=>$.type==="dynamic-tool"&&$.toolCallId===y.toolCallId),I=y,A=R;R!=null?(R.state=y.state,A.toolName=y.toolName,A.input=I.input,A.output=I.output,A.errorText=I.errorText,A.rawInput=(T=I.rawInput)!=null?T:A.rawInput,A.preliminary=I.preliminary,y.title!==void 0&&(A.title=y.title),A.providerExecuted=(x=I.providerExecuted)!=null?x:R.providerExecuted,I.providerMetadata!=null&&(R.callProviderMetadata=I.providerMetadata)):u.message.parts.push({type:"dynamic-tool",toolName:y.toolName,toolCallId:y.toolCallId,state:y.state,input:I.input,output:I.output,errorText:I.errorText,preliminary:I.preliminary,providerExecuted:I.providerExecuted,title:y.title,...I.providerMetadata!=null?{callProviderMetadata:I.providerMetadata}:{}})}async function b(y){if(y!=null){const T=u.message.metadata!=null?Un(u.message.metadata,y):y;t!=null&&await dr({value:T,schema:t,context:{field:"message.metadata",entityId:u.message.id}}),u.message.metadata=T}}switch(i.type){case"text-start":{const y={type:"text",text:"",providerMetadata:i.providerMetadata,state:"streaming"};u.activeTextParts[i.id]=y,u.message.parts.push(y),c();break}case"text-delta":{const y=u.activeTextParts[i.id];if(y==null)throw new Dr({chunkType:"text-delta",chunkId:i.id,message:`Received text-delta for missing text part with ID "${i.id}". Ensure a "text-start" chunk is sent before any "text-delta" chunks.`});y.text+=i.delta,y.providerMetadata=(p=i.providerMetadata)!=null?p:y.providerMetadata,c();break}case"text-end":{const y=u.activeTextParts[i.id];if(y==null)throw new Dr({chunkType:"text-end",chunkId:i.id,message:`Received text-end for missing text part with ID "${i.id}". Ensure a "text-start" chunk is sent before any "text-end" chunks.`});y.state="done",y.providerMetadata=(d=i.providerMetadata)!=null?d:y.providerMetadata,delete u.activeTextParts[i.id],c();break}case"reasoning-start":{const y={type:"reasoning",text:"",providerMetadata:i.providerMetadata,state:"streaming"};u.activeReasoningParts[i.id]=y,u.message.parts.push(y),c();break}case"reasoning-delta":{const y=u.activeReasoningParts[i.id];if(y==null)throw new Dr({chunkType:"reasoning-delta",chunkId:i.id,message:`Received reasoning-delta for missing reasoning part with ID "${i.id}". Ensure a "reasoning-start" chunk is sent before any "reasoning-delta" chunks.`});y.text+=i.delta,y.providerMetadata=(f=i.providerMetadata)!=null?f:y.providerMetadata,c();break}case"reasoning-end":{const y=u.activeReasoningParts[i.id];if(y==null)throw new Dr({chunkType:"reasoning-end",chunkId:i.id,message:`Received reasoning-end for missing reasoning part with ID "${i.id}". Ensure a "reasoning-start" chunk is sent before any "reasoning-end" chunks.`});y.providerMetadata=(m=i.providerMetadata)!=null?m:y.providerMetadata,y.state="done",delete u.activeReasoningParts[i.id],c();break}case"file":{u.message.parts.push({type:"file",mediaType:i.mediaType,url:i.url}),c();break}case"source-url":{u.message.parts.push({type:"source-url",sourceId:i.sourceId,url:i.url,title:i.title,providerMetadata:i.providerMetadata}),c();break}case"source-document":{u.message.parts.push({type:"source-document",sourceId:i.sourceId,mediaType:i.mediaType,title:i.title,filename:i.filename,providerMetadata:i.providerMetadata}),c();break}case"tool-input-start":{const y=u.message.parts.filter(wo);u.partialToolCalls[i.toolCallId]={text:"",toolName:i.toolName,index:y.length,dynamic:i.dynamic,title:i.title},i.dynamic?w({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-streaming",input:void 0,providerExecuted:i.providerExecuted,title:i.title,providerMetadata:i.providerMetadata}):g({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-streaming",input:void 0,providerExecuted:i.providerExecuted,title:i.title,providerMetadata:i.providerMetadata}),c();break}case"tool-input-delta":{const y=u.partialToolCalls[i.toolCallId];if(y==null)throw new Dr({chunkType:"tool-input-delta",chunkId:i.toolCallId,message:`Received tool-input-delta for missing tool call with ID "${i.toolCallId}". Ensure a "tool-input-start" chunk is sent before any "tool-input-delta" chunks.`});y.text+=i.inputTextDelta;const{value:T}=await nn(y.text);y.dynamic?w({toolCallId:i.toolCallId,toolName:y.toolName,state:"input-streaming",input:T,title:y.title}):g({toolCallId:i.toolCallId,toolName:y.toolName,state:"input-streaming",input:T,title:y.title}),c();break}case"tool-input-available":{i.dynamic?w({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-available",input:i.input,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata,title:i.title}):g({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-available",input:i.input,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata,title:i.title}),c(),o&&!i.providerExecuted&&await o({toolCall:i});break}case"tool-input-error":{i.dynamic?w({toolCallId:i.toolCallId,toolName:i.toolName,state:"output-error",input:i.input,errorText:i.errorText,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}):g({toolCallId:i.toolCallId,toolName:i.toolName,state:"output-error",input:void 0,rawInput:i.input,errorText:i.errorText,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}),c();break}case"tool-approval-request":{const y=h(i.toolCallId);y.state="approval-requested",y.approval={id:i.approvalId},c();break}case"tool-output-denied":{const y=h(i.toolCallId);y.state="output-denied",c();break}case"tool-output-available":{const y=h(i.toolCallId);y.type==="dynamic-tool"?w({toolCallId:i.toolCallId,toolName:y.toolName,state:"output-available",input:y.input,output:i.output,preliminary:i.preliminary,providerExecuted:i.providerExecuted,title:y.title}):g({toolCallId:i.toolCallId,toolName:bo(y),state:"output-available",input:y.input,output:i.output,providerExecuted:i.providerExecuted,preliminary:i.preliminary,title:y.title}),c();break}case"tool-output-error":{const y=h(i.toolCallId);y.type==="dynamic-tool"?w({toolCallId:i.toolCallId,toolName:y.toolName,state:"output-error",input:y.input,errorText:i.errorText,providerExecuted:i.providerExecuted,title:y.title}):g({toolCallId:i.toolCallId,toolName:bo(y),state:"output-error",input:y.input,rawInput:y.rawInput,errorText:i.errorText,providerExecuted:i.providerExecuted,title:y.title}),c();break}case"start-step":{u.message.parts.push({type:"step-start"});break}case"finish-step":{u.activeTextParts={},u.activeReasoningParts={};break}case"start":{i.messageId!=null&&(u.message.id=i.messageId),await b(i.messageMetadata),(i.messageId!=null||i.messageMetadata!=null)&&c();break}case"finish":{i.finishReason!=null&&(u.finishReason=i.finishReason),await b(i.messageMetadata),i.messageMetadata!=null&&c();break}case"message-metadata":{await b(i.messageMetadata),i.messageMetadata!=null&&c();break}case"error":{a==null||a(new Error(i.errorText));break}default:if(xE(i)){if((r==null?void 0:r[i.type])!=null){const x=u.message.parts.findIndex(I=>"id"in I&&"data"in I&&I.id===i.id&&I.type===i.type),R=x>=0?x:u.message.parts.length;await dr({value:i.data,schema:r[i.type],context:{field:`message.parts[${R}].data`,entityName:i.type,entityId:i.id}})}const y=i;if(y.transient){s==null||s(y);break}const T=y.id!=null?u.message.parts.find(x=>y.type===x.type&&y.id===x.id):void 0;T!=null?T.data=y.data:u.message.parts.push(y),s==null||s(y),c()}}l.enqueue(i)})}}))}function Lh({messageId:e,originalMessages:t=[],onFinish:r,onError:n,stream:a}){let o=t==null?void 0:t[t.length-1];(o==null?void 0:o.role)!=="assistant"?o=void 0:e=o.id;let s=!1;const i=a.pipeThrough(new TransformStream({transform(d,f){if(d.type==="start"){const m=d;m.messageId==null&&e!=null&&(m.messageId=e)}d.type==="abort"&&(s=!0),f.enqueue(d)}}));if(r==null)return i;const l=vi({lastMessage:o?structuredClone(o):void 0,messageId:e??""}),u=async d=>{await d({state:l,write:()=>{}})};let c=!1;const p=async()=>{if(c||!r)return;c=!0;const d=l.message.id===(o==null?void 0:o.id);await r({isAborted:s,isContinuation:d,responseMessage:l.message,messages:[...d?t.slice(0,-1):t,l.message],finishReason:l.finishReason})};return yi({stream:i,runUpdateMessageJob:u,onError:n}).pipeThrough(new TransformStream({transform(d,f){f.enqueue(d)},async cancel(){await p()},async flush(){await p()}}))}function wi({response:e,status:t,statusText:r,headers:n,stream:a,consumeSseStream:o}){let s=a.pipeThrough(new fi);if(o){const[i,l]=s.tee();s=i,o({stream:l})}qh({response:e,status:t,statusText:r,headers:Object.fromEntries(Oa(n,hi).entries()),stream:s.pipeThrough(new TextEncoderStream)})}function Gt(e){const t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=function(){const r=this.getReader();let n=!1;async function a(o){var s;if(!n){n=!0;try{o&&await((s=r.cancel)==null?void 0:s.call(r))}finally{try{r.releaseLock()}catch{}}}}return{async next(){if(n)return{done:!0,value:void 0};const{done:o,value:s}=await r.read();return o?(await a(!0),{done:!0,value:void 0}):{done:!1,value:s}},async return(){return await a(!0),{done:!0,value:void 0}},async throw(o){throw await a(!0),o}}},t}async function ka({stream:e,onError:t}){const r=e.getReader();try{for(;;){const{done:n}=await r.read();if(n)break}}catch(n){t==null||t(n)}finally{r.releaseLock()}}function Fu(){let e,t;return{promise:new Promise((n,a)=>{e=n,t=a}),resolve:e,reject:t}}function Vh(){let e=[],t=null,r=!1,n=Fu();const a=()=>{r=!0,n.resolve(),e.forEach(s=>s.cancel()),e=[],t==null||t.close()},o=async()=>{if(r&&e.length===0){t==null||t.close();return}if(e.length===0)return n=Fu(),await n.promise,o();try{const{value:s,done:i}=await e[0].read();i?(e.shift(),e.length===0&&r?t==null||t.close():await o()):t==null||t.enqueue(s)}catch(s){t==null||t.error(s),e.shift(),a()}};return{stream:new ReadableStream({start(s){t=s},pull:o,async cancel(){for(const s of e)await s.cancel();e=[],r=!0}}),addStream:s=>{if(r)throw new Error("Cannot add inner stream: outer stream is closed");e.push(s.getReader()),n.resolve()},close:()=>{r=!0,n.resolve(),e.length===0&&(t==null||t.close())},terminate:a}}function Gh(){var e,t;return(t=(e=globalThis==null?void 0:globalThis.performance)==null?void 0:e.now())!=null?t:Date.now()}function OE({tools:e,generatorStream:t,tracer:r,telemetry:n,system:a,messages:o,abortSignal:s,repairToolCall:i,experimental_context:l,generateId:u}){let c=null;const p=new ReadableStream({start(y){c=y}}),d=new Set,f=new Map,m=new Map;let h=!1,g;function w(){h&&d.size===0&&(g!=null&&c.enqueue(g),c.close())}const b=new TransformStream({async transform(y,T){const x=y.type;switch(x){case"stream-start":case"text-start":case"text-delta":case"text-end":case"reasoning-start":case"reasoning-delta":case"reasoning-end":case"tool-input-start":case"tool-input-delta":case"tool-input-end":case"source":case"response-metadata":case"error":case"raw":{T.enqueue(y);break}case"file":{T.enqueue({type:"file",file:new mE({data:y.data,mediaType:y.mediaType})});break}case"finish":{g={type:"finish",finishReason:y.finishReason.unified,rawFinishReason:y.finishReason.raw,usage:ca(y.usage),providerMetadata:y.providerMetadata};break}case"tool-approval-request":{const R=m.get(y.toolCallId);if(R==null){c.enqueue({type:"error",error:new No({toolCallId:y.toolCallId,approvalId:y.approvalId})});break}T.enqueue({type:"tool-approval-request",approvalId:y.approvalId,toolCall:R});break}case"tool-call":{try{const R=await $h({toolCall:y,tools:e,repairToolCall:i,system:a,messages:o});if(m.set(R.toolCallId,R),T.enqueue(R),R.invalid){c.enqueue({type:"tool-error",toolCallId:R.toolCallId,toolName:R.toolName,input:R.input,error:Mo(R.error),dynamic:!0,title:R.title});break}const I=e==null?void 0:e[R.toolName];if(I==null)break;if(I.onInputAvailable!=null&&await I.onInputAvailable({input:R.input,toolCallId:R.toolCallId,messages:o,abortSignal:s,experimental_context:l}),await Nh({tool:I,toolCall:R,messages:o,experimental_context:l})){c.enqueue({type:"tool-approval-request",approvalId:u(),toolCall:R});break}if(f.set(R.toolCallId,R.input),I.execute!=null&&R.providerExecuted!==!0){const A=u();d.add(A),ci({toolCall:R,tools:e,tracer:r,telemetry:n,messages:o,abortSignal:s,experimental_context:l,onPreliminaryToolResult:$=>{c.enqueue($)}}).then($=>{c.enqueue($)}).catch($=>{c.enqueue({type:"error",error:$})}).finally(()=>{d.delete(A),w()})}}catch(R){c.enqueue({type:"error",error:R})}break}case"tool-result":{const R=y.toolName;y.isError?c.enqueue({type:"tool-error",toolCallId:y.toolCallId,toolName:R,input:f.get(y.toolCallId),providerExecuted:!0,error:y.result,dynamic:y.dynamic}):T.enqueue({type:"tool-result",toolCallId:y.toolCallId,toolName:R,input:f.get(y.toolCallId),output:y.result,providerExecuted:!0,dynamic:y.dynamic});break}default:{const R=x;throw new Error(`Unhandled chunk type: ${R}`)}}},flush(){h=!0,w()}});return new ReadableStream({async start(y){return Promise.all([t.pipeThrough(b).pipeTo(new WritableStream({write(T){y.enqueue(T)},close(){}})),p.pipeTo(new WritableStream({write(T){y.enqueue(T)},close(){y.close()}}))])}})}var kE=jn({prefix:"aitxt",size:24});function Bh({model:e,tools:t,toolChoice:r,system:n,prompt:a,messages:o,maxRetries:s,abortSignal:i,timeout:l,headers:u,stopWhen:c=zo(1),experimental_output:p,output:d=p,experimental_telemetry:f,prepareStep:m,providerOptions:h,experimental_activeTools:g,activeTools:w=g,experimental_repairToolCall:b,experimental_transform:y,experimental_download:T,includeRawChunks:x=!1,onChunk:R,onError:I=({error:ne})=>{console.error(ne)},onFinish:A,onAbort:$,onStepFinish:N,experimental_context:M,experimental_include:P,_internal:{now:V=Gh,generateId:G=kE}={},...pe}){const ne=ii(l),D=mh(l),ae=WS(l),Ue=D!=null?new AbortController:void 0,Ze=ae!=null?new AbortController:void 0;return new AE({model:Nn(e),telemetry:f,headers:u,settings:pe,maxRetries:s,abortSignal:Uh(i,ne!=null?AbortSignal.timeout(ne):void 0,Ue==null?void 0:Ue.signal,Ze==null?void 0:Ze.signal),stepTimeoutMs:D,stepAbortController:Ue,chunkTimeoutMs:ae,chunkAbortController:Ze,system:n,prompt:a,messages:o,tools:t,toolChoice:r,transforms:Er(y),activeTools:w,repairToolCall:b,stopConditions:Er(c),output:d,providerOptions:h,prepareStep:m,includeRawChunks:x,onChunk:R,onError:I,onFinish:A,onAbort:$,onStepFinish:N,now:V,generateId:G,experimental_context:M,download:T,include:P})}function CE(e){let t,r="",n="",a,o="";function s({controller:i,partialOutput:l=void 0}){i.enqueue({part:{type:"text-delta",id:t,text:n,providerMetadata:a},partialOutput:l}),n=""}return new TransformStream({async transform(i,l){var u;if(i.type==="finish-step"&&n.length>0&&s({controller:l}),i.type!=="text-delta"&&i.type!=="text-start"&&i.type!=="text-end"){l.enqueue({part:i,partialOutput:void 0});return}if(t==null)t=i.id;else if(i.id!==t){l.enqueue({part:i,partialOutput:void 0});return}if(i.type==="text-start"){l.enqueue({part:i,partialOutput:void 0});return}if(i.type==="text-end"){n.length>0&&s({controller:l}),l.enqueue({part:i,partialOutput:void 0});return}r+=i.text,n+=i.text,a=(u=i.providerMetadata)!=null?u:a;const c=await e.parsePartialOutput({text:r});if(c!==void 0){const p=JSON.stringify(c.partial);p!==o&&(s({controller:l,partialOutput:c.partial}),o=p)}}})}var AE=class{constructor({model:e,telemetry:t,headers:r,settings:n,maxRetries:a,abortSignal:o,stepTimeoutMs:s,stepAbortController:i,chunkTimeoutMs:l,chunkAbortController:u,system:c,prompt:p,messages:d,tools:f,toolChoice:m,transforms:h,activeTools:g,repairToolCall:w,stopConditions:b,output:y,providerOptions:T,prepareStep:x,includeRawChunks:R,now:I,generateId:A,onChunk:$,onError:N,onFinish:M,onAbort:P,onStepFinish:V,experimental_context:G,download:pe,include:ne}){this._totalUsage=new St,this._finishReason=new St,this._rawFinishReason=new St,this._steps=new St,this.outputSpecification=y,this.includeRawChunks=R,this.tools=f;let D,ae=[];const Ue=[];let Ze,Ot,nt,Ye={},Fe=[];const ce=[],at=new Map;let kt,Ke={},qe={};const Ne=new TransformStream({async transform(we,se){var Re,z,$e,ht;se.enqueue(we);const{part:k}=we;if((k.type==="text-delta"||k.type==="reasoning-delta"||k.type==="source"||k.type==="tool-call"||k.type==="tool-result"||k.type==="tool-input-start"||k.type==="tool-input-delta"||k.type==="raw")&&await($==null?void 0:$({chunk:k})),k.type==="error"&&await N({error:Do(k.error)}),k.type==="text-start"&&(Ke[k.id]={type:"text",text:"",providerMetadata:k.providerMetadata},ae.push(Ke[k.id])),k.type==="text-delta"){const fe=Ke[k.id];if(fe==null){se.enqueue({part:{type:"error",error:`text part ${k.id} not found`},partialOutput:void 0});return}fe.text+=k.text,fe.providerMetadata=(Re=k.providerMetadata)!=null?Re:fe.providerMetadata}if(k.type==="text-end"){const fe=Ke[k.id];if(fe==null){se.enqueue({part:{type:"error",error:`text part ${k.id} not found`},partialOutput:void 0});return}fe.providerMetadata=(z=k.providerMetadata)!=null?z:fe.providerMetadata,delete Ke[k.id]}if(k.type==="reasoning-start"&&(qe[k.id]={type:"reasoning",text:"",providerMetadata:k.providerMetadata},ae.push(qe[k.id])),k.type==="reasoning-delta"){const fe=qe[k.id];if(fe==null){se.enqueue({part:{type:"error",error:`reasoning part ${k.id} not found`},partialOutput:void 0});return}fe.text+=k.text,fe.providerMetadata=($e=k.providerMetadata)!=null?$e:fe.providerMetadata}if(k.type==="reasoning-end"){const fe=qe[k.id];if(fe==null){se.enqueue({part:{type:"error",error:`reasoning part ${k.id} not found`},partialOutput:void 0});return}fe.providerMetadata=(ht=k.providerMetadata)!=null?ht:fe.providerMetadata,delete qe[k.id]}if(k.type==="file"&&ae.push({type:"file",file:k.file}),k.type==="source"&&ae.push(k),k.type==="tool-call"&&ae.push(k),k.type==="tool-result"&&!k.preliminary&&ae.push(k),k.type==="tool-approval-request"&&ae.push(k),k.type==="tool-error"&&ae.push(k),k.type==="start-step"&&(ae=[],qe={},Ke={},Ye=k.request,Fe=k.warnings),k.type==="finish-step"){const fe=await Ps({content:ae,tools:f}),ie=new jh({content:ae,finishReason:k.finishReason,rawFinishReason:k.rawFinishReason,usage:k.usage,warnings:Fe,request:Ye,response:{...k.response,messages:[...Ue,...fe]},providerMetadata:k.providerMetadata});await(V==null?void 0:V(ie)),yt({warnings:Fe,provider:e.provider,model:e.modelId}),ce.push(ie),Ue.push(...fe),D.resolve()}k.type==="finish"&&(nt=k.totalUsage,Ze=k.finishReason,Ot=k.rawFinishReason)},async flush(we){try{if(ce.length===0){const $e=o!=null&&o.aborted?o.reason:new si({message:"No output generated. Check the stream for errors."});Ee._finishReason.reject($e),Ee._rawFinishReason.reject($e),Ee._totalUsage.reject($e),Ee._steps.reject($e);return}const se=Ze??"other",Re=nt??Ka();Ee._finishReason.resolve(se),Ee._rawFinishReason.resolve(Ot),Ee._totalUsage.resolve(Re),Ee._steps.resolve(ce);const z=ce[ce.length-1];await(M==null?void 0:M({finishReason:z.finishReason,rawFinishReason:z.rawFinishReason,totalUsage:Re,usage:z.usage,content:z.content,text:z.text,reasoningText:z.reasoningText,reasoning:z.reasoning,files:z.files,sources:z.sources,toolCalls:z.toolCalls,staticToolCalls:z.staticToolCalls,dynamicToolCalls:z.dynamicToolCalls,toolResults:z.toolResults,staticToolResults:z.staticToolResults,dynamicToolResults:z.dynamicToolResults,request:z.request,response:z.response,warnings:z.warnings,providerMetadata:z.providerMetadata,steps:ce,experimental_context:G})),kt.setAttributes(await le({telemetry:t,attributes:{"ai.response.finishReason":se,"ai.response.text":{output:()=>z.text},"ai.response.toolCalls":{output:()=>{var $e;return($e=z.toolCalls)!=null&&$e.length?JSON.stringify(z.toolCalls):void 0}},"ai.response.providerMetadata":JSON.stringify(z.providerMetadata),"ai.usage.inputTokens":Re.inputTokens,"ai.usage.outputTokens":Re.outputTokens,"ai.usage.totalTokens":Re.totalTokens,"ai.usage.reasoningTokens":Re.reasoningTokens,"ai.usage.cachedInputTokens":Re.cachedInputTokens}}))}catch(se){we.error(se)}finally{kt.end()}}}),ut=Vh();this.addStream=ut.addStream,this.closeStream=ut.close;const wt=ut.stream.getReader();let bt=new ReadableStream({async start(we){we.enqueue({type:"start"})},async pull(we){function se(){P==null||P({steps:ce}),we.enqueue({type:"abort",...(o==null?void 0:o.reason)!==void 0?{reason:Gr(o.reason)}:{}}),we.close()}try{const{done:Re,value:z}=await wt.read();if(Re){we.close();return}if(o!=null&&o.aborted){se();return}we.enqueue(z)}catch(Re){Jr(Re)&&(o!=null&&o.aborted)?se():we.error(Re)}},cancel(we){return ut.stream.cancel(we)}});for(const we of h)bt=bt.pipeThrough(we({tools:f,stopStream(){ut.terminate()}}));this.baseStream=bt.pipeThrough(CE(y??yo())).pipeThrough(Ne);const{maxRetries:qt,retry:Yt}=Zt({maxRetries:a,abortSignal:o}),F=rn(t),J=Kr(n),_t=tn({model:e,telemetry:t,headers:r,settings:{...J,maxRetries:qt}}),Ee=this;tt({name:"ai.streamText",attributes:le({telemetry:t,attributes:{...et({operationId:"ai.streamText",telemetry:t}),..._t,"ai.prompt":{input:()=>JSON.stringify({system:c,prompt:p,messages:d})}}}),tracer:F,endWhenDone:!1,fn:async we=>{kt=we;const se=await $o({system:c,prompt:p,messages:d}),Re=se.messages,z=[],{approvedToolApprovals:$e,deniedToolApprovals:ht}=Ah({messages:Re});if(ht.length>0||$e.length>0){const fe=[...$e,...ht].filter(B=>B.toolCall.providerExecuted),ie=$e.filter(B=>!B.toolCall.providerExecuted),ir=ht.filter(B=>!B.toolCall.providerExecuted),Mr=ht.filter(B=>B.toolCall.providerExecuted);let ue;const Le=new ReadableStream({start(B){ue=B}});Ee.addStream(Le);try{for(const ge of[...ir,...Mr])ue==null||ue.enqueue({type:"tool-output-denied",toolCallId:ge.toolCall.toolCallId,toolName:ge.toolCall.toolName});const B=[];if(await Promise.all(ie.map(async ge=>{const Me=await ci({toolCall:ge.toolCall,tools:f,tracer:F,telemetry:t,messages:Re,abortSignal:o,experimental_context:G,onPreliminaryToolResult:lr=>{ue==null||ue.enqueue(lr)}});Me!=null&&(ue==null||ue.enqueue(Me),B.push(Me))})),fe.length>0&&z.push({role:"tool",content:fe.map(ge=>({type:"tool-approval-response",approvalId:ge.approvalResponse.approvalId,approved:ge.approvalResponse.approved,reason:ge.approvalResponse.reason,providerExecuted:!0}))}),B.length>0||ir.length>0){const ge=[];for(const Me of B)ge.push({type:"tool-result",toolCallId:Me.toolCallId,toolName:Me.toolName,output:await Lr({toolCallId:Me.toolCallId,input:Me.input,tool:f==null?void 0:f[Me.toolName],output:Me.type==="tool-result"?Me.output:Me.error,errorMode:Me.type==="tool-error"?"json":"none"})});for(const Me of ir)ge.push({type:"tool-result",toolCallId:Me.toolCall.toolCallId,toolName:Me.toolCall.toolName,output:{type:"execution-denied",reason:Me.approvalResponse.reason}});z.push({role:"tool",content:ge})}}finally{ue==null||ue.close()}}Ue.push(...z);async function k({currentStep:fe,responseMessages:ie,usage:ir}){var Mr,ue,Le,B,ge,Me,lr;const an=Ee.includeRawChunks,ur=s!=null?setTimeout(()=>i.abort(),s):void 0;let Ft;function Uo(){l!=null&&(Ft!=null&&clearTimeout(Ft),Ft=setTimeout(()=>u.abort(),l))}function Zn(){Ft!=null&&(clearTimeout(Ft),Ft=void 0)}function Ca(){ur!=null&&clearTimeout(ur)}try{D=new St;const Or=[...Re,...ie],Ve=await(x==null?void 0:x({model:e,steps:ce,stepNumber:ce.length,messages:Or,experimental_context:G})),Y=Nn((Mr=Ve==null?void 0:Ve.model)!=null?Mr:e),Xe=await Po({prompt:{system:(ue=Ve==null?void 0:Ve.system)!=null?ue:se.system,messages:(Le=Ve==null?void 0:Ve.messages)!=null?Le:Or},supportedUrls:await Y.supportedUrls,download:pe}),{toolChoice:kr,tools:Kt}=await bh({tools:f,toolChoice:(B=Ve==null?void 0:Ve.toolChoice)!=null?B:m,activeTools:(ge=Ve==null?void 0:Ve.activeTools)!=null?ge:g});G=(Me=Ve==null?void 0:Ve.experimental_context)!=null?Me:G;const Aa=Un(T,Ve==null?void 0:Ve.providerOptions),{result:{stream:Na,response:qn,request:on},doStreamSpan:Xt,startTimestampMs:Fn}=await Yt(()=>tt({name:"ai.streamText.doStream",attributes:le({telemetry:t,attributes:{...et({operationId:"ai.streamText.doStream",telemetry:t}),..._t,"ai.model.provider":Y.provider,"ai.model.id":Y.modelId,"ai.prompt.messages":{input:()=>jo(Xe)},"ai.prompt.tools":{input:()=>Kt==null?void 0:Kt.map(L=>JSON.stringify(L))},"ai.prompt.toolChoice":{input:()=>kr!=null?JSON.stringify(kr):void 0},"gen_ai.system":Y.provider,"gen_ai.request.model":Y.modelId,"gen_ai.request.frequency_penalty":J.frequencyPenalty,"gen_ai.request.max_tokens":J.maxOutputTokens,"gen_ai.request.presence_penalty":J.presencePenalty,"gen_ai.request.stop_sequences":J.stopSequences,"gen_ai.request.temperature":J.temperature,"gen_ai.request.top_k":J.topK,"gen_ai.request.top_p":J.topP}}),tracer:F,endWhenDone:!1,fn:async L=>({startTimestampMs:I(),doStreamSpan:L,result:await Y.doStream({...J,tools:Kt,toolChoice:kr,responseFormat:await(y==null?void 0:y.responseFormat),prompt:Xe,providerOptions:Aa,abortSignal:o,headers:r,includeRawChunks:an})})})),Zo=OE({tools:f,generatorStream:Na,tracer:F,telemetry:t,system:c,messages:Or,repairToolCall:w,abortSignal:o,experimental_context:G,generateId:A}),Ge=(lr=ne==null?void 0:ne.requestBody)==null||lr?on??{}:{...on,body:void 0},It=[],cr=[];let qo;const Fo={};let sn="other",Lo,Ct=Ka(),Vo,xi=!0,Lt={id:A(),timestamp:new Date,modelId:e.modelId},Ri="";Ee.addStream(Zo.pipeThrough(new TransformStream({async transform(L,Be){var Ln,Vn,Pa,De,ln;if(Uo(),L.type==="stream-start"){qo=L.warnings;return}if(xi){const Pe=I()-Fn;xi=!1,Xt.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":Pe}),Xt.setAttributes({"ai.response.msToFirstChunk":Pe}),Be.enqueue({type:"start-step",request:Ge,warnings:qo??[]})}const Go=L.type;switch(Go){case"tool-approval-request":case"text-start":case"text-end":{Be.enqueue(L);break}case"text-delta":{L.delta.length>0&&(Be.enqueue({type:"text-delta",id:L.id,text:L.delta,providerMetadata:L.providerMetadata}),Ri+=L.delta);break}case"reasoning-start":case"reasoning-end":{Be.enqueue(L);break}case"reasoning-delta":{Be.enqueue({type:"reasoning-delta",id:L.id,text:L.delta,providerMetadata:L.providerMetadata});break}case"tool-call":{Be.enqueue(L),It.push(L);break}case"tool-result":{Be.enqueue(L),L.preliminary||cr.push(L);break}case"tool-error":{Be.enqueue(L),cr.push(L);break}case"response-metadata":{Lt={id:(Ln=L.id)!=null?Ln:Lt.id,timestamp:(Vn=L.timestamp)!=null?Vn:Lt.timestamp,modelId:(Pa=L.modelId)!=null?Pa:Lt.modelId};break}case"finish":{Ct=L.usage,sn=L.finishReason,Lo=L.rawFinishReason,Vo=L.providerMetadata;const Pe=I()-Fn;Xt.addEvent("ai.stream.finish"),Xt.setAttributes({"ai.response.msToFinish":Pe,"ai.response.avgOutputTokensPerSecond":1e3*((De=Ct.outputTokens)!=null?De:0)/Pe});break}case"file":{Be.enqueue(L);break}case"source":{Be.enqueue(L);break}case"tool-input-start":{Fo[L.id]=L.toolName;const Pe=f==null?void 0:f[L.toolName];(Pe==null?void 0:Pe.onInputStart)!=null&&await Pe.onInputStart({toolCallId:L.id,messages:Or,abortSignal:o,experimental_context:G}),Be.enqueue({...L,dynamic:(ln=L.dynamic)!=null?ln:(Pe==null?void 0:Pe.type)==="dynamic",title:Pe==null?void 0:Pe.title});break}case"tool-input-end":{delete Fo[L.id],Be.enqueue(L);break}case"tool-input-delta":{const Pe=Fo[L.id],Bo=f==null?void 0:f[Pe];(Bo==null?void 0:Bo.onInputDelta)!=null&&await Bo.onInputDelta({inputTextDelta:L.delta,toolCallId:L.id,messages:Or,abortSignal:o,experimental_context:G}),Be.enqueue(L);break}case"error":{Be.enqueue(L),sn="error";break}case"raw":{an&&Be.enqueue(L);break}default:{const Pe=Go;throw new Error(`Unknown chunk type: ${Pe}`)}}},async flush(L){const Be=It.length>0?JSON.stringify(It):void 0;try{Xt.setAttributes(await le({telemetry:t,attributes:{"ai.response.finishReason":sn,"ai.response.text":{output:()=>Ri},"ai.response.toolCalls":{output:()=>Be},"ai.response.id":Lt.id,"ai.response.model":Lt.modelId,"ai.response.timestamp":Lt.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(Vo),"ai.usage.inputTokens":Ct.inputTokens,"ai.usage.outputTokens":Ct.outputTokens,"ai.usage.totalTokens":Ct.totalTokens,"ai.usage.reasoningTokens":Ct.reasoningTokens,"ai.usage.cachedInputTokens":Ct.cachedInputTokens,"gen_ai.response.finish_reasons":[sn],"gen_ai.response.id":Lt.id,"gen_ai.response.model":Lt.modelId,"gen_ai.usage.input_tokens":Ct.inputTokens,"gen_ai.usage.output_tokens":Ct.outputTokens}}))}catch{}finally{Xt.end()}L.enqueue({type:"finish-step",finishReason:sn,rawFinishReason:Lo,usage:Ct,providerMetadata:Vo,response:{...Lt,headers:qn==null?void 0:qn.headers}});const Ln=kh(ir,Ct);await D.promise;const Vn=It.filter(De=>De.providerExecuted!==!0),Pa=cr.filter(De=>De.providerExecuted!==!0);for(const De of It){if(De.providerExecuted!==!0)continue;const ln=f==null?void 0:f[De.toolName];(ln==null?void 0:ln.type)==="provider"&&ln.supportsDeferredResults&&(cr.some(Pe=>(Pe.type==="tool-result"||Pe.type==="tool-error")&&Pe.toolCallId===De.toolCallId)||at.set(De.toolCallId,{toolName:De.toolName}))}for(const De of cr)(De.type==="tool-result"||De.type==="tool-error")&&at.delete(De.toolCallId);if(Ca(),Zn(),(Vn.length>0&&Pa.length===Vn.length||at.size>0)&&!await zh({stopConditions:b,steps:ce})){ie.push(...await Ps({content:ce[ce.length-1].content,tools:f}));try{await k({currentStep:fe+1,responseMessages:ie,usage:Ln})}catch(De){L.enqueue({type:"error",error:De}),Ee.closeStream()}}else L.enqueue({type:"finish",finishReason:sn,rawFinishReason:Lo,totalUsage:Ln}),Ee.closeStream()}})))}finally{Ca(),Zn()}}await k({currentStep:0,responseMessages:z,usage:Ka()})}}).catch(we=>{Ee.addStream(new ReadableStream({start(se){se.enqueue({type:"error",error:we}),se.close()}})),Ee.closeStream()})}get steps(){return this.consumeStream(),this._steps.promise}get finalStep(){return this.steps.then(e=>e[e.length-1])}get content(){return this.finalStep.then(e=>e.content)}get warnings(){return this.finalStep.then(e=>e.warnings)}get providerMetadata(){return this.finalStep.then(e=>e.providerMetadata)}get text(){return this.finalStep.then(e=>e.text)}get reasoningText(){return this.finalStep.then(e=>e.reasoningText)}get reasoning(){return this.finalStep.then(e=>e.reasoning)}get sources(){return this.finalStep.then(e=>e.sources)}get files(){return this.finalStep.then(e=>e.files)}get toolCalls(){return this.finalStep.then(e=>e.toolCalls)}get staticToolCalls(){return this.finalStep.then(e=>e.staticToolCalls)}get dynamicToolCalls(){return this.finalStep.then(e=>e.dynamicToolCalls)}get toolResults(){return this.finalStep.then(e=>e.toolResults)}get staticToolResults(){return this.finalStep.then(e=>e.staticToolResults)}get dynamicToolResults(){return this.finalStep.then(e=>e.dynamicToolResults)}get usage(){return this.finalStep.then(e=>e.usage)}get request(){return this.finalStep.then(e=>e.request)}get response(){return this.finalStep.then(e=>e.response)}get totalUsage(){return this.consumeStream(),this._totalUsage.promise}get finishReason(){return this.consumeStream(),this._finishReason.promise}get rawFinishReason(){return this.consumeStream(),this._rawFinishReason.promise}teeStream(){const[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return Gt(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){e.type==="text-delta"&&t.enqueue(e.text)}})))}get fullStream(){return Gt(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(e){var t;try{await ka({stream:this.fullStream,onError:e==null?void 0:e.onError})}catch(r){(t=e==null?void 0:e.onError)==null||t.call(e,r)}}get experimental_partialOutputStream(){return this.partialOutputStream}get partialOutputStream(){return Gt(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){e!=null&&t.enqueue(e)}})))}get elementStream(){var e,t,r;const n=(e=this.outputSpecification)==null?void 0:e.createElementStreamTransform();if(n==null)throw new _r({functionality:`element streams in ${(r=(t=this.outputSpecification)==null?void 0:t.name)!=null?r:"text"} mode`});return Gt(this.teeStream().pipeThrough(n))}get output(){return this.finalStep.then(e=>{var t;return((t=this.outputSpecification)!=null?t:yo()).parseCompleteOutput({text:e.text},{response:e.response,usage:e.usage,finishReason:e.finishReason})})}toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:r,messageMetadata:n,sendReasoning:a=!0,sendSources:o=!1,sendStart:s=!0,sendFinish:i=!0,onError:l=Gr}={}){const u=t!=null?EE({originalMessages:e,responseMessageId:t}):void 0,c=d=>{var f;const m=(f=this.tools)==null?void 0:f[d.toolName];return m==null?d.dynamic:(m==null?void 0:m.type)==="dynamic"?!0:void 0},p=this.fullStream.pipeThrough(new TransformStream({transform:async(d,f)=>{const m=n==null?void 0:n({part:d}),h=d.type;switch(h){case"text-start":{f.enqueue({type:"text-start",id:d.id,...d.providerMetadata!=null?{providerMetadata:d.providerMetadata}:{}});break}case"text-delta":{f.enqueue({type:"text-delta",id:d.id,delta:d.text,...d.providerMetadata!=null?{providerMetadata:d.providerMetadata}:{}});break}case"text-end":{f.enqueue({type:"text-end",id:d.id,...d.providerMetadata!=null?{providerMetadata:d.providerMetadata}:{}});break}case"reasoning-start":{f.enqueue({type:"reasoning-start",id:d.id,...d.providerMetadata!=null?{providerMetadata:d.providerMetadata}:{}});break}case"reasoning-delta":{a&&f.enqueue({type:"reasoning-delta",id:d.id,delta:d.text,...d.providerMetadata!=null?{providerMetadata:d.providerMetadata}:{}});break}case"reasoning-end":{f.enqueue({type:"reasoning-end",id:d.id,...d.providerMetadata!=null?{providerMetadata:d.providerMetadata}:{}});break}case"file":{f.enqueue({type:"file",mediaType:d.file.mediaType,url:`data:${d.file.mediaType};base64,${d.file.base64}`});break}case"source":{o&&d.sourceType==="url"&&f.enqueue({type:"source-url",sourceId:d.id,url:d.url,title:d.title,...d.providerMetadata!=null?{providerMetadata:d.providerMetadata}:{}}),o&&d.sourceType==="document"&&f.enqueue({type:"source-document",sourceId:d.id,mediaType:d.mediaType,title:d.title,filename:d.filename,...d.providerMetadata!=null?{providerMetadata:d.providerMetadata}:{}});break}case"tool-input-start":{const g=c(d);f.enqueue({type:"tool-input-start",toolCallId:d.id,toolName:d.toolName,...d.providerExecuted!=null?{providerExecuted:d.providerExecuted}:{},...d.providerMetadata!=null?{providerMetadata:d.providerMetadata}:{},...g!=null?{dynamic:g}:{},...d.title!=null?{title:d.title}:{}});break}case"tool-input-delta":{f.enqueue({type:"tool-input-delta",toolCallId:d.id,inputTextDelta:d.delta});break}case"tool-call":{const g=c(d);d.invalid?f.enqueue({type:"tool-input-error",toolCallId:d.toolCallId,toolName:d.toolName,input:d.input,...d.providerExecuted!=null?{providerExecuted:d.providerExecuted}:{},...d.providerMetadata!=null?{providerMetadata:d.providerMetadata}:{},...g!=null?{dynamic:g}:{},errorText:l(d.error),...d.title!=null?{title:d.title}:{}}):f.enqueue({type:"tool-input-available",toolCallId:d.toolCallId,toolName:d.toolName,input:d.input,...d.providerExecuted!=null?{providerExecuted:d.providerExecuted}:{},...d.providerMetadata!=null?{providerMetadata:d.providerMetadata}:{},...g!=null?{dynamic:g}:{},...d.title!=null?{title:d.title}:{}});break}case"tool-approval-request":{f.enqueue({type:"tool-approval-request",approvalId:d.approvalId,toolCallId:d.toolCall.toolCallId});break}case"tool-result":{const g=c(d);f.enqueue({type:"tool-output-available",toolCallId:d.toolCallId,output:d.output,...d.providerExecuted!=null?{providerExecuted:d.providerExecuted}:{},...d.preliminary!=null?{preliminary:d.preliminary}:{},...g!=null?{dynamic:g}:{}});break}case"tool-error":{const g=c(d);f.enqueue({type:"tool-output-error",toolCallId:d.toolCallId,errorText:l(d.error),...d.providerExecuted!=null?{providerExecuted:d.providerExecuted}:{},...g!=null?{dynamic:g}:{}});break}case"tool-output-denied":{f.enqueue({type:"tool-output-denied",toolCallId:d.toolCallId});break}case"error":{f.enqueue({type:"error",errorText:l(d.error)});break}case"start-step":{f.enqueue({type:"start-step"});break}case"finish-step":{f.enqueue({type:"finish-step"});break}case"start":{s&&f.enqueue({type:"start",...m!=null?{messageMetadata:m}:{},...u!=null?{messageId:u}:{}});break}case"finish":{i&&f.enqueue({type:"finish",finishReason:d.finishReason,...m!=null?{messageMetadata:m}:{}});break}case"abort":{f.enqueue(d);break}case"tool-input-end":break;case"raw":break;default:{const g=h;throw new Error(`Unknown chunk type: ${g}`)}}m!=null&&h!=="start"&&h!=="finish"&&f.enqueue({type:"message-metadata",messageMetadata:m})}}));return Gt(Lh({stream:p,messageId:u??(t==null?void 0:t()),originalMessages:e,onFinish:r,onError:l}))}pipeUIMessageStreamToResponse(e,{originalMessages:t,generateMessageId:r,onFinish:n,messageMetadata:a,sendReasoning:o,sendSources:s,sendFinish:i,sendStart:l,onError:u,...c}={}){wi({response:e,stream:this.toUIMessageStream({originalMessages:t,generateMessageId:r,onFinish:n,messageMetadata:a,sendReasoning:o,sendSources:s,sendFinish:i,sendStart:l,onError:u}),...c})}pipeTextStreamToResponse(e,t){pi({response:e,textStream:this.textStream,...t})}toUIMessageStreamResponse({originalMessages:e,generateMessageId:t,onFinish:r,messageMetadata:n,sendReasoning:a,sendSources:o,sendFinish:s,sendStart:i,onError:l,...u}={}){return mi({stream:this.toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:r,messageMetadata:n,sendReasoning:a,sendSources:o,sendFinish:s,sendStart:i,onError:l}),...u})}toTextStreamResponse(e){return di({textStream:this.textStream,...e})}},Lu=class{constructor(e){this.version="agent-v1",this.settings=e}get id(){return this.settings.id}get tools(){return this.settings.tools}async prepareCall(e){var t,r,n,a;const{onStepFinish:o,...s}=this.settings,i={...s,stopWhen:(t=this.settings.stopWhen)!=null?t:zo(20),...e},l=(a=await((n=(r=this.settings).prepareCall)==null?void 0:n.call(r,i)))!=null?a:i,{instructions:u,messages:c,prompt:p,...d}=l;return{...d,system:u,messages:c,prompt:p}}mergeOnStepFinishCallbacks(e){const t=this.settings.onStepFinish;return e&&t?async r=>{await t(r),await e(r)}:e??t}async generate({abortSignal:e,timeout:t,onStepFinish:r,...n}){return Zh({...await this.prepareCall(n),abortSignal:e,timeout:t,onStepFinish:this.mergeOnStepFinishCallbacks(r)})}async stream({abortSignal:e,timeout:t,experimental_transform:r,onStepFinish:n,...a}){return Bh({...await this.prepareCall(a),abortSignal:e,timeout:t,experimental_transform:r,onStepFinish:this.mergeOnStepFinishCallbacks(n)})}};function NE({execute:e,onError:t=Mo,originalMessages:r,onFinish:n,generateId:a=kn}){let o;const s=[],i=new ReadableStream({start(c){o=c}});function l(c){try{o.enqueue(c)}catch{}}try{const c=e({writer:{write(p){l(p)},merge(p){s.push((async()=>{const d=p.getReader();for(;;){const{done:f,value:m}=await d.read();if(f)break;l(m)}})().catch(d=>{l({type:"error",errorText:t(d)})}))},onError:t}});c&&s.push(c.catch(p=>{l({type:"error",errorText:t(p)})}))}catch(c){l({type:"error",errorText:t(c)})}return new Promise(async c=>{for(;s.length>0;)await s.shift();c()}).finally(()=>{try{o.close()}catch{}}),Lh({stream:i,messageId:a(),originalMessages:r,onFinish:n,onError:t})}function PE({message:e,stream:t,onError:r,terminateOnError:n=!1}){var a;let o,s=!1;const i=new ReadableStream({start(c){o=c}}),l=vi({messageId:(a=e==null?void 0:e.id)!=null?a:"",lastMessage:e}),u=c=>{r==null||r(c),!s&&n&&(s=!0,o==null||o.error(c))};return ka({stream:yi({stream:t,runUpdateMessageJob(c){return c({state:l,write:()=>{o==null||o.enqueue(structuredClone(l.message))}})},onError:u}),onError:u}).finally(()=>{s||o==null||o.close()}),Gt(i)}async function bi(e,t){const r=[];t!=null&&t.ignoreIncompleteToolCalls&&(e=e.map(n=>({...n,parts:n.parts.filter(a=>!jt(a)||a.state!=="input-streaming"&&a.state!=="input-available")})));for(const n of e)switch(n.role){case"system":{const a=n.parts.filter(s=>s.type==="text"),o=a.reduce((s,i)=>i.providerMetadata!=null?{...s,...i.providerMetadata}:s,{});r.push({role:"system",content:a.map(s=>s.text).join(""),...Object.keys(o).length>0?{providerOptions:o}:{}});break}case"user":{r.push({role:"user",content:n.parts.map(a=>{var o;if(Qa(a))return{type:"text",text:a.text,...a.providerMetadata!=null?{providerOptions:a.providerMetadata}:{}};if(eo(a))return{type:"file",mediaType:a.mediaType,filename:a.filename,data:a.url,...a.providerMetadata!=null?{providerOptions:a.providerMetadata}:{}};if(Xa(a))return(o=t==null?void 0:t.convertDataPart)==null?void 0:o.call(t,a)}).filter(G_)});break}case"assistant":{if(n.parts!=null){let a=[];async function o(){var s,i,l,u,c,p;if(a.length===0)return;const d=[];for(const m of a)if(Qa(m))d.push({type:"text",text:m.text,...m.providerMetadata!=null?{providerOptions:m.providerMetadata}:{}});else if(eo(m))d.push({type:"file",mediaType:m.mediaType,filename:m.filename,data:m.url});else if($s(m))d.push({type:"reasoning",text:m.text,providerOptions:m.providerMetadata});else if(jt(m)){const h=Qn(m);m.state!=="input-streaming"&&(d.push({type:"tool-call",toolCallId:m.toolCallId,toolName:h,input:m.state==="output-error"?(s=m.input)!=null?s:"rawInput"in m?m.rawInput:void 0:m.input,providerExecuted:m.providerExecuted,...m.callProviderMetadata!=null?{providerOptions:m.callProviderMetadata}:{}}),m.approval!=null&&d.push({type:"tool-approval-request",approvalId:m.approval.id,toolCallId:m.toolCallId}),m.providerExecuted===!0&&m.state!=="approval-responded"&&(m.state==="output-available"||m.state==="output-error")&&d.push({type:"tool-result",toolCallId:m.toolCallId,toolName:h,output:await Lr({toolCallId:m.toolCallId,input:m.input,output:m.state==="output-error"?m.errorText:m.output,tool:(i=t==null?void 0:t.tools)==null?void 0:i[h],errorMode:m.state==="output-error"?"json":"none"}),...m.callProviderMetadata!=null?{providerOptions:m.callProviderMetadata}:{}}))}else if(Xa(m)){const h=(l=t==null?void 0:t.convertDataPart)==null?void 0:l.call(t,m);h!=null&&d.push(h)}else{const h=m;throw new Error(`Unsupported part: ${h}`)}r.push({role:"assistant",content:d});const f=a.filter(m=>{var h;return jt(m)&&(m.providerExecuted!==!0||((h=m.approval)==null?void 0:h.approved)!=null)});if(f.length>0){const m=[];for(const h of f)if(((u=h.approval)==null?void 0:u.approved)!=null&&m.push({type:"tool-approval-response",approvalId:h.approval.id,approved:h.approval.approved,reason:h.approval.reason,providerExecuted:h.providerExecuted}),h.providerExecuted!==!0)switch(h.state){case"output-denied":{m.push({type:"tool-result",toolCallId:h.toolCallId,toolName:Qn(h),output:{type:"error-text",value:(c=h.approval.reason)!=null?c:"Tool execution denied."},...h.callProviderMetadata!=null?{providerOptions:h.callProviderMetadata}:{}});break}case"output-error":case"output-available":{const g=Qn(h);m.push({type:"tool-result",toolCallId:h.toolCallId,toolName:g,output:await Lr({toolCallId:h.toolCallId,input:h.input,output:h.state==="output-error"?h.errorText:h.output,tool:(p=t==null?void 0:t.tools)==null?void 0:p[g],errorMode:h.state==="output-error"?"text":"none"}),...h.callProviderMetadata!=null?{providerOptions:h.callProviderMetadata}:{}});break}}m.length>0&&r.push({role:"tool",content:m})}a=[]}for(const s of n.parts)Qa(s)||$s(s)||eo(s)||jt(s)||Xa(s)?a.push(s):s.type==="step-start"&&await o();await o();break}break}default:{const a=n.role;throw new nh({originalMessage:n,message:`Unsupported role: ${a}`})}}return r}var $E=ye(()=>me(H(_({id:v(),role:Oe(["system","user","assistant"]),metadata:te().optional(),parts:H(ke([_({type:O("text"),text:v(),state:Oe(["streaming","done"]).optional(),providerMetadata:Z.optional()}),_({type:O("reasoning"),text:v(),state:Oe(["streaming","done"]).optional(),providerMetadata:Z.optional()}),_({type:O("source-url"),sourceId:v(),url:v(),title:v().optional(),providerMetadata:Z.optional()}),_({type:O("source-document"),sourceId:v(),mediaType:v(),title:v(),filename:v().optional(),providerMetadata:Z.optional()}),_({type:O("file"),mediaType:v(),filename:v().optional(),url:v(),providerMetadata:Z.optional()}),_({type:O("step-start")}),_({type:v().startsWith("data-"),id:v().optional(),data:te()}),_({type:O("dynamic-tool"),toolName:v(),toolCallId:v(),state:O("input-streaming"),input:te().optional(),providerExecuted:Q().optional(),callProviderMetadata:Z.optional(),output:oe().optional(),errorText:oe().optional(),approval:oe().optional()}),_({type:O("dynamic-tool"),toolName:v(),toolCallId:v(),state:O("input-available"),input:te(),providerExecuted:Q().optional(),output:oe().optional(),errorText:oe().optional(),callProviderMetadata:Z.optional(),approval:oe().optional()}),_({type:O("dynamic-tool"),toolName:v(),toolCallId:v(),state:O("approval-requested"),input:te(),providerExecuted:Q().optional(),output:oe().optional(),errorText:oe().optional(),callProviderMetadata:Z.optional(),approval:_({id:v(),approved:oe().optional(),reason:oe().optional()})}),_({type:O("dynamic-tool"),toolName:v(),toolCallId:v(),state:O("approval-responded"),input:te(),providerExecuted:Q().optional(),output:oe().optional(),errorText:oe().optional(),callProviderMetadata:Z.optional(),approval:_({id:v(),approved:Q(),reason:v().optional()})}),_({type:O("dynamic-tool"),toolName:v(),toolCallId:v(),state:O("output-available"),input:te(),providerExecuted:Q().optional(),output:te(),errorText:oe().optional(),callProviderMetadata:Z.optional(),preliminary:Q().optional(),approval:_({id:v(),approved:O(!0),reason:v().optional()}).optional()}),_({type:O("dynamic-tool"),toolName:v(),toolCallId:v(),state:O("output-error"),input:te(),rawInput:te().optional(),providerExecuted:Q().optional(),output:oe().optional(),errorText:v(),callProviderMetadata:Z.optional(),approval:_({id:v(),approved:O(!0),reason:v().optional()}).optional()}),_({type:O("dynamic-tool"),toolName:v(),toolCallId:v(),state:O("output-denied"),input:te(),providerExecuted:Q().optional(),output:oe().optional(),errorText:oe().optional(),callProviderMetadata:Z.optional(),approval:_({id:v(),approved:O(!1),reason:v().optional()})}),_({type:v().startsWith("tool-"),toolCallId:v(),state:O("input-streaming"),providerExecuted:Q().optional(),callProviderMetadata:Z.optional(),input:te().optional(),output:oe().optional(),errorText:oe().optional(),approval:oe().optional()}),_({type:v().startsWith("tool-"),toolCallId:v(),state:O("input-available"),providerExecuted:Q().optional(),input:te(),output:oe().optional(),errorText:oe().optional(),callProviderMetadata:Z.optional(),approval:oe().optional()}),_({type:v().startsWith("tool-"),toolCallId:v(),state:O("approval-requested"),input:te(),providerExecuted:Q().optional(),output:oe().optional(),errorText:oe().optional(),callProviderMetadata:Z.optional(),approval:_({id:v(),approved:oe().optional(),reason:oe().optional()})}),_({type:v().startsWith("tool-"),toolCallId:v(),state:O("approval-responded"),input:te(),providerExecuted:Q().optional(),output:oe().optional(),errorText:oe().optional(),callProviderMetadata:Z.optional(),approval:_({id:v(),approved:Q(),reason:v().optional()})}),_({type:v().startsWith("tool-"),toolCallId:v(),state:O("output-available"),providerExecuted:Q().optional(),input:te(),output:te(),errorText:oe().optional(),callProviderMetadata:Z.optional(),preliminary:Q().optional(),approval:_({id:v(),approved:O(!0),reason:v().optional()}).optional()}),_({type:v().startsWith("tool-"),toolCallId:v(),state:O("output-error"),providerExecuted:Q().optional(),input:te(),rawInput:te().optional(),output:oe().optional(),errorText:v(),callProviderMetadata:Z.optional(),approval:_({id:v(),approved:O(!0),reason:v().optional()}).optional()}),_({type:v().startsWith("tool-"),toolCallId:v(),state:O("output-denied"),providerExecuted:Q().optional(),input:te(),output:oe().optional(),errorText:oe().optional(),callProviderMetadata:Z.optional(),approval:_({id:v(),approved:O(!1),reason:v().optional()})})])).nonempty("Message must contain at least one part")})).nonempty("Messages array must not be empty")));async function Jh({messages:e,metadataSchema:t,dataSchemas:r,tools:n}){try{if(e==null)return{success:!1,error:new ve({parameter:"messages",value:e,message:"messages parameter must be provided"})};const a=await dr({value:e,schema:$E});if(t)for(const[o,s]of a.entries())await dr({value:s.metadata,schema:t,context:{field:`messages[${o}].metadata`,entityId:s.id}});if(r||n)for(const[o,s]of a.entries())for(const[i,l]of s.parts.entries()){if(r&&l.type.startsWith("data-")){const u=l,c=u.type.slice(5),p=r[c];if(!p)return{success:!1,error:new We({value:u.data,cause:`No data schema found for data part ${c}`,context:{field:`messages[${o}].parts[${i}].data`,entityName:c,entityId:u.id}})};await dr({value:u.data,schema:p,context:{field:`messages[${o}].parts[${i}].data`,entityName:c,entityId:u.id}})}if(n&&l.type.startsWith("tool-")){const u=l,c=u.type.slice(5),p=n[c];if(!p)return{success:!1,error:new We({value:u.input,cause:`No tool schema found for tool part ${c}`,context:{field:`messages[${o}].parts[${i}].input`,entityName:c,entityId:u.toolCallId}})};(u.state==="input-available"||u.state==="output-available"||u.state==="output-error"&&u.input!==void 0)&&await dr({value:u.input,schema:p.inputSchema,context:{field:`messages[${o}].parts[${i}].input`,entityName:c,entityId:u.toolCallId}}),u.state==="output-available"&&p.outputSchema&&await dr({value:u.output,schema:p.outputSchema,context:{field:`messages[${o}].parts[${i}].output`,entityName:c,entityId:u.toolCallId}})}}return{success:!0,data:a}}catch(a){return{success:!1,error:a}}}async function _i({messages:e,metadataSchema:t,dataSchemas:r,tools:n}){const a=await Jh({messages:e,metadataSchema:t,dataSchemas:r,tools:n});if(!a.success)throw a.error;return a.data}async function Ii({agent:e,uiMessages:t,options:r,abortSignal:n,timeout:a,experimental_transform:o,onStepFinish:s,...i}){var l;const u=await _i({messages:t,tools:e.tools}),c=await bi(u,{tools:e.tools});return(await e.stream({prompt:c,options:r,abortSignal:n,timeout:a,experimental_transform:o,onStepFinish:s})).toUIMessageStream({...i,originalMessages:(l=i.originalMessages)!=null?l:u})}async function DE({headers:e,status:t,statusText:r,consumeSseStream:n,...a}){return mi({headers:e,status:t,statusText:r,consumeSseStream:n,stream:await Ii(a)})}async function jE({response:e,headers:t,status:r,statusText:n,consumeSseStream:a,...o}){wi({response:e,headers:t,status:r,statusText:n,consumeSseStream:a,stream:await Ii(o)})}async function zE({model:e,value:t,providerOptions:r,maxRetries:n,abortSignal:a,headers:o,experimental_telemetry:s}){const i=hh(e),{maxRetries:l,retry:u}=Zt({maxRetries:n,abortSignal:a}),c=rt(o??{},`ai/${Rt}`),p=tn({model:i,telemetry:s,headers:c,settings:{maxRetries:l}}),d=rn(s);return tt({name:"ai.embed",attributes:le({telemetry:s,attributes:{...et({operationId:"ai.embed",telemetry:s}),...p,"ai.value":{input:()=>JSON.stringify(t)}}}),tracer:d,fn:async f=>{const{embedding:m,usage:h,warnings:g,response:w,providerMetadata:b}=await u(()=>tt({name:"ai.embed.doEmbed",attributes:le({telemetry:s,attributes:{...et({operationId:"ai.embed.doEmbed",telemetry:s}),...p,"ai.values":{input:()=>[JSON.stringify(t)]}}}),tracer:d,fn:async y=>{var T;const x=await i.doEmbed({values:[t],abortSignal:a,headers:c,providerOptions:r}),R=x.embeddings[0],I=(T=x.usage)!=null?T:{tokens:NaN};return y.setAttributes(await le({telemetry:s,attributes:{"ai.embeddings":{output:()=>x.embeddings.map(A=>JSON.stringify(A))},"ai.usage.tokens":I.tokens}})),{embedding:R,usage:I,warnings:x.warnings,providerMetadata:x.providerMetadata,response:x.response}}}));return f.setAttributes(await le({telemetry:s,attributes:{"ai.embedding":{output:()=>JSON.stringify(m)},"ai.usage.tokens":h.tokens}})),yt({warnings:g,provider:i.provider,model:i.modelId}),new UE({value:t,embedding:m,usage:h,warnings:g,providerMetadata:b,response:w})}})}var UE=class{constructor(e){this.value=e.value,this.embedding=e.embedding,this.usage=e.usage,this.warnings=e.warnings,this.providerMetadata=e.providerMetadata,this.response=e.response}};function Vu(e,t){if(t<=0)throw new Error("chunkSize must be greater than 0");const r=[];for(let n=0;n<e.length;n+=t)r.push(e.slice(n,n+t));return r}async function ZE({model:e,values:t,maxParallelCalls:r=1/0,maxRetries:n,abortSignal:a,headers:o,providerOptions:s,experimental_telemetry:i}){const l=hh(e),{maxRetries:u,retry:c}=Zt({maxRetries:n,abortSignal:a}),p=rt(o??{},`ai/${Rt}`),d=tn({model:l,telemetry:i,headers:p,settings:{maxRetries:u}}),f=rn(i);return tt({name:"ai.embedMany",attributes:le({telemetry:i,attributes:{...et({operationId:"ai.embedMany",telemetry:i}),...d,"ai.values":{input:()=>t.map(m=>JSON.stringify(m))}}}),tracer:f,fn:async m=>{var h;const[g,w]=await Promise.all([l.maxEmbeddingsPerCall,l.supportsParallelCalls]);if(g==null||g===1/0){const{embeddings:$,usage:N,warnings:M,response:P,providerMetadata:V}=await c(()=>tt({name:"ai.embedMany.doEmbed",attributes:le({telemetry:i,attributes:{...et({operationId:"ai.embedMany.doEmbed",telemetry:i}),...d,"ai.values":{input:()=>t.map(G=>JSON.stringify(G))}}}),tracer:f,fn:async G=>{var pe;const ne=await l.doEmbed({values:t,abortSignal:a,headers:p,providerOptions:s}),D=ne.embeddings,ae=(pe=ne.usage)!=null?pe:{tokens:NaN};return G.setAttributes(await le({telemetry:i,attributes:{"ai.embeddings":{output:()=>D.map(Ue=>JSON.stringify(Ue))},"ai.usage.tokens":ae.tokens}})),{embeddings:D,usage:ae,warnings:ne.warnings,providerMetadata:ne.providerMetadata,response:ne.response}}}));return m.setAttributes(await le({telemetry:i,attributes:{"ai.embeddings":{output:()=>$.map(G=>JSON.stringify(G))},"ai.usage.tokens":N.tokens}})),yt({warnings:M,provider:l.provider,model:l.modelId}),new Gu({values:t,embeddings:$,usage:N,warnings:M,providerMetadata:V,responses:[P]})}const b=Vu(t,g),y=[],T=[],x=[];let R=0,I;const A=Vu(b,w?r:1);for(const $ of A){const N=await Promise.all($.map(M=>c(()=>tt({name:"ai.embedMany.doEmbed",attributes:le({telemetry:i,attributes:{...et({operationId:"ai.embedMany.doEmbed",telemetry:i}),...d,"ai.values":{input:()=>M.map(P=>JSON.stringify(P))}}}),tracer:f,fn:async P=>{var V;const G=await l.doEmbed({values:M,abortSignal:a,headers:p,providerOptions:s}),pe=G.embeddings,ne=(V=G.usage)!=null?V:{tokens:NaN};return P.setAttributes(await le({telemetry:i,attributes:{"ai.embeddings":{output:()=>pe.map(D=>JSON.stringify(D))},"ai.usage.tokens":ne.tokens}})),{embeddings:pe,usage:ne,warnings:G.warnings,providerMetadata:G.providerMetadata,response:G.response}}}))));for(const M of N)if(y.push(...M.embeddings),T.push(...M.warnings),x.push(M.response),R+=M.usage.tokens,M.providerMetadata)if(!I)I={...M.providerMetadata};else for(const[P,V]of Object.entries(M.providerMetadata))I[P]={...(h=I[P])!=null?h:{},...V}}return m.setAttributes(await le({telemetry:i,attributes:{"ai.embeddings":{output:()=>y.map($=>JSON.stringify($))},"ai.usage.tokens":R}})),yt({warnings:T,provider:l.provider,model:l.modelId}),new Gu({values:t,embeddings:y,usage:{tokens:R},warnings:T,providerMetadata:I,responses:x})}})}var Gu=class{constructor(e){this.values=e.values,this.embeddings=e.embeddings,this.usage=e.usage,this.warnings=e.warnings,this.providerMetadata=e.providerMetadata,this.responses=e.responses}};async function Hh({model:e,prompt:t,n:r=1,maxImagesPerCall:n,size:a,aspectRatio:o,seed:s,providerOptions:i,maxRetries:l,abortSignal:u,headers:c}){var p,d;const f=JS(e),m=rt(c??{},`ai/${Rt}`),{retry:h}=Zt({maxRetries:l,abortSignal:u}),g=(p=n??await FE(f))!=null?p:1,w=Math.ceil(r/g),b=Array.from({length:w},($,N)=>{if(N<w-1)return g;const M=r%g;return M===0?g:M}),y=await Promise.all(b.map(async $=>h(()=>{const{prompt:N,files:M,mask:P}=LE(t);return f.doGenerate({prompt:N,files:M,mask:P,n:$,abortSignal:u,headers:m,size:a,aspectRatio:o,seed:s,providerOptions:i??{}})}))),T=[],x=[],R=[],I={};let A={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};for(const $ of y){if(T.push(...$.images.map(N=>{var M;return new br({data:N,mediaType:(M=Wt({data:N,signatures:Pn}))!=null?M:"image/png"})})),x.push(...$.warnings),$.usage!=null&&(A=pE(A,$.usage)),$.providerMetadata)for(const[N,M]of Object.entries($.providerMetadata))if(N==="gateway"){const P=I[N];P!=null&&typeof P=="object"?I[N]={...P,...M}:I[N]=M;const V=I[N].images;Array.isArray(V)&&V.length===0&&delete I[N].images}else(d=I[N])!=null||(I[N]={images:[]}),I[N].images.push(...$.providerMetadata[N].images);R.push($.response)}if(yt({warnings:x,provider:f.provider,model:f.modelId}),!T.length)throw new wf({responses:R});return new qE({images:T,warnings:x,responses:R,providerMetadata:I,usage:A})}var qE=class{constructor(e){this.images=e.images,this.warnings=e.warnings,this.responses=e.responses,this.providerMetadata=e.providerMetadata,this.usage=e.usage}get image(){return this.images[0]}};async function FE(e){return e.maxImagesPerCall instanceof Function?e.maxImagesPerCall({modelId:e.modelId}):e.maxImagesPerCall}function LE(e){return typeof e=="string"?{prompt:e,files:void 0,mask:void 0}:{prompt:e.text,files:e.images.map(Bu),mask:e.mask?Bu(e.mask):void 0}}function Bu(e){if(typeof e=="string"&&e.startsWith("http"))return{type:"url",url:e};if(typeof e=="string"&&e.startsWith("data:")){const{mediaType:r,base64Content:n}=ui(e);if(n!=null){const a=Br(n);return{type:"file",data:a,mediaType:r||Wt({data:a,signatures:Pn})||"image/png"}}}const t=wh(e);return{type:"file",data:t,mediaType:Wt({data:t,signatures:Pn})||"image/png"}}var VE=Hh;function GE(e){const t=e.filter(r=>r.type==="reasoning");return t.length===0?void 0:t.map(r=>r.text).join(`
`)}var BE={type:"no-schema",jsonSchema:async()=>{},async validatePartialResult({value:e,textDelta:t}){return{success:!0,value:{partial:e,textDelta:t}}},async validateFinalResult(e,t){return e===void 0?{success:!1,error:new dt({message:"No object generated: response did not match schema.",text:t.text,response:t.response,usage:t.usage,finishReason:t.finishReason})}:{success:!0,value:e}},createElementStream(){throw new _r({functionality:"element streams in no-schema mode"})}},JE=e=>({type:"object",jsonSchema:async()=>await e.jsonSchema,async validatePartialResult({value:t,textDelta:r}){return{success:!0,value:{partial:t,textDelta:r}}},async validateFinalResult(t){return pt({value:t,schema:e})},createElementStream(){throw new _r({functionality:"element streams in object mode"})}}),HE=e=>({type:"array",jsonSchema:async()=>{const{$schema:t,...r}=await e.jsonSchema;return{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:r}},required:["elements"],additionalProperties:!1}},async validatePartialResult({value:t,latestObject:r,isFirstDelta:n,isFinalDelta:a}){var o;if(!oo(t)||!_l(t.elements))return{success:!1,error:new We({value:t,cause:"value must be an object that contains an array of elements"})};const s=t.elements,i=[];for(let c=0;c<s.length;c++){const p=s[c],d=await pt({value:p,schema:e});if(!(c===s.length-1&&!a)){if(!d.success)return d;i.push(d.value)}}const l=(o=r==null?void 0:r.length)!=null?o:0;let u="";return n&&(u+="["),l>0&&(u+=","),u+=i.slice(l).map(c=>JSON.stringify(c)).join(","),a&&(u+="]"),{success:!0,value:{partial:i,textDelta:u}}},async validateFinalResult(t){if(!oo(t)||!_l(t.elements))return{success:!1,error:new We({value:t,cause:"value must be an object that contains an array of elements"})};const r=t.elements;for(const n of r){const a=await pt({value:n,schema:e});if(!a.success)return a}return{success:!0,value:r}},createElementStream(t){let r=0;return Gt(t.pipeThrough(new TransformStream({transform(n,a){switch(n.type){case"object":{const o=n.object;for(;r<o.length;r++)a.enqueue(o[r]);break}case"text-delta":case"finish":case"error":break;default:{const o=n;throw new Error(`Unsupported chunk type: ${o}`)}}}})))}}),WE=e=>({type:"enum",jsonSchema:async()=>({$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1}),async validateFinalResult(t){if(!oo(t)||typeof t.result!="string")return{success:!1,error:new We({value:t,cause:'value must be an object that contains a string in the "result" property.'})};const r=t.result;return e.includes(r)?{success:!0,value:r}:{success:!1,error:new We({value:t,cause:"value must be a string in the enum"})}},async validatePartialResult({value:t,textDelta:r}){if(!oo(t)||typeof t.result!="string")return{success:!1,error:new We({value:t,cause:'value must be an object that contains a string in the "result" property.'})};const n=t.result,a=e.filter(o=>o.startsWith(n));return t.result.length===0||a.length===0?{success:!1,error:new We({value:t,cause:"value must be a string in the enum"})}:{success:!0,value:{partial:a.length>1?n:a[0],textDelta:r}}},createElementStream(){throw new _r({functionality:"element streams in enum mode"})}});function Wh({output:e,schema:t,enumValues:r}){switch(e){case"object":return JE(or(t));case"array":return HE(or(t));case"enum":return WE(r);case"no-schema":return BE;default:{const n=e;throw new Error(`Unsupported output: ${n}`)}}}async function Ju(e,t,r){const n=await xt({text:e});if(!n.success)throw new dt({message:"No object generated: could not parse the response.",cause:n.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});const a=await t.validateFinalResult(n.value,{text:e,response:r.response,usage:r.usage});if(!a.success)throw new dt({message:"No object generated: response did not match schema.",cause:a.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});return a.value}async function Yh(e,t,r,n){try{return await Ju(e,t,n)}catch(a){if(r!=null&&dt.isInstance(a)&&(xn.isInstance(a.cause)||We.isInstance(a.cause))){const o=await r({text:e,error:a.cause});if(o===null)throw a;return await Ju(o,t,n)}throw a}}function Kh({output:e,schema:t,schemaName:r,schemaDescription:n,enumValues:a}){if(e!=null&&e!=="object"&&e!=="array"&&e!=="enum"&&e!=="no-schema")throw new ve({parameter:"output",value:e,message:"Invalid output type."});if(e==="no-schema"){if(t!=null)throw new ve({parameter:"schema",value:t,message:"Schema is not supported for no-schema output."});if(n!=null)throw new ve({parameter:"schemaDescription",value:n,message:"Schema description is not supported for no-schema output."});if(r!=null)throw new ve({parameter:"schemaName",value:r,message:"Schema name is not supported for no-schema output."});if(a!=null)throw new ve({parameter:"enumValues",value:a,message:"Enum values are not supported for no-schema output."})}if(e==="object"){if(t==null)throw new ve({parameter:"schema",value:t,message:"Schema is required for object output."});if(a!=null)throw new ve({parameter:"enumValues",value:a,message:"Enum values are not supported for object output."})}if(e==="array"){if(t==null)throw new ve({parameter:"schema",value:t,message:"Element schema is required for array output."});if(a!=null)throw new ve({parameter:"enumValues",value:a,message:"Enum values are not supported for array output."})}if(e==="enum"){if(t!=null)throw new ve({parameter:"schema",value:t,message:"Schema is not supported for enum output."});if(n!=null)throw new ve({parameter:"schemaDescription",value:n,message:"Schema description is not supported for enum output."});if(r!=null)throw new ve({parameter:"schemaName",value:r,message:"Schema name is not supported for enum output."});if(a==null)throw new ve({parameter:"enumValues",value:a,message:"Enum values are required for enum output."});for(const o of a)if(typeof o!="string")throw new ve({parameter:"enumValues",value:o,message:"Enum values must be strings."})}}var YE=jn({prefix:"aiobj",size:24});async function KE(e){const{model:t,output:r="object",system:n,prompt:a,messages:o,maxRetries:s,abortSignal:i,headers:l,experimental_repairText:u,experimental_telemetry:c,experimental_download:p,providerOptions:d,_internal:{generateId:f=YE,currentDate:m=()=>new Date}={},...h}=e,g=Nn(t),w="enum"in e?e.enum:void 0,{schema:b,schemaDescription:y,schemaName:T}="schema"in e?e:{};Kh({output:r,schema:b,schemaName:T,schemaDescription:y,enumValues:w});const{maxRetries:x,retry:R}=Zt({maxRetries:s,abortSignal:i}),I=Wh({output:r,schema:b,enumValues:w}),A=Kr(h),$=rt(l??{},`ai/${Rt}`),N=tn({model:g,telemetry:c,headers:$,settings:{...A,maxRetries:x}}),M=rn(c),P=await I.jsonSchema();try{return await tt({name:"ai.generateObject",attributes:le({telemetry:c,attributes:{...et({operationId:"ai.generateObject",telemetry:c}),...N,"ai.prompt":{input:()=>JSON.stringify({system:n,prompt:a,messages:o})},"ai.schema":P!=null?{input:()=>JSON.stringify(P)}:void 0,"ai.schema.name":T,"ai.schema.description":y,"ai.settings.output":I.type}}),tracer:M,fn:async V=>{var G;let pe,ne,D,ae,Ue,Ze,Ot,nt;const Ye=await $o({system:n,prompt:a,messages:o}),Fe=await Po({prompt:Ye,supportedUrls:await g.supportedUrls,download:p}),ce=await R(()=>tt({name:"ai.generateObject.doGenerate",attributes:le({telemetry:c,attributes:{...et({operationId:"ai.generateObject.doGenerate",telemetry:c}),...N,"ai.prompt.messages":{input:()=>jo(Fe)},"gen_ai.system":g.provider,"gen_ai.request.model":g.modelId,"gen_ai.request.frequency_penalty":A.frequencyPenalty,"gen_ai.request.max_tokens":A.maxOutputTokens,"gen_ai.request.presence_penalty":A.presencePenalty,"gen_ai.request.temperature":A.temperature,"gen_ai.request.top_k":A.topK,"gen_ai.request.top_p":A.topP}}),tracer:M,fn:async kt=>{var Ke,qe,Ne,ut,wt,bt,qt,Yt;const F=await g.doGenerate({responseFormat:{type:"json",schema:P,name:T,description:y},...Kr(h),prompt:Fe,providerOptions:d,abortSignal:i,headers:$}),J={id:(qe=(Ke=F.response)==null?void 0:Ke.id)!=null?qe:f(),timestamp:(ut=(Ne=F.response)==null?void 0:Ne.timestamp)!=null?ut:m(),modelId:(bt=(wt=F.response)==null?void 0:wt.modelId)!=null?bt:g.modelId,headers:(qt=F.response)==null?void 0:qt.headers,body:(Yt=F.response)==null?void 0:Yt.body},_t=Ns(F.content),Ee=GE(F.content);if(_t===void 0)throw new dt({message:"No object generated: the model did not return a response.",response:J,usage:ca(F.usage),finishReason:F.finishReason.unified});return kt.setAttributes(await le({telemetry:c,attributes:{"ai.response.finishReason":F.finishReason.unified,"ai.response.object":{output:()=>_t},"ai.response.id":J.id,"ai.response.model":J.modelId,"ai.response.timestamp":J.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(F.providerMetadata),"ai.usage.promptTokens":F.usage.inputTokens.total,"ai.usage.completionTokens":F.usage.outputTokens.total,"gen_ai.response.finish_reasons":[F.finishReason.unified],"gen_ai.response.id":J.id,"gen_ai.response.model":J.modelId,"gen_ai.usage.input_tokens":F.usage.inputTokens.total,"gen_ai.usage.output_tokens":F.usage.outputTokens.total}})),{...F,objectText:_t,reasoning:Ee,responseData:J}}}));pe=ce.objectText,ne=ce.finishReason.unified,D=ca(ce.usage),ae=ce.warnings,Ot=ce.providerMetadata,Ze=(G=ce.request)!=null?G:{},Ue=ce.responseData,nt=ce.reasoning,yt({warnings:ae,provider:g.provider,model:g.modelId});const at=await Yh(pe,I,u,{response:Ue,usage:D,finishReason:ne});return V.setAttributes(await le({telemetry:c,attributes:{"ai.response.finishReason":ne,"ai.response.object":{output:()=>JSON.stringify(at)},"ai.response.providerMetadata":JSON.stringify(Ot),"ai.usage.promptTokens":D.inputTokens,"ai.usage.completionTokens":D.outputTokens}})),new XE({object:at,reasoning:nt,finishReason:ne,usage:D,warnings:ae,request:Ze,response:Ue,providerMetadata:Ot})}})}catch(V){throw Do(V)}}var XE=class{constructor(e){this.object=e.object,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.providerMetadata=e.providerMetadata,this.response=e.response,this.request=e.request,this.reasoning=e.reasoning}toJsonResponse(e){var t;return new Response(JSON.stringify(this.object),{status:(t=e==null?void 0:e.status)!=null?t:200,headers:Oa(e==null?void 0:e.headers,{"content-type":"application/json; charset=utf-8"})})}};function QE(e,t){if(e.length!==t.length)throw new ve({parameter:"vector1,vector2",value:{vector1Length:e.length,vector2Length:t.length},message:"Vectors must have the same length"});const r=e.length;if(r===0)return 0;let n=0,a=0,o=0;for(let s=0;s<r;s++){const i=e[s],l=t[s];n+=i*i,a+=l*l,o+=i*l}return n===0||a===0?0:o/(Math.sqrt(n)*Math.sqrt(a))}function ex(e){const[t,r]=e.split(",");if(t.split(";")[0].split(":")[1]==null||r==null)throw new Error("Invalid data URL format");try{return window.atob(r)}catch{throw new Error("Error decoding data URL")}}function da(e,t){if(e===t)return!0;if(e==null||t==null)return!1;if(typeof e!="object"&&typeof t!="object")return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(Array.isArray(e)){if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++)if(!da(e[a],t[a]))return!1;return!0}const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(const a of r)if(!n.includes(a)||!da(e[a],t[a]))return!1;return!0}var Xh=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(e){return new Promise((t,r)=>{this.queue.push(async()=>{try{await e(),t()}catch(n){r(n)}}),this.processQueue()})}};function tx({chunks:e,initialDelayInMs:t=0,chunkDelayInMs:r=0,_internal:n}){var a;const o=(a=n==null?void 0:n.delay)!=null?a:Ro;let s=0;return new ReadableStream({async pull(i){s<e.length?(await o(s===0?t:r),i.enqueue(e[s++])):i.close()}})}var rx=jn({prefix:"aiobj",size:24});function nx(e){const{model:t,output:r="object",system:n,prompt:a,messages:o,maxRetries:s,abortSignal:i,headers:l,experimental_repairText:u,experimental_telemetry:c,experimental_download:p,providerOptions:d,onError:f=({error:A})=>{console.error(A)},onFinish:m,_internal:{generateId:h=rx,currentDate:g=()=>new Date,now:w=Gh}={},...b}=e,y="enum"in e&&e.enum?e.enum:void 0,{schema:T,schemaDescription:x,schemaName:R}="schema"in e?e:{};Kh({output:r,schema:T,schemaName:R,schemaDescription:x,enumValues:y});const I=Wh({output:r,schema:T,enumValues:y});return new ax({model:t,telemetry:c,headers:l,settings:b,maxRetries:s,abortSignal:i,outputStrategy:I,system:n,prompt:a,messages:o,schemaName:R,schemaDescription:x,providerOptions:d,repairText:u,onError:f,onFinish:m,download:p,generateId:h,currentDate:g,now:w})}var ax=class{constructor({model:e,headers:t,telemetry:r,settings:n,maxRetries:a,abortSignal:o,outputStrategy:s,system:i,prompt:l,messages:u,schemaName:c,schemaDescription:p,providerOptions:d,repairText:f,onError:m,onFinish:h,download:g,generateId:w,currentDate:b,now:y}){this._object=new St,this._usage=new St,this._providerMetadata=new St,this._warnings=new St,this._request=new St,this._response=new St,this._finishReason=new St;const T=Nn(e),{maxRetries:x,retry:R}=Zt({maxRetries:a,abortSignal:o}),I=Kr(n),A=tn({model:T,telemetry:r,headers:t,settings:{...I,maxRetries:x}}),$=rn(r),N=this,M=Vh(),P=new TransformStream({transform(V,G){G.enqueue(V),V.type==="error"&&m({error:Do(V.error)})}});this.baseStream=M.stream.pipeThrough(P),tt({name:"ai.streamObject",attributes:le({telemetry:r,attributes:{...et({operationId:"ai.streamObject",telemetry:r}),...A,"ai.prompt":{input:()=>JSON.stringify({system:i,prompt:l,messages:u})},"ai.schema":{input:async()=>JSON.stringify(await s.jsonSchema())},"ai.schema.name":c,"ai.schema.description":p,"ai.settings.output":s.type}}),tracer:$,endWhenDone:!1,fn:async V=>{const G=await $o({system:i,prompt:l,messages:u}),pe={responseFormat:{type:"json",schema:await s.jsonSchema(),name:c,description:p},...Kr(n),prompt:await Po({prompt:G,supportedUrls:await T.supportedUrls,download:g}),providerOptions:d,abortSignal:o,headers:t,includeRawChunks:!1},ne={transform:(F,J)=>{switch(F.type){case"text-delta":J.enqueue(F.delta);break;case"response-metadata":case"finish":case"error":case"stream-start":J.enqueue(F);break}}},{result:{stream:D,response:ae,request:Ue},doStreamSpan:Ze,startTimestampMs:Ot}=await R(()=>tt({name:"ai.streamObject.doStream",attributes:le({telemetry:r,attributes:{...et({operationId:"ai.streamObject.doStream",telemetry:r}),...A,"ai.prompt.messages":{input:()=>jo(pe.prompt)},"gen_ai.system":T.provider,"gen_ai.request.model":T.modelId,"gen_ai.request.frequency_penalty":I.frequencyPenalty,"gen_ai.request.max_tokens":I.maxOutputTokens,"gen_ai.request.presence_penalty":I.presencePenalty,"gen_ai.request.temperature":I.temperature,"gen_ai.request.top_k":I.topK,"gen_ai.request.top_p":I.topP}}),tracer:$,endWhenDone:!1,fn:async F=>({startTimestampMs:y(),doStreamSpan:F,result:await T.doStream(pe)})}));N._request.resolve(Ue??{});let nt,Ye=Ka(),Fe,ce,at,kt,Ke="",qe="",Ne={id:w(),timestamp:b(),modelId:T.modelId},ut,wt,bt=!0,qt=!0;const Yt=D.pipeThrough(new TransformStream(ne)).pipeThrough(new TransformStream({async transform(F,J){var _t,Ee,we;if(typeof F=="object"&&F.type==="stream-start"){nt=F.warnings;return}if(bt){const se=y()-Ot;bt=!1,Ze.addEvent("ai.stream.firstChunk",{"ai.stream.msToFirstChunk":se}),Ze.setAttributes({"ai.stream.msToFirstChunk":se})}if(typeof F=="string"){Ke+=F,qe+=F;const{value:se,state:Re}=await nn(Ke);if(se!==void 0&&!da(ut,se)){const z=await s.validatePartialResult({value:se,textDelta:qe,latestObject:wt,isFirstDelta:qt,isFinalDelta:Re==="successful-parse"});z.success&&!da(wt,z.value.partial)&&(ut=se,wt=z.value.partial,J.enqueue({type:"object",object:wt}),J.enqueue({type:"text-delta",textDelta:z.value.textDelta}),qe="",qt=!1)}return}switch(F.type){case"response-metadata":{Ne={id:(_t=F.id)!=null?_t:Ne.id,timestamp:(Ee=F.timestamp)!=null?Ee:Ne.timestamp,modelId:(we=F.modelId)!=null?we:Ne.modelId};break}case"finish":{qe!==""&&J.enqueue({type:"text-delta",textDelta:qe}),Fe=F.finishReason.unified,Ye=ca(F.usage),ce=F.providerMetadata,J.enqueue({...F,finishReason:F.finishReason.unified,usage:Ye,response:Ne}),yt({warnings:nt??[],provider:T.provider,model:T.modelId}),N._usage.resolve(Ye),N._providerMetadata.resolve(ce),N._warnings.resolve(nt),N._response.resolve({...Ne,headers:ae==null?void 0:ae.headers}),N._finishReason.resolve(Fe??"other");try{at=await Yh(Ke,s,f,{response:Ne,usage:Ye,finishReason:Fe}),N._object.resolve(at)}catch(se){kt=se,N._object.reject(se)}break}default:{J.enqueue(F);break}}},async flush(F){try{const J=Ye??{promptTokens:NaN,completionTokens:NaN,totalTokens:NaN};Ze.setAttributes(await le({telemetry:r,attributes:{"ai.response.finishReason":Fe,"ai.response.object":{output:()=>JSON.stringify(at)},"ai.response.id":Ne.id,"ai.response.model":Ne.modelId,"ai.response.timestamp":Ne.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(ce),"ai.usage.inputTokens":J.inputTokens,"ai.usage.outputTokens":J.outputTokens,"ai.usage.totalTokens":J.totalTokens,"ai.usage.reasoningTokens":J.reasoningTokens,"ai.usage.cachedInputTokens":J.cachedInputTokens,"gen_ai.response.finish_reasons":[Fe],"gen_ai.response.id":Ne.id,"gen_ai.response.model":Ne.modelId,"gen_ai.usage.input_tokens":J.inputTokens,"gen_ai.usage.output_tokens":J.outputTokens}})),Ze.end(),V.setAttributes(await le({telemetry:r,attributes:{"ai.usage.inputTokens":J.inputTokens,"ai.usage.outputTokens":J.outputTokens,"ai.usage.totalTokens":J.totalTokens,"ai.usage.reasoningTokens":J.reasoningTokens,"ai.usage.cachedInputTokens":J.cachedInputTokens,"ai.response.object":{output:()=>JSON.stringify(at)},"ai.response.providerMetadata":JSON.stringify(ce)}})),await(h==null?void 0:h({usage:J,object:at,error:kt,response:{...Ne,headers:ae==null?void 0:ae.headers},warnings:nt,providerMetadata:ce}))}catch(J){F.enqueue({type:"error",error:J})}finally{V.end()}}}));M.addStream(Yt)}}).catch(V=>{M.addStream(new ReadableStream({start(G){G.enqueue({type:"error",error:V}),G.close()}}))}).finally(()=>{M.close()}),this.outputStrategy=s}get object(){return this._object.promise}get usage(){return this._usage.promise}get providerMetadata(){return this._providerMetadata.promise}get warnings(){return this._warnings.promise}get request(){return this._request.promise}get response(){return this._response.promise}get finishReason(){return this._finishReason.promise}get partialObjectStream(){return Gt(this.baseStream.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case"object":t.enqueue(e.object);break;case"text-delta":case"finish":case"error":break;default:{const r=e;throw new Error(`Unsupported chunk type: ${r}`)}}}})))}get elementStream(){return this.outputStrategy.createElementStream(this.baseStream)}get textStream(){return Gt(this.baseStream.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case"text-delta":t.enqueue(e.textDelta);break;case"object":case"finish":case"error":break;default:{const r=e;throw new Error(`Unsupported chunk type: ${r}`)}}}})))}get fullStream(){return Gt(this.baseStream)}pipeTextStreamToResponse(e,t){pi({response:e,textStream:this.textStream,...t})}toTextStreamResponse(e){return di({textStream:this.textStream,...e})}},ox=class extends br{constructor({data:e,mediaType:t}){super({data:e,mediaType:t});let r="mp3";if(t){const n=t.split("/");n.length===2&&t!=="audio/mpeg"&&(r=n[1])}if(!r)throw new Error("Audio format must be provided or determinable from media type");this.format=r}};async function sx({model:e,text:t,voice:r,outputFormat:n,instructions:a,speed:o,language:s,providerOptions:i={},maxRetries:l,abortSignal:u,headers:c}){var p;const d=BS(e);if(!d)throw new Error("Model could not be resolved");const f=rt(c??{},`ai/${Rt}`),{retry:m}=Zt({maxRetries:l,abortSignal:u}),h=await m(()=>d.doGenerate({text:t,voice:r,outputFormat:n,instructions:a,speed:o,language:s,abortSignal:u,headers:f,providerOptions:i}));if(!h.audio||h.audio.length===0)throw new Of({responses:[h.response]});return yt({warnings:h.warnings,provider:d.provider,model:d.modelId}),new ix({audio:new ox({data:h.audio,mediaType:(p=Wt({data:h.audio,signatures:gh}))!=null?p:"audio/mp3"}),warnings:h.warnings,responses:[h.response],providerMetadata:h.providerMetadata})}var ix=class{constructor(e){var t;this.audio=e.audio,this.warnings=e.warnings,this.responses=e.responses,this.providerMetadata=(t=e.providerMetadata)!=null?t:{}}};function lx({messages:e,reasoning:t="none",toolCalls:r=[],emptyMessages:n="remove"}){(t==="all"||t==="before-last-message")&&(e=e.map((a,o)=>a.role!=="assistant"||typeof a.content=="string"||t==="before-last-message"&&o===e.length-1?a:{...a,content:a.content.filter(s=>s.type!=="reasoning")})),r==="none"?r=[]:r==="all"?r=[{type:"all"}]:r==="before-last-message"?r=[{type:"before-last-message"}]:typeof r=="string"&&(r=[{type:r}]);for(const a of r){const o=a.type==="all"?void 0:a.type==="before-last-message"?1:Number(a.type.slice(12).slice(0,-9)),s=new Set,i=new Set;if(o!=null){for(const l of e.slice(-o))if((l.role==="assistant"||l.role==="tool")&&typeof l.content!="string")for(const u of l.content)u.type==="tool-call"||u.type==="tool-result"?s.add(u.toolCallId):(u.type==="tool-approval-request"||u.type==="tool-approval-response")&&i.add(u.approvalId)}e=e.map((l,u)=>{if(l.role!=="assistant"&&l.role!=="tool"||typeof l.content=="string"||o&&u>=e.length-o)return l;const c={},p={};return{...l,content:l.content.filter(d=>d.type!=="tool-call"&&d.type!=="tool-result"&&d.type!=="tool-approval-request"&&d.type!=="tool-approval-response"||(d.type==="tool-call"?c[d.toolCallId]=d.toolName:d.type==="tool-approval-request"&&(p[d.approvalId]=c[d.toolCallId]),(d.type==="tool-call"||d.type==="tool-result")&&s.has(d.toolCallId)||(d.type==="tool-approval-request"||d.type==="tool-approval-response")&&i.has(d.approvalId))?!0:a.tools!=null&&!a.tools.includes(d.type==="tool-call"||d.type==="tool-result"?d.toolName:p[d.approvalId]))}})}return n==="remove"&&(e=e.filter(a=>a.content.length>0)),e}var ux={word:/\S+\s+/m,line:/\n+/m};function cx({delayInMs:e=10,chunking:t="word",_internal:{delay:r=Ro}={}}={}){let n;if(t!=null&&typeof t=="object"&&"segment"in t&&typeof t.segment=="function"){const a=t;n=o=>{if(o.length===0)return null;const i=a.segment(o)[Symbol.iterator]().next().value;return(i==null?void 0:i.segment)||null}}else if(typeof t=="function")n=a=>{const o=t(a);if(o==null)return null;if(!o.length)throw new Error("Chunking function must return a non-empty string.");if(!a.startsWith(o))throw new Error(`Chunking function must return a match that is a prefix of the buffer. Received: "${o}" expected to start with "${a}"`);return o};else{const a=typeof t=="string"?ux[t]:t instanceof RegExp?t:void 0;if(a==null)throw new Ls({argument:"chunking",message:`Chunking must be "word", "line", a RegExp, an Intl.Segmenter, or a ChunkDetector function. Received: ${t}`});n=o=>{const s=a.exec(o);return s?o.slice(0,s.index)+(s==null?void 0:s[0]):null}}return()=>{let a="",o="",s,i;function l(u){a.length>0&&s!==void 0&&(u.enqueue({type:s,text:a,id:o,...i!=null?{providerMetadata:i}:{}}),a="",i=void 0)}return new TransformStream({async transform(u,c){if(u.type!=="text-delta"&&u.type!=="reasoning-delta"){l(c),c.enqueue(u);return}(u.type!==s||u.id!==o)&&a.length>0&&l(c),a+=u.text,o=u.id,s=u.type,u.providerMetadata!=null&&(i=u.providerMetadata);let p;for(;(p=n(a))!=null;)c.enqueue({type:s,text:p,id:o}),a=a.slice(p.length),await r(e)}})}}async function dx({model:e,prompt:t,n:r=1,maxVideosPerCall:n,aspectRatio:a,resolution:o,duration:s,fps:i,seed:l,providerOptions:u,maxRetries:c,abortSignal:p,headers:d}){var f;const m=HS(e),h=rt(d??{},`ai/${Rt}`),{retry:g}=Zt({maxRetries:c,abortSignal:p}),{prompt:w,image:b}=px(t),y=(f=n??await fx(m))!=null?f:1,T=Math.ceil(r/y),x=Array.from({length:T},(M,P)=>{const V=r-P*y;return Math.min(V,y)}),R=await Promise.all(x.map(async M=>g(()=>m.doGenerate({prompt:w,n:M,aspectRatio:a,resolution:o,duration:s,fps:i,seed:l,image:b,providerOptions:u??{},headers:h,abortSignal:p})))),I=[],A=[],$=[],N={};for(const M of R){for(const P of M.videos)switch(P.type){case"url":{const{data:V,mediaType:G}=await li({url:new URL(P.url)}),pe=D=>!!D&&D!=="application/octet-stream",ne=pe(P.mediaType)&&P.mediaType||pe(G)&&G||Wt({data:V,signatures:Du})||"video/mp4";I.push(new br({data:V,mediaType:ne}));break}case"base64":{I.push(new br({data:P.data,mediaType:P.mediaType||"video/mp4"}));break}case"binary":{const V=P.mediaType||Wt({data:P.data,signatures:Du})||"video/mp4";I.push(new br({data:P.data,mediaType:V}));break}}if(A.push(...M.warnings),$.push({timestamp:M.response.timestamp,modelId:M.response.modelId,headers:M.response.headers,providerMetadata:M.providerMetadata}),M.providerMetadata!=null)for(const[P,V]of Object.entries(M.providerMetadata)){const G=N[P];G!=null&&typeof G=="object"?(N[P]={...G,...V},"videos"in G&&Array.isArray(G.videos)&&"videos"in V&&Array.isArray(V.videos)&&(N[P].videos=[...G.videos,...V.videos])):N[P]=V}}if(I.length===0)throw new Df({responses:$});return A.length>0&&yt({warnings:A,provider:m.provider,model:m.modelId}),{video:I[0],videos:I,warnings:A,responses:$,providerMetadata:N}}function px(e){var t,r;if(typeof e=="string")return{prompt:e,image:void 0};let n;if(e.image!=null){const a=e.image;if(typeof a=="string")if(a.startsWith("http://")||a.startsWith("https://"))n={type:"url",url:a};else if(a.startsWith("data:")){const{mediaType:o,base64Content:s}=ui(a);n={type:"file",mediaType:o??"image/png",data:Br(s??"")}}else{const o=Br(a);n={type:"file",mediaType:(t=Wt({data:o,signatures:Pn}))!=null?t:"image/png",data:o}}else a instanceof Uint8Array&&(n={type:"file",mediaType:(r=Wt({data:a,signatures:Pn}))!=null?r:"image/png",data:a})}return{prompt:e.text,image:n}}async function fx(e){return typeof e.maxVideosPerCall=="function"?await e.maxVideosPerCall({modelId:e.modelId}):e.maxVideosPerCall}function hx({settings:e}){return{specificationVersion:"v3",transformParams:async({params:t})=>Un(e,t)}}function mx({settings:e}){return{specificationVersion:"v3",transformParams:async({params:t})=>Un(e,t)}}function gx(e){return e.replace(/^```(?:json)?\s*\n?/,"").replace(/\n?```\s*$/,"").trim()}function vx(e){var t;const r=(t=e==null?void 0:e.transform)!=null?t:gx,n=(e==null?void 0:e.transform)!==void 0;return{specificationVersion:"v3",wrapGenerate:async({doGenerate:a})=>{const{content:o,...s}=await a(),i=[];for(const l of o){if(l.type!=="text"){i.push(l);continue}i.push({...l,text:r(l.text)})}return{content:i,...s}},wrapStream:async({doStream:a})=>{const{stream:o,...s}=await a(),i={},l=12;return{stream:o.pipeThrough(new TransformStream({transform:(u,c)=>{if(u.type==="text-start"){i[u.id]={startEvent:u,phase:n?"buffering":"prefix",buffer:"",prefixStripped:!1};return}if(u.type==="text-delta"){const p=i[u.id];if(!p){c.enqueue(u);return}if(p.buffer+=u.delta,p.phase==="buffering")return;if(p.phase==="prefix")if(p.buffer.length>0&&!p.buffer.startsWith("`"))p.phase="streaming",c.enqueue(p.startEvent);else if(p.buffer.startsWith("```")){if(p.buffer.includes(`
`)){const d=p.buffer.match(/^```(?:json)?\s*\n/);d?(p.buffer=p.buffer.slice(d[0].length),p.prefixStripped=!0,p.phase="streaming",c.enqueue(p.startEvent)):(p.phase="streaming",c.enqueue(p.startEvent))}}else p.buffer.length>=3&&!p.buffer.startsWith("```")&&(p.phase="streaming",c.enqueue(p.startEvent));if(p.phase==="streaming"&&p.buffer.length>l){const d=p.buffer.slice(0,-l);p.buffer=p.buffer.slice(-l),c.enqueue({type:"text-delta",id:u.id,delta:d})}return}if(u.type==="text-end"){const p=i[u.id];if(p){(p.phase==="prefix"||p.phase==="buffering")&&c.enqueue(p.startEvent);let d=p.buffer;p.phase==="buffering"?d=r(d):p.prefixStripped?d=d.replace(/\n?```\s*$/,"").trimEnd():d=r(d),d.length>0&&c.enqueue({type:"text-delta",id:u.id,delta:d}),c.enqueue(u),delete i[u.id];return}}c.enqueue(u)}})),...s}}}}function yx(e,t){if(t.length===0)return null;const r=e.indexOf(t);if(r!==-1)return r;for(let n=e.length-1;n>=0;n--){const a=e.substring(n);if(t.startsWith(a))return n}return null}function wx({tagName:e,separator:t=`
`,startWithReasoning:r=!1}){const n=`<${e}>`,a=`</${e}>`;return{specificationVersion:"v3",wrapGenerate:async({doGenerate:o})=>{const{content:s,...i}=await o(),l=[];for(const u of s){if(u.type!=="text"){l.push(u);continue}const c=r?n+u.text:u.text,p=new RegExp(`${n}(.*?)${a}`,"gs"),d=Array.from(c.matchAll(p));if(!d.length){l.push(u);continue}const f=d.map(h=>h[1]).join(t);let m=c;for(let h=d.length-1;h>=0;h--){const g=d[h],w=m.slice(0,g.index),b=m.slice(g.index+g[0].length);m=w+(w.length>0&&b.length>0?t:"")+b}l.push({type:"reasoning",text:f}),l.push({type:"text",text:m})}return{content:l,...i}},wrapStream:async({doStream:o})=>{const{stream:s,...i}=await o(),l={};let u;return{stream:s.pipeThrough(new TransformStream({transform:(c,p)=>{if(c.type==="text-start"){u=c;return}if(c.type==="text-end"&&u&&(p.enqueue(u),u=void 0),c.type!=="text-delta"){p.enqueue(c);return}l[c.id]==null&&(l[c.id]={isFirstReasoning:!0,isFirstText:!0,afterSwitch:!1,isReasoning:r,buffer:"",idCounter:0,textId:c.id});const d=l[c.id];d.buffer+=c.delta;function f(m){if(m.length>0){const h=d.afterSwitch&&(d.isReasoning?!d.isFirstReasoning:!d.isFirstText)?t:"";d.isReasoning&&(d.afterSwitch||d.isFirstReasoning)&&p.enqueue({type:"reasoning-start",id:`reasoning-${d.idCounter}`}),d.isReasoning?p.enqueue({type:"reasoning-delta",delta:h+m,id:`reasoning-${d.idCounter}`}):(u&&(p.enqueue(u),u=void 0),p.enqueue({type:"text-delta",delta:h+m,id:d.textId})),d.afterSwitch=!1,d.isReasoning?d.isFirstReasoning=!1:d.isFirstText=!1}}do{const m=d.isReasoning?a:n,h=yx(d.buffer,m);if(h==null){f(d.buffer),d.buffer="";break}if(f(d.buffer.slice(0,h)),h+m.length<=d.buffer.length)d.buffer=d.buffer.slice(h+m.length),d.isReasoning&&(d.isFirstReasoning&&p.enqueue({type:"reasoning-start",id:`reasoning-${d.idCounter}`}),p.enqueue({type:"reasoning-end",id:`reasoning-${d.idCounter++}`})),d.isReasoning=!d.isReasoning,d.afterSwitch=!0;else{d.buffer=d.buffer.slice(h);break}}while(!0)}})),...i}}}}function bx(){return{specificationVersion:"v3",wrapStream:async({doGenerate:e})=>{const t=await e();let r=0;return{stream:new ReadableStream({start(a){a.enqueue({type:"stream-start",warnings:t.warnings}),a.enqueue({type:"response-metadata",...t.response});for(const o of t.content)switch(o.type){case"text":{o.text.length>0&&(a.enqueue({type:"text-start",id:String(r)}),a.enqueue({type:"text-delta",id:String(r),delta:o.text}),a.enqueue({type:"text-end",id:String(r)}),r++);break}case"reasoning":{a.enqueue({type:"reasoning-start",id:String(r),providerMetadata:o.providerMetadata}),a.enqueue({type:"reasoning-delta",id:String(r),delta:o.text}),a.enqueue({type:"reasoning-end",id:String(r)}),r++;break}default:{a.enqueue(o);break}}a.enqueue({type:"finish",finishReason:t.finishReason,usage:t.usage,providerMetadata:t.providerMetadata}),a.close()}}),request:t.request,response:t.response}}}}function _x(e){return JSON.stringify(e.input)}function Ix({prefix:e="Input Examples:",format:t=_x,remove:r=!0}={}){return{specificationVersion:"v3",transformParams:async({params:n})=>{var a;if(!((a=n.tools)!=null&&a.length))return n;const o=n.tools.map(s=>{var i;if(s.type!=="function"||!((i=s.inputExamples)!=null&&i.length))return s;const l=s.inputExamples.map((p,d)=>t(p,d)).join(`
`),u=`${e}
${l}`,c=s.description?`${s.description}

${u}`:u;return{...s,description:c,inputExamples:r?void 0:s.inputExamples}});return{...n,tools:o}}}}var Ti=({model:e,middleware:t,modelId:r,providerId:n})=>[...Er(t)].reverse().reduce((a,o)=>Tx({model:a,middleware:o,modelId:r,providerId:n}),e),Tx=({model:e,middleware:{transformParams:t,wrapGenerate:r,wrapStream:n,overrideProvider:a,overrideModelId:o,overrideSupportedUrls:s},modelId:i,providerId:l})=>{var u,c,p;async function d({params:f,type:m}){return t?await t({params:f,type:m,model:e}):f}return{specificationVersion:"v3",provider:(u=l??(a==null?void 0:a({model:e})))!=null?u:e.provider,modelId:(c=i??(o==null?void 0:o({model:e})))!=null?c:e.modelId,supportedUrls:(p=s==null?void 0:s({model:e}))!=null?p:e.supportedUrls,async doGenerate(f){const m=await d({params:f,type:"generate"}),h=async()=>e.doGenerate(m);return r?r({doGenerate:h,doStream:async()=>e.doStream(m),params:m,model:e}):h()},async doStream(f){const m=await d({params:f,type:"stream"}),h=async()=>e.doGenerate(m),g=async()=>e.doStream(m);return n?n({doGenerate:h,doStream:g,params:m,model:e}):g()}}},Sx=({model:e,middleware:t,modelId:r,providerId:n})=>[...Er(t)].reverse().reduce((a,o)=>Ex({model:a,middleware:o,modelId:r,providerId:n}),e),Ex=({model:e,middleware:{transformParams:t,wrapEmbed:r,overrideProvider:n,overrideModelId:a,overrideMaxEmbeddingsPerCall:o,overrideSupportsParallelCalls:s},modelId:i,providerId:l})=>{var u,c,p,d;async function f({params:m}){return t?await t({params:m,model:e}):m}return{specificationVersion:"v3",provider:(u=l??(n==null?void 0:n({model:e})))!=null?u:e.provider,modelId:(c=i??(a==null?void 0:a({model:e})))!=null?c:e.modelId,maxEmbeddingsPerCall:(p=o==null?void 0:o({model:e}))!=null?p:e.maxEmbeddingsPerCall,supportsParallelCalls:(d=s==null?void 0:s({model:e}))!=null?d:e.supportsParallelCalls,async doEmbed(m){const h=await f({params:m}),g=async()=>e.doEmbed(h);return r?r({doEmbed:g,params:h,model:e}):g()}}},Si=({model:e,middleware:t,modelId:r,providerId:n})=>[...Er(t)].reverse().reduce((a,o)=>xx({model:a,middleware:o,modelId:r,providerId:n}),e),xx=({model:e,middleware:{transformParams:t,wrapGenerate:r,overrideProvider:n,overrideModelId:a,overrideMaxImagesPerCall:o},modelId:s,providerId:i})=>{var l,u,c;async function p({params:m}){return t?await t({params:m,model:e}):m}const d=(l=o==null?void 0:o({model:e}))!=null?l:e.maxImagesPerCall,f=d instanceof Function?d.bind(e):d;return{specificationVersion:"v3",provider:(u=i??(n==null?void 0:n({model:e})))!=null?u:e.provider,modelId:(c=s??(a==null?void 0:a({model:e})))!=null?c:e.modelId,maxImagesPerCall:f,async doGenerate(m){const h=await p({params:m}),g=async()=>e.doGenerate(h);return r?r({doGenerate:g,params:h,model:e}):g()}}};function Qh(e){if("specificationVersion"in e&&e.specificationVersion==="v3")return e;const t=e;return{specificationVersion:"v3",languageModel:r=>uh(t.languageModel(r)),embeddingModel:r=>ih(t.textEmbeddingModel(r)),imageModel:r=>lh(t.imageModel(r)),transcriptionModel:t.transcriptionModel?r=>fh(t.transcriptionModel(r)):void 0,speechModel:t.speechModel?r=>ph(t.speechModel(r)):void 0,rerankingModel:void 0}}function Rx({provider:e,languageModelMiddleware:t,imageModelMiddleware:r}){const n=Qh(e);return{specificationVersion:"v3",languageModel:a=>Ti({model:n.languageModel(a),middleware:t}),embeddingModel:n.embeddingModel,imageModel:a=>{let o=n.imageModel(a);return r!=null&&(o=Si({model:o,middleware:r})),o},transcriptionModel:n.transcriptionModel,speechModel:n.speechModel,rerankingModel:n.rerankingModel}}function em({languageModels:e,embeddingModels:t,imageModels:r,transcriptionModels:n,speechModels:a,rerankingModels:o,fallbackProvider:s}){const i=s?Qh(s):void 0;return{specificationVersion:"v3",languageModel(l){if(e!=null&&l in e)return e[l];if(i)return i.languageModel(l);throw new lt({modelId:l,modelType:"languageModel"})},embeddingModel(l){if(t!=null&&l in t)return t[l];if(i)return i.embeddingModel(l);throw new lt({modelId:l,modelType:"embeddingModel"})},imageModel(l){if(r!=null&&l in r)return r[l];if(i!=null&&i.imageModel)return i.imageModel(l);throw new lt({modelId:l,modelType:"imageModel"})},transcriptionModel(l){if(n!=null&&l in n)return n[l];if(i!=null&&i.transcriptionModel)return i.transcriptionModel(l);throw new lt({modelId:l,modelType:"transcriptionModel"})},speechModel(l){if(a!=null&&l in a)return a[l];if(i!=null&&i.speechModel)return i.speechModel(l);throw new lt({modelId:l,modelType:"speechModel"})},rerankingModel(l){if(o!=null&&l in o)return o[l];if(i!=null&&i.rerankingModel)return i.rerankingModel(l);throw new lt({modelId:l,modelType:"rerankingModel"})}}}var Mx=em,tm="AI_NoSuchProviderError",rm=`vercel.ai.error.${tm}`,Ox=Symbol.for(rm),nm,am=class extends lt{constructor({modelId:e,modelType:t,providerId:r,availableProviders:n,message:a=`No such provider: ${r} (available providers: ${n.join()})`}){super({errorName:tm,modelId:e,modelType:t,message:a}),this[nm]=!0,this.providerId=r,this.availableProviders=n}static isInstance(e){return C.hasMarker(e,rm)}};nm=Ox;function om(e,{separator:t=":",languageModelMiddleware:r,imageModelMiddleware:n}={}){const a=new Cx({separator:t,languageModelMiddleware:r,imageModelMiddleware:n});for(const[o,s]of Object.entries(e))a.registerProvider({id:o,provider:s});return a}var kx=om,Cx=class{constructor({separator:e,languageModelMiddleware:t,imageModelMiddleware:r}){this.providers={},this.separator=e,this.languageModelMiddleware=t,this.imageModelMiddleware=r}registerProvider({id:e,provider:t}){this.providers[e]=t}getProvider(e,t){const r=this.providers[e];if(r==null)throw new am({modelId:e,modelType:t,providerId:e,availableProviders:Object.keys(this.providers)});return r}splitId(e,t){const r=e.indexOf(this.separator);if(r===-1)throw new lt({modelId:e,modelType:t,message:`Invalid ${t} id for registry: ${e} (must be in the format "providerId${this.separator}modelId")`});return[e.slice(0,r),e.slice(r+this.separator.length)]}languageModel(e){var t,r;const[n,a]=this.splitId(e,"languageModel");let o=(r=(t=this.getProvider(n,"languageModel")).languageModel)==null?void 0:r.call(t,a);if(o==null)throw new lt({modelId:e,modelType:"languageModel"});return this.languageModelMiddleware!=null&&(o=Ti({model:o,middleware:this.languageModelMiddleware})),o}embeddingModel(e){var t;const[r,n]=this.splitId(e,"embeddingModel"),a=this.getProvider(r,"embeddingModel"),o=(t=a.embeddingModel)==null?void 0:t.call(a,n);if(o==null)throw new lt({modelId:e,modelType:"embeddingModel"});return o}imageModel(e){var t;const[r,n]=this.splitId(e,"imageModel"),a=this.getProvider(r,"imageModel");let o=(t=a.imageModel)==null?void 0:t.call(a,n);if(o==null)throw new lt({modelId:e,modelType:"imageModel"});return this.imageModelMiddleware!=null&&(o=Si({model:o,middleware:this.imageModelMiddleware})),o}transcriptionModel(e){var t;const[r,n]=this.splitId(e,"transcriptionModel"),a=this.getProvider(r,"transcriptionModel"),o=(t=a.transcriptionModel)==null?void 0:t.call(a,n);if(o==null)throw new lt({modelId:e,modelType:"transcriptionModel"});return o}speechModel(e){var t;const[r,n]=this.splitId(e,"speechModel"),a=this.getProvider(r,"speechModel"),o=(t=a.speechModel)==null?void 0:t.call(a,n);if(o==null)throw new lt({modelId:e,modelType:"speechModel"});return o}rerankingModel(e){var t;const[r,n]=this.splitId(e,"rerankingModel"),a=this.getProvider(r,"rerankingModel"),o=(t=a.rerankingModel)==null?void 0:t.call(a,n);if(o==null)throw new lt({modelId:e,modelType:"rerankingModel"});return o}};async function Ax({model:e,documents:t,query:r,topN:n,maxRetries:a,abortSignal:o,headers:s,providerOptions:i,experimental_telemetry:l}){if(t.length===0)return new Hu({originalDocuments:[],ranking:[],providerMetadata:void 0,response:{timestamp:new Date,modelId:e.modelId}});const{maxRetries:u,retry:c}=Zt({maxRetries:a,abortSignal:o}),p=typeof t[0]=="string"?{type:"text",values:t}:{type:"object",values:t},d=tn({model:e,telemetry:l,headers:s,settings:{maxRetries:u}}),f=rn(l);return tt({name:"ai.rerank",attributes:le({telemetry:l,attributes:{...et({operationId:"ai.rerank",telemetry:l}),...d,"ai.documents":{input:()=>t.map(m=>JSON.stringify(m))}}}),tracer:f,fn:async()=>{var m,h;const{ranking:g,response:w,providerMetadata:b,warnings:y}=await c(()=>tt({name:"ai.rerank.doRerank",attributes:le({telemetry:l,attributes:{...et({operationId:"ai.rerank.doRerank",telemetry:l}),...d,"ai.documents":{input:()=>t.map(T=>JSON.stringify(T))}}}),tracer:f,fn:async T=>{const x=await e.doRerank({documents:p,query:r,topN:n,providerOptions:i,abortSignal:o,headers:s}),R=x.ranking;return T.setAttributes(await le({telemetry:l,attributes:{"ai.ranking.type":p.type,"ai.ranking":{output:()=>R.map(I=>JSON.stringify(I))}}})),{ranking:R,providerMetadata:x.providerMetadata,response:x.response,warnings:x.warnings}}}));return yt({warnings:y??[],provider:e.provider,model:e.modelId}),new Hu({originalDocuments:t,ranking:g.map(T=>({originalIndex:T.index,score:T.relevanceScore,document:t[T.index]})),providerMetadata:b,response:{id:w==null?void 0:w.id,timestamp:(m=w==null?void 0:w.timestamp)!=null?m:new Date,modelId:(h=w==null?void 0:w.modelId)!=null?h:e.modelId,headers:w==null?void 0:w.headers,body:w==null?void 0:w.body}})}})}var Hu=class{constructor(e){this.originalDocuments=e.originalDocuments,this.ranking=e.ranking,this.response=e.response,this.providerMetadata=e.providerMetadata}get rerankedDocuments(){return this.ranking.map(e=>e.document)}};async function Nx({model:e,audio:t,providerOptions:r={},maxRetries:n,abortSignal:a,headers:o}){const s=GS(e);if(!s)throw new Error("Model could not be resolved");const{retry:i}=Zt({maxRetries:n,abortSignal:a}),l=rt(o??{},`ai/${Rt}`),u=t instanceof URL?(await li({url:t})).data:wh(t),c=await i(()=>{var p;return s.doGenerate({audio:u,abortSignal:a,headers:l,providerOptions:r,mediaType:(p=Wt({data:u,signatures:gh}))!=null?p:"audio/wav"})});if(yt({warnings:c.warnings,provider:s.provider,model:s.modelId}),!c.text)throw new Nf({responses:[c.response]});return new Px({text:c.text,segments:c.segments,language:c.language,durationInSeconds:c.durationInSeconds,warnings:c.warnings,responses:[c.response],providerMetadata:c.providerMetadata})}var Px=class{constructor(e){var t;this.text=e.text,this.segments=e.segments,this.language=e.language,this.durationInSeconds=e.durationInSeconds,this.warnings=e.warnings,this.responses=e.responses,this.providerMetadata=(t=e.providerMetadata)!=null?t:{}}};async function $x({stream:e,onTextPart:t}){const r=e.pipeThrough(new TextDecoderStream).getReader();for(;;){const{done:n,value:a}=await r.read();if(n)break;await t(a)}}var Dx=()=>fetch;async function jx({api:e,prompt:t,credentials:r,headers:n,body:a,streamProtocol:o="data",setCompletion:s,setLoading:i,setError:l,setAbortController:u,onFinish:c,onError:p,fetch:d=Dx()}){var f;try{i(!0),l(void 0);const m=new AbortController;u(m),s("");const h=await d(e,{method:"POST",body:JSON.stringify({prompt:t,...a}),credentials:r,headers:rt({"Content-Type":"application/json",...n},`ai-sdk/${Rt}`,Cn()),signal:m.signal}).catch(w=>{throw w});if(!h.ok)throw new Error((f=await h.text())!=null?f:"Failed to fetch the chat response.");if(!h.body)throw new Error("The response body is empty.");let g="";switch(o){case"text":{await $x({stream:h.body,onTextPart:w=>{g+=w,s(g)}});break}case"data":{await ka({stream:Oo({stream:h.body,schema:gi}).pipeThrough(new TransformStream({async transform(w){if(!w.success)throw w.error;const b=w.value;if(b.type==="text-delta")g+=b.delta,s(g);else if(b.type==="error")throw new Error(b.errorText)}})),onError:w=>{throw w}});break}default:{const w=o;throw new Error(`Unknown stream protocol: ${w}`)}}return c&&c(t,g),u(null),g}catch(m){if(m.name==="AbortError")return u(null),null;m instanceof Error&&p&&p(m),l(m)}finally{i(!1)}}async function sm(e){if(e==null)return[];if(!globalThis.FileList||!(e instanceof globalThis.FileList))throw new Error("FileList is not supported in the current environment");return Promise.all(Array.from(e).map(async t=>{const{name:r,type:n}=t,a=await new Promise((o,s)=>{const i=new FileReader;i.onload=l=>{var u;o((u=l.target)==null?void 0:u.result)},i.onerror=l=>s(l),i.readAsDataURL(t)});return{type:"file",mediaType:n,filename:r,url:a}}))}var Ei=class{constructor({api:e="/api/chat",credentials:t,headers:r,body:n,fetch:a,prepareSendMessagesRequest:o,prepareReconnectToStreamRequest:s}){this.api=e,this.credentials=t,this.headers=r,this.body=n,this.fetch=a,this.prepareSendMessagesRequest=o,this.prepareReconnectToStreamRequest=s}async sendMessages({abortSignal:e,...t}){var r,n,a,o,s;const i=await Se(this.body),l=await Se(this.headers),u=await Se(this.credentials),c={...$r(l),...$r(t.headers)},p=await((r=this.prepareSendMessagesRequest)==null?void 0:r.call(this,{api:this.api,id:t.chatId,messages:t.messages,body:{...i,...t.body},headers:c,credentials:u,requestMetadata:t.metadata,trigger:t.trigger,messageId:t.messageId})),d=(n=p==null?void 0:p.api)!=null?n:this.api,f=(p==null?void 0:p.headers)!==void 0?$r(p.headers):c,m=(p==null?void 0:p.body)!==void 0?p.body:{...i,...t.body,id:t.chatId,messages:t.messages,trigger:t.trigger,messageId:t.messageId},h=(a=p==null?void 0:p.credentials)!=null?a:u,w=await((o=this.fetch)!=null?o:globalThis.fetch)(d,{method:"POST",headers:rt({"Content-Type":"application/json",...f},`ai-sdk/${Rt}`,Cn()),body:JSON.stringify(m),credentials:h,signal:e});if(!w.ok)throw new Error((s=await w.text())!=null?s:"Failed to fetch the chat response.");if(!w.body)throw new Error("The response body is empty.");return this.processResponseStream(w.body)}async reconnectToStream(e){var t,r,n,a,o;const s=await Se(this.body),i=await Se(this.headers),l=await Se(this.credentials),u={...$r(i),...$r(e.headers)},c=await((t=this.prepareReconnectToStreamRequest)==null?void 0:t.call(this,{api:this.api,id:e.chatId,body:{...s,...e.body},headers:u,credentials:l,requestMetadata:e.metadata})),p=(r=c==null?void 0:c.api)!=null?r:`${this.api}/${e.chatId}/stream`,d=(c==null?void 0:c.headers)!==void 0?$r(c.headers):u,f=(n=c==null?void 0:c.credentials)!=null?n:l,h=await((a=this.fetch)!=null?a:globalThis.fetch)(p,{method:"GET",headers:rt(d,`ai-sdk/${Rt}`,Cn()),credentials:f});if(h.status===204)return null;if(!h.ok)throw new Error((o=await h.text())!=null?o:"Failed to fetch the chat response.");if(!h.body)throw new Error("The response body is empty.");return this.processResponseStream(h.body)}},im=class extends Ei{constructor(e={}){super(e)}processResponseStream(e){return Oo({stream:e,schema:gi}).pipeThrough(new TransformStream({async transform(t,r){if(!t.success)throw t.error;r.enqueue(t.value)}}))}},zx=class{constructor({generateId:e=kn,id:t=e(),transport:r=new im,messageMetadataSchema:n,dataPartSchemas:a,state:o,onError:s,onToolCall:i,onFinish:l,onData:u,sendAutomaticallyWhen:c}){this.activeResponse=void 0,this.jobExecutor=new Xh,this.sendMessage=async(p,d)=>{var f,m,h,g;if(p==null){await this.makeRequest({trigger:"submit-message",messageId:(f=this.lastMessage)==null?void 0:f.id,...d});return}let w;if("text"in p||"files"in p?w={parts:[...Array.isArray(p.files)?p.files:await sm(p.files),..."text"in p&&p.text!=null?[{type:"text",text:p.text}]:[]]}:w=p,p.messageId!=null){const b=this.state.messages.findIndex(y=>y.id===p.messageId);if(b===-1)throw new Error(`message with id ${p.messageId} not found`);if(this.state.messages[b].role!=="user")throw new Error(`message with id ${p.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,b+1),this.state.replaceMessage(b,{...w,id:p.messageId,role:(m=w.role)!=null?m:"user",metadata:p.metadata})}else this.state.pushMessage({...w,id:(h=w.id)!=null?h:this.generateId(),role:(g=w.role)!=null?g:"user",metadata:p.metadata});await this.makeRequest({trigger:"submit-message",messageId:p.messageId,...d})},this.regenerate=async({messageId:p,...d}={})=>{const f=p==null?this.state.messages.length-1:this.state.messages.findIndex(m=>m.id===p);if(f===-1)throw new Error(`message ${p} not found`);this.state.messages=this.state.messages.slice(0,this.messages[f].role==="assistant"?f:f+1),await this.makeRequest({trigger:"regenerate-message",messageId:p,...d})},this.resumeStream=async(p={})=>{await this.makeRequest({trigger:"resume-stream",...p})},this.clearError=()=>{this.status==="error"&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolApprovalResponse=async({id:p,approved:d,reason:f})=>this.jobExecutor.run(async()=>{const m=this.state.messages,h=m[m.length-1],g=w=>jt(w)&&w.state==="approval-requested"&&w.approval.id===p?{...w,state:"approval-responded",approval:{id:p,approved:d,reason:f}}:w;this.state.replaceMessage(m.length-1,{...h,parts:h.parts.map(g)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(g)),this.status!=="streaming"&&this.status!=="submitted"&&this.sendAutomaticallyWhen&&this.shouldSendAutomatically().then(w=>{var b;w&&this.makeRequest({trigger:"submit-message",messageId:(b=this.lastMessage)==null?void 0:b.id})})}),this.addToolOutput=async({state:p="output-available",tool:d,toolCallId:f,output:m,errorText:h})=>this.jobExecutor.run(async()=>{const g=this.state.messages,w=g[g.length-1],b=y=>jt(y)&&y.toolCallId===f?{...y,state:p,output:m,errorText:h}:y;this.state.replaceMessage(g.length-1,{...w,parts:w.parts.map(b)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(b)),this.status!=="streaming"&&this.status!=="submitted"&&this.sendAutomaticallyWhen&&this.shouldSendAutomatically().then(y=>{var T;y&&this.makeRequest({trigger:"submit-message",messageId:(T=this.lastMessage)==null?void 0:T.id})})}),this.addToolResult=this.addToolOutput,this.stop=async()=>{var p;this.status!=="streaming"&&this.status!=="submitted"||(p=this.activeResponse)!=null&&p.abortController&&this.activeResponse.abortController.abort()},this.id=t,this.transport=r,this.generateId=e,this.messageMetadataSchema=n,this.dataPartSchemas=a,this.state=o,this.onError=s,this.onToolCall=i,this.onFinish=l,this.onData=u,this.sendAutomaticallyWhen=c}get status(){return this.state.status}setStatus({status:e,error:t}){this.status!==e&&(this.state.status=e,this.state.error=t)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(e){this.state.messages=e}async shouldSendAutomatically(){if(!this.sendAutomaticallyWhen)return!1;const e=this.sendAutomaticallyWhen({messages:this.state.messages});return e&&typeof e=="object"&&"then"in e?await e:e}async makeRequest({trigger:e,metadata:t,headers:r,body:n,messageId:a}){var o,s,i;this.setStatus({status:"submitted",error:void 0});const l=this.lastMessage;let u=!1,c=!1,p=!1;try{const d={state:vi({lastMessage:this.state.snapshot(l),messageId:this.generateId()}),abortController:new AbortController};d.abortController.signal.addEventListener("abort",()=>{u=!0}),this.activeResponse=d;let f;if(e==="resume-stream"){const h=await this.transport.reconnectToStream({chatId:this.id,metadata:t,headers:r,body:n});if(h==null){this.setStatus({status:"ready"});return}f=h}else f=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:d.abortController.signal,metadata:t,headers:r,body:n,trigger:e,messageId:a});const m=h=>this.jobExecutor.run(()=>h({state:d.state,write:()=>{var g;this.setStatus({status:"streaming"}),d.state.message.id===((g=this.lastMessage)==null?void 0:g.id)?this.state.replaceMessage(this.state.messages.length-1,d.state.message):this.state.pushMessage(d.state.message)}}));await ka({stream:yi({stream:f,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:m,onError:h=>{throw h}}),onError:h=>{throw h}}),this.setStatus({status:"ready"})}catch(d){if(u||d.name==="AbortError")return u=!0,this.setStatus({status:"ready"}),null;p=!0,d instanceof TypeError&&(d.message.toLowerCase().includes("fetch")||d.message.toLowerCase().includes("network"))&&(c=!0),this.onError&&d instanceof Error&&this.onError(d),this.setStatus({status:"error",error:d})}finally{try{(s=this.onFinish)==null||s.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:u,isDisconnect:c,isError:p,finishReason:(o=this.activeResponse)==null?void 0:o.state.finishReason})}catch(d){console.error(d)}this.activeResponse=void 0}!p&&await this.shouldSendAutomatically()&&await this.makeRequest({trigger:"submit-message",messageId:(i=this.lastMessage)==null?void 0:i.id,metadata:t,headers:r,body:n})}},Ux=class{constructor({agent:e,options:t,...r}){this.agent=e,this.agentOptions=t,this.uiMessageStreamOptions=r}async sendMessages({messages:e,abortSignal:t}){const r=await _i({messages:e,tools:this.agent.tools}),n=await bi(r,{tools:this.agent.tools});return(await this.agent.stream({prompt:n,abortSignal:t,...this.agentOptions!==void 0?{options:this.agentOptions}:{}})).toUIMessageStream(this.uiMessageStreamOptions)}async reconnectToStream(e){return null}};function Zx({messages:e}){const t=e[e.length-1];if(!t||t.role!=="assistant")return!1;const r=t.parts.reduce((a,o,s)=>o.type==="step-start"?s:a,-1),n=t.parts.slice(r+1).filter(jt).filter(a=>!a.providerExecuted);return n.filter(a=>a.state==="approval-responded").length>0&&n.every(a=>a.state==="output-available"||a.state==="output-error"||a.state==="approval-responded")}function qx({messages:e}){const t=e[e.length-1];if(!t||t.role!=="assistant")return!1;const r=t.parts.reduce((a,o,s)=>o.type==="step-start"?s:a,-1),n=t.parts.slice(r+1).filter(jt).filter(a=>!a.providerExecuted);return n.length>0&&n.every(a=>a.state==="output-available"||a.state==="output-error")}function Fx({stream:e}){return e.pipeThrough(new TransformStream({start(t){t.enqueue({type:"start"}),t.enqueue({type:"start-step"}),t.enqueue({type:"text-start",id:"text-1"})},async transform(t,r){r.enqueue({type:"text-delta",id:"text-1",delta:t})},async flush(t){t.enqueue({type:"text-end",id:"text-1"}),t.enqueue({type:"finish-step"}),t.enqueue({type:"finish"})}}))}var Lx=class extends Ei{constructor(e={}){super(e)}processResponseStream(e){return Fx({stream:e.pipeThrough(new TextDecoderStream)})}};const Vx=Object.freeze(Object.defineProperty({__proto__:null,AISDKError:C,APICallError:He,AbstractChat:zx,DefaultChatTransport:im,DefaultGeneratedFile:br,DirectChatTransport:Ux,DownloadError:Wa,EmptyResponseBodyError:Fc,Experimental_Agent:Lu,HttpChatTransport:Ei,InvalidArgumentError:ve,InvalidDataContentError:Cs,InvalidMessageRoleError:Qf,InvalidPromptError:Pr,InvalidResponseDataError:Zg,InvalidStreamPartError:SS,InvalidToolApprovalError:of,InvalidToolInputError:Ao,JSONParseError:xn,JsonToSseTransformStream:fi,LoadAPIKeyError:Hn,LoadSettingError:Vg,MessageConversionError:nh,MissingToolResultsError:Os,NoContentGeneratedError:Bg,NoImageGeneratedError:wf,NoObjectGeneratedError:dt,NoOutputGeneratedError:si,NoSpeechGeneratedError:Of,NoSuchModelError:lt,NoSuchProviderError:am,NoSuchToolError:vo,NoTranscriptGeneratedError:Nf,NoVideoGeneratedError:Df,Output:Ph,RetryError:As,SerialJobExecutor:Xh,TextStreamChatTransport:Lx,TooManyEmbeddingValuesForCallError:id,ToolCallNotFoundForApprovalError:No,ToolCallRepairError:Lf,ToolLoopAgent:Lu,TypeValidationError:We,UIMessageStreamError:Dr,UI_MESSAGE_STREAM_HEADERS:hi,UnsupportedFunctionalityError:_r,UnsupportedModelVersionError:en,addToolInputExamplesMiddleware:Ix,asSchema:or,assistantModelMessageSchema:xh,callCompletionApi:jx,consumeStream:ka,convertFileListToFileUIParts:sm,convertToModelMessages:bi,cosineSimilarity:QE,createAgentUIStream:Ii,createAgentUIStreamResponse:DE,createGateway:qp,createIdGenerator:jn,createProviderRegistry:om,createTextStreamResponse:di,createUIMessageStream:NE,createUIMessageStreamResponse:mi,customProvider:em,defaultEmbeddingSettingsMiddleware:hx,defaultSettingsMiddleware:mx,dynamicTool:B0,embed:zE,embedMany:ZE,experimental_createProviderRegistry:kx,experimental_customProvider:Mx,experimental_generateImage:VE,experimental_generateSpeech:sx,experimental_generateVideo:dx,experimental_transcribe:Nx,extractJsonMiddleware:vx,extractReasoningMiddleware:wx,gateway:Fp,generateId:kn,generateImage:Hh,generateObject:KE,generateText:Zh,getStaticToolName:bo,getTextFromDataUrl:ex,getToolName:Qn,getToolOrDynamicToolName:ME,hasToolCall:_E,isDataUIPart:Xa,isDeepEqualData:da,isFileUIPart:eo,isReasoningUIPart:$s,isStaticToolUIPart:wo,isTextUIPart:Qa,isToolOrDynamicToolUIPart:RE,isToolUIPart:jt,jsonSchema:Sa,lastAssistantMessageIsCompleteWithApprovalResponses:Zx,lastAssistantMessageIsCompleteWithToolCalls:qx,modelMessageSchema:Mh,parseJsonEventStream:Oo,parsePartialJson:nn,pipeAgentUIStreamToResponse:jE,pipeTextStreamToResponse:pi,pipeUIMessageStreamToResponse:wi,pruneMessages:lx,readUIMessageStream:PE,rerank:Ax,safeValidateUIMessages:Jh,simulateReadableStream:tx,simulateStreamingMiddleware:bx,smoothStream:cx,stepCountIs:zo,streamObject:nx,streamText:Bh,systemModelMessageSchema:Sh,tool:G0,toolModelMessageSchema:Rh,uiMessageChunkSchema:gi,userModelMessageSchema:Eh,validateUIMessages:_i,wrapEmbeddingModel:Sx,wrapImageModel:Si,wrapLanguageModel:Ti,wrapProvider:Rx,zodSchema:me},Symbol.toStringTag,{value:"Module"}));export{Bi as default};
