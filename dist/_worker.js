var Ir=Object.defineProperty;var jt=e=>{throw TypeError(e)};var _r=(e,t,r)=>t in e?Ir(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var m=(e,t,r)=>_r(e,typeof t!="symbol"?t+"":t,r),ct=(e,t,r)=>t.has(e)||jt("Cannot "+r);var f=(e,t,r)=>(ct(e,t,"read from private field"),r?r.call(e):t.get(e)),A=(e,t,r)=>t.has(e)?jt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),E=(e,t,r,n)=>(ct(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),S=(e,t,r)=>(ct(e,t,"access private method"),r);var Mt=(e,t,r,n)=>({set _(s){E(e,t,s,r)},get _(){return f(e,t,n)}});var rr={Stringify:1},_=(e,t)=>{const r=new String(e);return r.isEscaped=!0,r.callbacks=t,r},Fr=/[&<>'"]/,nr=async(e,t)=>{let r="";t||(t=[]);const n=await Promise.all(e);for(let s=n.length-1;r+=n[s],s--,!(s<0);s--){let i=n[s];typeof i=="object"&&t.push(...i.callbacks||[]);const a=i.isEscaped;if(i=await(typeof i=="object"?i.toString():i),typeof i=="object"&&t.push(...i.callbacks||[]),i.isEscaped??a)r+=i;else{const o=[r];ne(i,o),r=o[0]}}return _(r,t)},ne=(e,t)=>{const r=e.search(Fr);if(r===-1){t[0]+=e;return}let n,s,i=0;for(s=r;s<e.length;s++){switch(e.charCodeAt(s)){case 34:n="&quot;";break;case 39:n="&#39;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}t[0]+=e.substring(i,s)+n,i=s+1}t[0]+=e.substring(i,s)},sr=e=>{const t=e.callbacks;if(!(t!=null&&t.length))return e;const r=[e],n={};return t.forEach(s=>s({phase:rr.Stringify,buffer:r,context:n})),r[0]},ir=async(e,t,r,n,s)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const i=e.callbacks;return i!=null&&i.length?(s?s[0]+=e:s=[e],Promise.all(i.map(o=>o({phase:t,buffer:s,context:n}))).then(o=>Promise.all(o.filter(Boolean).map(l=>ir(l,t,!1,n,s))).then(()=>s[0]))):Promise.resolve(e)},Br=(e,...t)=>{const r=[""];for(let n=0,s=e.length-1;n<s;n++){r[0]+=e[n];const i=Array.isArray(t[n])?t[n].flat(1/0):[t[n]];for(let a=0,o=i.length;a<o;a++){const l=i[a];if(typeof l=="string")ne(l,r);else if(typeof l=="number")r[0]+=l;else{if(typeof l=="boolean"||l===null||l===void 0)continue;if(typeof l=="object"&&l.isEscaped)if(l.callbacks)r.unshift("",l);else{const c=l.toString();c instanceof Promise?r.unshift("",c):r[0]+=c}else l instanceof Promise?r.unshift("",l):ne(l.toString(),r)}}}return r[0]+=e.at(-1),r.length===1?"callbacks"in r?_(sr(_(r[0],r.callbacks))):_(r[0]):nr(r,r.callbacks)},Rt=Symbol("RENDERER"),wt=Symbol("ERROR_HANDLER"),T=Symbol("STASH"),ar=Symbol("INTERNAL"),qr=Symbol("MEMO"),st=Symbol("PERMALINK"),$t=e=>(e[ar]=!0,e),or=e=>({value:t,children:r})=>{if(!r)return;const n={children:[{tag:$t(()=>{e.push(t)}),props:{}}]};Array.isArray(r)?n.children.push(...r.flat()):n.children.push(r),n.children.push({tag:$t(()=>{e.pop()}),props:{}});const s={tag:"",props:n,type:""};return s[wt]=i=>{throw e.pop(),i},s},lr=e=>{const t=[e],r=or(t);return r.values=t,r.Provider=r,Se.push(r),r},Se=[],Ot=e=>{const t=[e],r=(n=>{t.push(n.value);let s;try{s=n.children?(Array.isArray(n.children)?new hr("",{},n.children):n.children).toString():""}finally{t.pop()}return s instanceof Promise?s.then(i=>_(i,i.callbacks)):_(s)});return r.values=t,r.Provider=r,r[Rt]=or(t),Se.push(r),r},Ce=e=>e.values.at(-1),Xe={title:[],script:["src"],style:["data-href"],link:["href"],meta:["name","httpEquiv","charset","itemProp"]},Et={},Ye="data-precedence",Ue=e=>Array.isArray(e)?e:[e],Nt=new WeakMap,Ht=(e,t,r,n)=>({buffer:s,context:i})=>{if(!s)return;const a=Nt.get(i)||{};Nt.set(i,a);const o=a[e]||(a[e]=[]);let l=!1;const c=Xe[e];if(c.length>0){e:for(const[,u]of o)for(const h of c)if(((u==null?void 0:u[h])??null)===(r==null?void 0:r[h])){l=!0;break e}}if(l?s[0]=s[0].replaceAll(t,""):c.length>0?o.push([t,r,n]):o.unshift([t,r,n]),s[0].indexOf("</head>")!==-1){let u;if(n===void 0)u=o.map(([h])=>h);else{const h=[];u=o.map(([d,,p])=>{let y=h.indexOf(p);return y===-1&&(h.push(p),y=h.length-1),[d,y]}).sort((d,p)=>d[1]-p[1]).map(([d])=>d)}u.forEach(h=>{s[0]=s[0].replaceAll(h,"")}),s[0]=s[0].replace(/(?=<\/head>)/,u.join(""))}},We=(e,t,r)=>_(new U(e,r,Ue(t??[])).toString()),Ke=(e,t,r,n)=>{if("itemProp"in r)return We(e,t,r);let{precedence:s,blocking:i,...a}=r;s=n?s??"":void 0,n&&(a[Ye]=s);const o=new U(e,a,Ue(t||[])).toString();return o instanceof Promise?o.then(l=>_(o,[...l.callbacks||[],Ht(e,l,a,s)])):_(o,[Ht(e,o,a,s)])},Ur=({children:e,...t})=>{const r=St();if(r){const n=Ce(r);if(n==="svg"||n==="head")return new U("title",t,Ue(e??[]))}return Ke("title",e,t,!1)},Wr=({children:e,...t})=>{const r=St();return["src","async"].some(n=>!t[n])||r&&Ce(r)==="head"?We("script",e,t):Ke("script",e,t,!1)},Kr=({children:e,...t})=>["href","precedence"].every(r=>r in t)?(t["data-href"]=t.href,delete t.href,Ke("style",e,t,!0)):We("style",e,t),zr=({children:e,...t})=>["onLoad","onError"].some(r=>r in t)||t.rel==="stylesheet"&&(!("precedence"in t)||"disabled"in t)?We("link",e,t):Ke("link",e,t,"precedence"in t),Gr=({children:e,...t})=>{const r=St();return r&&Ce(r)==="head"?We("meta",e,t):Ke("meta",e,t,!1)},cr=(e,{children:t,...r})=>new U(e,r,Ue(t??[])),Vr=e=>(typeof e.action=="function"&&(e.action=st in e.action?e.action[st]:void 0),cr("form",e)),fr=(e,t)=>(typeof t.formAction=="function"&&(t.formAction=st in t.formAction?t.formAction[st]:void 0),cr(e,t)),Jr=e=>fr("input",e),Xr=e=>fr("button",e);const ft=Object.freeze(Object.defineProperty({__proto__:null,button:Xr,form:Vr,input:Jr,link:zr,meta:Gr,script:Wr,style:Kr,title:Ur},Symbol.toStringTag,{value:"Module"}));var Yr=new Map([["className","class"],["htmlFor","for"],["crossOrigin","crossorigin"],["httpEquiv","http-equiv"],["itemProp","itemprop"],["fetchPriority","fetchpriority"],["noModule","nomodule"],["formAction","formaction"]]),it=e=>Yr.get(e)||e,ur=(e,t)=>{for(const[r,n]of Object.entries(e)){const s=r[0]==="-"||!/[A-Z]/.test(r)?r:r.replace(/[A-Z]/g,i=>`-${i.toLowerCase()}`);t(s,n==null?null:typeof n=="number"?s.match(/^(?:a|border-im|column(?:-c|s)|flex(?:$|-[^b])|grid-(?:ar|[^a])|font-w|li|or|sca|st|ta|wido|z)|ty$/)?`${n}`:`${n}px`:n)}},Ne=void 0,St=()=>Ne,Zr=e=>/[A-Z]/.test(e)&&e.match(/^(?:al|basel|clip(?:Path|Rule)$|co|do|fill|fl|fo|gl|let|lig|i|marker[EMS]|o|pai|pointe|sh|st[or]|text[^L]|tr|u|ve|w)/)?e.replace(/([A-Z])/g,"-$1").toLowerCase():e,Qr=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],en=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","download","formnovalidate","hidden","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Pt=(e,t)=>{for(let r=0,n=e.length;r<n;r++){const s=e[r];if(typeof s=="string")ne(s,t);else{if(typeof s=="boolean"||s===null||s===void 0)continue;s instanceof U?s.toStringToBuffer(t):typeof s=="number"||s.isEscaped?t[0]+=s:s instanceof Promise?t.unshift("",s):Pt(s,t)}}},U=class{constructor(e,t,r){m(this,"tag");m(this,"props");m(this,"key");m(this,"children");m(this,"isEscaped",!0);m(this,"localContexts");this.tag=e,this.props=t,this.children=r}get type(){return this.tag}get ref(){return this.props.ref||null}toString(){var t,r;const e=[""];(t=this.localContexts)==null||t.forEach(([n,s])=>{n.values.push(s)});try{this.toStringToBuffer(e)}finally{(r=this.localContexts)==null||r.forEach(([n])=>{n.values.pop()})}return e.length===1?"callbacks"in e?sr(_(e[0],e.callbacks)).toString():e[0]:nr(e,e.callbacks)}toStringToBuffer(e){const t=this.tag,r=this.props;let{children:n}=this;e[0]+=`<${t}`;const s=Ne&&Ce(Ne)==="svg"?i=>Zr(it(i)):i=>it(i);for(let[i,a]of Object.entries(r))if(i=s(i),i!=="children"){if(i==="style"&&typeof a=="object"){let o="";ur(a,(l,c)=>{c!=null&&(o+=`${o?";":""}${l}:${c}`)}),e[0]+=' style="',ne(o,e),e[0]+='"'}else if(typeof a=="string")e[0]+=` ${i}="`,ne(a,e),e[0]+='"';else if(a!=null)if(typeof a=="number"||a.isEscaped)e[0]+=` ${i}="${a}"`;else if(typeof a=="boolean"&&en.includes(i))a&&(e[0]+=` ${i}=""`);else if(i==="dangerouslySetInnerHTML"){if(n.length>0)throw new Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");n=[_(a.__html)]}else if(a instanceof Promise)e[0]+=` ${i}="`,e.unshift('"',a);else if(typeof a=="function"){if(!i.startsWith("on")&&i!=="ref")throw new Error(`Invalid prop '${i}' of type 'function' supplied to '${t}'.`)}else e[0]+=` ${i}="`,ne(a.toString(),e),e[0]+='"'}if(Qr.includes(t)&&n.length===0){e[0]+="/>";return}e[0]+=">",Pt(n,e),e[0]+=`</${t}>`}},ut=class extends U{toStringToBuffer(e){const{children:t}=this,r={...this.props};t.length&&(r.children=t.length===1?t[0]:t);const n=this.tag.call(null,r);if(!(typeof n=="boolean"||n==null))if(n instanceof Promise)if(Se.length===0)e.unshift("",n);else{const s=Se.map(i=>[i,i.values.at(-1)]);e.unshift("",n.then(i=>(i instanceof U&&(i.localContexts=s),i)))}else n instanceof U?n.toStringToBuffer(e):typeof n=="number"||n.isEscaped?(e[0]+=n,n.callbacks&&(e.callbacks||(e.callbacks=[]),e.callbacks.push(...n.callbacks))):ne(n,e)}},hr=class extends U{toStringToBuffer(e){Pt(this.children,e)}},Dt=(e,t,...r)=>{t??(t={}),r.length&&(t.children=r.length===1?r[0]:r);const n=t.key;delete t.key;const s=Ze(e,t,r);return s.key=n,s},Lt=!1,Ze=(e,t,r)=>{if(!Lt){for(const n in Et)ft[n][Rt]=Et[n];Lt=!0}return typeof e=="function"?new ut(e,t,r):ft[e]?new ut(ft[e],t,r):e==="svg"||e==="head"?(Ne||(Ne=Ot("")),new U(e,t,[new ut(Ne,{value:e},r)])):new U(e,t,r)},tn=({children:e})=>new hr("",{children:e},Array.isArray(e)?e:e?[e]:[]);function v(e,t,r){let n;if(!t||!("children"in t))n=Ze(e,t,[]);else{const s=t.children;n=Array.isArray(s)?Ze(e,t,s):Ze(e,t,[s])}return n.key=r,n}var It=(e,t,r)=>(n,s)=>{let i=-1;return a(0);async function a(o){if(o<=i)throw new Error("next() called multiple times");i=o;let l,c=!1,u;if(e[o]?(u=e[o][0][0],n.req.routeIndex=o):u=o===e.length&&s||void 0,u)try{l=await u(n,()=>a(o+1))}catch(h){if(h instanceof Error&&t)n.error=h,l=await t(h,n),c=!0;else throw h}else n.finalized===!1&&r&&(l=await r(n));return l&&(n.finalized===!1||c)&&(n.res=l),n}},rn=Symbol(),nn=async(e,t=Object.create(null))=>{const{all:r=!1,dot:n=!1}=t,i=(e instanceof mr?e.raw.headers:e.headers).get("Content-Type");return i!=null&&i.startsWith("multipart/form-data")||i!=null&&i.startsWith("application/x-www-form-urlencoded")?sn(e,{all:r,dot:n}):{}};async function sn(e,t){const r=await e.formData();return r?an(r,t):{}}function an(e,t){const r=Object.create(null);return e.forEach((n,s)=>{t.all||s.endsWith("[]")?on(r,s,n):r[s]=n}),t.dot&&Object.entries(r).forEach(([n,s])=>{n.includes(".")&&(ln(r,n,s),delete r[n])}),r}var on=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:t.endsWith("[]")?e[t]=[r]:e[t]=r},ln=(e,t,r)=>{let n=e;const s=t.split(".");s.forEach((i,a)=>{a===s.length-1?n[i]=r:((!n[i]||typeof n[i]!="object"||Array.isArray(n[i])||n[i]instanceof File)&&(n[i]=Object.create(null)),n=n[i])})},dr=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},cn=e=>{const{groups:t,path:r}=fn(e),n=dr(r);return un(n,t)},fn=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,n)=>{const s=`@${n}`;return t.push([s,r]),s}),{groups:t,path:e}},un=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[n]=t[r];for(let s=e.length-1;s>=0;s--)if(e[s].includes(n)){e[s]=e[s].replace(n,t[r][1]);break}}return e},Ve={},hn=(e,t)=>{if(e==="*")return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const n=`${e}#${t}`;return Ve[n]||(r[2]?Ve[n]=t&&t[0]!==":"&&t[0]!=="*"?[n,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:Ve[n]=[e,r[1],!0]),Ve[n]}return null},Ct=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},dn=e=>Ct(e,decodeURI),pr=e=>{const t=e.url,r=t.indexOf("/",t.indexOf(":")+4);let n=r;for(;n<t.length;n++){const s=t.charCodeAt(n);if(s===37){const i=t.indexOf("?",n),a=t.slice(r,i===-1?void 0:i);return dn(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(s===63)break}return t.slice(r,n)},pn=e=>{const t=pr(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},ge=(e,t,...r)=>(r.length&&(t=ge(t,...r)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),vr=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),r=[];let n="";return t.forEach(s=>{if(s!==""&&!/\:/.test(s))n+="/"+s;else if(/\:/.test(s))if(/\?/.test(s)){r.length===0&&n===""?r.push("/"):r.push(n);const i=s.replace("?","");n+="/"+i,r.push(n)}else n+="/"+s}),r.filter((s,i,a)=>a.indexOf(s)===i)},ht=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?Ct(e,yr):e):e,gr=(e,t,r)=>{let n;if(!r&&t&&!/[%+]/.test(t)){let a=e.indexOf("?",8);if(a===-1)return;for(e.startsWith(t,a+1)||(a=e.indexOf(`&${t}`,a+1));a!==-1;){const o=e.charCodeAt(a+t.length+1);if(o===61){const l=a+t.length+2,c=e.indexOf("&",l);return ht(e.slice(l,c===-1?void 0:c))}else if(o==38||isNaN(o))return"";a=e.indexOf(`&${t}`,a+1)}if(n=/[%+]/.test(e),!n)return}const s={};n??(n=/[%+]/.test(e));let i=e.indexOf("?",8);for(;i!==-1;){const a=e.indexOf("&",i+1);let o=e.indexOf("=",i);o>a&&a!==-1&&(o=-1);let l=e.slice(i+1,o===-1?a===-1?void 0:a:o);if(n&&(l=ht(l)),i=a,l==="")continue;let c;o===-1?c="":(c=e.slice(o+1,a===-1?void 0:a),n&&(c=ht(c))),r?(s[l]&&Array.isArray(s[l])||(s[l]=[]),s[l].push(c)):s[l]??(s[l]=c)}return t?s[t]:s},vn=gr,gn=(e,t)=>gr(e,t,!0),yr=decodeURIComponent,_t=e=>Ct(e,yr),we,I,X,wr,Er,bt,Y,Xt,mr=(Xt=class{constructor(e,t="/",r=[[]]){A(this,X);m(this,"raw");A(this,we);A(this,I);m(this,"routeIndex",0);m(this,"path");m(this,"bodyCache",{});A(this,Y,e=>{const{bodyCache:t,raw:r}=this,n=t[e];if(n)return n;const s=Object.keys(t)[0];return s?t[s].then(i=>(s==="json"&&(i=JSON.stringify(i)),new Response(i)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,E(this,I,r),E(this,we,{})}param(e){return e?S(this,X,wr).call(this,e):S(this,X,Er).call(this)}query(e){return vn(this.url,e)}queries(e){return gn(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((r,n)=>{t[n]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await nn(this,e))}json(){return f(this,Y).call(this,"text").then(e=>JSON.parse(e))}text(){return f(this,Y).call(this,"text")}arrayBuffer(){return f(this,Y).call(this,"arrayBuffer")}blob(){return f(this,Y).call(this,"blob")}formData(){return f(this,Y).call(this,"formData")}addValidatedData(e,t){f(this,we)[e]=t}valid(e){return f(this,we)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[rn](){return f(this,I)}get matchedRoutes(){return f(this,I)[0].map(([[,e]])=>e)}get routePath(){return f(this,I)[0].map(([[,e]])=>e)[this.routeIndex].path}},we=new WeakMap,I=new WeakMap,X=new WeakSet,wr=function(e){const t=f(this,I)[0][this.routeIndex][1][e],r=S(this,X,bt).call(this,t);return r&&/\%/.test(r)?_t(r):r},Er=function(){const e={},t=Object.keys(f(this,I)[0][this.routeIndex][1]);for(const r of t){const n=S(this,X,bt).call(this,f(this,I)[0][this.routeIndex][1][r]);n!==void 0&&(e[r]=/\%/.test(n)?_t(n):n)}return e},bt=function(e){return f(this,I)[1]?f(this,I)[1][e]:e},Y=new WeakMap,Xt),yn="text/plain; charset=UTF-8",dt=(e,t)=>({"Content-Type":e,...t}),Le,Ie,z,Ee,G,D,_e,be,xe,oe,Fe,Be,Z,ye,Yt,mn=(Yt=class{constructor(e,t){A(this,Z);A(this,Le);A(this,Ie);m(this,"env",{});A(this,z);m(this,"finalized",!1);m(this,"error");A(this,Ee);A(this,G);A(this,D);A(this,_e);A(this,be);A(this,xe);A(this,oe);A(this,Fe);A(this,Be);m(this,"render",(...e)=>(f(this,be)??E(this,be,t=>this.html(t)),f(this,be).call(this,...e)));m(this,"setLayout",e=>E(this,_e,e));m(this,"getLayout",()=>f(this,_e));m(this,"setRenderer",e=>{E(this,be,e)});m(this,"header",(e,t,r)=>{this.finalized&&E(this,D,new Response(f(this,D).body,f(this,D)));const n=f(this,D)?f(this,D).headers:f(this,oe)??E(this,oe,new Headers);t===void 0?n.delete(e):r!=null&&r.append?n.append(e,t):n.set(e,t)});m(this,"status",e=>{E(this,Ee,e)});m(this,"set",(e,t)=>{f(this,z)??E(this,z,new Map),f(this,z).set(e,t)});m(this,"get",e=>f(this,z)?f(this,z).get(e):void 0);m(this,"newResponse",(...e)=>S(this,Z,ye).call(this,...e));m(this,"body",(e,t,r)=>S(this,Z,ye).call(this,e,t,r));m(this,"text",(e,t,r)=>!f(this,oe)&&!f(this,Ee)&&!t&&!r&&!this.finalized?new Response(e):S(this,Z,ye).call(this,e,t,dt(yn,r)));m(this,"json",(e,t,r)=>S(this,Z,ye).call(this,JSON.stringify(e),t,dt("application/json",r)));m(this,"html",(e,t,r)=>{const n=s=>S(this,Z,ye).call(this,s,t,dt("text/html; charset=UTF-8",r));return typeof e=="object"?ir(e,rr.Stringify,!1,{}).then(n):n(e)});m(this,"redirect",(e,t)=>{const r=String(e);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,t??302)});m(this,"notFound",()=>(f(this,xe)??E(this,xe,()=>new Response),f(this,xe).call(this,this)));E(this,Le,e),t&&(E(this,G,t.executionCtx),this.env=t.env,E(this,xe,t.notFoundHandler),E(this,Be,t.path),E(this,Fe,t.matchResult))}get req(){return f(this,Ie)??E(this,Ie,new mr(f(this,Le),f(this,Be),f(this,Fe))),f(this,Ie)}get event(){if(f(this,G)&&"respondWith"in f(this,G))return f(this,G);throw Error("This context has no FetchEvent")}get executionCtx(){if(f(this,G))return f(this,G);throw Error("This context has no ExecutionContext")}get res(){return f(this,D)||E(this,D,new Response(null,{headers:f(this,oe)??E(this,oe,new Headers)}))}set res(e){if(f(this,D)&&e){e=new Response(e.body,e);for(const[t,r]of f(this,D).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const n=f(this,D).headers.getSetCookie();e.headers.delete("set-cookie");for(const s of n)e.headers.append("set-cookie",s)}else e.headers.set(t,r)}E(this,D,e),this.finalized=!0}get var(){return f(this,z)?Object.fromEntries(f(this,z)):{}}},Le=new WeakMap,Ie=new WeakMap,z=new WeakMap,Ee=new WeakMap,G=new WeakMap,D=new WeakMap,_e=new WeakMap,be=new WeakMap,xe=new WeakMap,oe=new WeakMap,Fe=new WeakMap,Be=new WeakMap,Z=new WeakSet,ye=function(e,t,r){const n=f(this,D)?new Headers(f(this,D).headers):f(this,oe)??new Headers;if(typeof t=="object"&&"headers"in t){const i=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(const[a,o]of i)a.toLowerCase()==="set-cookie"?n.append(a,o):n.set(a,o)}if(r)for(const[i,a]of Object.entries(r))if(typeof a=="string")n.set(i,a);else{n.delete(i);for(const o of a)n.append(i,o)}const s=typeof t=="number"?t:(t==null?void 0:t.status)??f(this,Ee);return new Response(e,{status:s,headers:n})},Yt),j="ALL",wn="all",En=["get","post","put","delete","options","patch"],br="Can not add a route since the matcher is already built.",xr=class extends Error{},bn="__COMPOSED_HANDLER",xn=e=>e.text("404 Not Found",404),Ft=(e,t)=>{if("getResponse"in e){const r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},F,M,Ar,B,ie,Qe,et,Ae,An=(Ae=class{constructor(t={}){A(this,M);m(this,"get");m(this,"post");m(this,"put");m(this,"delete");m(this,"options");m(this,"patch");m(this,"all");m(this,"on");m(this,"use");m(this,"router");m(this,"getPath");m(this,"_basePath","/");A(this,F,"/");m(this,"routes",[]);A(this,B,xn);m(this,"errorHandler",Ft);m(this,"onError",t=>(this.errorHandler=t,this));m(this,"notFound",t=>(E(this,B,t),this));m(this,"fetch",(t,...r)=>S(this,M,et).call(this,t,r[1],r[0],t.method));m(this,"request",(t,r,n,s)=>t instanceof Request?this.fetch(r?new Request(t,r):t,n,s):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${ge("/",t)}`,r),n,s)));m(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(S(this,M,et).call(this,t.request,t,void 0,t.request.method))})});[...En,wn].forEach(i=>{this[i]=(a,...o)=>(typeof a=="string"?E(this,F,a):S(this,M,ie).call(this,i,f(this,F),a),o.forEach(l=>{S(this,M,ie).call(this,i,f(this,F),l)}),this)}),this.on=(i,a,...o)=>{for(const l of[a].flat()){E(this,F,l);for(const c of[i].flat())o.map(u=>{S(this,M,ie).call(this,c.toUpperCase(),f(this,F),u)})}return this},this.use=(i,...a)=>(typeof i=="string"?E(this,F,i):(E(this,F,"*"),a.unshift(i)),a.forEach(o=>{S(this,M,ie).call(this,j,f(this,F),o)}),this);const{strict:n,...s}=t;Object.assign(this,s),this.getPath=n??!0?t.getPath??pr:pn}route(t,r){const n=this.basePath(t);return r.routes.map(s=>{var a;let i;r.errorHandler===Ft?i=s.handler:(i=async(o,l)=>(await It([],r.errorHandler)(o,()=>s.handler(o,l))).res,i[bn]=s.handler),S(a=n,M,ie).call(a,s.method,s.path,i)}),this}basePath(t){const r=S(this,M,Ar).call(this);return r._basePath=ge(this._basePath,t),r}mount(t,r,n){let s,i;n&&(typeof n=="function"?i=n:(i=n.optionHandler,n.replaceRequest===!1?s=l=>l:s=n.replaceRequest));const a=i?l=>{const c=i(l);return Array.isArray(c)?c:[c]}:l=>{let c;try{c=l.executionCtx}catch{}return[l.env,c]};s||(s=(()=>{const l=ge(this._basePath,t),c=l==="/"?0:l.length;return u=>{const h=new URL(u.url);return h.pathname=h.pathname.slice(c)||"/",new Request(h,u)}})());const o=async(l,c)=>{const u=await r(s(l.req.raw),...a(l));if(u)return u;await c()};return S(this,M,ie).call(this,j,ge(t,"*"),o),this}},F=new WeakMap,M=new WeakSet,Ar=function(){const t=new Ae({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,E(t,B,f(this,B)),t.routes=this.routes,t},B=new WeakMap,ie=function(t,r,n){t=t.toUpperCase(),r=ge(this._basePath,r);const s={basePath:this._basePath,path:r,method:t,handler:n};this.router.add(t,r,[n,s]),this.routes.push(s)},Qe=function(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t},et=function(t,r,n,s){if(s==="HEAD")return(async()=>new Response(null,await S(this,M,et).call(this,t,r,n,"GET")))();const i=this.getPath(t,{env:n}),a=this.router.match(s,i),o=new mn(t,{path:i,matchResult:a,env:n,executionCtx:r,notFoundHandler:f(this,B)});if(a[0].length===1){let c;try{c=a[0][0][0][0](o,async()=>{o.res=await f(this,B).call(this,o)})}catch(u){return S(this,M,Qe).call(this,u,o)}return c instanceof Promise?c.then(u=>u||(o.finalized?o.res:f(this,B).call(this,o))).catch(u=>S(this,M,Qe).call(this,u,o)):c??f(this,B).call(this,o)}const l=It(a[0],this.errorHandler,f(this,B));return(async()=>{try{const c=await l(o);if(!c.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return c.res}catch(c){return S(this,M,Qe).call(this,c,o)}})()},Ae),Rr=[];function Rn(e,t){const r=this.buildAllMatchers(),n=((s,i)=>{const a=r[s]||r[j],o=a[2][i];if(o)return o;const l=i.match(a[0]);if(!l)return[[],Rr];const c=l.indexOf("",1);return[a[1][c],l]});return this.match=n,n(e,t)}var at="[^/]+",Me=".*",$e="(?:|/.*)",me=Symbol(),On=new Set(".\\+*[^]$()");function Sn(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===Me||e===$e?1:t===Me||t===$e?-1:e===at?1:t===at?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var le,ce,q,he,Pn=(he=class{constructor(){A(this,le);A(this,ce);A(this,q,Object.create(null))}insert(t,r,n,s,i){if(t.length===0){if(f(this,le)!==void 0)throw me;if(i)return;E(this,le,r);return}const[a,...o]=t,l=a==="*"?o.length===0?["","",Me]:["","",at]:a==="/*"?["","",$e]:a.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let c;if(l){const u=l[1];let h=l[2]||at;if(u&&l[2]&&(h===".*"||(h=h.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(h))))throw me;if(c=f(this,q)[h],!c){if(Object.keys(f(this,q)).some(d=>d!==Me&&d!==$e))throw me;if(i)return;c=f(this,q)[h]=new he,u!==""&&E(c,ce,s.varIndex++)}!i&&u!==""&&n.push([u,f(c,ce)])}else if(c=f(this,q)[a],!c){if(Object.keys(f(this,q)).some(u=>u.length>1&&u!==Me&&u!==$e))throw me;if(i)return;c=f(this,q)[a]=new he}c.insert(o,r,n,s,i)}buildRegExpStr(){const r=Object.keys(f(this,q)).sort(Sn).map(n=>{const s=f(this,q)[n];return(typeof f(s,ce)=="number"?`(${n})@${f(s,ce)}`:On.has(n)?`\\${n}`:n)+s.buildRegExpStr()});return typeof f(this,le)=="number"&&r.unshift(`#${f(this,le)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},le=new WeakMap,ce=new WeakMap,q=new WeakMap,he),ot,qe,Zt,Cn=(Zt=class{constructor(){A(this,ot,{varIndex:0});A(this,qe,new Pn)}insert(e,t,r){const n=[],s=[];for(let a=0;;){let o=!1;if(e=e.replace(/\{[^}]+\}/g,l=>{const c=`@\\${a}`;return s[a]=[c,l],a++,o=!0,c}),!o)break}const i=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=s.length-1;a>=0;a--){const[o]=s[a];for(let l=i.length-1;l>=0;l--)if(i[l].indexOf(o)!==-1){i[l]=i[l].replace(o,s[a][1]);break}}return f(this,qe).insert(i,t,n,f(this,ot),r),n}buildRegExp(){let e=f(this,qe).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],n=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(s,i,a)=>i!==void 0?(r[++t]=Number(i),"$()"):(a!==void 0&&(n[Number(a)]=++t),"")),[new RegExp(`^${e}`),r,n]}},ot=new WeakMap,qe=new WeakMap,Zt),Tn=[/^$/,[],Object.create(null)],tt=Object.create(null);function Or(e){return tt[e]??(tt[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function kn(){tt=Object.create(null)}function jn(e){var c;const t=new Cn,r=[];if(e.length===0)return Tn;const n=e.map(u=>[!/\*|\/:/.test(u[0]),...u]).sort(([u,h],[d,p])=>u?1:d?-1:h.length-p.length),s=Object.create(null);for(let u=0,h=-1,d=n.length;u<d;u++){const[p,y,w]=n[u];p?s[y]=[w.map(([x])=>[x,Object.create(null)]),Rr]:h++;let g;try{g=t.insert(y,h,p)}catch(x){throw x===me?new xr(y):x}p||(r[h]=w.map(([x,b])=>{const O=Object.create(null);for(b-=1;b>=0;b--){const[R,C]=g[b];O[R]=C}return[x,O]}))}const[i,a,o]=t.buildRegExp();for(let u=0,h=r.length;u<h;u++)for(let d=0,p=r[u].length;d<p;d++){const y=(c=r[u][d])==null?void 0:c[1];if(!y)continue;const w=Object.keys(y);for(let g=0,x=w.length;g<x;g++)y[w[g]]=o[y[w[g]]]}const l=[];for(const u in a)l[u]=r[a[u]];return[i,l,s]}function pe(e,t){if(e){for(const r of Object.keys(e).sort((n,s)=>s.length-n.length))if(Or(r).test(t))return[...e[r]]}}var Q,ee,lt,Sr,Qt,Mn=(Qt=class{constructor(){A(this,lt);m(this,"name","RegExpRouter");A(this,Q);A(this,ee);m(this,"match",Rn);E(this,Q,{[j]:Object.create(null)}),E(this,ee,{[j]:Object.create(null)})}add(e,t,r){var o;const n=f(this,Q),s=f(this,ee);if(!n||!s)throw new Error(br);n[e]||[n,s].forEach(l=>{l[e]=Object.create(null),Object.keys(l[j]).forEach(c=>{l[e][c]=[...l[j][c]]})}),t==="/*"&&(t="*");const i=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const l=Or(t);e===j?Object.keys(n).forEach(c=>{var u;(u=n[c])[t]||(u[t]=pe(n[c],t)||pe(n[j],t)||[])}):(o=n[e])[t]||(o[t]=pe(n[e],t)||pe(n[j],t)||[]),Object.keys(n).forEach(c=>{(e===j||e===c)&&Object.keys(n[c]).forEach(u=>{l.test(u)&&n[c][u].push([r,i])})}),Object.keys(s).forEach(c=>{(e===j||e===c)&&Object.keys(s[c]).forEach(u=>l.test(u)&&s[c][u].push([r,i]))});return}const a=vr(t)||[t];for(let l=0,c=a.length;l<c;l++){const u=a[l];Object.keys(s).forEach(h=>{var d;(e===j||e===h)&&((d=s[h])[u]||(d[u]=[...pe(n[h],u)||pe(n[j],u)||[]]),s[h][u].push([r,i-c+l+1]))})}}buildAllMatchers(){const e=Object.create(null);return Object.keys(f(this,ee)).concat(Object.keys(f(this,Q))).forEach(t=>{e[t]||(e[t]=S(this,lt,Sr).call(this,t))}),E(this,Q,E(this,ee,void 0)),kn(),e}},Q=new WeakMap,ee=new WeakMap,lt=new WeakSet,Sr=function(e){const t=[];let r=e===j;return[f(this,Q),f(this,ee)].forEach(n=>{const s=n[e]?Object.keys(n[e]).map(i=>[i,n[e][i]]):[];s.length!==0?(r||(r=!0),t.push(...s)):e!==j&&t.push(...Object.keys(n[j]).map(i=>[i,n[j][i]]))}),r?jn(t):null},Qt),te,V,er,$n=(er=class{constructor(e){m(this,"name","SmartRouter");A(this,te,[]);A(this,V,[]);E(this,te,e.routers)}add(e,t,r){if(!f(this,V))throw new Error(br);f(this,V).push([e,t,r])}match(e,t){if(!f(this,V))throw new Error("Fatal error");const r=f(this,te),n=f(this,V),s=r.length;let i=0,a;for(;i<s;i++){const o=r[i];try{for(let l=0,c=n.length;l<c;l++)o.add(...n[l]);a=o.match(e,t)}catch(l){if(l instanceof xr)continue;throw l}this.match=o.match.bind(o),E(this,te,[o]),E(this,V,void 0);break}if(i===s)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(f(this,V)||f(this,te).length!==1)throw new Error("No active router has been determined yet.");return f(this,te)[0]}},te=new WeakMap,V=new WeakMap,er),ke=Object.create(null),re,N,fe,Re,$,J,ae,Oe,Nn=(Oe=class{constructor(t,r,n){A(this,J);A(this,re);A(this,N);A(this,fe);A(this,Re,0);A(this,$,ke);if(E(this,N,n||Object.create(null)),E(this,re,[]),t&&r){const s=Object.create(null);s[t]={handler:r,possibleKeys:[],score:0},E(this,re,[s])}E(this,fe,[])}insert(t,r,n){E(this,Re,++Mt(this,Re)._);let s=this;const i=cn(r),a=[];for(let o=0,l=i.length;o<l;o++){const c=i[o],u=i[o+1],h=hn(c,u),d=Array.isArray(h)?h[0]:c;if(d in f(s,N)){s=f(s,N)[d],h&&a.push(h[1]);continue}f(s,N)[d]=new Oe,h&&(f(s,fe).push(h),a.push(h[1])),s=f(s,N)[d]}return f(s,re).push({[t]:{handler:n,possibleKeys:a.filter((o,l,c)=>c.indexOf(o)===l),score:f(this,Re)}}),s}search(t,r){var l;const n=[];E(this,$,ke);let i=[this];const a=dr(r),o=[];for(let c=0,u=a.length;c<u;c++){const h=a[c],d=c===u-1,p=[];for(let y=0,w=i.length;y<w;y++){const g=i[y],x=f(g,N)[h];x&&(E(x,$,f(g,$)),d?(f(x,N)["*"]&&n.push(...S(this,J,ae).call(this,f(x,N)["*"],t,f(g,$))),n.push(...S(this,J,ae).call(this,x,t,f(g,$)))):p.push(x));for(let b=0,O=f(g,fe).length;b<O;b++){const R=f(g,fe)[b],C=f(g,$)===ke?{}:{...f(g,$)};if(R==="*"){const L=f(g,N)["*"];L&&(n.push(...S(this,J,ae).call(this,L,t,f(g,$))),E(L,$,C),p.push(L));continue}const[W,H,P]=R;if(!h&&!(P instanceof RegExp))continue;const k=f(g,N)[W],se=a.slice(c).join("/");if(P instanceof RegExp){const L=P.exec(se);if(L){if(C[H]=L[0],n.push(...S(this,J,ae).call(this,k,t,f(g,$),C)),Object.keys(f(k,N)).length){E(k,$,C);const de=((l=L[0].match(/\//))==null?void 0:l.length)??0;(o[de]||(o[de]=[])).push(k)}continue}}(P===!0||P.test(h))&&(C[H]=h,d?(n.push(...S(this,J,ae).call(this,k,t,C,f(g,$))),f(k,N)["*"]&&n.push(...S(this,J,ae).call(this,f(k,N)["*"],t,C,f(g,$)))):(E(k,$,C),p.push(k)))}}i=p.concat(o.shift()??[])}return n.length>1&&n.sort((c,u)=>c.score-u.score),[n.map(({handler:c,params:u})=>[c,u])]}},re=new WeakMap,N=new WeakMap,fe=new WeakMap,Re=new WeakMap,$=new WeakMap,J=new WeakSet,ae=function(t,r,n,s){const i=[];for(let a=0,o=f(t,re).length;a<o;a++){const l=f(t,re)[a],c=l[r]||l[j],u={};if(c!==void 0&&(c.params=Object.create(null),i.push(c),n!==ke||s&&s!==ke))for(let h=0,d=c.possibleKeys.length;h<d;h++){const p=c.possibleKeys[h],y=u[c.score];c.params[p]=s!=null&&s[p]&&!y?s[p]:n[p]??(s==null?void 0:s[p]),u[c.score]=!0}}return i},Oe),ue,tr,Hn=(tr=class{constructor(){m(this,"name","TrieRouter");A(this,ue);E(this,ue,new Nn)}add(e,t,r){const n=vr(t);if(n){for(let s=0,i=n.length;s<i;s++)f(this,ue).insert(e,n[s],r);return}f(this,ue).insert(e,t,r)}match(e,t){return f(this,ue).search(e,t)}},ue=new WeakMap,tr),Pr=class extends An{constructor(e={}){super(e),this.router=e.router??new $n({routers:[new Mn,new Hn]})}},Dn=e=>{const r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},n=(i=>typeof i=="string"?i==="*"?()=>i:a=>i===a?a:null:typeof i=="function"?i:a=>i.includes(a)?a:null)(r.origin),s=(i=>typeof i=="function"?i:Array.isArray(i)?()=>i:()=>[])(r.allowMethods);return async function(a,o){var u;function l(h,d){a.res.headers.set(h,d)}const c=await n(a.req.header("origin")||"",a);if(c&&l("Access-Control-Allow-Origin",c),r.credentials&&l("Access-Control-Allow-Credentials","true"),(u=r.exposeHeaders)!=null&&u.length&&l("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),a.req.method==="OPTIONS"){r.origin!=="*"&&l("Vary","Origin"),r.maxAge!=null&&l("Access-Control-Max-Age",r.maxAge.toString());const h=await s(a.req.header("origin")||"",a);h.length&&l("Access-Control-Allow-Methods",h.join(","));let d=r.allowHeaders;if(!(d!=null&&d.length)){const p=a.req.header("Access-Control-Request-Headers");p&&(d=p.split(/\s*,\s*/))}return d!=null&&d.length&&(l("Access-Control-Allow-Headers",d.join(",")),a.res.headers.append("Vary","Access-Control-Request-Headers")),a.res.headers.delete("Content-Length"),a.res.headers.delete("Content-Type"),new Response(null,{headers:a.res.headers,status:204,statusText:"No Content"})}await o(),r.origin!=="*"&&a.header("Vary","Origin",{append:!0})}},He="_hp",Ln={Change:"Input",DoubleClick:"DblClick"},In={svg:"2000/svg",math:"1998/Math/MathML"},De=[],xt=new WeakMap,Pe=void 0,_n=()=>Pe,K=e=>"t"in e,pt={onClick:["click",!1]},Bt=e=>{if(!e.startsWith("on"))return;if(pt[e])return pt[e];const t=e.match(/^on([A-Z][a-zA-Z]+?(?:PointerCapture)?)(Capture)?$/);if(t){const[,r,n]=t;return pt[e]=[(Ln[r]||r).toLowerCase(),!!n]}},qt=(e,t)=>Pe&&e instanceof SVGElement&&/[A-Z]/.test(t)&&(t in e.style||t.match(/^(?:o|pai|str|u|ve)/))?t.replace(/([A-Z])/g,"-$1").toLowerCase():t,Fn=(e,t,r)=>{var n;t||(t={});for(let s in t){const i=t[s];if(s!=="children"&&(!r||r[s]!==i)){s=it(s);const a=Bt(s);if(a){if((r==null?void 0:r[s])!==i&&(r&&e.removeEventListener(a[0],r[s],a[1]),i!=null)){if(typeof i!="function")throw new Error(`Event handler for "${s}" is not a function`);e.addEventListener(a[0],i,a[1])}}else if(s==="dangerouslySetInnerHTML"&&i)e.innerHTML=i.__html;else if(s==="ref"){let o;typeof i=="function"?o=i(e)||(()=>i(null)):i&&"current"in i&&(i.current=e,o=()=>i.current=null),xt.set(e,o)}else if(s==="style"){const o=e.style;typeof i=="string"?o.cssText=i:(o.cssText="",i!=null&&ur(i,o.setProperty.bind(o)))}else{if(s==="value"){const l=e.nodeName;if(l==="INPUT"||l==="TEXTAREA"||l==="SELECT"){if(e.value=i==null||i===!1?null:i,l==="TEXTAREA"){e.textContent=i;continue}else if(l==="SELECT"){e.selectedIndex===-1&&(e.selectedIndex=0);continue}}}else(s==="checked"&&e.nodeName==="INPUT"||s==="selected"&&e.nodeName==="OPTION")&&(e[s]=i);const o=qt(e,s);i==null||i===!1?e.removeAttribute(o):i===!0?e.setAttribute(o,""):typeof i=="string"||typeof i=="number"?e.setAttribute(o,i):e.setAttribute(o,i.toString())}}}if(r)for(let s in r){const i=r[s];if(s!=="children"&&!(s in t)){s=it(s);const a=Bt(s);a?e.removeEventListener(a[0],i,a[1]):s==="ref"?(n=xt.get(e))==null||n():e.removeAttribute(qt(e,s))}}},Bn=(e,t)=>{t[T][0]=0,De.push([e,t]);const r=t.tag[Rt]||t.tag,n=r.defaultProps?{...r.defaultProps,...t.props}:t.props;try{return[r.call(null,n)]}finally{De.pop()}},Cr=(e,t,r,n,s)=>{var i,a;(i=e.vR)!=null&&i.length&&(n.push(...e.vR),delete e.vR),typeof e.tag=="function"&&((a=e[T][1][Mr])==null||a.forEach(o=>s.push(o))),e.vC.forEach(o=>{var l;if(K(o))r.push(o);else if(typeof o.tag=="function"||o.tag===""){o.c=t;const c=r.length;if(Cr(o,t,r,n,s),o.s){for(let u=c;u<r.length;u++)r[u].s=!0;o.s=!1}}else r.push(o),(l=o.vR)!=null&&l.length&&(n.push(...o.vR),delete o.vR)})},qn=e=>{for(;;e=e.tag===He||!e.vC||!e.pP?e.nN:e.vC[0]){if(!e)return null;if(e.tag!==He&&e.e)return e.e}},Tr=e=>{var t,r,n,s,i,a;K(e)||((r=(t=e[T])==null?void 0:t[1][Mr])==null||r.forEach(o=>{var l;return(l=o[2])==null?void 0:l.call(o)}),(n=xt.get(e.e))==null||n(),e.p===2&&((s=e.vC)==null||s.forEach(o=>o.p=2)),(i=e.vC)==null||i.forEach(Tr)),e.p||((a=e.e)==null||a.remove(),delete e.e),typeof e.tag=="function"&&(je.delete(e),rt.delete(e),delete e[T][3],e.a=!0)},kr=(e,t,r)=>{e.c=t,jr(e,t,r)},Ut=(e,t)=>{if(t){for(let r=0,n=e.length;r<n;r++)if(e[r]===t)return r}},Wt=Symbol(),jr=(e,t,r)=>{var c;const n=[],s=[],i=[];Cr(e,t,n,s,i),s.forEach(Tr);const a=r?void 0:t.childNodes;let o,l=null;if(r)o=-1;else if(!a.length)o=0;else{const u=Ut(a,qn(e.nN));u!==void 0?(l=a[u],o=u):o=Ut(a,(c=n.find(h=>h.tag!==He&&h.e))==null?void 0:c.e)??-1,o===-1&&(r=!0)}for(let u=0,h=n.length;u<h;u++,o++){const d=n[u];let p;if(d.s&&d.e)p=d.e,d.s=!1;else{const y=r||!d.e;K(d)?(d.e&&d.d&&(d.e.textContent=d.t),d.d=!1,p=d.e||(d.e=document.createTextNode(d.t))):(p=d.e||(d.e=d.n?document.createElementNS(d.n,d.tag):document.createElement(d.tag)),Fn(p,d.props,d.pP),jr(d,p,y))}d.tag===He?o--:r?p.parentNode||t.appendChild(p):a[o]!==p&&a[o-1]!==p&&(a[o+1]===p?t.appendChild(a[o]):t.insertBefore(p,l||a[o]||null))}if(e.pP&&delete e.pP,i.length){const u=[],h=[];i.forEach(([,d,,p,y])=>{d&&u.push(d),p&&h.push(p),y==null||y()}),u.forEach(d=>d()),h.length&&requestAnimationFrame(()=>{h.forEach(d=>d())})}},Un=(e,t)=>!!(e&&e.length===t.length&&e.every((r,n)=>r[1]===t[n][1])),rt=new WeakMap,At=(e,t,r)=>{var i,a,o,l,c,u;const n=!r&&t.pC;r&&(t.pC||(t.pC=t.vC));let s;try{r||(r=typeof t.tag=="function"?Bn(e,t):Ue(t.props.children)),((i=r[0])==null?void 0:i.tag)===""&&r[0][wt]&&(s=r[0][wt],e[5].push([e,s,t]));const h=n?[...t.pC]:t.vC?[...t.vC]:void 0,d=[];let p;for(let y=0;y<r.length;y++){Array.isArray(r[y])&&r.splice(y,1,...r[y].flat());let w=Wn(r[y]);if(w){typeof w.tag=="function"&&!w.tag[ar]&&(Se.length>0&&(w[T][2]=Se.map(x=>[x,x.values.at(-1)])),(a=e[5])!=null&&a.length&&(w[T][3]=e[5].at(-1)));let g;if(h&&h.length){const x=h.findIndex(K(w)?b=>K(b):w.key!==void 0?b=>b.key===w.key&&b.tag===w.tag:b=>b.tag===w.tag);x!==-1&&(g=h[x],h.splice(x,1))}if(g)if(K(w))g.t!==w.t&&(g.t=w.t,g.d=!0),w=g;else{const x=g.pP=g.props;if(g.props=w.props,g.f||(g.f=w.f||t.f),typeof w.tag=="function"){const b=g[T][2];g[T][2]=w[T][2]||[],g[T][3]=w[T][3],!g.f&&((g.o||g)===w.o||(l=(o=g.tag)[qr])!=null&&l.call(o,x,g.props))&&Un(b,g[T][2])&&(g.s=!0)}w=g}else if(!K(w)&&Pe){const x=Ce(Pe);x&&(w.n=x)}if(!K(w)&&!w.s&&(At(e,w),delete w.f),d.push(w),p&&!p.s&&!w.s)for(let x=p;x&&!K(x);x=(c=x.vC)==null?void 0:c.at(-1))x.nN=w;p=w}}t.vR=n?[...t.vC,...h||[]]:h||[],t.vC=d,n&&delete t.pC}catch(h){if(t.f=!0,h===Wt){if(s)return;throw h}const[d,p,y]=((u=t[T])==null?void 0:u[3])||[];if(p){const w=()=>nt([0,!1,e[2]],y),g=rt.get(y)||[];g.push(w),rt.set(y,g);const x=p(h,()=>{const b=rt.get(y);if(b){const O=b.indexOf(w);if(O!==-1)return b.splice(O,1),w()}});if(x){if(e[0]===1)e[1]=!0;else if(At(e,y,[x]),(p.length===1||e!==d)&&y.c){kr(y,y.c,!1);return}throw Wt}}throw h}finally{s&&e[5].pop()}},Wn=e=>{if(!(e==null||typeof e=="boolean")){if(typeof e=="string"||typeof e=="number")return{t:e.toString(),d:!0};if("vR"in e&&(e={tag:e.tag,props:e.props,key:e.key,f:e.f,type:e.tag,ref:e.props.ref,o:e.o||e}),typeof e.tag=="function")e[T]=[0,[]];else{const t=In[e.tag];t&&(Pe||(Pe=lr("")),e.props.children=[{tag:Pe,props:{value:e.n=`http://www.w3.org/${t}`,children:e.props.children}}])}return e}},Kt=(e,t)=>{var r,n;(r=t[T][2])==null||r.forEach(([s,i])=>{s.values.push(i)});try{At(e,t,void 0)}catch{return}if(t.a){delete t.a;return}(n=t[T][2])==null||n.forEach(([s])=>{s.values.pop()}),(e[0]!==1||!e[1])&&kr(t,t.c,!1)},je=new WeakMap,zt=[],nt=async(e,t)=>{e[5]||(e[5]=[]);const r=je.get(t);r&&r[0](void 0);let n;const s=new Promise(i=>n=i);if(je.set(t,[n,()=>{e[2]?e[2](e,t,i=>{Kt(i,t)}).then(()=>n(t)):(Kt(e,t),n(t))}]),zt.length)zt.at(-1).add(t);else{await Promise.resolve();const i=je.get(t);i&&(je.delete(t),i[1]())}return s},Kn=(e,t,r)=>({tag:He,props:{children:e},key:r,e:t,p:1}),vt=0,Mr=1,gt=2,yt=3,mt=new WeakMap,$r=(e,t)=>!e||!t||e.length!==t.length||t.some((r,n)=>r!==e[n]),zn=void 0,Gt=[],Gn=e=>{var a;const t=()=>typeof e=="function"?e():e,r=De.at(-1);if(!r)return[t(),()=>{}];const[,n]=r,s=(a=n[T][1])[vt]||(a[vt]=[]),i=n[T][0]++;return s[i]||(s[i]=[t(),o=>{const l=zn,c=s[i];if(typeof o=="function"&&(o=o(c[0])),!Object.is(o,c[0]))if(c[0]=o,Gt.length){const[u,h]=Gt.at(-1);Promise.all([u===3?n:nt([u,!1,l],n),h]).then(([d])=>{if(!d||!(u===2||u===3))return;const p=d.vC;requestAnimationFrame(()=>{setTimeout(()=>{p===d.vC&&nt([u===3?1:0,!1,l],d)})})})}else nt([0,!1,l],n)}])},Tt=(e,t)=>{var o;const r=De.at(-1);if(!r)return e;const[,n]=r,s=(o=n[T][1])[gt]||(o[gt]=[]),i=n[T][0]++,a=s[i];return $r(a==null?void 0:a[1],t)?s[i]=[e,t]:e=s[i][0],e},Vn=e=>{const t=mt.get(e);if(t){if(t.length===2)throw t[1];return t[0]}throw e.then(r=>mt.set(e,[r]),r=>mt.set(e,[void 0,r])),e},Jn=(e,t)=>{var o;const r=De.at(-1);if(!r)return e();const[,n]=r,s=(o=n[T][1])[yt]||(o[yt]=[]),i=n[T][0]++,a=s[i];return $r(a==null?void 0:a[1],t)&&(s[i]=[e(),t]),s[i][0]},Xn=lr({pending:!1,data:null,method:null,action:null}),Vt=new Set,Yn=e=>{Vt.add(e),e.finally(()=>Vt.delete(e))},kt=(e,t)=>Jn(()=>r=>{let n;e&&(typeof e=="function"?n=e(r)||(()=>{e(null)}):e&&"current"in e&&(e.current=r,n=()=>{e.current=null}));const s=t(r);return()=>{s==null||s(),n==null||n()}},[e]),ve=Object.create(null),Je=Object.create(null),ze=(e,t,r,n,s)=>{if(t!=null&&t.itemProp)return{tag:e,props:t,type:e,ref:t.ref};const i=document.head;let{onLoad:a,onError:o,precedence:l,blocking:c,...u}=t,h=null,d=!1;const p=Xe[e];let y;if(p.length>0){const b=i.querySelectorAll(e);e:for(const O of b)for(const R of Xe[e])if(O.getAttribute(R)===t[R]){h=O;break e}if(!h){const O=p.reduce((R,C)=>t[C]===void 0?R:`${R}-${C}-${t[C]}`,e);d=!Je[O],h=Je[O]||(Je[O]=(()=>{const R=document.createElement(e);for(const C of p)t[C]!==void 0&&R.setAttribute(C,t[C]),t.rel&&R.setAttribute("rel",t.rel);return R})())}}else y=i.querySelectorAll(e);l=n?l??"":void 0,n&&(u[Ye]=l);const w=Tt(b=>{if(p.length>0){let O=!1;for(const R of i.querySelectorAll(e)){if(O&&R.getAttribute(Ye)!==l){i.insertBefore(b,R);return}R.getAttribute(Ye)===l&&(O=!0)}i.appendChild(b)}else if(y){let O=!1;for(const R of y)if(R===b){O=!0;break}O||i.insertBefore(b,i.contains(y[0])?y[0]:i.querySelector(e)),y=void 0}},[l]),g=kt(t.ref,b=>{var C;const O=p[0];if(r===2&&(b.innerHTML=""),(d||y)&&w(b),!o&&!a)return;let R=ve[C=b.getAttribute(O)]||(ve[C]=new Promise((W,H)=>{b.addEventListener("load",W),b.addEventListener("error",H)}));a&&(R=R.then(a)),o&&(R=R.catch(o)),R.catch(()=>{})});if(s&&c==="render"){const b=Xe[e][0];if(t[b]){const O=t[b],R=ve[O]||(ve[O]=new Promise((C,W)=>{w(h),h.addEventListener("load",C),h.addEventListener("error",W)}));Vn(R)}}const x={tag:e,type:e,props:{...u,ref:g},ref:g};return x.p=r,h&&(x.e=h),Kn(x,i)},Zn=e=>{const t=_n(),r=t&&Ce(t);return r!=null&&r.endsWith("svg")?{tag:"title",props:e,type:"title",ref:e.ref}:ze("title",e,void 0,!1,!1)},Qn=e=>!e||["src","async"].some(t=>!e[t])?{tag:"script",props:e,type:"script",ref:e.ref}:ze("script",e,1,!1,!0),es=e=>!e||!["href","precedence"].every(t=>t in e)?{tag:"style",props:e,type:"style",ref:e.ref}:(e["data-href"]=e.href,delete e.href,ze("style",e,2,!0,!0)),ts=e=>!e||["onLoad","onError"].some(t=>t in e)||e.rel==="stylesheet"&&(!("precedence"in e)||"disabled"in e)?{tag:"link",props:e,type:"link",ref:e.ref}:ze("link",e,1,"precedence"in e,!0),rs=e=>ze("meta",e,void 0,!1,!1),Nr=Symbol(),ns=e=>{const{action:t,...r}=e;typeof t!="function"&&(r.action=t);const[n,s]=Gn([null,!1]),i=Tt(async c=>{const u=c.isTrusted?t:c.detail[Nr];if(typeof u!="function")return;c.preventDefault();const h=new FormData(c.target);s([h,!0]);const d=u(h);d instanceof Promise&&(Yn(d),await d),s([null,!0])},[]),a=kt(e.ref,c=>(c.addEventListener("submit",i),()=>{c.removeEventListener("submit",i)})),[o,l]=n;return n[1]=!1,{tag:Xn,props:{value:{pending:o!==null,data:o,method:o?"post":null,action:o?t:null},children:{tag:"form",props:{...r,ref:a},type:"form",ref:a}},f:l}},Hr=(e,{formAction:t,...r})=>{if(typeof t=="function"){const n=Tt(s=>{s.preventDefault(),s.currentTarget.form.dispatchEvent(new CustomEvent("submit",{detail:{[Nr]:t}}))},[]);r.ref=kt(r.ref,s=>(s.addEventListener("click",n),()=>{s.removeEventListener("click",n)}))}return{tag:e,props:r,type:e,ref:r.ref}},ss=e=>Hr("input",e),is=e=>Hr("button",e);Object.assign(Et,{title:Zn,script:Qn,style:es,link:ts,meta:rs,form:ns,input:ss,button:is});Ot(null);new TextEncoder;var as=Ot(null),os=(e,t,r,n)=>(s,i)=>{const a="<!DOCTYPE html>",o=r?Dt(c=>r(c,e),{Layout:t,...i},s):s,l=Br`${_(a)}${Dt(as.Provider,{value:e},o)}`;return e.html(l)},ls=(e,t)=>function(n,s){const i=n.getLayout()??tn;return e&&n.setLayout(a=>e({...a,Layout:i},n)),n.setRenderer(os(n,i,e)),s()};const cs=ls(({children:e})=>v("html",{lang:"ru",children:[v("head",{children:[v("meta",{charset:"UTF-8"}),v("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),v("title",{children:"Virtual Try-On - Виртуальная примерочная"}),v("link",{href:"/static/style.css",rel:"stylesheet"})]}),v("body",{children:e})]})),Ge=new Pr;Ge.use("/api/*",Dn());Ge.use(cs);Ge.get("/",e=>e.render(v("div",{children:[v("section",{id:"hero",class:"hero-section",children:v("div",{class:"hero-content",children:[v("video",{autoplay:!0,muted:!0,loop:!0,playsinline:!0,class:"hero-video",children:v("source",{src:"/static/hero-video.mp4",type:"video/mp4"})}),v("div",{class:"hero-overlay",children:[v("h1",{class:"hero-title",children:"Virtual Try-On"}),v("p",{class:"hero-subtitle",children:"Попробуйте любую одежду виртуально"}),v("div",{class:"scroll-indicator",children:[v("span",{children:"Прокрутите вниз"}),v("div",{class:"arrow-down"})]})]})]})}),v("section",{id:"tryon",class:"tryon-section",children:v("div",{class:"container",children:[v("h2",{class:"section-title",children:"Виртуальная примерочная"}),v("p",{class:"section-description",children:"Загрузите свое фото и фото одежды, которую хотите примерить"}),v("div",{class:"upload-container",children:[v("div",{class:"upload-box",children:[v("div",{class:"upload-area",id:"photo-upload",children:[v("input",{type:"file",id:"photo-input",accept:"image/*",style:"display: none;"}),v("div",{class:"upload-placeholder",children:[v("svg",{class:"upload-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:v("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),v("p",{children:"Ваше фото"}),v("span",{children:"Нажмите для загрузки"})]}),v("img",{id:"photo-preview",class:"image-preview",style:"display: none;"})]}),v("p",{class:"upload-label",children:"Фото человека"})]}),v("div",{class:"plus-icon",children:"+"}),v("div",{class:"upload-box",children:[v("div",{class:"upload-area",id:"outfit-upload",children:[v("input",{type:"file",id:"outfit-input",accept:"image/*",style:"display: none;"}),v("div",{class:"upload-placeholder",children:[v("svg",{class:"upload-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:v("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})}),v("p",{children:"Фото одежды"}),v("span",{children:"Нажмите для загрузки"})]}),v("img",{id:"outfit-preview",class:"image-preview",style:"display: none;"})]}),v("p",{class:"upload-label",children:"Одежда для примерки"})]}),v("div",{class:"equals-icon",children:"="}),v("div",{class:"upload-box",children:[v("div",{class:"result-area",id:"result-area",children:[v("div",{class:"result-placeholder",children:[v("svg",{class:"result-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:v("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5"})}),v("p",{children:"Результат"}),v("span",{children:"Появится здесь"})]}),v("img",{id:"result-preview",class:"image-preview",style:"display: none;"}),v("div",{id:"loading-spinner",class:"loading-spinner",style:"display: none;",children:[v("div",{class:"spinner"}),v("p",{children:"Обрабатываем изображения..."})]})]}),v("p",{class:"upload-label",children:"Ваш новый образ"})]})]}),v("button",{id:"generate-btn",class:"generate-btn",disabled:!0,children:"Создать образ"}),v("div",{id:"error-message",class:"error-message",style:"display: none;"})]})}),v("script",{src:"/static/app.js"})]})));Ge.post("/api/tryon",async e=>{var t,r,n,s,i,a,o,l;try{const c=await e.req.formData(),u=c.get("photo"),h=c.get("outfit");if(!u||!h)return e.json({error:"Требуются оба изображения"},400);const d=e.env.GATEWAY_URL,p=e.env.GATEWAY_TOKEN;if(!d||!p)return e.json({error:"Gateway не настроен",message:"Установите GATEWAY_URL и GATEWAY_TOKEN в переменных окружения."},500);const y=async P=>{const k=await P.arrayBuffer(),se=new Uint8Array(k);let L="";const de=8192;for(let Te=0;Te<se.length;Te+=de){const Lr=se.slice(Te,Math.min(Te+de,se.length));L+=String.fromCharCode(...Lr)}return btoa(L)},w=await y(u),g=await y(h);console.log("Step 1: Describing outfit from PHOTO B...");const b=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify({contents:[{parts:[{text:`Analyze this clothing image and provide a detailed JSON description.

Return ONLY valid JSON in this exact format:
{
  "garment_type": "type of clothing (e.g., dress, shirt, pants, jacket)",
  "color": "primary color(s)",
  "style": "style description (e.g., casual, formal, sporty, elegant)",
  "fit": "fit type (e.g., slim, loose, fitted, oversized)",
  "details": "notable features (e.g., buttons, patterns, sleeves, collar)"
}`},{inlineData:{mimeType:h.type,data:g}}]}],generationConfig:{temperature:.3,topK:32,topP:1}})});if(!b.ok){const P=await b.json();return console.error("Step 1 error:",P),e.json({error:"Ошибка Gateway (описание одежды)",message:"Не удалось описать одежду. Попробуйте другое изображение.",details:P},b.status)}const O=await b.json();let R='{"garment_type": "casual outfit", "color": "unknown", "style": "casual", "fit": "regular", "details": "none"}';try{if(O.candidates&&((r=(t=O.candidates[0])==null?void 0:t.content)!=null&&r.parts)){const P=O.candidates[0].content.parts.find(k=>k.text);if(P&&P.text){const k=P.text.match(/\{[\s\S]*\}/);k?(R=k[0],console.log("Extracted outfit description:",R)):(console.warn("No JSON found in response, using text as-is"),R=P.text)}}}catch(P){console.warn("Could not parse outfit description:",P)}console.log("Step 2: Generating virtual try-on image...");const C=`Virtual try-on task:

PHOTO A (Person): The person who will try on the outfit.
PHOTO B (Outfit): The target clothing to apply.

OUTFIT DESCRIPTION from PHOTO B:
${R}

TASK: Apply the outfit from PHOTO B onto the person from PHOTO A.

REQUIREMENTS:
- Keep the person's face, body shape, pose, and background EXACTLY the same
- Only change the clothing to match PHOTO B and its description
- Use the outfit description to ensure accuracy of garment type, color, style, fit, and details
- Make it look natural and realistic
- Maintain consistent lighting and shadows
- Preserve all body proportions
- Ensure the outfit fits the person's body naturally

Generate a photorealistic image showing the person wearing the new outfit.`,W=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify({contents:[{parts:[{text:C},{inlineData:{mimeType:u.type,data:w}},{inlineData:{mimeType:h.type,data:g}}]}],generationConfig:{responseModalities:["IMAGE"],temperature:.4,topK:32,topP:1}})});if(!W.ok){const P=await W.json();return console.error("Step 2 error:",P),e.json({error:"Ошибка Gateway (генерация изображения)",message:"Не удалось сгенерировать результат. Попробуйте позже.",details:P},W.status)}const H=await W.json();if(H.error)return console.error("Gemini API error:",H.error),e.json({error:"Ошибка API генерации изображений",message:"Сервис временно недоступен. Попробуйте позже.",details:H.error},500);if(H.candidates&&((n=H.candidates[0])!=null&&n.finishReason)){const P=H.candidates[0].finishReason;if(P==="SAFETY"||P==="BLOCKED_REASON")return e.json({error:"Контент заблокирован",message:"Изображения не прошли проверку безопасности. Попробуйте другие фото.",finishReason:P},400)}if(H.candidates&&((i=(s=H.candidates[0])==null?void 0:s.content)!=null&&i.parts)){for(const P of H.candidates[0].content.parts)if(P.inlineData){const k=P.inlineData.data,se=w.substring(0,100),L=k.substring(0,100);return se===L?e.json({error:"Результат идентичен входному изображению",message:"AI не смог обработать изображения корректно. Попробуйте другие фото или повторите позже.",warning:"same_as_input"},400):e.json({success:!0,image:`data:${P.inlineData.mimeType};base64,${k}`,outfitDescription:R})}}return e.json({error:"Не удалось получить результат",message:"Сервис не вернул изображение. Попробуйте позже.",details:H},500)}catch(c){console.error("Try-on error:",c);let u="Произошла ошибка при обработке изображений. Попробуйте позже.";return(a=c.message)!=null&&a.includes("fetch")?u="Не удалось подключиться к сервису AI. Проверьте подключение.":(o=c.message)!=null&&o.includes("timeout")?u="Превышено время ожидания. Попробуйте уменьшить размер изображений.":(l=c.message)!=null&&l.includes("stack")&&(u="Изображения слишком большие. Попробуйте меньшего размера (до 2MB)."),e.json({error:"Ошибка обработки",message:u,details:c.message,support:"Если проблема повторяется, попробуйте другие изображения или обратитесь к администратору."},500)}});const Jt=new Pr,fs=Object.assign({"/src/index.tsx":Ge});let Dr=!1;for(const[,e]of Object.entries(fs))e&&(Jt.all("*",t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),Jt.notFound(t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),Dr=!0);if(!Dr)throw new Error("Can't import modules from ['/src/index.ts','/src/index.tsx','/app/server.ts']");export{Jt as default};
